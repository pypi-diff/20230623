# Comparing `tmp/mariqt-0.4.4-py2.py3-none-any.whl.zip` & `tmp/mariqt-0.5.1-py2.py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,30 +1,33 @@
-Zip file size: 208071 bytes, number of entries: 28
--rw-r--r--  2.0 unx     5876 b- defN 23-May-12 14:13 mariqt/converters.py
--rw-r--r--  2.0 unx    12721 b- defN 23-May-12 14:13 mariqt/core.py
--rw-r--r--  2.0 unx     8485 b- defN 23-May-12 14:13 mariqt/directories.py
--rw-r--r--  2.0 unx      465 b- defN 23-May-12 14:13 mariqt/equipment.py
--rw-r--r--  2.0 unx    16541 b- defN 23-May-12 14:13 mariqt/files.py
--rw-r--r--  2.0 unx    27845 b- defN 23-May-12 14:13 mariqt/geo.py
--rw-r--r--  2.0 unx    23283 b- defN 23-May-12 14:13 mariqt/image.py
--rw-r--r--  2.0 unx     3064 b- defN 23-May-12 14:13 mariqt/misc.py
--rw-r--r--  2.0 unx    40059 b- defN 23-May-12 14:13 mariqt/navigation.py
--rw-r--r--  2.0 unx     7345 b- defN 23-May-12 14:13 mariqt/provenance.py
--rw-r--r--  2.0 unx    22316 b- defN 23-May-12 14:13 mariqt/reports.py
--rw-r--r--  2.0 unx     4294 b- defN 23-May-12 14:13 mariqt/settings.py
--rw-r--r--  2.0 unx    13762 b- defN 23-May-12 14:13 mariqt/tests.py
--rw-r--r--  2.0 unx    30040 b- defN 23-May-12 14:13 mariqt/variables.py
--rw-r--r--  2.0 unx       21 b- defN 23-May-12 14:13 mariqt/version.py
--rw-r--r--  2.0 unx    12135 b- defN 23-May-12 14:13 mariqt/sources/dship.py
--rw-r--r--  2.0 unx     4586 b- defN 23-May-12 14:13 mariqt/sources/dship_settings.py
--rw-r--r--  2.0 unx     2177 b- defN 23-May-12 14:13 mariqt/sources/elements.py
--rw-r--r--  2.0 unx   105112 b- defN 23-May-12 14:13 mariqt/sources/ifdo.py
--rw-r--r--  2.0 unx     5533 b- defN 23-May-12 14:13 mariqt/sources/ofop.py
--rw-r--r--  2.0 unx   650149 b- defN 23-May-12 14:13 mariqt/sources/svgs.py
--rw-r--r--  2.0 unx     3728 b- defN 23-May-12 14:13 mariqt/sources/underway.py
--rw-rw-rw-  2.0 unx      162 b- defN 23-May-12 14:14 mariqt-0.4.4.dist-info/AUTHORS.md
--rw-rw-rw-  2.0 unx    35140 b- defN 23-May-12 14:14 mariqt-0.4.4.dist-info/LICENSE
--rw-r--r--  2.0 unx     1133 b- defN 23-May-12 14:14 mariqt-0.4.4.dist-info/METADATA
--rw-r--r--  2.0 unx      110 b- defN 23-May-12 14:14 mariqt-0.4.4.dist-info/WHEEL
--rw-r--r--  2.0 unx        7 b- defN 23-May-12 14:14 mariqt-0.4.4.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2165 b- defN 23-May-12 14:14 mariqt-0.4.4.dist-info/RECORD
-28 files, 1038254 bytes uncompressed, 204687 bytes compressed:  80.3%
+Zip file size: 213367 bytes, number of entries: 31
+-rw-r--r--  2.0 unx     5876 b- defN 23-Jun-23 14:17 mariqt/converters.py
+-rw-r--r--  2.0 unx    14710 b- defN 23-Jun-23 14:17 mariqt/core.py
+-rw-r--r--  2.0 unx     8485 b- defN 23-Jun-23 14:17 mariqt/directories.py
+-rw-r--r--  2.0 unx      465 b- defN 23-Jun-23 14:17 mariqt/equipment.py
+-rw-r--r--  2.0 unx    16621 b- defN 23-Jun-23 14:17 mariqt/files.py
+-rw-r--r--  2.0 unx    27845 b- defN 23-Jun-23 14:17 mariqt/geo.py
+-rw-r--r--  2.0 unx    23207 b- defN 23-Jun-23 14:17 mariqt/image.py
+-rw-r--r--  2.0 unx     3090 b- defN 23-Jun-23 14:17 mariqt/misc.py
+-rw-r--r--  2.0 unx    40059 b- defN 23-Jun-23 14:17 mariqt/navigation.py
+-rw-r--r--  2.0 unx     7345 b- defN 23-Jun-23 14:17 mariqt/provenance.py
+-rw-r--r--  2.0 unx    22316 b- defN 23-Jun-23 14:17 mariqt/reports.py
+-rw-r--r--  2.0 unx     4376 b- defN 23-Jun-23 14:17 mariqt/settings.py
+-rw-r--r--  2.0 unx     8323 b- defN 23-Jun-23 14:17 mariqt/tests.py
+-rw-r--r--  2.0 unx     9613 b- defN 23-Jun-23 14:17 mariqt/variables.py
+-rw-r--r--  2.0 unx       21 b- defN 23-Jun-23 14:17 mariqt/version.py
+-rw-rw-rw-  2.0 unx     6175 b- defN 23-Jun-23 14:17 mariqt/resources/fair-marine-images/docs/schemas/annotation-v2.0.0.json
+-rw-rw-rw-  2.0 unx    42461 b- defN 23-Jun-23 14:17 mariqt/resources/fair-marine-images/docs/schemas/ifdo-v2.0.0.json
+-rw-rw-rw-  2.0 unx     3218 b- defN 23-Jun-23 14:17 mariqt/resources/fair-marine-images/docs/schemas/provenance-v0.1.0.json
+-rw-r--r--  2.0 unx    12135 b- defN 23-Jun-23 14:17 mariqt/sources/dship.py
+-rw-r--r--  2.0 unx     4586 b- defN 23-Jun-23 14:17 mariqt/sources/dship_settings.py
+-rw-r--r--  2.0 unx     2177 b- defN 23-Jun-23 14:17 mariqt/sources/elements.py
+-rw-r--r--  2.0 unx   112498 b- defN 23-Jun-23 14:17 mariqt/sources/ifdo.py
+-rw-r--r--  2.0 unx     5533 b- defN 23-Jun-23 14:17 mariqt/sources/ofop.py
+-rw-r--r--  2.0 unx   650149 b- defN 23-Jun-23 14:17 mariqt/sources/svgs.py
+-rw-r--r--  2.0 unx     3728 b- defN 23-Jun-23 14:17 mariqt/sources/underway.py
+-rw-rw-rw-  2.0 unx      162 b- defN 23-Jun-23 14:19 mariqt-0.5.1.dist-info/AUTHORS.md
+-rw-rw-rw-  2.0 unx    35140 b- defN 23-Jun-23 14:19 mariqt-0.5.1.dist-info/LICENSE
+-rw-r--r--  2.0 unx     1133 b- defN 23-Jun-23 14:19 mariqt-0.5.1.dist-info/METADATA
+-rw-r--r--  2.0 unx      110 b- defN 23-Jun-23 14:19 mariqt-0.5.1.dist-info/WHEEL
+-rw-r--r--  2.0 unx        7 b- defN 23-Jun-23 14:19 mariqt-0.5.1.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2542 b- defN 23-Jun-23 14:19 mariqt-0.5.1.dist-info/RECORD
+31 files, 1074106 bytes uncompressed, 209341 bytes compressed:  80.5%
```

## zipnote {}

```diff
@@ -39,14 +39,23 @@
 
 Filename: mariqt/variables.py
 Comment: 
 
 Filename: mariqt/version.py
 Comment: 
 
+Filename: mariqt/resources/fair-marine-images/docs/schemas/annotation-v2.0.0.json
+Comment: 
+
+Filename: mariqt/resources/fair-marine-images/docs/schemas/ifdo-v2.0.0.json
+Comment: 
+
+Filename: mariqt/resources/fair-marine-images/docs/schemas/provenance-v0.1.0.json
+Comment: 
+
 Filename: mariqt/sources/dship.py
 Comment: 
 
 Filename: mariqt/sources/dship_settings.py
 Comment: 
 
 Filename: mariqt/sources/elements.py
@@ -60,26 +69,26 @@
 
 Filename: mariqt/sources/svgs.py
 Comment: 
 
 Filename: mariqt/sources/underway.py
 Comment: 
 
-Filename: mariqt-0.4.4.dist-info/AUTHORS.md
+Filename: mariqt-0.5.1.dist-info/AUTHORS.md
 Comment: 
 
-Filename: mariqt-0.4.4.dist-info/LICENSE
+Filename: mariqt-0.5.1.dist-info/LICENSE
 Comment: 
 
-Filename: mariqt-0.4.4.dist-info/METADATA
+Filename: mariqt-0.5.1.dist-info/METADATA
 Comment: 
 
-Filename: mariqt-0.4.4.dist-info/WHEEL
+Filename: mariqt-0.5.1.dist-info/WHEEL
 Comment: 
 
-Filename: mariqt-0.4.4.dist-info/top_level.txt
+Filename: mariqt-0.5.1.dist-info/top_level.txt
 Comment: 
 
-Filename: mariqt-0.4.4.dist-info/RECORD
+Filename: mariqt-0.5.1.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## mariqt/core.py

```diff
@@ -3,14 +3,16 @@
 import hashlib
 import datetime
 import threading
 import time
 import ast
 import gc
 import copy
+import jsonschema
+from pprint import pprint
 
 import mariqt.variables as miqtv
 
 
 def assertExists(path):
 	""" Asserts that a file/folder exists and otherwise terminates the program"""
 	if not os.path.exists(path):
@@ -399,7 +401,69 @@
 	def __str__(self):
 		# stop PrintLoadingMsg if its still running
 		for obj in gc.get_objects():
 			if isinstance(obj, PrintLoadingMsg):
 				obj.stop()
 		return super().__str__()
 
+
+def jsonschmea_type_2_python_type(jsonschema_type:str):
+	""" convert json schema type string to python type """
+	if jsonschema_type == "string":
+		return str
+	elif jsonschema_type == "number":
+		return float
+	elif jsonschema_type == "integer":
+		return int
+	elif jsonschema_type == "array":
+		return list
+	elif jsonschema_type == "object":
+		return dict
+	
+
+def resolve_jsonschema(obj:dict,schema:dict,store:dict=None,resolver:jsonschema.RefResolver=None):
+	""" Return schema with all $refs resolved """
+	if resolver is None:
+		if store is None:
+			resolver = jsonschema.RefResolver.from_schema(schema)
+		else:
+			resolver = jsonschema.RefResolver.from_schema(schema,store=store)
+	
+	if isinstance(obj,dict):
+		ret = {}
+		resolved = {}
+		for key, val in obj.items():
+			if key == "$ref":
+				# local
+				resolved_ret = resolver.resolve(val)
+				# internal ref starts with #
+				if '#' in val and val.split('#')[0] == "":
+					resolved = resolved_ret[1]
+					resolved = resolve_jsonschema(resolved,schema,store,resolver)
+				# external ref
+				else:
+					url = resolved_ret[0]
+					# resolve complete external schema first
+					base_schema = resolver.resolve(url.split('#')[0])[1]
+					resolved_base_schema = resolve_jsonschema(base_schema,base_schema)
+					sub_resolver = jsonschema.RefResolver.from_schema(resolved_base_schema)
+					# resolve val on completely resolved external schema
+					resolved = sub_resolver.resolve(val)[1]
+			else:
+				ret[key] = resolve_jsonschema(val,schema,store,resolver)
+		ret.update(resolved)
+		return ret
+	
+	if isinstance(obj,list):
+		ret = []
+		for item in obj:
+			ret.append(resolve_jsonschema(item,schema,store,resolver))
+		return ret
+
+	# otherwise (string)
+	return obj
+	
+
+def get_ifdo_fields():
+    """ Returns field defs as dict """
+    ifdo_schema_resolved = resolve_jsonschema( miqtv.ifdo_schema,  miqtv.ifdo_schema, miqtv.schema_store)
+    return ifdo_schema_resolved["$defs"]["iFDO-fields"]["properties"]
```

## mariqt/files.py

```diff
@@ -318,15 +318,17 @@
 					converter = conv
 					break
 				# TODO notify if converter not found?
 			col_indcs[field] = {'index':col_indcs_orig[field],'converter':converter}
 
 	if key_col != "" and col_indcs[key_col] >= 0:
 		data = {}
+		line_nr = -1
 		for line in file:
+			line_nr += 1
 			# Skip comments within file
 			if line[0] == "#":
 				continue
 			try:
 				vals = tabFileColumnValues(line,col_indcs,col_separator,convert)
 				key = vals[key_col]
 				del vals[key_col]
@@ -336,15 +338,15 @@
 						data[key] = [data[key]]
 					data[key].append(vals)
 				else:
 					data[key] = vals
 			except Exception as e:
 				if graceful:
 					continue
-				raise e
+				raise Exception("line " + str(line_nr) + ": " + str(e)) 
 	else:
 		data = []
 		for line in file:
 			# Skip comments within file
 			if line[0] == "#":
 				continue
 			try:
```

## mariqt/image.py

```diff
@@ -515,21 +515,21 @@
 		# in case of video files there are list entries for different time stamps. Possibly also for the same time stamp, those are merged here
 		if isinstance(item,list):
 
 			for subItem in item:
 				if 'image-filename' not in subItem:
 					raise Exception("subitem",subItem,"does not contain a field 'image-filename'")
 				tmp_itemsDict = {subItem['image-filename']:subItem}
-				log = miqtc.recursivelyUpdateDicts(itemsDict, tmp_itemsDict, miqtv.ifdo_mutually_exclusive_fields)
+				log = miqtc.recursivelyUpdateDicts(itemsDict, tmp_itemsDict)
 
 		else:
 			if 'image-filename' not in item:
 				raise Exception("item",item,"does not contain a field 'image-filename'")
 			tmp_itemsDict = {item['image-filename']:item}
-			log = miqtc.recursivelyUpdateDicts(itemsDict, tmp_itemsDict, miqtv.ifdo_mutually_exclusive_fields)
+			log = miqtc.recursivelyUpdateDicts(itemsDict, tmp_itemsDict)
 	return itemsDict
 
 def createImageItemsListFromImageItemsDict(items:dict):
 	""" Creates from a dict of item dicts a list of dicts with the 'image-filename' value becoming an item field again """
 	itemsList = []
 	for item in items:
 		if isinstance(items[item],list):
```

## mariqt/misc.py

```diff
@@ -1,11 +1,11 @@
 
 
-def iFDOFieldDefinitionFromMarkdownTableToDictStr(mdFile:str, altFields:dict={'image-depth':['image-altitude'],'image-altitude':['image-depth']}):
-	""" reads field defintions from tables in markdown files and return str to create dict in variables.py"""
+def iFDOFieldDefinitionFromMarkdownTableToDictStr(mdFile:str, altFields:dict={'image-depth':['image-altitude-meters'],'image-altitude-meters':['image-depth']}):
+	""" DEPRECATED! reads field defintions from tables in markdown files and return str to create dict in variables.py"""
 	retStrs = []
 	retDict ={}
 	with open(mdFile,'r') as f:
 		content = f.readlines()
 	for line in content:
 		fields = line.split('|')
 		if len(fields) >= 3:
```

## mariqt/settings.py

```diff
@@ -1,9 +1,10 @@
 import os
 import json
+import copy
 try:
 	import yaml
 except ModuleNotFoundError as er:
     raise ModuleNotFoundError(str(er.args) + "\n Install with e.g. $ pip install pyyaml")
 
 
 def parseReplaceVal(cfg:dict,key:str):
@@ -12,17 +13,20 @@
 		raise Exception("key",key,"not in", cfg)
 
 	val = cfg[key]
 	if isinstance(val,dict) or isinstance(val,list) or isinstance(val,int) or isinstance(val,float):
 		return val
 	vals = val.split("___")
 	for i in range(1,len(vals),2):
-		if not vals[i].lower() in cfg:
-			raise Exception("key",vals[i].lower(),"referenced in field",key,"not in", cfg)
-		val = val.replace("___"+vals[i]+"___",cfg[vals[i].lower()])
+		insert = copy.deepcopy(cfg)
+		for key_i in vals[i].lower().split(':'):
+			if not key_i in insert:
+				raise Exception("key",key_i,"referenced in field",key,"not in", cfg)
+			insert = insert[key_i]
+		val = val.replace("___"+vals[i]+"___",insert)
 	return val
 
 
 class Settings:
 
 	def __init__(self,params:dict = {},path:str = "",default:bool = False,project:str = ""):
```

## mariqt/tests.py

```diff
@@ -1,35 +1,67 @@
 """ This file contains various validation functions to check whether given parameters adhere to the MareHub AG V/I conventions"""
 
 import os
 import datetime
 import copy
+import jsonschema
 
 import mariqt.variables as miqtv
 import mariqt.directories as miqtd
 import mariqt.core as miqtc
 import mariqt.image as miqti
 
-def isValidPerson(o:dict,msg=[]):
-	""" Checks whether the dict contains the fields needed to identify a person"""
-	if not isinstance(o,dict):
-		msg.append("person is not a dict")
-		return False
-	req = miqtv.req_person_fields
-	for r in req:
-		if not r in o or o[r] == "":
-			continue
+# def isValidPerson(o:dict,msg=[]):
+# 	""" Checks whether the dict contains the fields needed to identify a person"""
+# 	if not isinstance(o,dict):
+# 		msg.append("person is not a dict")
+# 		return False
+# 	req = miqtv.req_person_fields
+# 	for r in req:
+# 		if not r in o or o[r] == "":
+# 			continue
 		
-		if r == "email" and not isValidEmail(o[r]):
-			msg.append("invalid email")
-			return False
-		if r == "orcid" and not isValidOrcid(o[r]):
-			msg.append("invalid orcid")
-			return False
-	return True
+# 		if r == "email" and not isValidEmail(o[r]):
+# 			msg.append("invalid email")
+# 			return False
+# 		if r == "orcid" and not isValidOrcid(o[r]):
+# 			msg.append("invalid orcid")
+# 			return False
+# 	return True
+
+def validate_ifdo(ifdo:dict,short_msg=True):
+	""" Validate ifdo against schema 
+	Returns valid:bool, message:str """
+	return validate_against_schema(ifdo,schema=miqtv.ifdo_schema,short_msg=short_msg,store=miqtv.schema_store)
+
+
+def validate_against_schema(obj:dict,schema:dict,short_msg=True, store=None):
+	""" validate ifdo aginst json schema.
+	Returns valid:bool, message:str """
+	try:
+		if store is None:
+			jsonschema.validate(instance=obj, 
+								schema=schema,
+								format_checker= jsonschema.FormatChecker())
+			return True, ''
+
+		else:
+			resolver = jsonschema.RefResolver.from_schema(schema,store=store)
+			jsonschema.validate(instance=obj, 
+								schema=schema,
+								format_checker= jsonschema.FormatChecker(),
+								resolver=resolver)
+			return True, ''
+	except jsonschema.ValidationError as ex:
+		if short_msg:
+			msg = ' -> '.join([str(e) for e in list(ex.path)]) + ": " + str(ex)[0:str(ex).find("\n\n")]
+		else:
+			msg = str(ex)
+		#print(ex)
+		return False, msg
 
 
 def isValidDatapath(path:str):
 	""" Check whether a path leads to a proper leaf data folder (raw, processed, etc.)"""
 	try:
 		d = miqtd.Dir(path)
 		return d.validDataDir()
@@ -113,242 +145,57 @@
 		miqtc.parseFileDateTimeAsUTC(name)
 	except:
 		return [False,"cannot parse date time"]
 
 	return [True, ""]
 
 
-def isValidiFDOField(field,value,fieldDefinition=miqtv.ifdo_fields):
-	""" Tries to parse value to field's dataType and throws exception if it does not succeed """
-	
-	if 'valid' in fieldDefinition[field] and value not in fieldDefinition[field]['valid']:
-		raise miqtc.IfdoException(field+": value \"" + str(value) + "\" not in " + str(fieldDefinition[field]['valid']))
-	elif field in ['image-filename']:
-		if not isValidImageName(value)[0]:
-			raise miqtc.IfdoException('Invalid item name',str(value),isValidImageName(value)[1])
-	elif field in ['image-datetime']:
+def is_valid_ifdo_field(field_name:str,field_value):
+	""" Check field and throw IfdoException if invalid. 
+	To iterate over many fields its much faster to use are_valid_ifdo_fields """
+	# fake ifdo with field in header since item part schema validation does not return nice error message but only
+	# 'not valid under any of the given schemas' cuz of oneOf
+	item_test_ifdo = {'image-set-header':{field_name: field_value}}
+	valid, msg = validate_against_schema(item_test_ifdo,miqtv.ifdo_schema_reduced_for_field_validation,short_msg=True,store=miqtv.schema_store)
+	if not valid:
+		raise miqtc.IfdoException(field_name,"invalid:",msg)
+
+	# additional checks
+	ifdo_field_additional_checks(field_name,field_value)
+
+
+def ifdo_field_additional_checks(field_name:str,field_value):
+	""" Run checks additional to schema validation. Throw IfdoException if invalid. """
+	# additional checks
+	if field_name in ['image-filename']:
+		if not isValidImageName(field_value)[0]:
+			raise miqtc.IfdoException('Invalid item name',str(field_value),isValidImageName(field_value)[1])
+	elif field_name in ['image-datetime']:
 		try:
 			format = miqtv.date_formats['mariqt']
-			datetime.datetime.strptime(value,format)
+			datetime.datetime.strptime(field_value,format)
 		except:
-			raise miqtc.IfdoException('Invalid datetime value',str(value), "does not match format:",format)
+			raise miqtc.IfdoException('Invalid datetime value',str(field_value), "does not match format:",format)
+	elif field_name in ['image-uuid','image-set-uuid']:
+		if not miqtc.is_valid_uuid(field_value):
+			raise miqtc.IfdoException(field_name,"invalid uuid 4:",str(field_value))
+
+
+def are_valid_ifdo_fields(fields:dict, ignore_empty_fields = True):
+	""" Check fields and throw IfdoException if an invalid field is found. Does not check if all required fields are there. """
+	if ignore_empty_fields:
+		fields = miqtc.recursivelyRemoveEmptyFields(fields)
+	item_test_ifdo = {'image-set-header':fields}
+	valid, msg = validate_against_schema(item_test_ifdo,miqtv.ifdo_schema_reduced_for_field_validation,short_msg=True,store=miqtv.schema_store)
+	if not valid:
+		msg = msg.replace('image-set-header','')
+		raise miqtc.IfdoException(msg)
 	
-	elif field in ['image-longitude']:
-		try:
-			value = float(value)
-		except:
-			raise miqtc.IfdoException(field,'value is not a float',str(value))
-		if value < -180 or value > 180:
-			raise miqtc.IfdoException(field,'value is out of bounds',str(value))
-	elif field in ['image-latitude']:
-		try:
-			value = float(value)
-		except:
-			raise miqtc.IfdoException(field,'value is not a float',str(value))
-		if value < -90 or value > 90:
-			raise miqtc.IfdoException(field,'value is out of bounds',str(value))
-	elif field in ['image-depth']:
-		try:
-			value = float(value)
-		except:
-			raise miqtc.IfdoException(field,'value is not a float',str(value))
-		if value < -1: # it can happen that pressure sensors measure small negative depth at surface
-			raise miqtc.IfdoException(field,'value is out of bounds',str(value))
-	elif field in ['image-altitude']:
-		try:
-			value = float(value)
-		except:
-			raise miqtc.IfdoException(field,'value is not a float',str(value))
-		if value < 0:
-			raise miqtc.IfdoException(field,'value is out of bounds',str(value))
-	elif field in ['image-abstract']:
-		if len(value) < 500 or len(value) > 2000:
-			raise miqtc.IfdoException("Length of the abstract ("+ str(len(value)) +") is too long (max. 2000 chars) or too short (min 500 chars)")
-	elif field in ['image-pi']:
-		msg = []
-		if not isValidPerson(value,msg):
-			raise miqtc.IfdoException("Not a valid person description for the pi: "+msg[0],str(value))
-	elif field in ['image-creators']:
-		for p in value:
-			msg = []
-			if not isValidPerson(p,msg):
-				raise miqtc.IfdoException("Not a valid person description for one of the creators: "+msg[0],str(value))
-	elif field in ['image-coordinate-uncertainty-meters']:
-		try:
-			value = float(value)
-		except:
-			raise miqtc.IfdoException(field,'value is not a float',str(value))
-		if value < 0:
-			raise miqtc.IfdoException(field,'value is out of bounds',str(value))
-	elif field in fieldDefinition:
-		if 'dataType' in fieldDefinition[field]:
-			if fieldDefinition[field]['dataType'] == miqtv.dataTypes.float:
-				try:
-					value = float(value)
-				except:
-					raise miqtc.IfdoException(field,'value is not a float',str(value))
-			if fieldDefinition[field]['dataType'] == miqtv.dataTypes.int:
-				try:
-					value = int(value)
-				except:
-					raise miqtc.IfdoException(field,'value is not a float',str(value))
-			elif fieldDefinition[field]['dataType'] == miqtv.dataTypes.uuid:
-				if not miqtc.is_valid_uuid(value):
-					raise miqtc.IfdoException(field,"invalid uuid 4:",str(value))
-	else:
-		print("Unknown field \"" + field + "\"")
-	
-	return value
-
-
-def isValidiFDOItem(item:dict,header:dict,reqFields:dict=miqtv.ifdo_item_core_fields):
-	""" Returns list of fields which are missing to achieve FAIRness for the item and throws Exception if any field is filled invalidly. """
-	missingFieldsForFairness = []
-	for req in [ k for k,v in reqFields.items() if v['fairnessReq']]:
-
-		field_found_in = None
-
-		# add alt fields
-		altFields = []
-		if 'alt-fields' in reqFields[req]:
-			altFields = [alt for alt in reqFields[req]['alt-fields'] if alt != '']
-		reqAndAlts = [req] + altFields
-		fieldName = ""
-		for field in reqAndAlts:
-
-			fieldName = field
-			# check in item
-			if field in item and item[field] != "":
-				field_found_in = item
-				break
-			# check in header
-			if field in header and header[field] != "":
-				field_found_in = header
-				break
-
-		# A required field nor its alternative was not found in item or header
-		if field_found_in == None:
-			missingFieldsForFairness.append(req)
-		else:
-			# A required field was found, now check its value
-			field_found_in[fieldName] = isValidiFDOField(fieldName,field_found_in[fieldName],fieldDefinition=reqFields)
-
-			# check sub fields:
-			if 'subFields' in reqFields[req]:
-				subitem = copy.deepcopy(field_found_in[fieldName])
-				# list
-				if reqFields[req]['dataType'] == miqtv.dataTypes.list:
-					if not isinstance(subitem,list):
-						raise miqtc.IfdoException(fieldName + " must be a list")
-					subitems = subitem
-				# dict
-				else:
-					subitems = [subitem]
-				for subitem in subitems:
-					if not isinstance(subitem,dict):
-						subitem = {}
-					subMissing = isValidiFDOItem(subitem,{},reqFields[req]['subFields'])
-					if len(subMissing) != 0:
-						missingFieldsForFairness.append(req + ":" + str(subMissing))
-
-	return missingFieldsForFairness
-
-
-def isValidiFDOCoreHeader(header:dict):
-	""" Returns list of fields which are missing to achieve FAIRness for the header and throws Exception if any field is filled invalidly. """
-	missingFieldsForFairness = []
-	for req in [ k for k,v in miqtv.ifdo_header_core_fields.items() if v['fairnessReq']]:
-
-		field_found = False
-		alt_field_found = False
-
-		if req in header and header[req] != "":
-			field_found = True
-		elif 'alt-fields' in miqtv.ifdo_header_core_fields[req] and len(miqtv.ifdo_header_core_fields[req]['alt-fields']) > 0:
-			for alt in miqtv.ifdo_header_core_fields[req]['alt-fields']:
-				if alt in header and header[alt] != "":
-					alt_field_found = True
-
-		# A required field was not found
-		if not field_found:
-			if not alt_field_found:
-				missingFieldsForFairness.append(req)
-		else:
-			# Validata values
-			header[req] = isValidiFDOField(req,header[req])
-
-	return missingFieldsForFairness
-
-
-def isValidiFDOCapture(iFDO:dict):
-	""" Returns fields of variables.ifdo_capture_fields which are missing in iFDO and throws exception if a field contains an invalid value"""
-	return isValidiFDO(iFDO,miqtv.ifdo_capture_fields)
-def isValidiFDOContent(iFDO:dict):
-	""" Returns fields of variables.ifdo_content_fields which are missing in iFDO and throws exception if a field contains an invalid value"""
-	return isValidiFDO(iFDO,miqtv.ifdo_content_fields)
-
-
-def isValidiFDO(iFDO:dict,ref:dict):
-	""" Returns fields of ref which are missing in iFDO and throws exception if a field contains an invalid value"""
-	vals_missing = []
-
-	if 'image-set-header' not in iFDO or 'image-set-items' not in iFDO:
-		raise Exception("iFOD does not contain 'image-set-header' or 'image-set-items'")
-
-	prog = miqtc.PrintKnownProgressMsg("Checking fields", len(ref), modulo=10)
-	for req in ref:
-		prog.progress()
-		# check if in header
-		inHeader = False
-		if req in iFDO['image-set-header']:
-			iFDO['image-set-header'][req] = isValidiFDOField(req,iFDO['image-set-header'][req])
-			inHeader = True
-
-		# if not in header and a 'set' field, its missing
-		if req[:9] == 'image-set' and not inHeader:
-			vals_missing.append(req)
-		# check if in items
-		else:
-			num = 0
-			for item in iFDO['image-set-items']:
-				if req not in iFDO['image-set-items'][item]:
-					num += 1
-				else:
-					iFDO['image-set-items'][item][req] = isValidiFDOField(req,iFDO['image-set-items'][item][req])
-
-			if num == len(iFDO['image-set-items']) and not inHeader:
-				vals_missing.append(req+": neither the set's header nor any image item contain this field")
-			elif num > 0 and not inHeader:
-				vals_missing.append(req+": neither the set's header nor "+str(num)+" of "+str(len(iFDO['image-set-items']))+" contain this field")
-	prog.clear()
-	return vals_missing
-
-	"""
-	for req in ref:
-		if req[:9] == 'image-set':
-			# It is a header field
-			if req not in iFDO['image-set-header']:
-				vals_missing.append(req)
-			else:
-				iFDO['image-set-header'][req] = isValidiFDOField(req,iFDO['image-set-header'][req])
-		else:
-			# It is an item field:
-			num = 0
-			for item in iFDO['image-set-items']:
-				if req not in iFDO['image-set-items'][item]:
-					num += 1
-				else:
-					iFDO['image-set-items'][item][req] = isValidiFDOField(req,iFDO['image-set-items'][item][req])
-				
-			if num == len(iFDO['image-set-items']):
-				vals_missing.append(req+": no image item contains this field")
-			elif num > 0:
-				vals_missing.append(req+": "+str(num)+" of "+str(len(iFDO['image-set-items']))+" do not contain this field")
-	return vals_missing
-	"""
+	for field_name,field_val in fields.items():
+		ifdo_field_additional_checks(field_name,field_val)
 
 
 def filesHaveUniqueName(files:list):
 	""" checks if all files (with or without path) have unique file names. Returns True/False and list of duplicates"""
 	fileNames_noPath = []
 	duplicates = []
 	prog = miqtc.PrintKnownProgressMsg("Checking files have unique name", len(files), modulo=10)
```

## mariqt/variables.py

```diff
@@ -1,14 +1,15 @@
 """ A dictionary holding various header field names to store 4.5D navigation information in the form of: t (utc time), x (longitude), y (latitude), z (depth: below sea level), a (altitude: above seafloor)"""
-from enum import Enum
 import os
+import json
+import copy
 
 myDir = os.path.dirname(os.path.abspath(__file__))
 version = {}
-with open(os.path.join(os.path.dirname(os.path.abspath(__file__)),"version.py")) as fp:
+with open(os.path.join(myDir,"version.py")) as fp:
     exec(fp.read(), version)
 	
 version = version['__version__']
 
 apis = {
 		'osis_underway':'https://dm-apps-node0.geomar.de/osis-underway/api/v1/'
 		}
@@ -16,14 +17,15 @@
 pos_header = {
 		# Field/column name definition for internally handling this kind of t,y,x,z,h position data
 		"mariqt":{
 			'utc':'utc',		# YYYY-MM-DD HH:ii:ss.sssss+0000 (UTC!!!) -> t-axis
 			'lat':'lat',		# Decimal degrees, WGS84 / EPSG4362 -> y-axis
 			'lon':'lon',		# Decimal degrees, WGS84 / EPSG4326 -> x-axis
 			'dep':'dep',		# Depth of the signal, sample, platform, ... *in the water* -> z-axis, positive when submerged, negative when in air
+			'alt':'alt',
 			'hgt':'hgt',		# Height above the seafloor -> relative measure!
 			'uncert':'uncert' 	# Coorindate uncertainty in standard deviation
 		},
 
 		# Definition of field/column names according to the iFDO specification:
 		# https://gitlab.hzdr.de/datahub/marehub/ag-videosimages/metadata-profiles-fdos/-/blob/master/MareHub_AGVI_iFDO.md
 		"ifdo":{'utc':'image-datetime','lat':'image-latitude','lon':'image-longitude','dep':'image-depth','hgt':'image-meters-above-ground'},
@@ -120,15 +122,15 @@
 				'mariqt':{	'uuid':'image-uuid',
 							'img':'image-filename',
 							'utc':'image-datetime',
 							'lat':'image-latitude',
 							'lon':'image-longitude',
 							'dep':'image-depth',
 							'hgt':'image-meters-above-ground',
-							'alt':'image-altitude',
+							'alt':'image-altitude-meters',
 							'hash':'image-hash-sha256',
 							'acqui':'image-acquisition-settings',
 							'uncert':'image-coordinate-uncertainty-meters',
 							'yaw':'image-camera-yaw-degrees',
 							'pitch':'image-camera-pitch-degrees',
 							'roll':'image-camera-roll-degrees',
 							'pose':'image-camera-pose'
@@ -147,160 +149,43 @@
 colors = ['#94B242','#24589B','#DCB734','#E7753B','#A0BAAC','#CAD9A0','#82C9EB','#E9DCA6','#ED9A72','#D0DDD6','#EFF5E4','#E6F5FB','#F7F1DC','#F9DED2','#E8EEEB']
 color_names = {'entity':'#94B242','process':'#24589B','infrastructure':'#DCB734','missing':'#ED9A72','error':'#E7753B','green':'#94B242','light_green':'#EFF5E4','blue':'#24589B','light_blue':'#E6F5FB','yellow':'#DCB734','light_yellow':'#F7F1DC','red':'#E7753B','light_red':'#F9DED2','grey':'#A0BAAC','light_grey':'#E8EEEB','mid_green':'#CAD9A0','mid_blue':'#82C9EB','mid_yellow':'#E9DCA6','mid_red':'#ED9A72','mid_grey':'#D0DDD6','dark_grey':'#6D7F77',}
 
 
 
 ############# iFDO ###########################################
 
-iFDO_version = "v1.2.0"
-
-class dataTypes(Enum): # default is string
-	float = 0
-	dict = 1
-	text = 2 # just for gui elements to show bigger text field
-	list = 3 # TODO needs to be handled
-	uuid = 4
-	int = 5
+_ifdo_schema_file = os.path.join(os.path.join(os.path.join(myDir,'resources'),'fair-marine-images/docs/schemas'),'ifdo-v2.0.0.json')
+_provenance_schema_file = os.path.join(os.path.join(os.path.join(myDir,'resources'),'fair-marine-images/docs/schemas'),'provenance-v0.1.0.json')
+_annotation_schema_file = os.path.join(os.path.join(os.path.join(myDir,'resources'),'fair-marine-images/docs/schemas'),'annotation-v2.0.0.json')
+
+with open(_provenance_schema_file) as f:
+	provenance_schema = json.load(f)
+with open(_annotation_schema_file) as f:
+	annotation_schema = json.load(f)
+with open(_ifdo_schema_file) as f:
+	as_str = f.read()
+	if provenance_schema['$id']  not in as_str or annotation_schema['$id'] not in as_str:
+		raise Exception("procenacen of annotation schema id not found in ifdo schema")
+	ifdo_schema = json.loads(as_str)
+
+# store to use local schema files instead of online ones to avoid version conflicts
+schema_store = {
+    provenance_schema['$id'] : provenance_schema,
+    annotation_schema['$id'] : annotation_schema,
+}
+
+iFDO_version = ifdo_schema['$id'].split('-')[-1].replace(".json","")
+
+ifdo_schema_reduced_for_field_validation = copy.deepcopy(ifdo_schema)
+del ifdo_schema_reduced_for_field_validation['required']
+del ifdo_schema_reduced_for_field_validation['properties']['image-set-header']['required']
 
 image_set_header_key = 'image-set-header'
 image_set_items_key =  'image-set-items'
 
-req_person_fields = ['name','email','orcid']
-
-ifdo_mutually_exclusive_fields = [['image-depth','image-altitude']]
-
-ifdo_header_core_fields = {
-	'image-set-name':{'comment': 'A unique name for the image set, should include `<project>, <event>, <sensor>` and purpose','fairnessReq':True},
-	'image-set-uuid':{'comment': 'A UUID (**version 4 - random**) for the entire image set', 'dataType': dataTypes.uuid,'fairnessReq':True},
-	'image-set-handle':{'comment': 'A Handle URL (using the UUID?) to point to the landing page of the data set','fairnessReq':True},
-	'image-set-ifdo-version':{'comment': 'The semantic version information of the iFDO standard used. The default is v1.0.0','fairnessReq':True},
-}
-
-keyValidPlusCustom = "$OTHER" # add this key to valid list if also custom values are allowed
-
-person_dict = {'name':{'comment': 'Full name of principal investigator','fairnessReq':True},
-			   'orcid':{'comment': 'ORCID of principal investigator','fairnessReq':True},}
-
-ifdo_item_core_fields = {
-	'image-datetime':{'comment': 'The fully-qualified ISO8601 UTC time of image acquisition (or start time of a video). E.g.: %Y-%m-%d %H:%M:%S.%f (in Python). You *may* specify a different date format using the optional iFDO capture field `image-datetime-format`','fairnessReq':True},
-	'image-latitude':{'comment': 'Y-coordinate of the camera center in decimal degrees: D.DDDDDDD (use at least seven significant digits that is ca. 1cm resolution)', 'dataType': dataTypes.float,'fairnessReq':True},
-	'image-longitude':{'comment': 'X-coordinate of the camera center in decimal degrees: D.DDDDDDD (use at least seven significant digits that is ca. 1cm resolution)', 'dataType': dataTypes.float,'fairnessReq':True},
-	'image-depth':{'comment': 'Z-coordinate of camera center in meters. *Use this when camera is below water, then it has positive values.*', 'dataType': dataTypes.float, 'alt-fields': ['image-altitude'],'fairnessReq':True},
-	'image-altitude':{'comment': 'Z-coordinate of camera center in meters. *Use this when camera is above water, then it has positive values.* You can also use image-depth with negative values instead!', 'dataType': dataTypes.float, 'alt-fields': ['image-depth'],'fairnessReq':True},
-	'image-coordinate-reference-system':{'comment': 'The coordinate reference system, e.g. **EPSG:4326**','fairnessReq':True},
-	'image-coordinate-uncertainty-meters':{'comment': 'The average/static uncertainty of coordinates in this dataset, given in meters. Computed e.g. as the standard deviation of coordinate corrections during smoothing / splining.', 'dataType': dataTypes.float,'fairnessReq':False},
-	'image-context':{'comment': 'The high-level "umbrella" project','fairnessReq':False},
-	'image-project':{'comment': 'The lower-level / specific expedition or cruise or experiment or ...','fairnessReq':False},
-	'image-event':{'comment': 'One event of a project or expedition or cruise or experiment or ...','fairnessReq':False},
-	'image-platform':{'comment': 'Platform URN or Equipment Git ID or Handle URL','fairnessReq':True},
-	'image-sensor':{'comment': 'Sensor URN or Equipment Git ID or Handle URL','fairnessReq':True},
-	'image-uuid':{'comment': 'UUID (**version 4 - random**) for the image file (still or moving)', 'dataType': dataTypes.uuid,'fairnessReq':True},
-	'image-hash-sha256':{'comment': 'An SHA256 hash to represent the whole file (including UUID in metadata!) to verify integrity on disk','fairnessReq':True},
-	'image-pi':{'comment': 'Information to identify the principal investigator. See details below', 'dataType': dataTypes.dict,'fairnessReq':True,
-			'subFields':person_dict,},
-	'image-creators':{'comment': 'A list containing dicts for all creators containing: {orcid:..., name:...}', 'dataType': dataTypes.list,'fairnessReq':True,
-			'subFields':person_dict,},
-	'image-license':{'comment': 'License to use the data (should be FAIR, e.g. **CC-BY** or CC-0)','fairnessReq':True},
-	'image-copyright':{'comment': 'Copyright sentence / contact person or office', 'dataType': dataTypes.text,'fairnessReq':True},
-	'image-abstract':{'comment': '500 - 2000 characters describing what, when, where, why and how the data was collected. Includes general information on the event (aka station, experiment), e.g. overlap between images/frames, parameters on platform movement, aims, purpose of image capture etc. You can use \'___field-name___\' to insert field values', 'dataType': dataTypes.text,'fairnessReq':False},
-	'image-local-path':{'comment': 'Local relative or absolute path to a directory in which (also its sub-directories) the referenced images files are located. Absolute paths must start with and relative paths without path separator (ignoring drive letters on windows) .The default is the relative path \'../raw\'','fairnessReq':False}
-}
-
-ifdo_content_fields = {
-	'image-entropy':{'comment': 'Information content of an image / frame according to Shannon entropy.', 'dataType': dataTypes.float},
-	'image-particle-count':{'comment': 'Counts of single particles/objects in an image / frame', 'dataType': dataTypes.int},
-	'image-average-color':{'comment': 'The average colour for each image / frame and the `n` channels of an image (e.g. 3 for RGB)\nFormat: [int,int,int]'},
-	'image-mpeg7-colorlayout':{'comment': 'An nD feature vector per image / frame of varying dimensionality according to the chosen descriptor settings.\nFormat: [float,float,...]'},
-	'image-mpeg7-colorstatistic':{'comment': 'An nD feature vector per image / frame of varying dimensionality according to the chosen descriptor settings.\nFormat: [float,float,...]'},
-	'image-mpeg7-colorstructure':{'comment': 'An nD feature vector per image / frame of varying dimensionality according to the chosen descriptor settings.\nFormat: [float,float,...]'},
-	'image-mpeg7-dominantcolor':{'comment': 'An nD feature vector per image / frame of varying dimensionality according to the chosen descriptor settings.\nFormat: [float,float,...]'},
-	'image-mpeg7-edgehistogram':{'comment': 'An nD feature vector per image / frame of varying dimensionality according to the chosen descriptor settings.\nFormat: [float,float,...]'},
-	'image-mpeg7-homogeneoustexture':{'comment': 'An nD feature vector per image / frame of varying dimensionality according to the chosen descriptor settings.\nFormat: [float,float,...]'},
-	'image-mpeg7-scalablecolor':{'comment': 'An nD feature vector per image / frame of varying dimensionality according to the chosen descriptor settings.\nFormat: [float,float,...]'},
-	'image-annotation-labels':{'comment': 'All the labels used in the image-annotations. Specified by an id (e.g. AphiaID), a human-readable name and an optional description.\nFormat: [{id:`<LID>`,name:string,info:`<description>`},...]'},
-	'image-annotation-creators':{'comment': "All the annotators that created image-annotations. Specified by an id (e.g. ORCID), a human-readable name and an optional type specifying the annotator's expertise.\nFormat: [{id:`<ORCID/UUID>`,name:string,type:string (expert, non-expert, AI)},...]"},
-	'image-annotations':{'comment': 'This field is mighty powerful! It stores all annotations as a list of dictionaries of 3-4 fields: shape, coordinates, labels and (optional) frames. See further explanations below. The list of labels specifies the IDs or names of objects and annotators and their confidence. These should be specified in an `image-annotation-labels` and `image-annotation-creators` field (see above) to provide more information on the values used in these fields.\nFormat: [{coordinates:...,labels:...,shape:,...,frames:...},`<ANNOTATION-2>`,...]',
-			'subFields':{
-					'shape':{'comment': 'The annotation shape is specified by a keyword (allowed values: see previous column).', 'valid': ['single-pixel', 'polyline', 'polygon', 'circle', 'rectangle', 'ellipse', 'whole-image']},
-					'coordinates':{'comment': 'The pixel coordinates of one annotation. The top-left corner of an image is the (0,0) coordinate. The x-axis is the horizontal axis. Pixel coordinates may be fractional. Coordinates can be given as a list of lists in case of video annotations that change coordinates over time (see `image-annotation:frames` below). Otherwise it is just a list of floats. The required number of pixel coordinates is defined by the shape (0 for whole-image, 2 for single-pixel, 3 for circle, 8 for ellipse/rectangle, 4 or more for polyline, 8 or more for polygon). The third coordinate value of a circle defines the radius. The first and last coordinates of a polygon must be equal.\nFormat: [[p1.x,p1.y,p2x,p2.y,...]..]'},
-					'labels':{'comment': 'A list of labels and annotators for one annotation. Use label IDs and annotator IDs here. The optional confidence in an annotation can be given as a float between 0 (100% uncertain) and 1 (100% certain). The confidence can be given independently for each label. Labels are independent of frames. The `created-at` field contains an ISO8601 string like `2011-10-05T14:48:00.000Z`\nFormat: [{label: `<LID>`, annotator: `<ORCID/UUID>`, created-at: `<datetime>`, confidence: `<float>`},...]'},
-					'frames':{'comment': '(only required for video annotations) Frame times (in seconds from the beginning of a video) of a video annotation. Each frame time is linked to one entry in `image-annotations:coordinates` at the same position in the list, which specifies the current coordinates of the annotation at that frame.\nFormat: [f1,...]'},},},
-}
-
-ifdo_capture_fields = {
-	'image-acquisition':{'comment': 'photo: still images, video: moving images, slide: microscopy images / slide scans', 'valid': ['photo', 'video', 'slide']},
-	'image-quality':{'comment': "raw: straight from the sensor, processed: QA/QC'd, product: image data ready for interpretation", 'valid': ['raw', 'processed', 'product']},
-	'image-deployment':{'comment': 'mapping: planned path execution along 2-3 spatial axes, stationary: fixed spatial position, survey: planned path execution along free path, exploration: unplanned path execution, experiment: observation of manipulated environment, sampling: ex-situ imaging of samples taken by other method', 'valid': ['mapping', 'stationary', 'survey', 'exploration', 'experiment', 'sampling']},
-	'image-navigation':{'comment': 'satellite: GPS/Galileo etc., beacon: USBL etc., transponder: LBL etc., reconstructed: position estimated from other measures like cable length and course over ground', 'valid': ['satellite', 'beacon', 'transponder', 'reconstructed']},
-	'image-scale-reference':{'comment': '3D camera: the imaging system provides scale directly, calibrated camera: image data and additional external data like object distance provide scale together, laser marker: scale information is embedded in the visual data, optical flow: scale is computed from the relative movement of the images and the camera navigation data', 'valid': ['3D camera', 'calibrated camera', 'laser marker', 'optical flow']},
-	'image-illumination':{'comment': 'sunlight: the scene is only illuminated by the sun, artificial light: the scene is only illuminated by artificial light, mixed light: both sunlight and artificial light illuminate the scene', 'valid': ['sunlight', 'artificial light', 'mixed light']},
-	'image-pixel-magnitude':{'comment': 'average size of one pixel of an image', 'valid': ['km', 'hm', 'dam', 'm', 'cm', 'mm', 'µm']},
-	'image-marine-zone':{'comment': 'seafloor: images taken in/on/right above the seafloor, water column: images taken in the free water without the seafloor or the sea surface in sight, sea surface: images taken right below the sea surface, atmosphere: images taken outside of the water, laboratory: images taken ex-situ', 'valid': ['seafloor', 'water column', 'sea surface', 'atmosphere', 'laboratory']},
-	'image-spectral-resolution':{'comment': 'grayscale: single channel imagery, rgb: three channel imagery, multi-spectral: 4-10 channel imagery, hyper-spectral: 10+ channel imagery', 'valid': ['grayscale', 'rgb', 'multi-spectral', 'hyper-spectral']},
-	'image-capture-mode':{'comment': 'whether the time points of image capture were systematic, human-truggered or both', 'valid': ['timer', 'manual', 'mixed']},
-	'image-fauna-attraction':{'comment': 'Allowed: none, baited, light', 'valid': ['none', 'baited', 'light']},
-	'image-area-square-meter':{'comment': 'The footprint of the entire image in square meters', 'dataType': dataTypes.float},
-	'image-meters-above-ground':{'comment': 'Distance of the camera to the seafloor in meters', 'dataType': dataTypes.float},
-	'image-acquisition-settings':{'comment': 'All the information that is recorded by the camera in the EXIF, IPTC etc. As a dict. Includes ISO, aperture, etc.', 'dataType': dataTypes.dict},
-	'image-camera-yaw-degrees':{'comment': "Camera view yaw angle. Rotation of camera coordinates (x,y,z = top, right, line of sight) with respect to NED coordinates (x,y,z = north,east,down) in accordance with the yaw,pitch,roll rotation order convention: 1. yaw around z, 2. pitch around rotated y, 3. roll around rotated x. Rotation directions according to \'right-hand rule\'. I.e. for yaw,pitch,roll = 0,0,0 camera is facing downward with top side towards north.", 'dataType': dataTypes.float},
-	'image-camera-pitch-degrees':{'comment': "Camera view pitch angle. Rotation of camera coordinates (x,y,z = top, right, line of sight) with respect to NED coordinates (x,y,z = north,east,down) in accordance with the yaw,pitch,roll rotation order convention: 1. yaw around z, 2. pitch around rotated y, 3. roll around rotated x. Rotation directions according to \'right-hand rule\'. I.e. for yaw,pitch,roll = 0,0,0 camera is facing downward with top side towards north.", 'dataType': dataTypes.float},
-	'image-camera-roll-degrees':{'comment': "Camera view roll angle. Rotation of camera coordinates (x,y,z = top, right, line of sight) with respect to NED coordinates (x,y,z = north,east,down) in accordance with the yaw,pitch,roll rotation order convention: 1. yaw around z, 2. pitch around rotated y, 3. roll around rotated x. Rotation directions according to \'right-hand rule\'. I.e. for yaw,pitch,roll = 0,0,0 camera is facing downward with top side towards north.", 'dataType': dataTypes.float},
-	'image-overlap-fraction':{'comment': 'The average overlap of two consecutive images i and j as the area images in both of the images (A_i * A_j) divided by the total area images by the two images (A_i + A_j - A_i * A_j): f = A_i * A_j / (A_i + A_j - A_i * A_j) -> 0 if no overlap. 1 if complete overlap', 'dataType': dataTypes.float},
-	'image-datetime-format':{'comment': 'A date time format string in Python notation (e.g. %Y-%m-%d %H:%M:%S.%f) to specify a different date format used throughout the iFDO file. The assumed default is the one in brackets. Make sure to reach second-accuracy with your date times!'},
-	'image-camera-pose':{'comment': 'Information required to specify camera pose. For details on subfields see rows below.', 'dataType': dataTypes.dict,
-			'subFields':{
-					'pose-utm-zone':{'comment': 'The UTM zone number'},
-					'pose-utm-epsg':{'comment': 'The EPSG code of the UTM zone'},
-					'pose-utm-east-north-up-meters':{'comment': 'The position of the camera center in UTM coordinates.\nFormat: [float,float,float]'},
-					'pose-absolute-orientation-utm-matrix':{'comment': '3x3 row-major float rotation matrix that transforms a direction in camera coordinates (x,y,z = right,down,line of sight) into a direction in UTM coordinates (x,y,z = easting,northing,up)}', 'dataType': dataTypes.list},},},
-	'image-camera-housing-viewport':{'comment': 'Information on the camera pressure housing viewport (the glass). For details on subfields see rows below.', 'dataType': dataTypes.dict,
-			'subFields':{
-					'viewport-type':{'comment': 'e.g.: flatport, domeport, other'},
-					'viewport-optical-density':{'comment': 'Unit-less optical density number (1.0=vacuum)', 'dataType': dataTypes.float},
-					'viewport-thickness-millimeter':{'comment': 'Thickness of viewport in millimeters', 'dataType': dataTypes.float},
-					'viewport-extra-description':{'comment': 'A textual description of the viewport used', 'dataType': dataTypes.text},},},
-	'image-flatport-parameters':{'comment': 'Information required to specify the characteristics of a flatport camera housing. For details on subfields see rows below.', 'dataType': dataTypes.dict,
-			'subFields':{
-					'flatport-lens-port-distance-millimeter':{'comment': 'The distance between the front of the camera lens and the inner side of the housing viewport in millimeters.', 'dataType': dataTypes.float},
-					'flatport-interface-normal-direction':{'comment': '3D direction vector to specify how the view direction of the lens intersects with the viewport (unit-less, (0,0,1) is "aligned")\nFormat: [float, float, float]'},
-					'flatport-extra-description':{'comment': 'A textual description of the flatport used', 'dataType': dataTypes.text},},},
-	'image-domeport-parameters':{'comment': 'Information required to specify the characteristics of a domeport camera housing. For details on subfields see rows below.', 'dataType': dataTypes.dict,
-			'subFields':{
-					'domeport-outer-radius-millimeter':{'comment': 'Outer radius of the domeport - the part that has contact with the water.', 'dataType': dataTypes.float},
-					'domeport-decentering-offset-xyz-millimeter':{'comment': '3D offset vector of the camera center from the domeport center in millimeters\nFormat: [float,float,float]'},
-					'domeport-extra-description':{'comment': 'A textual description of the domeport used', 'dataType': dataTypes.text},},},
-	'image-camera-calibration-model':{'comment': 'Information required to specify the camera calibration model. For details on the subfields see rows below.', 'dataType': dataTypes.dict,
-			'subFields':{
-					'calibration-model-type':{'comment': 'e.g.: rectilinear air, rectilinear water, fisheye air, fisheye water, other'},
-					'calibration-focal-length-xy-pixel':{'comment': '2D focal length in pixels\nFormat: [float, float]'},
-					'calibration-principal-point-xy-pixel':{'comment': '2D principal point of the calibration in pixels (top left pixel center is 0,0, x right, y down)\nFormat: [float,float]'},
-					'calibration-distortion-coefficients':{'comment': 'rectilinear: k1, k2, p1, p2, k3, k4, k5, k6, fisheye: k1, k2, k3, k4', 'dataType': dataTypes.list},
-					'calibration-approximate-field-of-view-water-xy-degree':{'comment': 'Proxy for pixel to meter conversion, and as backup\nFormat: [float, float]'},
-					'calibration-model-extra-description':{'comment': 'Explain model, or if lens parameters are in mm rather than in pixel', 'dataType': dataTypes.text},},},
-	'image-photometric-calibration':{'comment': 'Information required to specify the photometric calibration. For details on the subfields see rows below.', 'dataType': dataTypes.dict,
-			'subFields':{
-					'photometric-sequence-white-balancing':{'comment': 'A text on how white-balancing was done.', 'dataType': dataTypes.text},
-					'photometric-exposure-factor-RGB':{'comment': 'RGB factors applied to this image, product of ISO, exposure time, relative white balance\nFormat: [float, float, float]'},
-					'photometric-sequence-illumination-type':{'comment': 'e.g. "constant artificial", "globally adapted artificial", "individually varying light sources", "sunlight", "mixed")'},
-					'photometric-sequence-illumination-description':{'comment': 'A text on how the image sequence was illuminated', 'dataType': dataTypes.text},
-					'photometric-illumination-factor-RGB':{'comment': 'RGB factors applied to artificial lights for this image\nFormat: [float, float, float]'},
-					'photometric-water-properties-description':{'comment': 'A text describing the photometric properties of the water within which the images were capture', 'dataType': dataTypes.text},},},
-	'image-objective':{'comment': 'A general translation of the aims and objectives of the study, as they pertain to biology and method scope. This should define the primary and secondary data to be measured and to what precision.', 'dataType': dataTypes.text},
-	'image-target-environment':{'comment': 'A description, delineation, and definition of the habitat or environment of study, including boundaries of such', 'dataType': dataTypes.text},
-	'image-target-timescale':{'comment': 'A description, delineation, and definition of the period, interval or temporal environment of the study.', 'dataType': dataTypes.text},
-	'image-spatial-contraints':{'comment': 'A description / definition of the spatial extent of the study area (inside which the photographs were captured), including boundaries and reasons for constraints (e.g. scientific, practical)', 'dataType': dataTypes.text},
-	'image-temporal-constraints':{'comment': 'A description / definition of the temporal extent, including boundaries and reasons for constraints (e.g. scientific, practical)', 'dataType': dataTypes.text},
-	'image-time-synchronisation':{'comment': 'Synchronisation procedure and determined time offsets between camera recording values and UTC', 'dataType': dataTypes.text},
-	'image-item-identification-scheme':{'comment': 'How the images file names are constructed. Should be like this `<project>_<event>_<sensor>_<date>_<time>.<ext>`', 'dataType': dataTypes.text},
-	'image-curation-protocol':{'comment': 'A description of the image and metadata curation steps and results', 'dataType': dataTypes.text},
-}
-
-ifdo_coreFields = {**ifdo_header_core_fields, **ifdo_item_core_fields}
-ifdo_fields =  {**ifdo_coreFields, **ifdo_content_fields, **ifdo_capture_fields}
-
 
 # exiftool path in case its not in PATH
 global exiftool_path
 exiftool_path = ""
 def setExiftoolPath(exiftool_path_:str):
 	""" Sets the basepath for Exiftool if its not in PATH """
 	global exiftool_path
```

### encoding

```diff
@@ -1 +1 @@
-utf-8
+us-ascii
```

## mariqt/version.py

```diff
@@ -1 +1 @@
-__version__ = '0.4.4'
+__version__ = '0.5.1'
```

## mariqt/sources/ifdo.py

```diff
@@ -10,6561 +10,7023 @@
 00000090: 6f6e 0a69 6d70 6f72 7420 6e75 6d70 7920  on.import numpy 
 000000a0: 6173 206e 700a 696d 706f 7274 2061 7374  as np.import ast
 000000b0: 0a69 6d70 6f72 7420 636f 7079 0a69 6d70  .import copy.imp
 000000c0: 6f72 7420 6461 7465 7469 6d65 0a66 726f  ort datetime.fro
 000000d0: 6d20 7070 7269 6e74 2069 6d70 6f72 7420  m pprint import 
 000000e0: 7070 7269 6e74 0a66 726f 6d20 6465 6570  pprint.from deep
 000000f0: 6469 6666 2069 6d70 6f72 7420 4465 6570  diff import Deep
-00000100: 4469 6666 0a69 6d70 6f72 7420 7469 6d65  Diff.import time
-00000110: 0a0a 696d 706f 7274 206d 6172 6971 742e  ..import mariqt.
-00000120: 636f 7265 2061 7320 6d69 7174 630a 696d  core as miqtc.im
-00000130: 706f 7274 206d 6172 6971 742e 6469 7265  port mariqt.dire
-00000140: 6374 6f72 6965 7320 6173 206d 6971 7464  ctories as miqtd
-00000150: 0a69 6d70 6f72 7420 6d61 7269 7174 2e66  .import mariqt.f
-00000160: 696c 6573 2061 7320 6d69 7174 660a 696d  iles as miqtf.im
-00000170: 706f 7274 206d 6172 6971 742e 7661 7269  port mariqt.vari
-00000180: 6162 6c65 7320 6173 206d 6971 7476 0a69  ables as miqtv.i
-00000190: 6d70 6f72 7420 6d61 7269 7174 2e69 6d61  mport mariqt.ima
-000001a0: 6765 2061 7320 6d69 7174 690a 696d 706f  ge as miqti.impo
-000001b0: 7274 206d 6172 6971 742e 7465 7374 7320  rt mariqt.tests 
-000001c0: 6173 206d 6971 7474 0a69 6d70 6f72 7420  as miqtt.import 
-000001d0: 6d61 7269 7174 2e6e 6176 6967 6174 696f  mariqt.navigatio
-000001e0: 6e20 6173 206d 6971 746e 0a69 6d70 6f72  n as miqtn.impor
-000001f0: 7420 6d61 7269 7174 2e73 6574 7469 6e67  t mariqt.setting
-00000200: 7320 6173 206d 6971 7473 0a69 6d70 6f72  s as miqts.impor
-00000210: 7420 6d61 7269 7174 2e70 726f 7665 6e61  t mariqt.provena
-00000220: 6e63 6520 6173 206d 6971 7470 0a69 6d70  nce as miqtp.imp
-00000230: 6f72 7420 6d61 7269 7174 2e67 656f 2061  ort mariqt.geo a
-00000240: 7320 6d69 7174 670a 0a0a 636c 6173 7320  s miqtg...class 
-00000250: 6e6f 6e43 6f72 6546 6965 6c64 496e 7465  nonCoreFieldInte
-00000260: 726d 6564 6961 7465 4974 656d 496e 666f  rmediateItemInfo
-00000270: 4669 6c65 3a0a 2020 2020 6465 6620 5f5f  File:.    def __
-00000280: 696e 6974 5f5f 2873 656c 662c 2066 696c  init__(self, fil
-00000290: 654e 616d 653a 7374 722c 2073 6570 6172  eName:str, separ
-000002a0: 6174 6f72 3a73 7472 2c20 6865 6164 6572  ator:str, header
-000002b0: 3a64 6963 742c 2064 6174 6574 696d 655f  :dict, datetime_
-000002c0: 666f 726d 6174 3a73 7472 3d6d 6971 7476  format:str=miqtv
-000002d0: 2e64 6174 655f 666f 726d 6174 735b 276d  .date_formats['m
-000002e0: 6172 6971 7427 5d29 3a0a 2020 2020 2020  ariqt']):.      
-000002f0: 2020 7365 6c66 2e66 696c 654e 616d 6520    self.fileName 
-00000300: 3d20 6669 6c65 4e61 6d65 0a20 2020 2020  = fileName.     
-00000310: 2020 2073 656c 662e 7365 7061 7261 746f     self.separato
-00000320: 7220 3d20 7365 7061 7261 746f 720a 2020  r = separator.  
-00000330: 2020 2020 2020 7365 6c66 2e68 6561 6465        self.heade
-00000340: 7220 3d20 6865 6164 6572 0a20 2020 2020  r = header.     
-00000350: 2020 2073 656c 662e 6461 7465 7469 6d65     self.datetime
-00000360: 5f66 6f72 6d61 7420 3d20 6461 7465 7469  _format = dateti
-00000370: 6d65 5f66 6f72 6d61 740a 0a20 2020 2064  me_format..    d
-00000380: 6566 205f 5f65 715f 5f28 7365 6c66 2c20  ef __eq__(self, 
-00000390: 6f74 6865 7229 3a0a 2020 2020 2020 2020  other):.        
-000003a0: 6966 2073 656c 662e 6669 6c65 4e61 6d65  if self.fileName
-000003b0: 3d3d 6f74 6865 722e 6669 6c65 4e61 6d65  ==other.fileName
-000003c0: 2061 6e64 2073 656c 662e 7365 7061 7261   and self.separa
-000003d0: 746f 7220 3d3d 206f 7468 6572 2e73 6570  tor == other.sep
-000003e0: 6172 6174 6f72 2061 6e64 2073 656c 662e  arator and self.
-000003f0: 6865 6164 6572 3d3d 6f74 6865 722e 6865  header==other.he
-00000400: 6164 6572 2061 6e64 2073 656c 662e 6461  ader and self.da
-00000410: 7465 7469 6d65 5f66 6f72 6d61 743d 3d6f  tetime_format==o
-00000420: 7468 6572 2e64 6174 6574 696d 655f 666f  ther.datetime_fo
-00000430: 726d 6174 3a0a 2020 2020 2020 2020 2020  rmat:.          
-00000440: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
-00000450: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00000460: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00000470: 616c 7365 0a0a 6465 6620 6669 6e64 4669  alse..def findFi
-00000480: 656c 6428 6966 646f 5f64 6963 742c 6b65  eld(ifdo_dict,ke
-00000490: 7973 293a 0a20 2020 2020 2020 2022 2222  ys):.        """
-000004a0: 204c 6f6f 6b73 2066 6f72 2020 6b65 7973   Looks for  keys
-000004b0: 2028 226b 6579 2220 6f72 205b 6b65 7931   ("key" or [key1
-000004c0: 2c6b 6579 325d 2920 696e 2069 6664 6f5f  ,key2]) in ifdo_
-000004d0: 6469 6374 2061 6e64 2072 6574 7572 6e73  dict and returns
-000004e0: 2069 7473 2076 616c 7565 206f 7220 616e   its value or an
-000004f0: 2065 6d70 7479 2073 7472 696e 6720 6966   empty string if
-00000500: 206b 6579 206e 6f74 2066 6f75 6e64 2222   key not found""
-00000510: 220a 2020 2020 2020 2020 6966 206e 6f74  ".        if not
-00000520: 2069 7369 6e73 7461 6e63 6528 6b65 7973   isinstance(keys
-00000530: 2c20 6c69 7374 293a 0a20 2020 2020 2020  , list):.       
-00000540: 2020 2020 206b 6579 7320 3d20 5b6b 6579       keys = [key
-00000550: 735d 0a0a 2020 2020 2020 2020 6172 203d  s]..        ar =
-00000560: 2069 6664 6f5f 6469 6374 0a20 2020 2020   ifdo_dict.     
-00000570: 2020 2066 6f72 206b 2069 6e20 6b65 7973     for k in keys
-00000580: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00000590: 206b 2069 6e20 6172 3a0a 2020 2020 2020   k in ar:.      
-000005a0: 2020 2020 2020 2020 2020 6172 203d 2061            ar = a
-000005b0: 725b 6b5d 0a20 2020 2020 2020 2020 2020  r[k].           
-000005c0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000005d0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-000005e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000005f0: 6b20 3d20 696e 7428 6b29 0a20 2020 2020  k = int(k).     
-00000600: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00000610: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-00000620: 2861 722c 6c69 7374 2920 6f72 206c 656e  (ar,list) or len
-00000630: 2861 7229 203c 206b 3a0a 2020 2020 2020  (ar) < k:.      
-00000640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000650: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00000660: 6f72 2822 496e 6465 7822 2c6b 2c22 6f75  or("Index",k,"ou
-00000670: 7420 6f66 2062 6f75 6e64 7322 2c6c 656e  t of bounds",len
-00000680: 2861 7229 290a 2020 2020 2020 2020 2020  (ar)).          
-00000690: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
+00000100: 4469 6666 0a66 726f 6d20 7061 636b 6167  Diff.from packag
+00000110: 696e 672e 7665 7273 696f 6e20 696d 706f  ing.version impo
+00000120: 7274 2056 6572 7369 6f6e 0a0a 696d 706f  rt Version..impo
+00000130: 7274 206d 6172 6971 742e 636f 7265 2061  rt mariqt.core a
+00000140: 7320 6d69 7174 630a 696d 706f 7274 206d  s miqtc.import m
+00000150: 6172 6971 742e 6469 7265 6374 6f72 6965  ariqt.directorie
+00000160: 7320 6173 206d 6971 7464 0a69 6d70 6f72  s as miqtd.impor
+00000170: 7420 6d61 7269 7174 2e66 696c 6573 2061  t mariqt.files a
+00000180: 7320 6d69 7174 660a 696d 706f 7274 206d  s miqtf.import m
+00000190: 6172 6971 742e 7661 7269 6162 6c65 7320  ariqt.variables 
+000001a0: 6173 206d 6971 7476 0a69 6d70 6f72 7420  as miqtv.import 
+000001b0: 6d61 7269 7174 2e69 6d61 6765 2061 7320  mariqt.image as 
+000001c0: 6d69 7174 690a 696d 706f 7274 206d 6172  miqti.import mar
+000001d0: 6971 742e 7465 7374 7320 6173 206d 6971  iqt.tests as miq
+000001e0: 7474 0a69 6d70 6f72 7420 6d61 7269 7174  tt.import mariqt
+000001f0: 2e6e 6176 6967 6174 696f 6e20 6173 206d  .navigation as m
+00000200: 6971 746e 0a69 6d70 6f72 7420 6d61 7269  iqtn.import mari
+00000210: 7174 2e73 6574 7469 6e67 7320 6173 206d  qt.settings as m
+00000220: 6971 7473 0a69 6d70 6f72 7420 6d61 7269  iqts.import mari
+00000230: 7174 2e70 726f 7665 6e61 6e63 6520 6173  qt.provenance as
+00000240: 206d 6971 7470 0a69 6d70 6f72 7420 6d61   miqtp.import ma
+00000250: 7269 7174 2e67 656f 2061 7320 6d69 7174  riqt.geo as miqt
+00000260: 670a 0a0a 636c 6173 7320 6e6f 6e43 6f72  g...class nonCor
+00000270: 6546 6965 6c64 496e 7465 726d 6564 6961  eFieldIntermedia
+00000280: 7465 4974 656d 496e 666f 4669 6c65 3a0a  teItemInfoFile:.
+00000290: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+000002a0: 2873 656c 662c 2066 696c 654e 616d 653a  (self, fileName:
+000002b0: 7374 722c 2073 6570 6172 6174 6f72 3a73  str, separator:s
+000002c0: 7472 2c20 6865 6164 6572 3a64 6963 742c  tr, header:dict,
+000002d0: 2064 6174 6574 696d 655f 666f 726d 6174   datetime_format
+000002e0: 3a73 7472 3d6d 6971 7476 2e64 6174 655f  :str=miqtv.date_
+000002f0: 666f 726d 6174 735b 276d 6172 6971 7427  formats['mariqt'
+00000300: 5d29 3a0a 2020 2020 2020 2020 7365 6c66  ]):.        self
+00000310: 2e66 696c 654e 616d 6520 3d20 6669 6c65  .fileName = file
+00000320: 4e61 6d65 0a20 2020 2020 2020 2073 656c  Name.        sel
+00000330: 662e 7365 7061 7261 746f 7220 3d20 7365  f.separator = se
+00000340: 7061 7261 746f 720a 2020 2020 2020 2020  parator.        
+00000350: 7365 6c66 2e68 6561 6465 7220 3d20 6865  self.header = he
+00000360: 6164 6572 0a20 2020 2020 2020 2073 656c  ader.        sel
+00000370: 662e 6461 7465 7469 6d65 5f66 6f72 6d61  f.datetime_forma
+00000380: 7420 3d20 6461 7465 7469 6d65 5f66 6f72  t = datetime_for
+00000390: 6d61 740a 0a20 2020 2064 6566 205f 5f65  mat..    def __e
+000003a0: 715f 5f28 7365 6c66 2c20 6f74 6865 7229  q__(self, other)
+000003b0: 3a0a 2020 2020 2020 2020 6966 2073 656c  :.        if sel
+000003c0: 662e 6669 6c65 4e61 6d65 3d3d 6f74 6865  f.fileName==othe
+000003d0: 722e 6669 6c65 4e61 6d65 2061 6e64 2073  r.fileName and s
+000003e0: 656c 662e 7365 7061 7261 746f 7220 3d3d  elf.separator ==
+000003f0: 206f 7468 6572 2e73 6570 6172 6174 6f72   other.separator
+00000400: 2061 6e64 2073 656c 662e 6865 6164 6572   and self.header
+00000410: 3d3d 6f74 6865 722e 6865 6164 6572 2061  ==other.header a
+00000420: 6e64 2073 656c 662e 6461 7465 7469 6d65  nd self.datetime
+00000430: 5f66 6f72 6d61 743d 3d6f 7468 6572 2e64  _format==other.d
+00000440: 6174 6574 696d 655f 666f 726d 6174 3a0a  atetime_format:.
+00000450: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00000460: 726e 2054 7275 650a 2020 2020 2020 2020  rn True.        
+00000470: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00000480: 2020 7265 7475 726e 2046 616c 7365 0a0a    return False..
+00000490: 6465 6620 6669 6e64 4669 656c 6428 6966  def findField(if
+000004a0: 646f 5f64 6963 742c 6b65 7973 293a 0a20  do_dict,keys):. 
+000004b0: 2020 2020 2020 2022 2222 204c 6f6f 6b73         """ Looks
+000004c0: 2066 6f72 2020 6b65 7973 2028 226b 6579   for  keys ("key
+000004d0: 2220 6f72 205b 6b65 7931 2c6b 6579 325d  " or [key1,key2]
+000004e0: 2920 696e 2069 6664 6f5f 6469 6374 2061  ) in ifdo_dict a
+000004f0: 6e64 2072 6574 7572 6e73 2069 7473 2076  nd returns its v
+00000500: 616c 7565 206f 7220 616e 2065 6d70 7479  alue or an empty
+00000510: 2073 7472 696e 6720 6966 206b 6579 206e   string if key n
+00000520: 6f74 2066 6f75 6e64 2222 220a 2020 2020  ot found""".    
+00000530: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
+00000540: 7461 6e63 6528 6b65 7973 2c20 6c69 7374  tance(keys, list
+00000550: 293a 0a20 2020 2020 2020 2020 2020 206b  ):.            k
+00000560: 6579 7320 3d20 5b6b 6579 735d 0a0a 2020  eys = [keys]..  
+00000570: 2020 2020 2020 6172 203d 2069 6664 6f5f        ar = ifdo_
+00000580: 6469 6374 0a20 2020 2020 2020 2066 6f72  dict.        for
+00000590: 206b 2069 6e20 6b65 7973 3a0a 2020 2020   k in keys:.    
+000005a0: 2020 2020 2020 2020 6966 206b 2069 6e20          if k in 
+000005b0: 6172 3a0a 2020 2020 2020 2020 2020 2020  ar:.            
+000005c0: 2020 2020 6172 203d 2061 725b 6b5d 0a20      ar = ar[k]. 
+000005d0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000005e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000005f0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00000600: 2020 2020 2020 2020 2020 6b20 3d20 696e            k = in
+00000610: 7428 6b29 0a20 2020 2020 2020 2020 2020  t(k).           
+00000620: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00000630: 6973 696e 7374 616e 6365 2861 722c 6c69  isinstance(ar,li
+00000640: 7374 2920 6f72 206c 656e 2861 7229 203c  st) or len(ar) <
+00000650: 206b 3a0a 2020 2020 2020 2020 2020 2020   k:.            
+00000660: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00000670: 6520 5661 6c75 6545 7272 6f72 2822 496e  e ValueError("In
+00000680: 6465 7822 2c6b 2c22 6f75 7420 6f66 2062  dex",k,"out of b
+00000690: 6f75 6e64 7322 2c6c 656e 2861 7229 290a  ounds",len(ar)).
 000006a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000006b0: 2020 7265 7475 726e 2022 220a 2020 2020    return "".    
-000006c0: 2020 2020 2020 2020 2020 2020 6172 203d              ar =
-000006d0: 2061 725b 6b5d 0a20 2020 2020 2020 2072   ar[k].        r
-000006e0: 6574 7572 6e20 6172 0a0a 0a63 6c61 7373  eturn ar...class
-000006f0: 2069 4644 4f5f 5265 6164 6572 3a0a 2020   iFDO_Reader:.  
-00000700: 2020 2220 5072 6f76 6964 6573 2063 6f6e    " Provides con
-00000710: 7665 6e69 656e 7420 6675 6e63 7469 6f6e  venient function
-00000720: 7320 666f 7220 7265 6164 696e 6720 6461  s for reading da
-00000730: 7461 2066 726f 6d20 6946 444f 2066 696c  ta from iFDO fil
-00000740: 6573 2022 0a0a 2020 2020 6465 6620 5f5f  es "..    def __
-00000750: 696e 6974 5f5f 2873 656c 662c 2069 4644  init__(self, iFD
-00000760: 4f66 696c 653a 7374 7229 3a0a 2020 2020  Ofile:str):.    
-00000770: 2020 2020 2220 5072 6f76 6964 6573 2063      " Provides c
-00000780: 6f6e 7665 6e69 656e 7420 6675 6e63 7469  onvenient functi
-00000790: 6f6e 7320 666f 7220 7265 6164 696e 6720  ons for reading 
-000007a0: 6461 7461 2066 726f 6d20 6946 444f 2066  data from iFDO f
-000007b0: 696c 6573 2022 0a20 2020 2020 2020 200a  iles ".        .
-000007c0: 2020 2020 2020 2020 7365 6c66 2e69 4644          self.iFD
-000007d0: 4f66 696c 6520 3d20 6946 444f 6669 6c65  Ofile = iFDOfile
-000007e0: 0a20 2020 2020 2020 206f 203d 206f 7065  .        o = ope
-000007f0: 6e28 7365 6c66 2e69 4644 4f66 696c 652c  n(self.iFDOfile,
-00000800: 2027 7227 290a 2020 2020 2020 2020 7365   'r').        se
-00000810: 6c66 2e69 6664 6f20 3d20 7961 6d6c 2e6c  lf.ifdo = yaml.l
-00000820: 6f61 6428 6f2c 2020 4c6f 6164 6572 3d79  oad(o,  Loader=y
-00000830: 616d 6c2e 434c 6f61 6465 7229 0a20 2020  aml.CLoader).   
-00000840: 2020 2020 206f 2e63 6c6f 7365 2829 0a0a       o.close()..
-00000850: 0a20 2020 2064 6566 205f 5f67 6574 6974  .    def __getit
-00000860: 656d 5f5f 2873 656c 662c 206b 6579 7329  em__(self, keys)
-00000870: 3a0a 2020 2020 2020 2020 2222 2220 5265  :.        """ Re
-00000880: 7475 726e 7320 636f 7079 206f 6620 6368  turns copy of ch
-00000890: 6563 6b65 6420 6966 646f 2073 6574 206f  ecked ifdo set o
-000008a0: 7220 6974 656d 2066 6965 6c64 2076 616c  r item field val
-000008b0: 7565 2c20 616c 736f 2063 6f6e 7369 6465  ue, also conside
-000008c0: 726e 6720 6465 6661 756c 7420 7661 6c75  rng default valu
-000008d0: 6573 2066 726f 6d20 6865 6164 6572 2e0a  es from header..
-000008e0: 2020 2020 2020 2020 2020 2020 5573 6520              Use 
-000008f0: 6b65 7973 2061 7320 652e 672e 2027 3c69  keys as e.g. '<i
-00000900: 7465 6d3e 3a3c 6b65 793e 3a2e 2e2e 272e  tem>:<key>:...'.
-00000910: 2043 616e 2062 6520 7573 6564 2066 6f72   Can be used for
-00000920: 2068 6561 6465 7220 6669 656c 6473 2061   header fields a
-00000930: 7320 7765 6c6c 2061 7320 6974 656d 2066  s well as item f
-00000940: 6965 6c64 732e 0a20 2020 2020 2020 2020  ields..         
-00000950: 2020 2049 7465 6d20 696e 6465 7820 6361     Item index ca
-00000960: 6e20 6265 206c 6567 6c65 6374 6564 2c20  n be leglected, 
-00000970: 696e 2063 6173 6520 6f66 2076 6964 656f  in case of video
-00000980: 2061 2064 6963 7420 7b3c 696d 6167 652d   a dict {<image-
-00000990: 6461 7461 7469 6d65 3e3a 3c76 616c 7565  datatime>:<value
-000009a0: 3e2c 2e2e 2e7d 2069 7320 7265 7475 726e  >,...} is return
-000009b0: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
-000009c0: 5261 6973 6573 2049 6664 6f45 7863 6570  Raises IfdoExcep
-000009d0: 7469 6f6e 2069 6620 6974 656d 2064 6f65  tion if item doe
-000009e0: 7320 6e6f 7420 6578 6973 742e 2022 2222  s not exist. """
-000009f0: 0a20 2020 2020 2020 206b 6579 7320 3d20  .        keys = 
-00000a00: 6b65 7973 2e73 706c 6974 2827 3a27 290a  keys.split(':').
-00000a10: 2020 2020 2020 2020 7265 7475 726e 2069          return i
-00000a20: 4644 4f2e 5f69 4644 4f5f 5f67 6574 4669  FDO._iFDO__getFi
-00000a30: 656c 6456 616c 7565 2873 656c 662e 6966  eldValue(self.if
-00000a40: 646f 2c6b 6579 7329 0a0a 0a20 2020 2064  do,keys)...    d
-00000a50: 6566 2067 6574 496d 6167 6573 506f 7369  ef getImagesPosi
-00000a60: 7469 6f6e 7328 7365 6c66 2c69 6d61 6765  tions(self,image
-00000a70: 5f74 7970 6573 3d6d 6971 7476 2e69 6d61  _types=miqtv.ima
-00000a80: 6765 5f74 7970 6573 293a 0a20 2020 2020  ge_types):.     
-00000a90: 2020 2022 2222 2052 6574 7572 6e73 2069     """ Returns i
-00000aa0: 6d61 6765 7320 6669 7273 7420 706f 7369  mages first posi
-00000ab0: 7469 6f6e 2873 2920 0a20 2020 2020 2020  tion(s) .       
-00000ac0: 2020 2020 2040 7265 7475 726e 3a20 7b27       @return: {'
-00000ad0: 696d 6167 654e 616d 6527 3a20 5b7b 276c  imageName': [{'l
-00000ae0: 6174 273a 2076 616c 7565 2c20 276c 6f6e  at': value, 'lon
-00000af0: 273a 2076 616c 7565 2c20 2764 6174 6574  ': value, 'datet
-00000b00: 696d 6527 3a20 7661 6c75 657d 5d7d 2c20  ime': value}]}, 
-00000b10: 696d 6167 652d 636f 6f72 6469 6e61 7465  image-coordinate
-00000b20: 2d72 6566 6572 656e 6365 2d73 7973 7465  -reference-syste
-00000b30: 6d20 2222 220a 2020 2020 2020 2020 0a20  m """.        . 
-00000b40: 2020 2020 2020 2072 6574 4469 6374 203d         retDict =
-00000b50: 207b 7d0a 2020 2020 2020 2020 7265 7452   {}.        retR
-00000b60: 6566 7379 7320 3d20 7365 6c66 2e69 6664  efsys = self.ifd
-00000b70: 6f5b 6d69 7174 762e 696d 6167 655f 7365  o[miqtv.image_se
-00000b80: 745f 6865 6164 6572 5f6b 6579 5d5b 2769  t_header_key]['i
-00000b90: 6d61 6765 2d63 6f6f 7264 696e 6174 652d  mage-coordinate-
-00000ba0: 7265 6665 7265 6e63 652d 7379 7374 656d  reference-system
-00000bb0: 275d 0a0a 2020 2020 2020 2020 6865 6164  ']..        head
-00000bc0: 6572 5661 6c4c 6174 203d 204e 6f6e 650a  erValLat = None.
-00000bd0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00000be0: 2020 2020 2020 2020 2068 6561 6465 7256           headerV
-00000bf0: 616c 4c61 7420 3d20 7365 6c66 2e69 6664  alLat = self.ifd
-00000c00: 6f5b 6d69 7174 762e 696d 6167 655f 7365  o[miqtv.image_se
-00000c10: 745f 6865 6164 6572 5f6b 6579 5d5b 2769  t_header_key]['i
-00000c20: 6d61 6765 2d6c 6174 6974 7564 6527 5d0a  mage-latitude'].
-00000c30: 2020 2020 2020 2020 6578 6365 7074 204b          except K
-00000c40: 6579 4572 726f 723a 0a20 2020 2020 2020  eyError:.       
-00000c50: 2020 2020 2070 6173 730a 0a20 2020 2020       pass..     
-00000c60: 2020 2068 6561 6465 7256 616c 4c6f 6e20     headerValLon 
-00000c70: 3d20 4e6f 6e65 0a20 2020 2020 2020 2074  = None.        t
-00000c80: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00000c90: 6865 6164 6572 5661 6c4c 6f6e 203d 2073  headerValLon = s
-00000ca0: 656c 662e 6966 646f 5b6d 6971 7476 2e69  elf.ifdo[miqtv.i
-00000cb0: 6d61 6765 5f73 6574 5f68 6561 6465 725f  mage_set_header_
-00000cc0: 6b65 795d 5b27 696d 6167 652d 6c6f 6e67  key]['image-long
-00000cd0: 6974 7564 6527 5d0a 2020 2020 2020 2020  itude'].        
-00000ce0: 6578 6365 7074 204b 6579 4572 726f 723a  except KeyError:
-00000cf0: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
-00000d00: 730a 0a0a 2020 2020 2020 2020 666f 7220  s...        for 
-00000d10: 6669 6c65 4e61 6d65 2069 6e20 7365 6c66  fileName in self
-00000d20: 2e69 6664 6f5b 6d69 7174 762e 696d 6167  .ifdo[miqtv.imag
-00000d30: 655f 7365 745f 6974 656d 735f 6b65 795d  e_set_items_key]
-00000d40: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00000d50: 2066 696c 654e 616d 652e 7370 6c69 7428   fileName.split(
-00000d60: 272e 2729 5b2d 315d 2e6c 6f77 6572 2829  '.')[-1].lower()
-00000d70: 2069 6e20 696d 6167 655f 7479 7065 733a   in image_types:
-00000d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00000d90: 2072 6574 4469 6374 5b66 696c 654e 616d   retDict[fileNam
-00000da0: 655d 203d 2073 656c 662e 5f5f 6765 7449  e] = self.__getI
-00000db0: 7465 6d4c 6174 4c6f 6e28 6669 6c65 4e61  temLatLon(fileNa
-00000dc0: 6d65 2c68 6561 6465 7256 616c 4c61 742c  me,headerValLat,
-00000dd0: 6865 6164 6572 5661 6c4c 6f6e 290a 0a20  headerValLon).. 
-00000de0: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-00000df0: 7444 6963 742c 2072 6574 5265 6673 7973  tDict, retRefsys
-00000e00: 0a0a 0a20 2020 2064 6566 2077 7269 7465  ...    def write
-00000e10: 576f 726c 6446 696c 6573 466f 7250 686f  WorldFilesForPho
-00000e20: 746f 7328 7365 6c66 2c64 6573 7444 6972  tos(self,destDir
-00000e30: 3a73 7472 2c69 6d61 6765 536f 7572 6365  :str,imageSource
-00000e40: 4469 723a 7374 7229 3a0a 2020 2020 2020  Dir:str):.      
-00000e50: 2020 2222 2220 5772 6974 6573 2077 6f72    """ Writes wor
-00000e60: 6c64 2066 696c 6573 2066 6f72 2070 686f  ld files for pho
-00000e70: 746f 7320 6966 2061 6c6c 2072 6571 7569  tos if all requi
-00000e80: 7265 6420 6669 656c 6473 2061 7265 2074  red fields are t
-00000e90: 6865 7265 2075 6e64 6572 2074 6865 2061  here under the a
-00000ea0: 7373 756d 7074 696f 6e20 7468 6174 2074  ssumption that t
-00000eb0: 6865 2063 616d 6572 6120 7761 7320 6c6f  he camera was lo
-00000ec0: 6f6b 696e 6720 7374 7261 6967 6874 2064  oking straight d
-00000ed0: 6f77 6e20 2870 6974 6368 2061 6e64 2072  own (pitch and r
-00000ee0: 6f6c 6c20 6172 6520 6967 6e6f 7265 6421  oll are ignored!
-00000ef0: 292e 200a 2020 2020 2020 2020 2020 2020  ). .            
-00000f00: 5265 7475 726e 7320 6120 6c69 7374 206f  Returns a list o
-00000f10: 6620 6974 656d 7320 666f 7220 7768 6963  f items for whic
-00000f20: 6820 6372 6561 7469 6f6e 2066 6169 6c65  h creation faile
-00000f30: 643a 205b 5b69 7465 6d2c 6d73 675d 2c2e  d: [[item,msg],.
-00000f40: 2e2e 5d22 2222 0a0a 2020 2020 2020 2020  ..]"""..        
-00000f50: 2320 544f 444f 2067 6574 2069 6d61 6765  # TODO get image
-00000f60: 7320 6f6e 6c69 6e65 2066 726f 6d20 6272  s online from br
-00000f70: 6f6b 6572 0a0a 2020 2020 2020 2020 6946  oker..        iF
-00000f80: 444f 6578 6365 7074 696f 6e73 203d 205b  DOexceptions = [
-00000f90: 5d0a 0a20 2020 2020 2020 2023 2067 6574  ]..        # get
-00000fa0: 2069 6d61 6765 7320 706f 7369 7469 6f6e   images position
-00000fb0: 0a20 2020 2020 2020 2070 6f73 6974 696f  .        positio
-00000fc0: 6e73 4c61 744c 6f6e 2c20 7265 6673 7973  nsLatLon, refsys
-00000fd0: 203d 2073 656c 662e 6765 7449 6d61 6765   = self.getImage
-00000fe0: 7350 6f73 6974 696f 6e73 2869 6d61 6765  sPositions(image
-00000ff0: 5f74 7970 6573 3d6d 6971 7476 2e70 686f  _types=miqtv.pho
-00001000: 746f 5f74 7970 6573 290a 2020 2020 2020  to_types).      
-00001010: 2020 6372 7346 6965 6c64 546d 7020 3d20    crsFieldTmp = 
-00001020: 2727 2e6a 6f69 6e28 6520 666f 7220 6520  ''.join(e for e 
-00001030: 696e 2072 6566 7379 7320 6966 2065 2e69  in refsys if e.i
-00001040: 7361 6c6e 756d 2829 292e 6c6f 7765 7228  salnum()).lower(
-00001050: 290a 2020 2020 2020 2020 6966 2063 7273  ).        if crs
-00001060: 4669 656c 6454 6d70 203d 3d20 2777 6773  FieldTmp == 'wgs
-00001070: 3834 2720 6f72 2063 7273 4669 656c 6454  84' or crsFieldT
-00001080: 6d70 203d 3d20 2765 7073 6734 3332 3627  mp == 'epsg4326'
-00001090: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-000010a0: 6673 7973 203d 2022 5747 5338 3422 0a20  fsys = "WGS84". 
-000010b0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000010c0: 2020 2020 2020 2020 2069 4644 4f65 7863           iFDOexc
-000010d0: 6570 7469 6f6e 732e 6170 7065 6e64 285b  eptions.append([
-000010e0: 2222 2c22 436f 6f72 6469 6e61 7465 7320  "","Coordinates 
-000010f0: 7265 6665 7265 6e63 6520 7379 7374 656d  reference system
-00001100: 205c 2222 202b 2072 6566 7379 7320 2b20   \"" + refsys + 
-00001110: 225c 2220 6361 6e20 6e6f 7420 6265 2068  "\" can not be h
-00001120: 616e 646c 6564 2e20 5573 6520 7072 6566  andled. Use pref
-00001130: 6572 6162 6c79 2045 5053 473a 3433 3236  erably EPSG:4326
-00001140: 206f 7220 5747 5338 3422 5d29 0a20 2020   or WGS84"]).   
-00001150: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00001160: 6946 444f 6578 6365 7074 696f 6e73 0a0a  iFDOexceptions..
-00001170: 0a20 2020 2020 2020 2066 6f72 2070 686f  .        for pho
-00001180: 746f 2069 6e20 706f 7369 7469 6f6e 734c  to in positionsL
-00001190: 6174 4c6f 6e3a 0a20 2020 2020 2020 2020  atLon:.         
-000011a0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-000011b0: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
-000011c0: 636b 4974 656d 4861 7368 2870 686f 746f  ckItemHash(photo
-000011d0: 2c69 6d61 6765 536f 7572 6365 4469 7229  ,imageSourceDir)
-000011e0: 2023 2054 4f44 4f20 636f 756c 6420 6265   # TODO could be
-000011f0: 2069 6e20 6469 6666 6572 656e 7420 7375   in different su
-00001200: 6266 6f6c 6465 7220 6f72 2066 726f 6d20  bfolder or from 
-00001210: 6f6e 6c69 6e65 2062 726f 6b65 720a 0a20  online broker.. 
-00001220: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00001230: 2063 6f6e 7665 7274 2074 6f20 7574 6d20   convert to utm 
-00001240: 746f 2061 766f 6964 2070 7265 6369 7369  to avoid precisi
-00001250: 6f6e 2069 7373 7565 2077 6974 6820 6c61  on issue with la
-00001260: 742f 6c6f 6e20 7661 6c75 6573 2069 6e20  t/lon values in 
-00001270: 776f 726c 6420 6669 6c65 730a 2020 2020  world files.    
-00001280: 2020 2020 2020 2020 2020 2020 6c61 7420              lat 
-00001290: 3d20 706f 7369 7469 6f6e 734c 6174 4c6f  = positionsLatLo
-000012a0: 6e5b 7068 6f74 6f5d 5b30 5d5b 276c 6174  n[photo][0]['lat
-000012b0: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
-000012c0: 2020 206c 6f6e 203d 2070 6f73 6974 696f     lon = positio
-000012d0: 6e73 4c61 744c 6f6e 5b70 686f 746f 5d5b  nsLatLon[photo][
-000012e0: 305d 5b27 6c6f 6e27 5d0a 2020 2020 2020  0]['lon'].      
-000012f0: 2020 2020 2020 2020 2020 6561 7374 696e            eastin
-00001300: 672c 6e6f 7274 6869 6e67 2c7a 6f6e 652c  g,northing,zone,
-00001310: 6973 4e6f 7274 6820 3d20 6d69 7174 672e  isNorth = miqtg.
-00001320: 6c61 744c 6f6e 3275 746d 286c 6174 2c6c  latLon2utm(lat,l
-00001330: 6f6e 2c72 6566 7379 7329 0a20 2020 2020  on,refsys).     
-00001340: 2020 2020 2020 2020 2020 2065 7869 6620             exif 
-00001350: 3d20 7365 6c66 2e5f 5f67 6574 4974 656d  = self.__getItem
-00001360: 4465 6661 756c 7456 616c 7565 2870 686f  DefaultValue(pho
-00001370: 746f 2c27 696d 6167 652d 6163 7175 6973  to,'image-acquis
-00001380: 6974 696f 6e2d 7365 7474 696e 6773 2729  ition-settings')
-00001390: 2023 2054 4f44 4f20 7768 6174 2069 6620   # TODO what if 
-000013a0: 6e6f 7420 7468 6572 653f 2072 6561 6420  not there? read 
-000013b0: 6672 6f6d 2069 6d61 6765 2064 6972 6563  from image direc
-000013c0: 746c 793f 2053 686f 756c 6420 6265 2063  tly? Should be c
-000013d0: 6865 636b 6564 2069 6620 6861 7368 206d  hecked if hash m
-000013e0: 6174 6368 6573 3f20 496d 6167 6520 636f  atches? Image co
-000013f0: 756c 6420 6861 7665 2062 6565 6e20 6372  uld have been cr
-00001400: 6f70 7065 6420 6166 7465 7220 6946 444f  opped after iFDO
-00001410: 2063 7265 6174 696f 6e0a 2020 2020 2020   creation.      
-00001420: 2020 2020 2020 2020 2020 696d 6167 6557            imageW
-00001430: 6964 7468 203d 2069 6e74 2873 7472 2865  idth = int(str(e
-00001440: 7869 665b 2749 6d61 6765 2057 6964 7468  xif['Image Width
-00001450: 275d 292e 7374 7269 7028 275c 2727 2929  ']).strip('\''))
-00001460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001470: 2069 6d61 6765 4865 6967 6874 203d 2069   imageHeight = i
-00001480: 6e74 2873 7472 2865 7869 665b 2749 6d61  nt(str(exif['Ima
-00001490: 6765 2048 6569 6768 7427 5d29 2e73 7472  ge Height']).str
-000014a0: 6970 2827 5c27 2729 290a 2020 2020 2020  ip('\'')).      
-000014b0: 2020 2020 2020 2020 2020 6865 6164 696e            headin
-000014c0: 6720 3d20 7365 6c66 2e5f 5f67 6574 4974  g = self.__getIt
-000014d0: 656d 4465 6661 756c 7456 616c 7565 2870  emDefaultValue(p
-000014e0: 686f 746f 2c27 696d 6167 652d 6361 6d65  hoto,'image-came
-000014f0: 7261 2d79 6177 2d64 6567 7265 6573 2729  ra-yaw-degrees')
-00001500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001510: 2061 6c74 6974 7564 6520 3d20 7365 6c66   altitude = self
-00001520: 2e5f 5f67 6574 4974 656d 4465 6661 756c  .__getItemDefaul
-00001530: 7456 616c 7565 2870 686f 746f 2c27 696d  tValue(photo,'im
-00001540: 6167 652d 6d65 7465 7273 2d61 626f 7665  age-meters-above
-00001550: 2d67 726f 756e 6427 290a 0a20 2020 2020  -ground')..     
-00001560: 2020 2020 2020 2020 2020 2064 6f6d 6550             domeP
-00001570: 6f72 742c 6d73 6720 3d20 7365 6c66 2e5f  ort,msg = self._
-00001580: 5f74 7279 4765 7449 7344 6f6d 6550 6f72  _tryGetIsDomePor
-00001590: 7428 7068 6f74 6f29 0a20 2020 2020 2020  t(photo).       
-000015a0: 2020 2020 2020 2020 2066 6f63 616c 4c65           focalLe
-000015b0: 6e67 6850 6978 656c 732c 206d 7367 203d  nghPixels, msg =
-000015c0: 2073 656c 662e 5f5f 7472 7947 6574 466f   self.__tryGetFo
-000015d0: 6361 6c4c 656e 6774 6849 6e50 6978 656c  calLengthInPixel
-000015e0: 7328 7068 6f74 6f2c 2064 6f6d 6550 6f72  s(photo, domePor
-000015f0: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
-00001600: 2020 2069 6620 666f 6361 6c4c 656e 6768     if focalLengh
-00001610: 5069 7865 6c73 203d 3d20 5b2d 312c 2d31  Pixels == [-1,-1
-00001620: 5d20 6f72 2066 6f63 616c 4c65 6e67 6850  ] or focalLenghP
-00001630: 6978 656c 7320 3d3d 202d 313a 0a20 2020  ixels == -1:.   
-00001640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001650: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
-00001660: 6f45 7863 6570 7469 6f6e 286d 7367 290a  oException(msg).
-00001670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001680: 6d69 7174 672e 7772 6974 6553 696d 706c  miqtg.writeSimpl
-00001690: 6555 746d 576f 726c 6446 696c 6528 6f73  eUtmWorldFile(os
-000016a0: 2e70 6174 682e 6a6f 696e 2864 6573 7444  .path.join(destD
-000016b0: 6972 2c6d 6971 7467 2e63 6f6e 7665 7274  ir,miqtg.convert
-000016c0: 496d 6167 654e 616d 6554 6f57 6f72 6c64  ImageNameToWorld
-000016d0: 4669 6c65 4e61 6d65 2870 686f 746f 2929  FileName(photo))
-000016e0: 2c65 6173 7469 6e67 2c6e 6f72 7468 696e  ,easting,northin
-000016f0: 672c 7a6f 6e65 2c69 734e 6f72 7468 2c69  g,zone,isNorth,i
-00001700: 6d61 6765 5769 6474 682c 696d 6167 6548  mageWidth,imageH
-00001710: 6569 6768 742c 6865 6164 696e 672c 616c  eight,heading,al
-00001720: 7469 7475 6465 2c66 6f63 616c 4c65 6e67  titude,focalLeng
-00001730: 6850 6978 656c 735b 305d 2c66 6f63 616c  hPixels[0],focal
-00001740: 4c65 6e67 6850 6978 656c 735b 315d 290a  LenghPixels[1]).
-00001750: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-00001760: 7074 206d 6971 7463 2e49 6664 6f45 7863  pt miqtc.IfdoExc
-00001770: 6570 7469 6f6e 2061 7320 653a 0a20 2020  eption as e:.   
-00001780: 2020 2020 2020 2020 2020 2020 2069 4644               iFD
-00001790: 4f65 7863 6570 7469 6f6e 732e 6170 7065  Oexceptions.appe
-000017a0: 6e64 285b 7068 6f74 6f2c 7374 7228 652e  nd([photo,str(e.
-000017b0: 6172 6773 295d 290a 0a20 2020 2020 2020  args)])..       
-000017c0: 2072 6574 7572 6e20 6946 444f 6578 6365   return iFDOexce
-000017d0: 7074 696f 6e73 0a0a 0a20 2020 2064 6566  ptions...    def
-000017e0: 2063 6865 636b 4974 656d 4861 7368 2873   checkItemHash(s
-000017f0: 656c 662c 6974 656d 3a73 7472 2c66 696c  elf,item:str,fil
-00001800: 6544 6972 3a73 7472 293a 0a20 2020 2020  eDir:str):.     
-00001810: 2020 2022 2222 2063 6f6d 7061 7265 7320     """ compares 
-00001820: 6669 6c65 2773 2068 6173 6820 7769 7468  file's hash with
-00001830: 2068 6173 6820 696e 2069 4644 4f20 616e   hash in iFDO an
-00001840: 6420 7468 726f 7773 2065 7863 6570 7469  d throws excepti
-00001850: 6f6e 2069 6620 7468 6579 2064 6f6e 2774  on if they don't
-00001860: 206d 6174 6368 2022 2222 0a0a 2020 2020   match """..    
-00001870: 2020 2020 6669 6c65 203d 206f 732e 7061      file = os.pa
-00001880: 7468 2e6a 6f69 6e28 6669 6c65 4469 722c  th.join(fileDir,
-00001890: 6974 656d 290a 2020 2020 2020 2020 6966  item).        if
-000018a0: 206e 6f74 206f 732e 7061 7468 2e69 7366   not os.path.isf
-000018b0: 696c 6528 6669 6c65 293a 0a20 2020 2020  ile(file):.     
-000018c0: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
-000018d0: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
-000018e0: 2822 4669 6c65 205c 2222 202b 2069 7465  ("File \"" + ite
-000018f0: 6d20 2b20 225c 2220 6e6f 7420 666f 756e  m + "\" not foun
-00001900: 6420 696e 2064 6972 205c 2222 202b 2066  d in dir \"" + f
-00001910: 696c 6544 6972 202b 2022 5c22 2229 0a0a  ileDir + "\"")..
-00001920: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00001930: 7461 6e63 6528 7365 6c66 2e69 6664 6f5b  tance(self.ifdo[
-00001940: 6d69 7174 762e 696d 6167 655f 7365 745f  miqtv.image_set_
-00001950: 6974 656d 735f 6b65 795d 5b69 7465 6d5d  items_key][item]
-00001960: 2c6c 6973 7429 3a20 2320 696e 2063 6173  ,list): # in cas
-00001970: 6520 6f66 2076 6964 656f 2077 6974 6820  e of video with 
-00001980: 6974 656d 2061 7320 6c69 7374 2074 6865  item as list the
-00001990: 2066 6972 7374 2065 6e74 7279 2068 6f6c   first entry hol
-000019a0: 6473 2074 6865 2064 6566 6175 6c74 2061  ds the default a
-000019b0: 6e64 2074 6865 2068 6173 6820 6361 6e6e  nd the hash cann
-000019c0: 6f74 2076 6172 7920 666f 7220 7468 6520  ot vary for the 
-000019d0: 7361 6d65 2069 6d61 6765 0a20 2020 2020  same image.     
-000019e0: 2020 2020 2020 2069 7465 6d45 6e74 7279         itemEntry
-000019f0: 203d 2073 656c 662e 6966 646f 5b6d 6971   = self.ifdo[miq
-00001a00: 7476 2e69 6d61 6765 5f73 6574 5f69 7465  tv.image_set_ite
-00001a10: 6d73 5f6b 6579 5d5b 6974 656d 5d5b 305d  ms_key][item][0]
-00001a20: 200a 2020 2020 2020 2020 656c 7365 3a0a   .        else:.
-00001a30: 2020 2020 2020 2020 2020 2020 6974 656d              item
-00001a40: 456e 7472 7920 3d20 7365 6c66 2e69 6664  Entry = self.ifd
-00001a50: 6f5b 6d69 7174 762e 696d 6167 655f 7365  o[miqtv.image_se
-00001a60: 745f 6974 656d 735f 6b65 795d 5b69 7465  t_items_key][ite
-00001a70: 6d5d 0a20 2020 2020 2020 2069 6620 6e6f  m].        if no
-00001a80: 7420 6974 656d 456e 7472 795b 2769 6d61  t itemEntry['ima
-00001a90: 6765 2d68 6173 682d 7368 6132 3536 275d  ge-hash-sha256']
-00001aa0: 203d 3d20 6d69 7174 632e 7368 6132 3536   == miqtc.sha256
-00001ab0: 4861 7368 4669 6c65 2866 696c 6529 3a0a  HashFile(file):.
-00001ac0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00001ad0: 6520 6d69 7174 632e 4966 646f 4578 6365  e miqtc.IfdoExce
-00001ae0: 7074 696f 6e28 6974 656d 2c20 2269 4644  ption(item, "iFD
-00001af0: 4f20 656e 7472 7920 6973 206e 6f74 2075  O entry is not u
-00001b00: 7020 746f 2064 6174 652c 2069 6d61 6765  p to date, image
-00001b10: 2068 6173 6820 646f 6573 206e 6f74 206d   hash does not m
-00001b20: 6174 6368 2e22 290a 0a20 2020 2064 6566  atch.")..    def
-00001b30: 2067 6574 496d 6167 6544 6972 6563 746f   getImageDirecto
-00001b40: 7279 2873 656c 6629 3a0a 2020 2020 2020  ry(self):.      
-00001b50: 2020 2222 2220 5265 7475 726e 7320 7468    """ Returns th
-00001b60: 6520 6c6f 7765 726d 6f73 7420 6c6f 6361  e lowermost loca
-00001b70: 6c20 6469 7265 6374 6f72 7920 636f 6e74  l directory cont
-00001b80: 6169 6e69 6e67 2074 6865 2069 6d61 6765  aining the image
-00001b90: 2066 696c 6573 2069 6e66 6572 7265 6420   files inferred 
-00001ba0: 6672 6f6d 2027 696d 6167 652d 6c6f 6361  from 'image-loca
-00001bb0: 6c2d 7061 7468 272e 2049 6620 2769 6d61  l-path'. If 'ima
-00001bc0: 6765 2d6c 6f63 616c 2d70 6174 6827 206e  ge-local-path' n
-00001bd0: 6f74 2070 726f 7669 6465 6420 666f 7220  ot provided for 
-00001be0: 616c 6c20 696d 6167 6520 6974 656d 7320  all image items 
-00001bf0: 7468 6520 6946 444f 2773 2070 6172 656e  the iFDO's paren
-00001c00: 7420 6469 7265 6374 6f72 7920 6973 2072  t directory is r
-00001c10: 6574 7572 6e65 642e 2022 2222 0a20 2020  eturned. """.   
-00001c20: 2020 2020 206c 6f63 616c 5061 7468 7320       localPaths 
-00001c30: 3d20 5b5d 0a20 2020 2020 2020 2069 4644  = [].        iFD
-00001c40: 4f46 696c 6550 6172 656e 7444 6972 203d  OFileParentDir =
-00001c50: 206f 732e 7061 7468 2e64 6972 6e61 6d65   os.path.dirname
-00001c60: 286f 732e 7061 7468 2e64 6972 6e61 6d65  (os.path.dirname
-00001c70: 2873 656c 662e 6946 444f 6669 6c65 2929  (self.iFDOfile))
-00001c80: 0a20 2020 2020 2020 2066 6f72 2069 7465  .        for ite
-00001c90: 6d20 696e 2073 656c 662e 6966 646f 5b6d  m in self.ifdo[m
-00001ca0: 6971 7476 2e69 6d61 6765 5f73 6574 5f69  iqtv.image_set_i
-00001cb0: 7465 6d73 5f6b 6579 5d3a 0a20 2020 2020  tems_key]:.     
-00001cc0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00001cd0: 2020 2020 2020 2020 2020 2020 6974 656d              item
-00001ce0: 4c6f 6361 6c50 6174 6820 3d20 7365 6c66  LocalPath = self
-00001cf0: 2e5f 5f67 6574 4974 656d 4465 6661 756c  .__getItemDefaul
-00001d00: 7456 616c 7565 2869 7465 6d2c 2769 6d61  tValue(item,'ima
-00001d10: 6765 2d6c 6f63 616c 2d70 6174 6827 290a  ge-local-path').
-00001d20: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-00001d30: 7074 206d 6971 7463 2e49 6664 6f45 7863  pt miqtc.IfdoExc
-00001d40: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
-00001d50: 2020 2020 2020 2020 6974 656d 4c6f 6361          itemLoca
-00001d60: 6c50 6174 6820 3d20 6946 444f 4669 6c65  lPath = iFDOFile
-00001d70: 5061 7265 6e74 4469 720a 2020 2020 2020  ParentDir.      
-00001d80: 2020 2020 2020 6966 2069 7465 6d4c 6f63        if itemLoc
-00001d90: 616c 5061 7468 206e 6f74 2069 6e20 6c6f  alPath not in lo
-00001da0: 6361 6c50 6174 6873 3a0a 2020 2020 2020  calPaths:.      
-00001db0: 2020 2020 2020 2020 2020 6c6f 6361 6c50            localP
-00001dc0: 6174 6873 2e61 7070 656e 6428 6974 656d  aths.append(item
-00001dd0: 4c6f 6361 6c50 6174 6829 0a20 2020 2020  LocalPath).     
-00001de0: 2020 2063 6f6d 6d6f 6e50 6174 6820 3d20     commonPath = 
-00001df0: 6f73 2e70 6174 682e 636f 6d6d 6f6e 7061  os.path.commonpa
-00001e00: 7468 286c 6f63 616c 5061 7468 7329 0a20  th(localPaths). 
-00001e10: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
-00001e20: 2e70 6174 682e 6973 6162 7328 636f 6d6d  .path.isabs(comm
-00001e30: 6f6e 5061 7468 293a 0a20 2020 2020 2020  onPath):.       
-00001e40: 2020 2020 2063 6f6d 6d6f 6e50 6174 6820       commonPath 
-00001e50: 3d20 6f73 2e70 6174 682e 6e6f 726d 7061  = os.path.normpa
-00001e60: 7468 286f 732e 7061 7468 2e6a 6f69 6e28  th(os.path.join(
-00001e70: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
-00001e80: 7365 6c66 2e69 4644 4f66 696c 6529 2c20  self.iFDOfile), 
-00001e90: 636f 6d6d 6f6e 5061 7468 2929 0a20 2020  commonPath)).   
-00001ea0: 2020 2020 2072 6574 7572 6e20 636f 6d6d       return comm
-00001eb0: 6f6e 5061 7468 0a0a 0a20 2020 2064 6566  onPath...    def
-00001ec0: 205f 5f74 7279 4765 7449 7344 6f6d 6550   __tryGetIsDomeP
-00001ed0: 6f72 7428 7365 6c66 2c69 7465 6d29 3a0a  ort(self,item):.
-00001ee0: 2020 2020 2020 2020 2222 2220 5472 6965          """ Trie
-00001ef0: 7320 746f 2072 6561 6420 706f 7274 2074  s to read port t
-00001f00: 7970 6520 6672 6f6d 2027 696d 6167 652d  ype from 'image-
-00001f10: 6361 6d65 7261 2d68 6f75 7369 6e67 2d76  camera-housing-v
-00001f20: 6965 7770 6f72 7427 5b76 6965 7770 6f72  iewport'[viewpor
-00001f30: 742d 7479 7065 5d20 6f72 2027 696d 6167  t-type] or 'imag
-00001f40: 652d 666c 6174 706f 7274 2d70 6172 616d  e-flatport-param
-00001f50: 6574 6572 7327 2f27 696d 6167 652d 646f  eters'/'image-do
-00001f60: 6d65 706f 7274 2d70 6172 616d 6574 6572  meport-parameter
-00001f70: 7327 200a 2020 2020 2020 2020 2020 2020  s' .            
-00001f80: 5265 7475 726e 7320 5472 7565 2c6d 7367  Returns True,msg
-00001f90: 2069 6620 646f 6d65 2070 6f72 742c 2046   if dome port, F
-00001fa0: 616c 7365 2c6d 7367 2069 6620 666c 6174  alse,msg if flat
-00001fb0: 2070 6f72 742c 204e 6f6e 652c 6d73 6720   port, None,msg 
-00001fc0: 6f74 6865 7277 6973 6520 2222 220a 0a20  otherwise """.. 
-00001fd0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00001fe0: 2020 2020 2020 2020 706f 7274 5479 7065          portType
-00001ff0: 5374 7220 3d20 7365 6c66 2e5f 5f67 6574  Str = self.__get
-00002000: 4974 656d 4465 6661 756c 7456 616c 7565  ItemDefaultValue
-00002010: 2869 7465 6d2c 2769 6d61 6765 2d63 616d  (item,'image-cam
-00002020: 6572 612d 686f 7573 696e 672d 7669 6577  era-housing-view
-00002030: 706f 7274 2729 0a20 2020 2020 2020 2020  port').         
-00002040: 2020 2070 6f72 7454 7970 6553 7472 203d     portTypeStr =
-00002050: 2070 6f72 7454 7970 6553 7472 5b27 7669   portTypeStr['vi
-00002060: 6577 706f 7274 2d74 7970 6527 5d0a 2020  ewport-type'].  
-00002070: 2020 2020 2020 2020 2020 6966 2027 646f            if 'do
-00002080: 6d65 2720 696e 2070 6f72 7454 7970 6553  me' in portTypeS
-00002090: 7472 2e6c 6f77 6572 2829 2061 6e64 206e  tr.lower() and n
-000020a0: 6f74 2027 666c 6174 2720 696e 2070 6f72  ot 'flat' in por
-000020b0: 7454 7970 6553 7472 2e6c 6f77 6572 2829  tTypeStr.lower()
-000020c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000020d0: 2020 7265 7475 726e 2054 7275 652c 2250    return True,"P
-000020e0: 6172 7365 6420 6672 6f6d 2027 696d 6167  arsed from 'imag
-000020f0: 652d 6361 6d65 7261 2d68 6f75 7369 6e67  e-camera-housing
-00002100: 2d76 6965 7770 6f72 7427 5b27 7669 6577  -viewport'['view
-00002110: 706f 7274 2d74 7970 6527 5d22 0a20 2020  port-type']".   
-00002120: 2020 2020 2020 2020 2065 6c69 6620 6e6f           elif no
-00002130: 7420 2764 6f6d 6527 2069 6e20 706f 7274  t 'dome' in port
-00002140: 5479 7065 5374 722e 6c6f 7765 7228 2920  TypeStr.lower() 
-00002150: 616e 6420 2766 6c61 7427 2069 6e20 706f  and 'flat' in po
-00002160: 7274 5479 7065 5374 722e 6c6f 7765 7228  rtTypeStr.lower(
-00002170: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00002180: 2020 2072 6574 7572 6e20 4661 6c73 652c     return False,
-00002190: 2250 6172 7365 6420 6672 6f6d 2027 696d  "Parsed from 'im
-000021a0: 6167 652d 6361 6d65 7261 2d68 6f75 7369  age-camera-housi
-000021b0: 6e67 2d76 6965 7770 6f72 7427 5b27 7669  ng-viewport'['vi
-000021c0: 6577 706f 7274 2d74 7970 6527 5d22 0a20  ewport-type']". 
-000021d0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000021e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000021f0: 2072 6574 7572 6e20 4e6f 6e65 2c22 436f   return None,"Co
-00002200: 756c 6420 6e6f 7420 7265 6164 2070 6f72  uld not read por
-00002210: 7420 7479 7065 2066 726f 6d20 2769 6d61  t type from 'ima
-00002220: 6765 2d63 616d 6572 612d 686f 7573 696e  ge-camera-housin
-00002230: 672d 7669 6577 706f 7274 275b 2776 6965  g-viewport'['vie
-00002240: 7770 6f72 742d 7479 7065 275d 2069 6e20  wport-type'] in 
-00002250: 6974 656d 3a20 2220 2b20 6974 656d 0a20  item: " + item. 
-00002260: 2020 2020 2020 2065 7863 6570 7420 286d         except (m
-00002270: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
-00002280: 6f6e 2c20 4b65 7945 7272 6f72 293a 0a20  on, KeyError):. 
-00002290: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
-000022a0: 0a20 2020 2020 2020 2066 6c61 7450 6f72  .        flatPor
-000022b0: 7450 6172 616d 7346 6f75 6e64 203d 2046  tParamsFound = F
-000022c0: 616c 7365 0a20 2020 2020 2020 2074 7279  alse.        try
-000022d0: 3a20 0a20 2020 2020 2020 2020 2020 2066  : .            f
-000022e0: 6c61 7450 6f72 7450 6172 616d 7320 3d20  latPortParams = 
-000022f0: 7365 6c66 2e5f 5f67 6574 4974 656d 4465  self.__getItemDe
-00002300: 6661 756c 7456 616c 7565 2869 7465 6d2c  faultValue(item,
-00002310: 2769 6d61 6765 2d66 6c61 7470 6f72 742d  'image-flatport-
-00002320: 7061 7261 6d65 7465 7273 2729 0a20 2020  parameters').   
-00002330: 2020 2020 2020 2020 2066 6c61 7450 6f72           flatPor
-00002340: 7450 6172 616d 7346 6f75 6e64 203d 2054  tParamsFound = T
-00002350: 7275 650a 2020 2020 2020 2020 6578 6365  rue.        exce
-00002360: 7074 206d 6971 7463 2e49 6664 6f45 7863  pt miqtc.IfdoExc
-00002370: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
-00002380: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
-00002390: 2064 6f6d 6550 6f72 7450 6172 616d 7346   domePortParamsF
-000023a0: 6f75 6e64 203d 2046 616c 7365 0a20 2020  ound = False.   
-000023b0: 2020 2020 2074 7279 3a20 0a20 2020 2020       try: .     
-000023c0: 2020 2020 2020 2064 6f6d 6550 6f72 7450         domePortP
-000023d0: 6172 616d 7320 3d20 7365 6c66 2e5f 5f67  arams = self.__g
-000023e0: 6574 4974 656d 4465 6661 756c 7456 616c  etItemDefaultVal
-000023f0: 7565 2869 7465 6d2c 2769 6d61 6765 2d64  ue(item,'image-d
-00002400: 6f6d 6570 6f72 742d 7061 7261 6d65 7465  omeport-paramete
-00002410: 7273 2729 0a20 2020 2020 2020 2020 2020  rs').           
-00002420: 2064 6f6d 6550 6f72 7450 6172 616d 7346   domePortParamsF
-00002430: 6f75 6e64 203d 2054 7275 650a 2020 2020  ound = True.    
-00002440: 2020 2020 6578 6365 7074 206d 6971 7463      except miqtc
-00002450: 2e49 6664 6f45 7863 6570 7469 6f6e 3a0a  .IfdoException:.
-00002460: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-00002470: 0a0a 2020 2020 2020 2020 6966 2066 6c61  ..        if fla
-00002480: 7450 6f72 7450 6172 616d 7346 6f75 6e64  tPortParamsFound
-00002490: 2061 6e64 2064 6f6d 6550 6f72 7450 6172   and domePortPar
-000024a0: 616d 7346 6f75 6e64 3a0a 2020 2020 2020  amsFound:.      
-000024b0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-000024c0: 652c 2243 6f75 6c64 206e 6f74 2072 6561  e,"Could not rea
-000024d0: 6420 706f 7274 2074 7970 6520 6672 6f6d  d port type from
-000024e0: 2069 7465 6d20 6173 2069 7420 636f 6e74   item as it cont
-000024f0: 6169 6e73 2069 6e66 6f20 6f6e 2062 6f74  ains info on bot
-00002500: 6820 666c 6174 2061 6e64 2064 6f6d 6520  h flat and dome 
-00002510: 706f 7274 3a20 2220 2b20 6974 656d 0a20  port: " + item. 
-00002520: 2020 2020 2020 2069 6620 666c 6174 506f         if flatPo
-00002530: 7274 5061 7261 6d73 466f 756e 643a 0a20  rtParamsFound:. 
-00002540: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00002550: 6e20 4661 6c73 652c 2241 7373 756d 6564  n False,"Assumed
-00002560: 2061 7320 666c 6174 2070 6f72 7420 6173   as flat port as
-00002570: 2027 696d 6167 652d 666c 6174 706f 7274   'image-flatport
-00002580: 2d70 6172 616d 6574 6572 7327 2066 6f75  -parameters' fou
-00002590: 6e64 2069 6e20 6974 656d 3a20 2220 2b20  nd in item: " + 
-000025a0: 6974 656d 0a20 2020 2020 2020 2069 6620  item.        if 
-000025b0: 646f 6d65 506f 7274 5061 7261 6d73 466f  domePortParamsFo
-000025c0: 756e 643a 0a20 2020 2020 2020 2020 2020  und:.           
-000025d0: 2072 6574 7572 6e20 5472 7565 2c22 4173   return True,"As
-000025e0: 7375 6d65 6420 6173 2064 6f6d 6520 706f  sumed as dome po
-000025f0: 7274 2061 7320 2769 6d61 6765 2d64 6f6d  rt as 'image-dom
-00002600: 6570 6f72 742d 7061 7261 6d65 7465 7273  eport-parameters
-00002610: 2720 666f 756e 6420 696e 2069 7465 6d3a  ' found in item:
-00002620: 2022 202b 2069 7465 6d0a 2020 2020 2020   " + item.      
-00002630: 2020 7265 7475 726e 204e 6f6e 652c 2243    return None,"C
-00002640: 6f75 6c64 206e 6f74 2072 6561 6420 706f  ould not read po
-00002650: 7274 2074 7970 6520 6672 6f6d 2069 7465  rt type from ite
-00002660: 6d3a 2022 202b 2069 7465 6d0a 0a0a 2020  m: " + item...  
-00002670: 2020 6465 6620 5f5f 7472 7947 6574 466f    def __tryGetFo
-00002680: 6361 6c4c 656e 6774 6849 6e50 6978 656c  calLengthInPixel
-00002690: 7328 7365 6c66 2c69 7465 6d3a 7374 722c  s(self,item:str,
-000026a0: 646f 6d65 506f 7274 3d4e 6f6e 6529 3a0a  domePort=None):.
-000026b0: 2020 2020 2020 2020 2222 2220 0a20 2020          """ .   
-000026c0: 2020 2020 2054 7269 6573 2074 6f20 7265       Tries to re
-000026d0: 6164 2f64 6574 6572 6d69 6e65 2066 6f63  ad/determine foc
-000026e0: 616c 206c 656e 6774 6820 696e 2070 6978  al length in pix
-000026f0: 656c 7320 6569 7468 6572 2066 726f 6d20  els either from 
-00002700: 2769 6d61 6765 2d63 616d 6572 612d 6361  'image-camera-ca
-00002710: 6c69 6272 6174 696f 6e2d 6d6f 6465 6c27  libration-model'
-00002720: 5b27 6361 6c69 6272 6174 696f 6e2d 666f  ['calibration-fo
-00002730: 6361 6c2d 6c65 6e67 7468 2d78 792d 7069  cal-length-xy-pi
-00002740: 7865 6c27 5d20 6f72 2066 726f 6d20 6578  xel'] or from ex
-00002750: 6966 2076 616c 7565 732e 0a20 2020 2020  if values..     
-00002760: 2020 2069 6620 646f 6d65 506f 7274 203d     if domePort =
-00002770: 2046 616c 7365 2c20 666c 6174 2070 6f72   False, flat por
-00002780: 7420 6973 2061 7373 756d 6564 2061 6e64  t is assumed and
-00002790: 2061 2063 6f72 7265 6374 696f 6e20 6661   a correction fa
-000027a0: 6374 6f72 206f 6620 312e 3333 2069 7320  ctor of 1.33 is 
-000027b0: 6170 706c 6965 6420 666f 7220 666f 6361  applied for foca
-000027c0: 6c20 6c65 6e67 7468 2064 6574 6572 6d69  l length determi
-000027d0: 6e65 6420 6672 6f6d 2065 7869 6620 7661  ned from exif va
-000027e0: 6c75 6573 0a20 2020 2020 2020 2052 6574  lues.        Ret
-000027f0: 7572 6e73 2065 6974 6865 7220 666f 6361  urns either foca
-00002800: 6c4c 656e 6774 682c 206d 6573 7361 6765  lLength, message
-00002810: 206f 7220 5b66 6f63 616c 4c65 6e67 7468   or [focalLength
-00002820: 582c 666f 6361 6c4c 656e 6774 6859 5d2c  X,focalLengthY],
-00002830: 206d 6573 7361 6765 2e20 4966 2075 6e73   message. If uns
-00002840: 7563 6365 7373 6675 6c20 666f 6361 6c4c  uccessful focalL
-00002850: 656e 6774 6820 3d20 2d31 0a20 2020 2020  ength = -1.     
-00002860: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-00002870: 2320 7472 7920 7265 6164 2066 726f 6d20  # try read from 
-00002880: 2769 6d61 6765 2d63 616d 6572 612d 6361  'image-camera-ca
-00002890: 6c69 6272 6174 696f 6e2d 6d6f 6465 6c27  libration-model'
-000028a0: 5b27 6361 6c69 6272 6174 696f 6e2d 666f  ['calibration-fo
-000028b0: 6361 6c2d 6c65 6e67 7468 2d78 792d 7069  cal-length-xy-pi
-000028c0: 7865 6c27 5d0a 2020 2020 2020 2020 7472  xel'].        tr
-000028d0: 793a 0a20 2020 2020 2020 2020 2020 2066  y:.            f
-000028e0: 6f63 616c 4c65 6e67 7468 5859 203d 2073  ocalLengthXY = s
-000028f0: 656c 662e 5f5f 6765 7449 7465 6d44 6566  elf.__getItemDef
-00002900: 6175 6c74 5661 6c75 6528 6974 656d 2c27  aultValue(item,'
-00002910: 696d 6167 652d 6361 6d65 7261 2d63 616c  image-camera-cal
-00002920: 6962 7261 7469 6f6e 2d6d 6f64 656c 2729  ibration-model')
-00002930: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-00002940: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00002950: 2020 666f 6361 6c4c 656e 6774 6858 5920    focalLengthXY 
-00002960: 3d20 666f 6361 6c4c 656e 6774 6858 595b  = focalLengthXY[
-00002970: 2763 616c 6962 7261 7469 6f6e 2d66 6f63  'calibration-foc
-00002980: 616c 2d6c 656e 6774 682d 7879 2d70 6978  al-length-xy-pix
-00002990: 656c 275d 0a20 2020 2020 2020 2020 2020  el'].           
-000029a0: 2065 7863 6570 7420 4b65 7945 7272 6f72   except KeyError
-000029b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000029c0: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
-000029d0: 646f 4578 6365 7074 696f 6e28 6974 656d  doException(item
-000029e0: 2c22 646f 6573 206e 6f74 2063 6f6e 7461  ,"does not conta
-000029f0: 696e 2027 696d 6167 652d 6361 6d65 7261  in 'image-camera
-00002a00: 2d63 616c 6962 7261 7469 6f6e 2d6d 6f64  -calibration-mod
-00002a10: 656c 275b 2763 616c 6962 7261 7469 6f6e  el'['calibration
-00002a20: 2d66 6f63 616c 2d6c 656e 6774 682d 7879  -focal-length-xy
-00002a30: 2d70 6978 656c 275d 2229 0a0a 2020 2020  -pixel']")..    
-00002a40: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-00002a50: 7369 6e73 7461 6e63 6528 666f 6361 6c4c  sinstance(focalL
-00002a60: 656e 6774 6858 592c 6c69 7374 293a 2023  engthXY,list): #
-00002a70: 2078 2061 6e64 2079 2076 616c 7565 2061   x and y value a
-00002a80: 7265 2069 6465 6e74 6963 616c 0a20 2020  re identical.   
-00002a90: 2020 2020 2020 2020 2020 2020 2066 6f63               foc
-00002aa0: 616c 4c65 6e67 7468 5859 203d 205b 666f  alLengthXY = [fo
-00002ab0: 6361 6c4c 656e 6774 6858 592c 666f 6361  calLengthXY,foca
-00002ac0: 6c4c 656e 6774 6858 595d 0a20 2020 2020  lLengthXY].     
-00002ad0: 2020 2020 2020 2069 6620 6c65 6e28 666f         if len(fo
-00002ae0: 6361 6c4c 656e 6774 6858 5929 2021 3d20  calLengthXY) != 
-00002af0: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
-00002b00: 2020 2072 6169 7365 206d 6971 7463 2e49     raise miqtc.I
-00002b10: 6664 6f45 7863 6570 7469 6f6e 2869 7465  fdoException(ite
-00002b20: 6d2c 2249 6e76 616c 6964 2065 6e74 7279  m,"Invalid entry
-00002b30: 2066 6f72 2027 696d 6167 652d 6361 6d65   for 'image-came
-00002b40: 7261 2d63 616c 6962 7261 7469 6f6e 2d6d  ra-calibration-m
-00002b50: 6f64 656c 275b 2763 616c 6962 7261 7469  odel'['calibrati
-00002b60: 6f6e 2d66 6f63 616c 2d6c 656e 6774 682d  on-focal-length-
-00002b70: 7879 2d70 6978 656c 275d 203a 2022 202b  xy-pixel'] : " +
-00002b80: 2073 7472 2866 6f63 616c 4c65 6e67 7468   str(focalLength
-00002b90: 5859 2920 290a 0a20 2020 2020 2020 2020  XY) )..         
-00002ba0: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
-00002bb0: 616e 6365 2866 6f63 616c 4c65 6e67 7468  ance(focalLength
-00002bc0: 5859 5b30 5d2c 666c 6f61 7429 206f 7220  XY[0],float) or 
-00002bd0: 6e6f 7420 6973 696e 7374 616e 6365 2866  not isinstance(f
-00002be0: 6f63 616c 4c65 6e67 7468 5859 5b30 5d2c  ocalLengthXY[0],
-00002bf0: 696e 7429 206f 7220 6e6f 7420 6973 696e  int) or not isin
-00002c00: 7374 616e 6365 2866 6f63 616c 4c65 6e67  stance(focalLeng
-00002c10: 7468 5859 5b31 5d2c 666c 6f61 7429 206f  thXY[1],float) o
-00002c20: 7220 6e6f 7420 6973 696e 7374 616e 6365  r not isinstance
-00002c30: 2866 6f63 616c 4c65 6e67 7468 5859 5b31  (focalLengthXY[1
-00002c40: 5d2c 696e 7429 3a0a 2020 2020 2020 2020  ],int):.        
-00002c50: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00002c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002c70: 2066 6f63 616c 4c65 6e67 7468 5859 203d   focalLengthXY =
-00002c80: 205b 666c 6f61 7428 666f 6361 6c4c 656e   [float(focalLen
-00002c90: 6774 6858 595b 305d 292c 666c 6f61 7428  gthXY[0]),float(
-00002ca0: 666f 6361 6c4c 656e 6774 6858 595b 315d  focalLengthXY[1]
-00002cb0: 295d 0a20 2020 2020 2020 2020 2020 2020  )].             
-00002cc0: 2020 2065 7863 6570 7420 5661 6c75 6545     except ValueE
-00002cd0: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-00002ce0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00002cf0: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
-00002d00: 696f 6e28 6974 656d 2c22 496e 7661 6c69  ion(item,"Invali
-00002d10: 6420 656e 7472 7920 666f 7220 2769 6d61  d entry for 'ima
-00002d20: 6765 2d63 616d 6572 612d 6361 6c69 6272  ge-camera-calibr
-00002d30: 6174 696f 6e2d 6d6f 6465 6c27 5b27 6361  ation-model'['ca
-00002d40: 6c69 6272 6174 696f 6e2d 666f 6361 6c2d  libration-focal-
-00002d50: 6c65 6e67 7468 2d78 792d 7069 7865 6c27  length-xy-pixel'
-00002d60: 5d20 3a20 2220 2b20 7374 7228 666f 6361  ] : " + str(foca
-00002d70: 6c4c 656e 6774 6858 5929 2029 0a20 2020  lLengthXY) ).   
-00002d80: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-00002d90: 2020 2020 2020 7265 7475 726e 2066 6f63        return foc
-00002da0: 616c 4c65 6e67 7468 5859 2c20 2250 6172  alLengthXY, "Par
-00002db0: 7365 6420 6672 6f6d 2027 696d 6167 652d  sed from 'image-
-00002dc0: 6361 6d65 7261 2d63 616c 6962 7261 7469  camera-calibrati
-00002dd0: 6f6e 2d6d 6f64 656c 275b 2763 616c 6962  on-model'['calib
-00002de0: 7261 7469 6f6e 2d66 6f63 616c 2d6c 656e  ration-focal-len
-00002df0: 6774 682d 7879 2d70 6978 656c 275d 220a  gth-xy-pixel']".
-00002e00: 2020 2020 2020 2020 6578 6365 7074 206d          except m
-00002e10: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
-00002e20: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
-00002e30: 7061 7373 0a0a 2020 2020 2020 2020 756e  pass..        un
-00002e40: 6465 7277 6174 6572 496d 6167 6520 3d20  derwaterImage = 
-00002e50: 5472 7565 0a20 2020 2020 2020 2074 7279  True.        try
-00002e60: 3a0a 2020 2020 2020 2020 2020 2020 6465  :.            de
-00002e70: 7074 6830 203d 2073 656c 662e 5f5f 6765  pth0 = self.__ge
-00002e80: 7449 7465 6d44 6566 6175 6c74 5661 6c75  tItemDefaultValu
-00002e90: 6528 6974 656d 2c27 696d 6167 652d 6465  e(item,'image-de
-00002ea0: 7074 6827 290a 2020 2020 2020 2020 2020  pth').          
-00002eb0: 2020 6966 2064 6570 7468 3020 3c20 303a    if depth0 < 0:
-00002ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002ed0: 2075 6e64 6572 7761 7465 7249 6d61 6765   underwaterImage
-00002ee0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-00002ef0: 2065 7863 6570 7420 6d69 7174 632e 4966   except miqtc.If
-00002f00: 646f 4578 6365 7074 696f 6e3a 0a20 2020  doException:.   
-00002f10: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
-00002f20: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00002f30: 2020 2020 2020 2061 6c74 3020 3d20 7365         alt0 = se
-00002f40: 6c66 5b69 7465 6d2b 2730 3a69 6d61 6765  lf[item+'0:image
-00002f50: 2d61 6c74 6974 7564 6527 5d20 2373 656c  -altitude'] #sel
-00002f60: 662e 5f5f 6765 7449 7465 6d44 6566 6175  f.__getItemDefau
-00002f70: 6c74 5661 6c75 6528 6974 656d 2c20 2769  ltValue(item, 'i
-00002f80: 6d61 6765 2d61 6c74 6974 7564 6527 290a  mage-altitude').
-00002f90: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-00002fa0: 6c74 3020 3e20 303a 0a20 2020 2020 2020  lt0 > 0:.       
-00002fb0: 2020 2020 2020 2020 2075 6e64 6572 7761           underwa
-00002fc0: 7465 7249 6d61 6765 203d 2046 616c 7365  terImage = False
-00002fd0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00002fe0: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
-00002ff0: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
-00003000: 2070 6173 730a 0a20 2020 2020 2020 2023   pass..        #
-00003010: 2061 6464 2063 6f72 7265 6374 696f 6e20   add correction 
-00003020: 6661 6374 6f72 2066 6f72 2066 6c61 7420  factor for flat 
-00003030: 706f 7274 0a20 2020 2020 2020 2069 6620  port.        if 
-00003040: 646f 6d65 506f 7274 2069 7320 4e6f 6e65  domePort is None
-00003050: 2061 6e64 2075 6e64 6572 7761 7465 7249   and underwaterI
-00003060: 6d61 6765 3a0a 2020 2020 2020 2020 2020  mage:.          
-00003070: 2020 7265 7475 726e 205b 2d31 2c2d 315d    return [-1,-1]
-00003080: 2c20 2243 6f75 6c64 206e 6f74 2064 6574  , "Could not det
-00003090: 6572 6d69 6e65 2066 6f63 616c 206c 656e  ermine focal len
-000030a0: 6774 6820 6672 6f6d 2027 696d 6167 652d  gth from 'image-
-000030b0: 6361 6d65 7261 2d63 616c 6962 7261 7469  camera-calibrati
-000030c0: 6f6e 2d6d 6f64 656c 275b 2763 616c 6962  on-model'['calib
-000030d0: 7261 7469 6f6e 2d66 6f63 616c 2d6c 656e  ration-focal-len
-000030e0: 6774 682d 7879 2d70 6978 656c 275d 2061  gth-xy-pixel'] a
-000030f0: 6e64 2070 6f72 7420 7479 7065 2c20 7768  nd port type, wh
-00003100: 6963 6820 6973 2072 6571 7569 7265 6420  ich is required 
-00003110: 666f 7220 636f 7272 6563 7420 6576 616c  for correct eval
-00003120: 7561 7469 6f6e 206f 6620 6578 6966 2076  uation of exif v
-00003130: 616c 7565 732c 2069 7320 6e6f 7420 7072  alues, is not pr
-00003140: 6f76 6964 6564 2122 0a20 2020 2020 2020  ovided!".       
-00003150: 2063 6f72 7265 6374 696f 6e46 6b74 203d   correctionFkt =
-00003160: 2031 2e30 0a20 2020 2020 2020 2069 6620   1.0.        if 
-00003170: 646f 6d65 506f 7274 203d 3d20 4661 6c73  domePort == Fals
-00003180: 6520 616e 6420 756e 6465 7277 6174 6572  e and underwater
-00003190: 496d 6167 653a 0a20 2020 2020 2020 2020  Image:.         
-000031a0: 2020 2063 6f72 7265 6374 696f 6e46 6b74     correctionFkt
-000031b0: 203d 2031 2e33 330a 0a20 2020 2020 2020   = 1.33..       
-000031c0: 2023 206f 7468 6572 7769 7365 2074 7279   # otherwise try
-000031d0: 2064 6572 6976 6520 6672 6f6d 2065 7869   derive from exi
-000031e0: 6620 7461 6773 0a20 2020 2020 2020 2065  f tags.        e
-000031f0: 7869 6620 3d20 7365 6c66 2e5f 5f67 6574  xif = self.__get
-00003200: 4974 656d 4465 6661 756c 7456 616c 7565  ItemDefaultValue
-00003210: 2869 7465 6d2c 2769 6d61 6765 2d61 6371  (item,'image-acq
-00003220: 7569 7369 7469 6f6e 2d73 6574 7469 6e67  uisition-setting
-00003230: 7327 290a 2020 2020 2020 2020 2323 2066  s').        ## f
-00003240: 726f 6d20 466f 6361 6c20 4c65 6e67 7468  rom Focal Length
-00003250: 2c20 466f 6361 6c20 506c 616e 6520 5820  , Focal Plane X 
-00003260: 5265 736f 6c75 7469 6f6e 2c20 466f 6361  Resolution, Foca
-00003270: 6c20 506c 616e 6520 5920 5265 736f 6c75  l Plane Y Resolu
-00003280: 7469 6f6e 2c20 466f 6361 6c20 506c 616e  tion, Focal Plan
-00003290: 6520 5265 736f 6c75 7469 6f6e 2055 6e69  e Resolution Uni
-000032a0: 740a 2020 2020 2020 2020 666f 6361 6c4c  t.        focalL
-000032b0: 656e 6774 6858 592c 206d 7367 203d 2073  engthXY, msg = s
-000032c0: 656c 662e 5f5f 7472 7944 6574 6572 6d69  elf.__tryDetermi
-000032d0: 6e65 466f 6361 6c4c 656e 6768 7449 6e50  neFocalLenghtInP
-000032e0: 6978 656c 7346 726f 6d45 7869 665f 3128  ixelsFromExif_1(
-000032f0: 6578 6966 290a 2020 2020 2020 2020 6966  exif).        if
-00003300: 2066 6f63 616c 4c65 6e67 7468 5859 2021   focalLengthXY !
-00003310: 3d20 5b2d 312c 2d31 5d3a 0a20 2020 2020  = [-1,-1]:.     
-00003320: 2020 2020 2020 2072 6574 7572 6e20 5b65         return [e
-00003330: 2a63 6f72 7265 6374 696f 6e46 6b74 2066  *correctionFkt f
-00003340: 6f72 2065 2069 6e20 666f 6361 6c4c 656e  or e in focalLen
-00003350: 6774 6858 595d 2c20 2744 6572 6976 6564  gthXY], 'Derived
-00003360: 2066 726f 6d20 6578 6966 2074 6167 7320   from exif tags 
-00003370: 466f 6361 6c20 4c65 6e67 7468 2c20 466f  Focal Length, Fo
-00003380: 6361 6c20 506c 616e 6520 5820 5265 736f  cal Plane X Reso
-00003390: 6c75 7469 6f6e 2c20 466f 6361 6c20 506c  lution, Focal Pl
-000033a0: 616e 6520 5920 5265 736f 6c75 7469 6f6e  ane Y Resolution
-000033b0: 2c20 466f 6361 6c20 506c 616e 6520 5265  , Focal Plane Re
-000033c0: 736f 6c75 7469 6f6e 2055 6e69 7427 0a20  solution Unit'. 
-000033d0: 2020 2020 2020 2023 2320 6672 6f6d 2066         ## from f
-000033e0: 726f 6d20 3335 206d 6d20 6571 7569 7661  rom 35 mm equiva
-000033f0: 6c65 6e74 2066 6f63 616c 206c 656e 6774  lent focal lengt
-00003400: 680a 2020 2020 2020 2020 666f 6361 6c4c  h.        focalL
-00003410: 656e 6774 6858 592c 206d 7367 203d 2073  engthXY, msg = s
-00003420: 656c 662e 5f5f 7472 7944 6574 6572 6d69  elf.__tryDetermi
-00003430: 6e65 466f 6361 6c4c 656e 6768 7449 6e50  neFocalLenghtInP
-00003440: 6978 656c 7346 726f 6d45 7869 665f 3228  ixelsFromExif_2(
-00003450: 6578 6966 290a 2020 2020 2020 2020 6966  exif).        if
-00003460: 2066 6f63 616c 4c65 6e67 7468 5859 2021   focalLengthXY !
-00003470: 3d20 5b2d 312c 2d31 5d3a 0a20 2020 2020  = [-1,-1]:.     
-00003480: 2020 2020 2020 2072 6574 7572 6e20 5b65         return [e
-00003490: 2a63 6f72 7265 6374 696f 6e46 6b74 2066  *correctionFkt f
-000034a0: 6f72 2065 2069 6e20 666f 6361 6c4c 656e  or e in focalLen
-000034b0: 6774 6858 595d 2c20 2744 6572 6976 6564  gthXY], 'Derived
-000034c0: 2066 726f 6d20 6578 6966 2074 6167 2046   from exif tag F
-000034d0: 6f63 616c 204c 656e 6774 6820 7769 7468  ocal Length with
-000034e0: 2033 3520 6d6d 2065 7175 6976 616c 656e   35 mm equivalen
-000034f0: 7427 0a20 0a20 2020 2020 2020 2072 6574  t'. .        ret
-00003500: 7572 6e20 5b2d 312c 2d31 5d2c 2022 436f  urn [-1,-1], "Co
-00003510: 756c 6420 6e6f 7420 6465 7465 726d 696e  uld not determin
-00003520: 6520 6672 6f6d 2066 6f63 616c 206c 656e  e from focal len
-00003530: 6774 6820 696e 2070 6978 656c 7320 6672  gth in pixels fr
-00003540: 6f6d 206e 6569 7468 6572 2027 696d 6167  om neither 'imag
-00003550: 652d 6361 6d65 7261 2d63 616c 6962 7261  e-camera-calibra
-00003560: 7469 6f6e 2d6d 6f64 656c 275b 2763 616c  tion-model'['cal
-00003570: 6962 7261 7469 6f6e 2d66 6f63 616c 2d6c  ibration-focal-l
-00003580: 656e 6774 682d 7879 2d70 6978 656c 275d  ength-xy-pixel']
-00003590: 206e 6f72 2065 7869 6620 7461 6773 2046   nor exif tags F
-000035a0: 6f63 616c 204c 656e 6774 682c 2046 6f63  ocal Length, Foc
-000035b0: 616c 2050 6c61 6e65 2058 2052 6573 6f6c  al Plane X Resol
-000035c0: 7574 696f 6e2c 2046 6f63 616c 2050 6c61  ution, Focal Pla
-000035d0: 6e65 2059 2052 6573 6f6c 7574 696f 6e2c  ne Y Resolution,
-000035e0: 2046 6f63 616c 2050 6c61 6e65 2052 6573   Focal Plane Res
-000035f0: 6f6c 7574 696f 6e20 556e 6974 220a 0a0a  olution Unit"...
-00003600: 2020 2020 6465 6620 5f5f 7472 7944 6574      def __tryDet
-00003610: 6572 6d69 6e65 466f 6361 6c4c 656e 6768  ermineFocalLengh
-00003620: 7449 6e50 6978 656c 7346 726f 6d45 7869  tInPixelsFromExi
-00003630: 665f 3128 7365 6c66 2c65 7869 6644 6963  f_1(self,exifDic
-00003640: 743a 6469 6374 293a 0a20 2020 2020 2020  t:dict):.       
-00003650: 2022 2222 2074 7279 2074 6f20 6465 7465   """ try to dete
-00003660: 726d 696e 6520 666f 6361 6c20 6c65 6e67  rmine focal leng
-00003670: 7468 2069 6e20 7069 7865 6c73 2066 726f  th in pixels fro
-00003680: 6d20 6578 6966 2074 6167 7320 466f 6361  m exif tags Foca
-00003690: 6c20 4c65 6e67 7468 2c20 466f 6361 6c20  l Length, Focal 
-000036a0: 506c 616e 6520 5820 5265 736f 6c75 7469  Plane X Resoluti
-000036b0: 6f6e 2c20 466f 6361 6c20 506c 616e 6520  on, Focal Plane 
-000036c0: 5920 5265 736f 6c75 7469 6f6e 2c20 466f  Y Resolution, Fo
-000036d0: 6361 6c20 506c 616e 6520 5265 736f 6c75  cal Plane Resolu
-000036e0: 7469 6f6e 2055 6e69 742e 0a20 2020 2020  tion Unit..     
-000036f0: 2020 2020 2020 2052 6574 7275 6e73 205b         Retruns [
-00003700: 666f 6361 6c4c 656e 6774 6850 6978 656c  focalLengthPixel
-00003710: 735f 782c 666f 6361 6c4c 656e 6774 6850  s_x,focalLengthP
-00003720: 6978 656c 735f 795d 2c20 6d65 7373 6167  ixels_y], messag
-00003730: 650a 2020 2020 2020 2020 2020 2020 5265  e.            Re
-00003740: 7472 756e 7320 666f 6361 6c4c 656e 6774  truns focalLengt
-00003750: 6850 6978 656c 7320 3d20 2d31 2069 6620  hPixels = -1 if 
-00003760: 6e6f 7420 7375 6363 6573 7366 756c 6c20  not successfull 
-00003770: 2222 220a 0a20 2020 2020 2020 2074 7279  """..        try
-00003780: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-00003790: 6361 6c4c 656e 6774 6820 3d20 7374 7228  calLength = str(
-000037a0: 6578 6966 4469 6374 5b27 466f 6361 6c20  exifDict['Focal 
-000037b0: 4c65 6e67 7468 275d 290a 2020 2020 2020  Length']).      
-000037c0: 2020 2020 2020 666f 6361 6c50 6c61 6e65        focalPlane
-000037d0: 5265 735f 7820 3d20 666c 6f61 7428 7374  Res_x = float(st
-000037e0: 7228 6578 6966 4469 6374 5b27 466f 6361  r(exifDict['Foca
-000037f0: 6c20 506c 616e 6520 5820 5265 736f 6c75  l Plane X Resolu
-00003800: 7469 6f6e 275d 292e 7374 7269 7028 275c  tion']).strip('\
-00003810: 2727 2929 0a20 2020 2020 2020 2020 2020  '')).           
-00003820: 2066 6f63 616c 506c 616e 6552 6573 5f79   focalPlaneRes_y
-00003830: 203d 2066 6c6f 6174 2873 7472 2865 7869   = float(str(exi
-00003840: 6644 6963 745b 2746 6f63 616c 2050 6c61  fDict['Focal Pla
-00003850: 6e65 2059 2052 6573 6f6c 7574 696f 6e27  ne Y Resolution'
-00003860: 5d29 2e73 7472 6970 2827 5c27 2729 290a  ]).strip('\'')).
-00003870: 2020 2020 2020 2020 2020 2020 666f 6361              foca
-00003880: 6c50 6c61 6e65 5265 735f 756e 6974 203d  lPlaneRes_unit =
-00003890: 2073 7472 2865 7869 6644 6963 745b 2746   str(exifDict['F
-000038a0: 6f63 616c 2050 6c61 6e65 2052 6573 6f6c  ocal Plane Resol
-000038b0: 7574 696f 6e20 556e 6974 275d 292e 7374  ution Unit']).st
-000038c0: 7269 7028 275c 2727 290a 2020 2020 2020  rip('\'').      
-000038d0: 2020 6578 6365 7074 2028 4b65 7945 7272    except (KeyErr
-000038e0: 6f72 2c20 5661 6c75 6545 7272 6f72 293a  or, ValueError):
-000038f0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00003900: 7572 6e20 5b2d 312c 2d31 5d2c 2022 436f  urn [-1,-1], "Co
-00003910: 756c 6420 6e6f 7420 6669 6e64 2061 6c6c  uld not find all
-00003920: 2072 6571 7569 7265 6420 6669 656c 6473   required fields
-00003930: 2046 6f63 616c 204c 656e 6774 682c 2046   Focal Length, F
-00003940: 6f63 616c 2050 6c61 6e65 2058 2052 6573  ocal Plane X Res
-00003950: 6f6c 7574 696f 6e2c 2046 6f63 616c 2050  olution, Focal P
-00003960: 6c61 6e65 2059 2052 6573 6f6c 7574 696f  lane Y Resolutio
-00003970: 6e2c 2046 6f63 616c 2050 6c61 6e65 2052  n, Focal Plane R
-00003980: 6573 6f6c 7574 696f 6e20 556e 6974 220a  esolution Unit".
-00003990: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-000039a0: 2023 2070 6172 7365 2066 6f63 616c 206c   # parse focal l
-000039b0: 656e 6774 6820 6672 6f6d 206c 6566 7420  ength from left 
-000039c0: 286d 6179 2062 6520 2737 2e35 206d 6d20  (may be '7.5 mm 
-000039d0: 282e 2e2e 2927 290a 2020 2020 2020 2020  (...)').        
-000039e0: 666f 6361 6c4c 656e 6774 6853 7472 6970  focalLengthStrip
-000039f0: 7065 6420 3d20 666f 6361 6c4c 656e 6774  ped = focalLengt
-00003a00: 682e 7374 7269 7028 290a 2020 2020 2020  h.strip().      
-00003a10: 2020 666f 6361 6c4c 656e 6774 6846 6c6f    focalLengthFlo
-00003a20: 6174 203d 204e 6f6e 650a 2020 2020 2020  at = None.      
-00003a30: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
-00003a40: 286c 656e 2866 6f63 616c 4c65 6e67 7468  (len(focalLength
-00003a50: 5374 7269 7070 6564 2929 3a0a 2020 2020  Stripped)):.    
-00003a60: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00003a70: 2020 2020 2020 2020 2020 2020 2066 6f63               foc
-00003a80: 616c 4c65 6e67 7468 466c 6f61 7420 3d20  alLengthFloat = 
-00003a90: 666c 6f61 7428 666f 6361 6c4c 656e 6774  float(focalLengt
-00003aa0: 6853 7472 6970 7065 645b 303a 692b 315d  hStripped[0:i+1]
-00003ab0: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
-00003ac0: 6365 7074 2056 616c 7565 4572 726f 723a  cept ValueError:
-00003ad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003ae0: 2070 6173 730a 2020 2020 2020 2020 6966   pass.        if
-00003af0: 2066 6f63 616c 4c65 6e67 7468 466c 6f61   focalLengthFloa
-00003b00: 7420 6973 204e 6f6e 653a 0a20 2020 2020  t is None:.     
-00003b10: 2020 2020 2020 2072 6574 7572 6e20 5b2d         return [-
-00003b20: 312c 2d31 5d2c 2022 436f 756c 6420 6e6f  1,-1], "Could no
-00003b30: 7420 7061 7273 6520 666f 7263 616c 206c  t parse forcal l
-00003b40: 656e 6774 6820 6672 6f6d 2027 466f 6361  ength from 'Foca
-00003b50: 6c20 4c65 6e67 7468 273a 2022 202b 2066  l Length': " + f
-00003b60: 6f63 616c 4c65 6e67 7468 0a20 2020 2020  ocalLength.     
-00003b70: 2020 2073 6361 6c65 466b 745f 666f 6361     scaleFkt_foca
-00003b80: 6c20 3d20 7365 6c66 2e5f 5f75 6e69 7443  l = self.__unitC
-00003b90: 6f6e 7665 7273 696f 6e46 6163 7432 6d6d  onversionFact2mm
-00003ba0: 2866 6f63 616c 4c65 6e67 7468 290a 2020  (focalLength).  
-00003bb0: 2020 2020 2020 6966 2073 6361 6c65 466b        if scaleFk
-00003bc0: 745f 666f 6361 6c20 3d3d 202d 313a 0a20  t_focal == -1:. 
-00003bd0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00003be0: 6e20 5b2d 312c 2d31 5d2c 2022 436f 756c  n [-1,-1], "Coul
-00003bf0: 6420 6e6f 7420 7061 7273 6520 666f 7263  d not parse forc
-00003c00: 616c 206c 656e 6774 6820 756e 6974 2066  al length unit f
-00003c10: 726f 6d20 2746 6f63 616c 204c 656e 6774  rom 'Focal Lengt
-00003c20: 6827 3a20 2220 2b20 666f 6361 6c4c 656e  h': " + focalLen
-00003c30: 6774 680a 2020 2020 2020 2020 666f 6361  gth.        foca
-00003c40: 6c4c 656e 6774 685f 6d6d 203d 2066 6f63  lLength_mm = foc
-00003c50: 616c 4c65 6e67 7468 466c 6f61 7420 2a20  alLengthFloat * 
-00003c60: 7363 616c 6546 6b74 5f66 6f63 616c 0a0a  scaleFkt_focal..
-00003c70: 2020 2020 2020 2020 7363 616c 6546 6b74          scaleFkt
-00003c80: 5f72 6573 203d 2073 656c 662e 5f5f 756e  _res = self.__un
-00003c90: 6974 436f 6e76 6572 7369 6f6e 4661 6374  itConversionFact
-00003ca0: 326d 6d28 666f 6361 6c50 6c61 6e65 5265  2mm(focalPlaneRe
-00003cb0: 735f 756e 6974 290a 2020 2020 2020 2020  s_unit).        
-00003cc0: 6966 2073 6361 6c65 466b 745f 7265 7320  if scaleFkt_res 
-00003cd0: 3d3d 202d 313a 0a20 2020 2020 2020 2020  == -1:.         
-00003ce0: 2020 2072 6574 7572 6e20 5b2d 312c 2d31     return [-1,-1
-00003cf0: 5d2c 2022 436f 756c 6420 6e6f 7420 7061  ], "Could not pa
-00003d00: 7273 6520 466f 6361 6c20 506c 616e 6520  rse Focal Plane 
-00003d10: 5265 736f 6c75 7469 6f6e 2055 6e69 7420  Resolution Unit 
-00003d20: 6672 6f6d 2027 466f 6361 6c20 506c 616e  from 'Focal Plan
-00003d30: 6520 5265 736f 6c75 7469 6f6e 2055 6e69  e Resolution Uni
-00003d40: 7427 3a20 2220 2b20 666f 6361 6c50 6c61  t': " + focalPla
-00003d50: 6e65 5265 735f 756e 6974 0a0a 2020 2020  neRes_unit..    
-00003d60: 2020 2020 666f 6361 6c4c 656e 6774 6850      focalLengthP
-00003d70: 6978 656c 735f 7820 3d20 666f 6361 6c4c  ixels_x = focalL
-00003d80: 656e 6774 685f 6d6d 202a 2066 6f63 616c  ength_mm * focal
-00003d90: 506c 616e 6552 6573 5f78 202f 2073 6361  PlaneRes_x / sca
-00003da0: 6c65 466b 745f 7265 730a 2020 2020 2020  leFkt_res.      
-00003db0: 2020 666f 6361 6c4c 656e 6774 6850 6978    focalLengthPix
-00003dc0: 656c 735f 7920 3d20 666f 6361 6c4c 656e  els_y = focalLen
-00003dd0: 6774 685f 6d6d 202a 2066 6f63 616c 506c  gth_mm * focalPl
-00003de0: 616e 6552 6573 5f79 202f 2073 6361 6c65  aneRes_y / scale
-00003df0: 466b 745f 7265 730a 0a20 2020 2020 2020  Fkt_res..       
-00003e00: 2072 6574 7572 6e20 5b66 6f63 616c 4c65   return [focalLe
-00003e10: 6e67 7468 5069 7865 6c73 5f78 2c66 6f63  ngthPixels_x,foc
-00003e20: 616c 4c65 6e67 7468 5069 7865 6c73 5f79  alLengthPixels_y
-00003e30: 5d2c 2022 220a 0a0a 2020 2020 6465 6620  ], ""...    def 
-00003e40: 5f5f 7472 7944 6574 6572 6d69 6e65 466f  __tryDetermineFo
-00003e50: 6361 6c4c 656e 6768 7449 6e50 6978 656c  calLenghtInPixel
-00003e60: 7346 726f 6d45 7869 665f 3228 7365 6c66  sFromExif_2(self
-00003e70: 2c65 7869 6644 6963 743a 6469 6374 293a  ,exifDict:dict):
-00003e80: 0a20 2020 2020 2020 2022 2222 2074 7279  .        """ try
-00003e90: 2074 6f20 6465 7465 726d 696e 6520 666f   to determine fo
-00003ea0: 6361 6c20 6c65 6e67 7468 2069 6e20 7069  cal length in pi
-00003eb0: 7865 6c73 2066 726f 6d20 3335 206d 6d20  xels from 35 mm 
-00003ec0: 6571 7569 7661 6c65 6e74 2066 6f63 616c  equivalent focal
-00003ed0: 206c 656e 6774 6820 696e 2065 7869 6620   length in exif 
-00003ee0: 7461 6720 466f 6361 6c20 4c65 6e67 7468  tag Focal Length
-00003ef0: 2773 2061 6464 206f 6e20 652e 672e 2027  's add on e.g. '
-00003f00: 372e 3020 6d6d 2028 3335 206d 6d20 6571  7.0 mm (35 mm eq
-00003f10: 7569 7661 6c65 6e74 3a20 3338 2e38 206d  uivalent: 38.8 m
-00003f20: 6d29 272e 0a20 2020 2020 2020 2020 2020  m)'..           
-00003f30: 2052 6574 7275 6e73 205b 666f 6361 6c4c   Retruns [focalL
-00003f40: 656e 6774 6850 6978 656c 735f 782c 666f  engthPixels_x,fo
-00003f50: 6361 6c4c 656e 6774 6850 6978 656c 735f  calLengthPixels_
-00003f60: 795d 2c20 6d65 7373 6167 650a 2020 2020  y], message.    
-00003f70: 2020 2020 2020 2020 5265 7472 756e 7320          Retruns 
-00003f80: 666f 6361 6c4c 656e 6774 6850 6978 656c  focalLengthPixel
-00003f90: 7320 3d20 2d31 2069 6620 6e6f 7420 7375  s = -1 if not su
-00003fa0: 6363 6573 7366 756c 6c20 2222 220a 0a20  ccessfull """.. 
-00003fb0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00003fc0: 2020 2020 2020 2020 666f 6361 6c4c 656e          focalLen
-00003fd0: 6774 6820 3d20 7374 7228 6578 6966 4469  gth = str(exifDi
-00003fe0: 6374 5b27 466f 6361 6c20 4c65 6e67 7468  ct['Focal Length
-00003ff0: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
-00004000: 696d 6167 6557 6964 7468 203d 2069 6e74  imageWidth = int
-00004010: 2873 7472 2865 7869 6644 6963 745b 2749  (str(exifDict['I
-00004020: 6d61 6765 2057 6964 7468 275d 292e 7374  mage Width']).st
-00004030: 7269 7028 275c 2727 2929 0a20 2020 2020  rip('\'')).     
-00004040: 2020 2065 7863 6570 7420 284b 6579 4572     except (KeyEr
-00004050: 726f 722c 2056 616c 7565 4572 726f 7229  ror, ValueError)
-00004060: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00004070: 7475 726e 205b 2d31 2c2d 315d 2c20 2243  turn [-1,-1], "C
-00004080: 6f75 6c64 206e 6f74 2066 696e 6420 616c  ould not find al
-00004090: 6c20 7265 7175 6972 6564 2066 6965 6c64  l required field
-000040a0: 7320 466f 6361 6c20 4c65 6e67 7468 2c20  s Focal Length, 
-000040b0: 496d 6167 6520 5769 6474 6822 0a0a 2020  Image Width"..  
-000040c0: 2020 2020 2020 2320 7472 7920 7061 7273        # try pars
-000040d0: 6520 3335 206d 6d20 6571 7569 7661 6c65  e 35 mm equivale
-000040e0: 6e74 2066 726f 6d20 652e 672e 3a20 2037  nt from e.g.:  7
-000040f0: 2e30 206d 6d20 2833 3520 6d6d 2065 7175  .0 mm (35 mm equ
-00004100: 6976 616c 656e 743a 2033 382e 3820 6d6d  ivalent: 38.8 mm
-00004110: 290a 2020 2020 2020 2020 636f 6c6f 6e49  ).        colonI
-00004120: 6e64 6578 203d 2066 6f63 616c 4c65 6e67  ndex = focalLeng
-00004130: 7468 2e66 696e 6428 273a 2729 0a20 2020  th.find(':').   
-00004140: 2020 2020 2069 6620 636f 6c6f 6e49 6e64       if colonInd
-00004150: 6578 203d 3d20 2d31 3a0a 2020 2020 2020  ex == -1:.      
-00004160: 2020 2020 2020 7265 7475 726e 205b 2d31        return [-1
-00004170: 2c2d 315d 2c20 2243 6f75 6c64 206e 6f74  ,-1], "Could not
-00004180: 2070 6172 7365 2033 3520 6d6d 2065 7175   parse 35 mm equ
-00004190: 6976 616c 656e 7420 666f 6361 6c20 6c65  ivalent focal le
-000041a0: 6e67 7468 2066 726f 6d20 2746 6f63 616c  ngth from 'Focal
-000041b0: 204c 656e 6774 6827 3a20 2220 2b20 666f   Length': " + fo
-000041c0: 6361 6c4c 656e 6774 680a 2020 2020 2020  calLength.      
-000041d0: 2020 666f 6361 6c4c 656e 6774 6845 7133    focalLengthEq3
-000041e0: 356d 6d46 6c6f 6174 203d 204e 6f6e 650a  5mmFloat = None.
-000041f0: 2020 2020 2020 2020 6571 7561 6c33 356d          equal35m
-00004200: 6d50 6172 7420 3d20 666f 6361 6c4c 656e  mPart = focalLen
-00004210: 6774 685b 636f 6c6f 6e49 6e64 6578 2b31  gth[colonIndex+1
-00004220: 3a3a 5d2e 7374 7269 7028 290a 2020 2020  ::].strip().    
-00004230: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-00004240: 6765 286c 656e 2865 7175 616c 3335 6d6d  ge(len(equal35mm
-00004250: 5061 7274 2929 3a0a 2020 2020 2020 2020  Part)):.        
-00004260: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00004270: 2020 2020 2020 2020 2066 6f63 616c 4c65           focalLe
-00004280: 6e67 7468 4571 3335 6d6d 466c 6f61 7420  ngthEq35mmFloat 
-00004290: 3d20 666c 6f61 7428 6571 7561 6c33 356d  = float(equal35m
-000042a0: 6d50 6172 745b 303a 692b 315d 290a 2020  mPart[0:i+1]).  
-000042b0: 2020 2020 2020 2020 2020 6578 6365 7074            except
-000042c0: 2056 616c 7565 4572 726f 723a 0a20 2020   ValueError:.   
-000042d0: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-000042e0: 730a 2020 2020 2020 2020 7363 616c 6546  s.        scaleF
-000042f0: 6b74 203d 2073 656c 662e 5f5f 756e 6974  kt = self.__unit
-00004300: 436f 6e76 6572 7369 6f6e 4661 6374 326d  ConversionFact2m
-00004310: 6d28 666f 6361 6c4c 656e 6774 685b 636f  m(focalLength[co
-00004320: 6c6f 6e49 6e64 6578 2b31 3a3a 5d29 0a20  lonIndex+1::]). 
-00004330: 2020 2020 2020 2069 6620 666f 6361 6c4c         if focalL
-00004340: 656e 6774 6845 7133 356d 6d46 6c6f 6174  engthEq35mmFloat
-00004350: 2069 7320 4e6f 6e65 206f 7220 7363 616c   is None or scal
-00004360: 6546 6b74 203d 3d20 2d31 3a0a 2020 2020  eFkt == -1:.    
-00004370: 2020 2020 2020 2020 7265 7475 726e 205b          return [
-00004380: 2d31 2c2d 315d 2c20 2243 6f75 6c64 206e  -1,-1], "Could n
-00004390: 6f74 2070 6172 7365 2033 3520 6d6d 2065  ot parse 35 mm e
-000043a0: 7175 6976 616c 656e 7420 666f 6361 6c20  quivalent focal 
-000043b0: 6c65 6e67 7468 2066 726f 6d20 2746 6f63  length from 'Foc
-000043c0: 616c 204c 656e 6774 6827 3a20 2220 2b20  al Length': " + 
-000043d0: 666f 6361 6c4c 656e 6774 680a 2020 2020  focalLength.    
-000043e0: 2020 2020 0a20 2020 2020 2020 2066 6f63      .        foc
-000043f0: 616c 4c65 6e67 7468 5069 7865 6c73 203d  alLengthPixels =
-00004400: 2066 6f63 616c 4c65 6e67 7468 4571 3335   focalLengthEq35
-00004410: 6d6d 466c 6f61 7420 2a20 7363 616c 6546  mmFloat * scaleF
-00004420: 6b74 202a 2069 6d61 6765 5769 6474 6820  kt * imageWidth 
-00004430: 2f20 3336 2e30 0a20 2020 2020 2020 2072  / 36.0.        r
-00004440: 6574 7572 6e20 5b66 6f63 616c 4c65 6e67  eturn [focalLeng
-00004450: 7468 5069 7865 6c73 2c66 6f63 616c 4c65  thPixels,focalLe
-00004460: 6e67 7468 5069 7865 6c73 5d2c 2022 220a  ngthPixels], "".
-00004470: 0a0a 2020 2020 6465 6620 5f5f 756e 6974  ..    def __unit
-00004480: 436f 6e76 6572 7369 6f6e 4661 6374 326d  ConversionFact2m
-00004490: 6d28 7365 6c66 2c75 6e69 743a 7374 7229  m(self,unit:str)
-000044a0: 3a0a 2020 2020 2020 2020 2222 2220 6c6f  :.        """ lo
-000044b0: 6f6b 7320 666f 7220 6c65 7474 6572 2073  oks for letter s
-000044c0: 6571 7565 6e63 6520 696e 2075 6e69 7420  equence in unit 
-000044d0: 616e 6420 6368 6563 6b73 2069 6620 6974  and checks if it
-000044e0: 2773 2027 696e 6368 6573 272c 276d 272c  's 'inches','m',
-000044f0: 2763 6d27 2c27 6d6d 272c 2775 6d27 206f  'cm','mm','um' o
-00004500: 7220 2727 2061 6e64 2072 6574 7572 6e73  r '' and returns
-00004510: 2072 6573 7065 6374 6976 6520 636f 6e76   respective conv
-00004520: 6572 7369 6f6e 2066 6163 746f 7220 746f  ersion factor to
-00004530: 206d 6d20 2869 6620 7468 6572 6520 6172   mm (if there ar
-00004540: 6520 6e6f 206c 6574 7465 7273 2069 7420  e no letters it 
-00004550: 7265 7475 726e 7320 3129 2e20 4f74 6865  returns 1). Othe
-00004560: 7277 6973 6520 7265 7475 726e 202d 3120  rwise return -1 
-00004570: 2222 220a 0a20 2020 2020 2020 2066 6972  """..        fir
-00004580: 7374 4c65 7474 6572 5365 7120 3d20 2222  stLetterSeq = ""
-00004590: 0a20 2020 2020 2020 2066 6972 7374 466f  .        firstFo
-000045a0: 756e 6420 3d20 4661 6c73 650a 2020 2020  und = False.    
-000045b0: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-000045c0: 6765 286c 656e 2875 6e69 7429 293a 0a20  ge(len(unit)):. 
-000045d0: 2020 2020 2020 2020 2020 2069 6620 756e             if un
-000045e0: 6974 5b69 5d2e 6973 616c 7068 6128 293a  it[i].isalpha():
-000045f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004600: 2066 6972 7374 466f 756e 6420 3d20 5472   firstFound = Tr
-00004610: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-00004620: 2020 2066 6972 7374 4c65 7474 6572 5365     firstLetterSe
-00004630: 7120 2b3d 2075 6e69 745b 695d 0a20 2020  q += unit[i].   
-00004640: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00004650: 756e 6974 5b69 5d2e 6973 616c 7068 6128  unit[i].isalpha(
-00004660: 2920 616e 6420 6669 7273 7446 6f75 6e64  ) and firstFound
-00004670: 203d 3d20 5472 7565 3a0a 2020 2020 2020   == True:.      
-00004680: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-00004690: 0a20 2020 2020 2020 2069 6620 6669 7273  .        if firs
-000046a0: 744c 6574 7465 7253 6571 2e6c 6f77 6572  tLetterSeq.lower
-000046b0: 2829 203d 3d20 2269 6e63 6865 7322 3a0a  () == "inches":.
-000046c0: 2020 2020 2020 2020 2020 2020 7363 616c              scal
-000046d0: 6546 6b74 203d 2032 352e 340a 2020 2020  eFkt = 25.4.    
-000046e0: 2020 2020 656c 6966 2066 6972 7374 4c65      elif firstLe
-000046f0: 7474 6572 5365 712e 6c6f 7765 7228 2920  tterSeq.lower() 
-00004700: 3d3d 2022 6d22 3a0a 2020 2020 2020 2020  == "m":.        
-00004710: 2020 2020 7363 616c 6546 6b74 203d 2031      scaleFkt = 1
-00004720: 3030 302e 303b 0a20 2020 2020 2020 2065  000.0;.        e
-00004730: 6c69 6620 6669 7273 744c 6574 7465 7253  lif firstLetterS
-00004740: 6571 2e6c 6f77 6572 2829 203d 3d20 2263  eq.lower() == "c
-00004750: 6d22 3a0a 2020 2020 2020 2020 2020 2020  m":.            
-00004760: 7363 616c 6546 6b74 203d 2031 302e 303b  scaleFkt = 10.0;
-00004770: 0a20 2020 2020 2020 2065 6c69 6620 6669  .        elif fi
-00004780: 7273 744c 6574 7465 7253 6571 2e6c 6f77  rstLetterSeq.low
-00004790: 6572 2829 203d 3d20 226d 6d22 3a0a 2020  er() == "mm":.  
-000047a0: 2020 2020 2020 2020 2020 7363 616c 6546            scaleF
-000047b0: 6b74 203d 2031 2e30 3b0a 2020 2020 2020  kt = 1.0;.      
-000047c0: 2020 656c 6966 2066 6972 7374 4c65 7474    elif firstLett
-000047d0: 6572 5365 712e 6c6f 7765 7228 2920 3d3d  erSeq.lower() ==
-000047e0: 2022 756d 223a 0a20 2020 2020 2020 2020   "um":.         
-000047f0: 2020 2073 6361 6c65 466b 7420 3d20 312f     scaleFkt = 1/
-00004800: 3130 3030 3b0a 2020 2020 2020 2020 656c  1000;.        el
-00004810: 6966 2066 6972 7374 4c65 7474 6572 5365  if firstLetterSe
-00004820: 712e 6c6f 7765 7228 2920 3d3d 2022 223a  q.lower() == "":
-00004830: 0a20 2020 2020 2020 2020 2020 2073 6361  .            sca
-00004840: 6c65 466b 7420 3d20 313b 0a20 2020 2020  leFkt = 1;.     
-00004850: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00004860: 2020 2020 2073 6361 6c65 466b 7420 3d20       scaleFkt = 
-00004870: 2d31 0a0a 2020 2020 2020 2020 7265 7475  -1..        retu
-00004880: 726e 2073 6361 6c65 466b 740a 0a0a 2020  rn scaleFkt...  
-00004890: 2020 6465 6620 5f5f 6765 7449 7465 6d44    def __getItemD
-000048a0: 6566 6175 6c74 5661 6c75 6528 7365 6c66  efaultValue(self
-000048b0: 2c69 7465 6d3a 7374 722c 6669 656c 644e  ,item:str,fieldN
-000048c0: 616d 653a 7374 7229 3a0a 2020 2020 2020  ame:str):.      
-000048d0: 2020 2222 2220 7265 7475 726e 7320 6974    """ returns it
-000048e0: 656d 2076 616c 7565 7320 2866 6972 7374  em values (first
-000048f0: 2065 6e74 7279 2069 6e20 6361 7365 206f   entry in case o
-00004900: 6620 7669 6465 6f73 292e 2054 6872 6f77  f videos). Throw
-00004910: 7320 6d61 7269 7174 2e63 6f72 652e 4966  s mariqt.core.If
-00004920: 646f 4578 6365 7074 696f 6e20 6966 2066  doException if f
-00004930: 6965 6c64 206e 6f74 2066 6f75 6e64 2e20  ield not found. 
-00004940: 2222 220a 0a20 2020 2020 2020 2072 6574  """..        ret
-00004950: 203d 2073 656c 665b 223a 222e 6a6f 696e   = self[":".join
-00004960: 285b 6974 656d 2c27 3027 2c66 6965 6c64  ([item,'0',field
-00004970: 4e61 6d65 5d29 5d0a 2020 2020 2020 2020  Name])].        
-00004980: 6966 2072 6574 203d 3d20 2222 3a0a 2020  if ret == "":.  
-00004990: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
-000049a0: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
-000049b0: 6f6e 2822 4572 726f 723a 2046 6965 6c64  on("Error: Field
-000049c0: 207b 307d 206e 6569 7468 6572 2066 6f75   {0} neither fou
-000049d0: 6e64 2069 6e20 6974 656d 207b 317d 206e  nd in item {1} n
-000049e0: 6f72 2068 6561 6465 7222 2e66 6f72 6d61  or header".forma
-000049f0: 7428 6669 656c 644e 616d 652c 6974 656d  t(fieldName,item
-00004a00: 2929 0a20 2020 2020 2020 2072 6574 7572  )).        retur
-00004a10: 6e20 7265 740a 0a0a 2020 2020 6465 6620  n ret...    def 
-00004a20: 5f5f 6765 7449 7465 6d4c 6174 4c6f 6e28  __getItemLatLon(
-00004a30: 7365 6c66 2c69 7465 6d3a 7374 722c 6865  self,item:str,he
-00004a40: 6164 6572 5661 6c4c 6174 2c68 6561 6465  aderValLat,heade
-00004a50: 7256 616c 4c6f 6e29 3a0a 2020 2020 2020  rValLon):.      
-00004a60: 2020 2222 2220 7265 7475 726e 7320 7b27    """ returns {'
-00004a70: 6c61 7427 3a20 7661 6c75 652c 2027 6c6f  lat': value, 'lo
-00004a80: 6e27 3a20 7661 6c75 652c 2027 6461 7465  n': value, 'date
-00004a90: 7469 6d65 273a 2076 616c 7565 7d20 6f66  time': value} of
-00004aa0: 206c 6973 7420 6f66 2074 686f 7365 2022   list of those "
-00004ab0: 2222 0a0a 2020 2020 2020 2020 6974 656d  ""..        item
-00004ac0: 5661 6c20 3d20 7365 6c66 2e69 6664 6f5b  Val = self.ifdo[
-00004ad0: 6d69 7174 762e 696d 6167 655f 7365 745f  miqtv.image_set_
-00004ae0: 6974 656d 735f 6b65 795d 5b69 7465 6d5d  items_key][item]
-00004af0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00004b00: 6973 696e 7374 616e 6365 2869 7465 6d56  isinstance(itemV
-00004b10: 616c 2c6c 6973 7429 3a0a 2020 2020 2020  al,list):.      
-00004b20: 2020 2020 2020 7265 7420 3d20 7365 6c66        ret = self
-00004b30: 2e5f 5f70 6172 7365 324c 6174 4c6f 6e44  .__parse2LatLonD
-00004b40: 6963 7428 6974 656d 5661 6c2c 6865 6164  ict(itemVal,head
-00004b50: 6572 5661 6c4c 6174 2c68 6561 6465 7256  erValLat,headerV
-00004b60: 616c 4c6f 6e29 0a20 2020 2020 2020 2065  alLon).        e
-00004b70: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00004b80: 2072 6574 203d 205b 5d0a 2020 2020 2020   ret = [].      
-00004b90: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00004ba0: 2020 2020 2020 2020 2020 2069 7465 6d4c             itemL
-00004bb0: 6174 4465 6661 756c 7420 3d20 6974 656d  atDefault = item
-00004bc0: 5661 6c5b 305d 5b27 696d 6167 652d 6c61  Val[0]['image-la
-00004bd0: 7469 7475 6465 275d 0a20 2020 2020 2020  titude'].       
-00004be0: 2020 2020 2065 7863 6570 7420 4b65 7945       except KeyE
-00004bf0: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-00004c00: 2020 2020 2020 6974 656d 4c61 7444 6566        itemLatDef
-00004c10: 6175 6c74 203d 2068 6561 6465 7256 616c  ault = headerVal
-00004c20: 4c61 740a 2020 2020 2020 2020 2020 2020  Lat.            
-00004c30: 2020 2020 2369 6620 6974 656d 4c61 7444      #if itemLatD
-00004c40: 6566 6175 6c74 2069 7320 4e6f 6e65 3a0a  efault is None:.
-00004c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004c60: 2320 2020 2072 6169 7365 2045 7863 6570  #    raise Excep
-00004c70: 7469 6f6e 2822 4572 726f 723a 2046 6965  tion("Error: Fie
-00004c80: 6c64 207b 307d 206e 6569 7468 6572 2066  ld {0} neither f
-00004c90: 6f75 6e64 2069 6e20 6974 656d 207b 317d  ound in item {1}
-00004ca0: 206e 6f72 2068 6561 6465 7222 2e66 6f72   nor header".for
-00004cb0: 6d61 7428 2769 6d61 6765 2d6c 6174 6974  mat('image-latit
-00004cc0: 7564 6527 2c69 7465 6d29 290a 0a20 2020  ude',item))..   
-00004cd0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-00004ce0: 2020 2020 2020 2020 2020 2020 2020 6974                it
-00004cf0: 656d 4c6f 6e44 6566 6175 6c74 203d 2069  emLonDefault = i
-00004d00: 7465 6d56 616c 5b30 5d5b 2769 6d61 6765  temVal[0]['image
-00004d10: 2d6c 6f6e 6769 7475 6465 275d 0a20 2020  -longitude'].   
-00004d20: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-00004d30: 4b65 7945 7272 6f72 3a0a 2020 2020 2020  KeyError:.      
-00004d40: 2020 2020 2020 2020 2020 6974 656d 4c6f            itemLo
-00004d50: 6e44 6566 6175 6c74 203d 2068 6561 6465  nDefault = heade
-00004d60: 7256 616c 4c6f 6e0a 2020 2020 2020 2020  rValLon.        
-00004d70: 2020 2020 2020 2020 2369 6620 6974 656d          #if item
-00004d80: 4c6f 6e44 6566 6175 6c74 2069 7320 4e6f  LonDefault is No
-00004d90: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00004da0: 2020 2020 2320 2020 2072 6169 7365 2045      #    raise E
-00004db0: 7863 6570 7469 6f6e 2822 4572 726f 723a  xception("Error:
-00004dc0: 2046 6965 6c64 207b 307d 206e 6569 7468   Field {0} neith
-00004dd0: 6572 2066 6f75 6e64 2069 6e20 6974 656d  er found in item
-00004de0: 207b 317d 206e 6f72 2068 6561 6465 7222   {1} nor header"
-00004df0: 2e66 6f72 6d61 7428 2769 6d61 6765 2d6c  .format('image-l
-00004e00: 6174 6974 7564 6527 2c69 7465 6d29 290a  atitude',item)).
-00004e10: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00004e20: 2073 7562 456e 7472 7920 696e 2069 7465   subEntry in ite
-00004e30: 6d56 616c 3a0a 2020 2020 2020 2020 2020  mVal:.          
-00004e40: 2020 2020 2020 7265 742e 6170 7065 6e64        ret.append
-00004e50: 2873 656c 662e 5f5f 7061 7273 6532 4c61  (self.__parse2La
-00004e60: 744c 6f6e 4469 6374 2873 7562 456e 7472  tLonDict(subEntr
-00004e70: 792c 6974 656d 4c61 7444 6566 6175 6c74  y,itemLatDefault
-00004e80: 2c69 7465 6d4c 6f6e 4465 6661 756c 7429  ,itemLonDefault)
-00004e90: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-00004ea0: 6e20 7265 740a 2020 2020 2020 2020 2020  n ret.          
-00004eb0: 2020 0a0a 2020 2020 6465 6620 5f5f 7061    ..    def __pa
-00004ec0: 7273 6532 4c61 744c 6f6e 4469 6374 2873  rse2LatLonDict(s
-00004ed0: 656c 662c 6974 656d 5661 6c2c 6865 6164  elf,itemVal,head
-00004ee0: 6572 5661 6c4c 6174 2c68 6561 6465 7256  erValLat,headerV
-00004ef0: 616c 4c6f 6e29 3a0a 2020 2020 2020 2020  alLon):.        
-00004f00: 2222 2220 7265 7475 726e 7320 7b27 6c61  """ returns {'la
-00004f10: 7427 3a6c 6174 2c27 6c6f 6e27 3a6c 6f6e  t':lat,'lon':lon
-00004f20: 2c27 6461 7465 7469 6d65 273a 6461 7465  ,'datetime':date
-00004f30: 7469 6d65 7d20 2222 220a 2020 2020 2020  time} """.      
-00004f40: 2020 6461 7465 7469 6d65 203d 2069 7465    datetime = ite
-00004f50: 6d56 616c 5b27 696d 6167 652d 6461 7465  mVal['image-date
-00004f60: 7469 6d65 275d 0a20 2020 2020 2020 2074  time'].        t
-00004f70: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00004f80: 6c61 7420 3d20 6974 656d 5661 6c5b 2769  lat = itemVal['i
-00004f90: 6d61 6765 2d6c 6174 6974 7564 6527 5d0a  mage-latitude'].
-00004fa0: 2020 2020 2020 2020 6578 6365 7074 204b          except K
-00004fb0: 6579 4572 726f 723a 0a20 2020 2020 2020  eyError:.       
-00004fc0: 2020 2020 206c 6174 203d 2068 6561 6465       lat = heade
-00004fd0: 7256 616c 4c61 740a 2020 2020 2020 2020  rValLat.        
-00004fe0: 2020 2020 6966 206c 6174 2069 7320 4e6f      if lat is No
-00004ff0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00005000: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
-00005010: 696f 6e28 2245 7272 6f72 3a20 4669 656c  ion("Error: Fiel
-00005020: 6420 7b30 7d20 6e65 6974 6865 7220 666f  d {0} neither fo
-00005030: 756e 6420 696e 2069 7465 6d20 7b31 7d20  und in item {1} 
-00005040: 6e6f 7220 6865 6164 6572 222e 666f 726d  nor header".form
-00005050: 6174 2827 696d 6167 652d 6c61 7469 7475  at('image-latitu
-00005060: 6465 272c 6974 656d 5661 6c29 290a 2020  de',itemVal)).  
-00005070: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00005080: 2020 2020 2020 206c 6f6e 203d 2069 7465         lon = ite
-00005090: 6d56 616c 5b27 696d 6167 652d 6c6f 6e67  mVal['image-long
-000050a0: 6974 7564 6527 5d0a 2020 2020 2020 2020  itude'].        
-000050b0: 6578 6365 7074 204b 6579 4572 726f 723a  except KeyError:
-000050c0: 0a20 2020 2020 2020 2020 2020 206c 6f6e  .            lon
-000050d0: 203d 2068 6561 6465 7256 616c 4c6f 6e0a   = headerValLon.
-000050e0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-000050f0: 6f6e 2069 7320 4e6f 6e65 3a0a 2020 2020  on is None:.    
-00005100: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00005110: 6520 4578 6365 7074 696f 6e28 2245 7272  e Exception("Err
-00005120: 6f72 3a20 4669 656c 6420 7b30 7d20 6e65  or: Field {0} ne
-00005130: 6974 6865 7220 666f 756e 6420 696e 2069  ither found in i
-00005140: 7465 6d20 7b31 7d20 6e6f 7220 6865 6164  tem {1} nor head
-00005150: 6572 222e 666f 726d 6174 2827 696d 6167  er".format('imag
-00005160: 652d 6c6f 6e67 6974 7564 6527 2c69 7465  e-longitude',ite
-00005170: 6d56 616c 2929 0a20 2020 2020 2020 2072  mVal)).        r
-00005180: 6574 7572 6e20 7b27 6c61 7427 3a6c 6174  eturn {'lat':lat
-00005190: 2c27 6c6f 6e27 3a6c 6f6e 2c27 6461 7465  ,'lon':lon,'date
-000051a0: 7469 6d65 273a 6461 7465 7469 6d65 7d0a  time':datetime}.
-000051b0: 0a0a 6465 6620 6946 444f 4672 6f6d 4669  ..def iFDOFromFi
-000051c0: 6c65 2869 4644 4f66 696c 653a 7374 722c  le(iFDOfile:str,
-000051d0: 6861 6e64 6c65 5f70 7265 6669 783d 2732  handle_prefix='2
-000051e0: 302e 3530 302e 3132 3038 3527 2c70 726f  0.500.12085',pro
-000051f0: 7665 6e61 6e63 6520 3d20 4e6f 6e65 2c76  venance = None,v
-00005200: 6572 626f 7365 3d54 7275 652c 7374 6172  erbose=True,star
-00005210: 7445 6d70 7479 3d46 616c 7365 2c77 7269  tEmpty=False,wri
-00005220: 7465 546d 7050 726f 7646 696c 653d 5472  teTmpProvFile=Tr
-00005230: 7565 2c69 6d61 6765 5f62 726f 6b65 725f  ue,image_broker_
-00005240: 7575 6964 3d22 6565 3237 3735 3738 2d61  uuid="ee277578-a
-00005250: 3931 312d 3438 3464 2d61 3531 352d 3963  911-484d-a515-9c
-00005260: 3738 3164 3739 6161 3931 2229 3a0a 2020  781d79aa91"):.  
-00005270: 2020 2222 2220 436f 6e76 656e 6965 6e63    """ Convenienc
-00005280: 6520 6675 6e63 7469 6f6e 2074 6f20 6372  e function to cr
-00005290: 6561 7465 2061 6e20 6946 444f 206f 626a  eate an iFDO obj
-000052a0: 6563 7420 6469 7265 6374 6c79 2066 6f72  ect directly for
-000052b0: 6d20 616e 2065 7869 7374 696e 6720 6946  m an existing iF
-000052c0: 444f 2066 696c 652e 2054 7269 6573 2074  DO file. Tries t
-000052d0: 6f20 696e 6665 7220 696d 6167 6520 6669  o infer image fi
-000052e0: 6c65 7320 6c6f 6361 7469 6f6e 2066 726f  les location fro
-000052f0: 6d20 2769 6d61 6765 2d6c 6f63 616c 2d70  m 'image-local-p
-00005300: 6174 6827 2e20 5265 7475 726e 7320 6946  ath'. Returns iF
-00005310: 444f 206f 626a 6563 742e 200a 2020 2020  DO object. .    
-00005320: 2020 2020 2d20 6946 444f 6669 6c65 3a20      - iFDOfile: 
-00005330: 7374 7269 6e67 2070 6174 6820 746f 206c  string path to l
-00005340: 6f61 6420 616e 2065 7870 6c69 6369 7420  oad an explicit 
-00005350: 6946 444f 2066 696c 652e 0a20 2020 2020  iFDO file..     
-00005360: 2020 202d 2068 616e 646c 655f 7072 6566     - handle_pref
-00005370: 6978 3a20 7374 7269 6e67 2070 7265 6669  ix: string prefi
-00005380: 7820 6f66 2074 6865 2068 616e 646c 6520  x of the handle 
-00005390: 7365 7276 6572 2e20 4465 6661 756c 743a  server. Default:
-000053a0: 2074 6865 206f 6e65 2066 6f72 2047 656f   the one for Geo
-000053b0: 6d61 722e 0a20 2020 2020 2020 202d 2070  mar..        - p
-000053c0: 726f 7665 6e61 6e63 653a 206d 6172 6971  rovenance: mariq
-000053d0: 742e 7072 6f76 656e 6361 6e63 652e 5072  t.provencance.Pr
-000053e0: 6f76 656e 616e 6365 206f 626a 6563 7420  ovenance object 
-000053f0: 746f 2074 7261 636b 2064 6174 6120 7072  to track data pr
-00005400: 6f76 656e 616e 6365 2e20 4465 6661 756c  ovenance. Defaul
-00005410: 743a 2061 206e 6577 2070 726f 7665 6e61  t: a new provena
-00005420: 6e63 6520 6f62 6a65 6374 2069 7320 6372  nce object is cr
-00005430: 6561 7465 6420 696e 2074 6865 2027 7072  eated in the 'pr
-00005440: 6f74 6f63 6f6c 2720 7375 6266 6f6c 6465  otocol' subfolde
-00005450: 722e 0a20 2020 2020 2020 202d 2076 6572  r..        - ver
-00005460: 626f 7365 3a20 626f 6f6c 2077 6865 7468  bose: bool wheth
-00005470: 6572 2074 6f20 7072 696e 7420 6f75 7420  er to print out 
-00005480: 696e 666f 726d 6174 696f 6e2e 2050 726f  information. Pro
-00005490: 6365 7373 696e 6720 6973 2066 6173 7465  cessing is faste
-000054a0: 7220 6966 2076 6572 626f 7365 2069 7320  r if verbose is 
-000054b0: 4661 6c73 652e 2044 6566 6175 6c74 3a20  False. Default: 
-000054c0: 5472 7565 2e0a 2020 2020 2020 2020 2d20  True..        - 
-000054d0: 7374 6172 7445 6d70 7479 3a20 626f 6f6c  startEmpty: bool
-000054e0: 2077 6865 7468 6572 2069 7427 7320 6163   whether it's ac
-000054f0: 6365 7074 6564 2074 6861 7420 7468 6572  cepted that ther
-00005500: 6520 6172 6520 6e6f 7420 696d 6167 6573  e are not images
-00005510: 2079 6574 2069 6e20 2764 6972 272e 2044   yet in 'dir'. D
-00005520: 6566 6175 6c74 3a20 4661 6c73 652e 0a20  efault: False.. 
-00005530: 2020 2020 2020 202d 2077 7269 7465 546d         - writeTm
-00005540: 7050 726f 7646 696c 653a 2062 6f6f 6c20  pProvFile: bool 
-00005550: 7768 6574 6865 7220 746f 2077 7269 7465  whether to write
-00005560: 2061 2074 656d 706f 7261 7279 2070 726f   a temporary pro
-00005570: 7665 6e61 6e63 6520 6669 6c65 2064 7572  venance file dur
-00005580: 696e 6720 7468 6520 6946 444f 2063 7265  ing the iFDO cre
-00005590: 6174 696f 6e20 7072 6f63 6573 7320 7768  ation process wh
-000055a0: 6963 6820 7769 6c6c 2062 6520 7265 706c  ich will be repl
-000055b0: 6163 6564 2062 7920 6120 6669 6e61 6c20  aced by a final 
-000055c0: 6f6e 6520 696e 2074 6865 2065 6e64 2e20  one in the end. 
-000055d0: 4465 6661 756c 743a 2054 7275 650a 2020  Default: True.  
-000055e0: 2020 2020 2020 2d20 696d 6167 655f 6272        - image_br
-000055f0: 6f6b 6572 5f75 7569 643a 2075 7569 6420  oker_uuid: uuid 
-00005600: 6f66 2069 6d61 6765 2062 726f 6b65 7220  of image broker 
-00005610: 746f 2063 7265 6174 6520 696d 6167 6520  to create image 
-00005620: 6861 6e64 6c65 7320 6173 2068 7474 7073  handles as https
-00005630: 3a2f 2f68 646c 2e68 616e 646c 652e 6e65  ://hdl.handle.ne
-00005640: 742f 3c68 616e 646c 655f 7072 6566 6978  t/<handle_prefix
-00005650: 3e2f 3c69 6d61 6765 5f62 726f 6b65 725f  >/<image_broker_
-00005660: 7575 6964 3e40 3c69 6d61 6765 2d75 7569  uuid>@<image-uui
-00005670: 643e 2022 2222 0a20 2020 2072 6561 6465  d> """.    reade
-00005680: 7220 3d20 6946 444f 5f52 6561 6465 7228  r = iFDO_Reader(
-00005690: 6946 444f 6669 6c65 290a 2020 2020 696d  iFDOfile).    im
-000056a0: 6167 6573 4469 7220 3d20 6d69 7174 632e  agesDir = miqtc.
-000056b0: 746f 556e 6978 5061 7468 286f 732e 7061  toUnixPath(os.pa
-000056c0: 7468 2e6e 6f72 6d70 6174 6828 6d69 7174  th.normpath(miqt
-000056d0: 632e 746f 556e 6978 5061 7468 2872 6561  c.toUnixPath(rea
-000056e0: 6465 722e 6765 7449 6d61 6765 4469 7265  der.getImageDire
-000056f0: 6374 6f72 7928 2929 2929 0a20 2020 2062  ctory()))).    b
-00005700: 6173 6544 6972 203d 206d 6971 7463 2e74  aseDir = miqtc.t
-00005710: 6f55 6e69 7850 6174 6828 6f73 2e70 6174  oUnixPath(os.pat
-00005720: 682e 636f 6d6d 6f6e 7061 7468 285b 6946  h.commonpath([iF
-00005730: 444f 6669 6c65 2c69 6d61 6765 7344 6972  DOfile,imagesDir
-00005740: 5d29 290a 2020 2020 696d 6167 6544 6174  ])).    imageDat
-00005750: 6154 7970 6546 6f6c 6465 7220 3d20 5b65  aTypeFolder = [e
-00005760: 2066 6f72 2065 2069 6e20 696d 6167 6573   for e in images
-00005770: 4469 722e 7265 706c 6163 6528 6261 7365  Dir.replace(base
-00005780: 4469 722c 2222 292e 7370 6c69 7428 222f  Dir,"").split("/
-00005790: 2229 2069 6620 6520 213d 2022 225d 5b30  ") if e != ""][0
-000057a0: 5d0a 2020 2020 6966 2069 6d61 6765 4461  ].    if imageDa
-000057b0: 7461 5479 7065 466f 6c64 6572 206e 6f74  taTypeFolder not
-000057c0: 2069 6e20 6d69 7174 642e 4469 722e 6474   in miqtd.Dir.dt
-000057d0: 2e5f 5f6d 656d 6265 7273 5f5f 3a0a 2020  .__members__:.  
-000057e0: 2020 2020 2020 7261 6973 6520 6d69 7174        raise miqt
-000057f0: 632e 4966 646f 4578 6365 7074 696f 6e28  c.IfdoException(
-00005800: 2249 6d61 6765 7320 6172 6520 6e6f 7420  "Images are not 
-00005810: 6c6f 6361 7465 6420 696e 2061 2076 616c  located in a val
-00005820: 6964 2064 6174 6120 7479 7065 2064 6972  id data type dir
-00005830: 6563 746f 7279 2028 7261 772c 2069 6e74  ectory (raw, int
-00005840: 6572 6d65 6469 6174 652c 2070 726f 6365  ermediate, proce
-00005850: 7373 6564 2c20 2e2e 2e29 2069 6e20 7468  ssed, ...) in th
-00005860: 6520 7361 6d65 2070 726f 6a65 6374 2061  e same project a
-00005870: 7320 6946 444f 2066 696c 652e 2229 0a20  s iFDO file."). 
-00005880: 2020 2069 6d61 6765 7344 6174 6154 7970     imagesDataTyp
-00005890: 6544 6972 203d 206f 732e 7061 7468 2e6a  eDir = os.path.j
-000058a0: 6f69 6e28 6261 7365 4469 722c 696d 6167  oin(baseDir,imag
-000058b0: 6544 6174 6154 7970 6546 6f6c 6465 7229  eDataTypeFolder)
-000058c0: 0a20 2020 2064 6972 4f62 6a20 3d20 6d69  .    dirObj = mi
-000058d0: 7174 642e 4469 7228 2222 2c69 6d61 6765  qtd.Dir("",image
-000058e0: 7344 6174 6154 7970 6544 6972 2c20 6372  sDataTypeDir, cr
-000058f0: 6561 7465 3d46 616c 7365 2c20 7769 7468  eate=False, with
-00005900: 5f67 6561 723d 4661 6c73 6529 0a20 2020  _gear=False).   
-00005910: 2072 6574 7572 6e20 6946 444f 2864 6972   return iFDO(dir
-00005920: 3d64 6972 4f62 6a2c 6861 6e64 6c65 5f70  =dirObj,handle_p
-00005930: 7265 6669 783d 6861 6e64 6c65 5f70 7265  refix=handle_pre
-00005940: 6669 782c 7072 6f76 656e 616e 6365 3d70  fix,provenance=p
-00005950: 726f 7665 6e61 6e63 652c 7665 7262 6f73  rovenance,verbos
-00005960: 653d 7665 7262 6f73 652c 7374 6172 7445  e=verbose,startE
-00005970: 6d70 7479 3d73 7461 7274 456d 7074 792c  mpty=startEmpty,
-00005980: 7772 6974 6554 6d70 5072 6f76 4669 6c65  writeTmpProvFile
-00005990: 3d77 7269 7465 546d 7050 726f 7646 696c  =writeTmpProvFil
-000059a0: 652c 6946 444f 6669 6c65 3d69 4644 4f66  e,iFDOfile=iFDOf
-000059b0: 696c 652c 696d 6167 655f 6272 6f6b 6572  ile,image_broker
-000059c0: 5f75 7569 643d 696d 6167 655f 6272 6f6b  _uuid=image_brok
-000059d0: 6572 5f75 7569 6429 0a0a 0a63 6c61 7373  er_uuid)...class
-000059e0: 2069 4644 4f3a 0a20 2020 2022 2043 6c61   iFDO:.    " Cla
-000059f0: 7373 2066 6f72 2063 7265 6174 696e 6720  ss for creating 
-00005a00: 616e 6420 6564 6974 696e 6720 6946 444f  and editing iFDO
-00005a10: 2e79 616d 6c20 6669 6c65 7320 220a 0a20  .yaml files ".. 
-00005a20: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-00005a30: 7365 6c66 2c20 6469 723a 6d69 7174 642e  self, dir:miqtd.
-00005a40: 4469 722c 2068 616e 646c 655f 7072 6566  Dir, handle_pref
-00005a50: 6978 3d27 3230 2e35 3030 2e31 3230 3835  ix='20.500.12085
-00005a60: 272c 7072 6f76 656e 616e 6365 203d 204e  ',provenance = N
-00005a70: 6f6e 652c 7665 7262 6f73 653d 5472 7565  one,verbose=True
-00005a80: 2c73 7461 7274 456d 7074 793d 4661 6c73  ,startEmpty=Fals
-00005a90: 652c 7772 6974 6554 6d70 5072 6f76 4669  e,writeTmpProvFi
-00005aa0: 6c65 3d54 7275 652c 6946 444f 6669 6c65  le=True,iFDOfile
-00005ab0: 3d4e 6f6e 652c 696d 6167 655f 6272 6f6b  =None,image_brok
-00005ac0: 6572 5f75 7569 643d 2265 6532 3737 3537  er_uuid="ee27757
-00005ad0: 382d 6139 3131 2d34 3834 642d 6135 3135  8-a911-484d-a515
-00005ae0: 2d39 6337 3831 6437 3961 6139 3122 293a  -9c781d79aa91"):
-00005af0: 0a20 2020 2020 2020 2022 2222 2043 7265  .        """ Cre
-00005b00: 6174 6573 2061 6e20 6946 4f44 206f 626a  ates an iFOD obj
-00005b10: 6563 742e 2052 6571 7569 7265 7320 6120  ect. Requires a 
-00005b20: 7661 6c69 6420 6469 7265 6374 6f72 7920  valid directory 
-00005b30: 636f 6e74 6169 6e69 6e67 2069 6d61 6765  containing image
-00005b40: 2064 6174 6120 6f72 2f61 6e64 2061 6e64   data or/and and
-00005b50: 2069 4644 4f20 6669 6c65 2061 6e64 2061   iFDO file and a
-00005b60: 2068 616e 646c 6520 7072 6566 6978 2069   handle prefix i
-00005b70: 6620 6974 2773 206e 6f74 2074 6865 2047  f it's not the G
-00005b80: 656f 6d61 7220 6f6e 652e 204c 6f61 6473  eomar one. Loads
-00005b90: 2064 6972 6563 746f 7279 2773 2069 4644   directory's iFD
-00005ba0: 4f20 6669 6c65 2069 6620 6974 2065 7869  O file if it exi
-00005bb0: 7374 7320 616c 7265 6164 792e 0a20 2020  sts already..   
-00005bc0: 2020 2020 2020 2020 202d 2064 6972 3a20           - dir: 
-00005bd0: 6d61 7269 7174 2e64 6972 6563 746f 7269  mariqt.directori
-00005be0: 6573 2e44 6972 206f 626a 6563 7420 706f  es.Dir object po
-00005bf0: 696e 7469 6e67 2074 6f20 6120 7661 6c69  inting to a vali
-00005c00: 6420 6461 7461 2074 7970 6520 6469 7265  d data type dire
-00005c10: 6374 6f72 7920 2872 6177 2c20 696e 7465  ctory (raw, inte
-00005c20: 726d 6564 6961 7465 2c20 7072 6f63 6573  rmediate, proces
-00005c30: 7365 642c 202e 2e2e 2920 636f 6e74 6169  sed, ...) contai
-00005c40: 6e69 6e67 2074 6865 2069 6d61 6765 2064  ning the image d
-00005c50: 6174 612e 0a20 2020 2020 2020 2020 2020  ata..           
-00005c60: 202d 2068 616e 646c 655f 7072 6566 6978   - handle_prefix
-00005c70: 3a20 7374 7269 6e67 2070 7265 6669 7820  : string prefix 
-00005c80: 6f66 2074 6865 2068 616e 646c 6520 7365  of the handle se
-00005c90: 7276 6572 2e20 4465 6661 756c 743a 2074  rver. Default: t
-00005ca0: 6865 206f 6e65 2066 6f72 2047 656f 6d61  he one for Geoma
-00005cb0: 722e 0a20 2020 2020 2020 2020 2020 202d  r..            -
-00005cc0: 2070 726f 7665 6e61 6e63 653a 206d 6172   provenance: mar
-00005cd0: 6971 742e 7072 6f76 656e 6361 6e63 652e  iqt.provencance.
-00005ce0: 5072 6f76 656e 616e 6365 206f 626a 6563  Provenance objec
-00005cf0: 7420 746f 2074 7261 636b 2064 6174 6120  t to track data 
-00005d00: 7072 6f76 656e 616e 6365 2e20 4465 6661  provenance. Defa
-00005d10: 756c 743a 2061 206e 6577 2070 726f 7665  ult: a new prove
-00005d20: 6e61 6e63 6520 6f62 6a65 6374 2069 7320  nance object is 
-00005d30: 6372 6561 7465 6420 696e 2074 6865 2027  created in the '
-00005d40: 7072 6f74 6f63 6f6c 2720 7375 6266 6f6c  protocol' subfol
-00005d50: 6465 722e 0a20 2020 2020 2020 2020 2020  der..           
-00005d60: 202d 2076 6572 626f 7365 3a20 626f 6f6c   - verbose: bool
-00005d70: 2077 6865 7468 6572 2074 6f20 7072 696e   whether to prin
-00005d80: 7420 6f75 7420 696e 666f 726d 6174 696f  t out informatio
-00005d90: 6e2e 2044 6566 6175 6c74 3a20 5472 7565  n. Default: True
-00005da0: 2e0a 2020 2020 2020 2020 2020 2020 2d20  ..            - 
-00005db0: 7374 6172 7445 6d70 7479 3a20 626f 6f6c  startEmpty: bool
-00005dc0: 2077 6865 7468 6572 2069 7427 7320 6163   whether it's ac
-00005dd0: 6365 7074 6564 2074 6861 7420 7468 6572  cepted that ther
-00005de0: 6520 6172 6520 6e6f 7420 696d 6167 6573  e are not images
-00005df0: 2079 6574 2069 6e20 2764 6972 272e 2044   yet in 'dir'. D
-00005e00: 6566 6175 6c74 3a20 4661 6c73 652e 0a20  efault: False.. 
-00005e10: 2020 2020 2020 2020 2020 202d 2077 7269             - wri
-00005e20: 7465 546d 7050 726f 7646 696c 653a 2062  teTmpProvFile: b
-00005e30: 6f6f 6c20 7768 6574 6865 7220 746f 2077  ool whether to w
-00005e40: 7269 7465 2061 2074 656d 706f 7261 7279  rite a temporary
-00005e50: 2070 726f 7665 6e61 6e63 6520 6669 6c65   provenance file
-00005e60: 2064 7572 696e 6720 7468 6520 6946 444f   during the iFDO
-00005e70: 2063 7265 6174 696f 6e20 7072 6f63 6573   creation proces
-00005e80: 7320 7768 6963 6820 7769 6c6c 2062 6520  s which will be 
-00005e90: 7265 706c 6163 6564 2062 7920 6120 6669  replaced by a fi
-00005ea0: 6e61 6c20 6f6e 6520 696e 2074 6865 2065  nal one in the e
-00005eb0: 6e64 2e20 4465 6661 756c 743a 2054 7275  nd. Default: Tru
-00005ec0: 650a 2020 2020 2020 2020 2020 2020 2d20  e.            - 
-00005ed0: 6946 444f 6669 6c65 3a20 7374 7269 6e67  iFDOfile: string
-00005ee0: 2070 6174 6820 746f 206c 6f61 6420 616e   path to load an
-00005ef0: 2065 7870 6c69 6369 7420 6946 444f 2066   explicit iFDO f
-00005f00: 696c 652e 2049 6620 6e6f 7420 7072 6f76  ile. If not prov
-00005f10: 6964 6564 2061 206d 6174 6368 696e 6720  ided a matching 
-00005f20: 6946 444f 2066 696c 6520 2869 6620 6974  iFDO file (if it
-00005f30: 2061 6c72 6561 6479 2065 7869 7374 7329   already exists)
-00005f40: 2077 696c 6c20 6265 206c 6f61 6465 6420   will be loaded 
-00005f50: 6672 6f6d 2074 6865 2027 7072 6f64 7563  from the 'produc
-00005f60: 7473 2720 7375 6264 6972 6563 746f 7279  ts' subdirectory
-00005f70: 2e20 4465 6661 756c 743a 204e 6f6e 6520  . Default: None 
-00005f80: 0a20 2020 2020 2020 2020 2020 202d 2069  .            - i
-00005f90: 6d61 6765 5f62 726f 6b65 725f 7575 6964  mage_broker_uuid
-00005fa0: 3a20 7575 6964 206f 6620 696d 6167 6520  : uuid of image 
-00005fb0: 6272 6f6b 6572 2074 6f20 6372 6561 7465  broker to create
-00005fc0: 2069 6d61 6765 2068 616e 646c 6573 2061   image handles a
-00005fd0: 7320 6874 7470 733a 2f2f 6864 6c2e 6861  s https://hdl.ha
-00005fe0: 6e64 6c65 2e6e 6574 2f3c 6861 6e64 6c65  ndle.net/<handle
-00005ff0: 5f70 7265 6669 783e 2f3c 696d 6167 655f  _prefix>/<image_
-00006000: 6272 6f6b 6572 5f75 7569 643e 403c 696d  broker_uuid>@<im
-00006010: 6167 652d 7575 6964 3e20 2222 220a 0a20  age-uuid> """.. 
-00006020: 2020 2020 2020 2023 2063 6865 636b 2074         # check t
-00006030: 6861 7420 6174 2064 6972 206f 7220 6946  hat at dir or iF
-00006040: 444f 6669 6c65 2070 726f 7669 6465 640a  DOfile provided.
-00006050: 2020 2020 2020 2020 6966 2064 6972 2069          if dir i
-00006060: 7320 4e6f 6e65 2061 6e64 2069 4644 4f66  s None and iFDOf
-00006070: 696c 6520 6973 204e 6f6e 653a 0a20 2020  ile is None:.   
-00006080: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
-00006090: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
-000060a0: 6f6e 2822 4e65 6974 6865 7220 6469 7220  on("Neither dir 
-000060b0: 6e6f 7220 6946 444f 6669 6c65 2070 726f  nor iFDOfile pro
-000060c0: 7669 6465 6420 666f 7220 6946 444f 2e22  vided for iFDO."
-000060d0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000060e0: 6469 7220 3d20 6469 720a 2020 2020 2020  dir = dir.      
-000060f0: 2020 7365 6c66 2e69 6d61 6765 7344 6972    self.imagesDir
-00006100: 203d 2064 6972 2e74 6f74 7970 6528 290a   = dir.totype().
-00006110: 2020 2020 2020 2020 7365 6c66 2e64 6972          self.dir
-00006120: 2e63 7265 6174 6554 7970 6546 6f6c 6465  .createTypeFolde
-00006130: 7228 290a 2020 2020 2020 2020 7365 6c66  r().        self
-00006140: 2e68 616e 646c 655f 7072 6566 6978 203d  .handle_prefix =
-00006150: 2022 6874 7470 733a 2f2f 6864 6c2e 6861   "https://hdl.ha
-00006160: 6e64 6c65 2e6e 6574 2f22 202b 2068 616e  ndle.net/" + han
-00006170: 646c 655f 7072 6566 6978 0a20 2020 2020  dle_prefix.     
-00006180: 2020 2073 656c 662e 696d 6167 655f 6861     self.image_ha
-00006190: 6e64 6c65 5f70 7265 6669 7820 3d20 7365  ndle_prefix = se
-000061a0: 6c66 2e68 616e 646c 655f 7072 6566 6978  lf.handle_prefix
-000061b0: 202b 2022 2f22 202b 2069 6d61 6765 5f62   + "/" + image_b
-000061c0: 726f 6b65 725f 7575 6964 0a0a 2020 2020  roker_uuid..    
+000006b0: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
+000006c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000006d0: 726e 2022 220a 2020 2020 2020 2020 2020  rn "".          
+000006e0: 2020 2020 2020 6172 203d 2061 725b 6b5d        ar = ar[k]
+000006f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00000700: 6172 0a0a 0a63 6c61 7373 2069 4644 4f5f  ar...class iFDO_
+00000710: 5265 6164 6572 3a0a 2020 2020 2220 5072  Reader:.    " Pr
+00000720: 6f76 6964 6573 2063 6f6e 7665 6e69 656e  ovides convenien
+00000730: 7420 6675 6e63 7469 6f6e 7320 666f 7220  t functions for 
+00000740: 7265 6164 696e 6720 6461 7461 2066 726f  reading data fro
+00000750: 6d20 6946 444f 2066 696c 6573 2022 0a0a  m iFDO files "..
+00000760: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+00000770: 2873 656c 662c 2069 4644 4f66 696c 653a  (self, iFDOfile:
+00000780: 7374 7229 3a0a 2020 2020 2020 2020 2220  str):.        " 
+00000790: 5072 6f76 6964 6573 2063 6f6e 7665 6e69  Provides conveni
+000007a0: 656e 7420 6675 6e63 7469 6f6e 7320 666f  ent functions fo
+000007b0: 7220 7265 6164 696e 6720 6461 7461 2066  r reading data f
+000007c0: 726f 6d20 6946 444f 2066 696c 6573 2022  rom iFDO files "
+000007d0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+000007e0: 2020 7365 6c66 2e69 4644 4f66 696c 6520    self.iFDOfile 
+000007f0: 3d20 6946 444f 6669 6c65 0a20 2020 2020  = iFDOfile.     
+00000800: 2020 206f 203d 206f 7065 6e28 7365 6c66     o = open(self
+00000810: 2e69 4644 4f66 696c 652c 2027 7227 290a  .iFDOfile, 'r').
+00000820: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
+00000830: 6f20 3d20 7961 6d6c 2e6c 6f61 6428 6f2c  o = yaml.load(o,
+00000840: 2020 4c6f 6164 6572 3d79 616d 6c2e 434c    Loader=yaml.CL
+00000850: 6f61 6465 7229 0a20 2020 2020 2020 206f  oader).        o
+00000860: 2e63 6c6f 7365 2829 0a0a 0a20 2020 2064  .close()...    d
+00000870: 6566 205f 5f67 6574 6974 656d 5f5f 2873  ef __getitem__(s
+00000880: 656c 662c 206b 6579 7329 3a0a 2020 2020  elf, keys):.    
+00000890: 2020 2020 2222 2220 5265 7475 726e 7320      """ Returns 
+000008a0: 636f 7079 206f 6620 6368 6563 6b65 6420  copy of checked 
+000008b0: 6966 646f 2073 6574 206f 7220 6974 656d  ifdo set or item
+000008c0: 2066 6965 6c64 2076 616c 7565 2c20 616c   field value, al
+000008d0: 736f 2063 6f6e 7369 6465 726e 6720 6465  so considerng de
+000008e0: 6661 756c 7420 7661 6c75 6573 2066 726f  fault values fro
+000008f0: 6d20 6865 6164 6572 2e0a 2020 2020 2020  m header..      
+00000900: 2020 2020 2020 5573 6520 6b65 7973 2061        Use keys a
+00000910: 7320 652e 672e 2027 3c69 7465 6d3e 3a3c  s e.g. '<item>:<
+00000920: 6b65 793e 3a2e 2e2e 272e 2043 616e 2062  key>:...'. Can b
+00000930: 6520 7573 6564 2066 6f72 2068 6561 6465  e used for heade
+00000940: 7220 6669 656c 6473 2061 7320 7765 6c6c  r fields as well
+00000950: 2061 7320 6974 656d 2066 6965 6c64 732e   as item fields.
+00000960: 0a20 2020 2020 2020 2020 2020 2049 7465  .            Ite
+00000970: 6d20 696e 6465 7820 6361 6e20 6265 206c  m index can be l
+00000980: 6567 6c65 6374 6564 2c20 696e 2063 6173  eglected, in cas
+00000990: 6520 6f66 2076 6964 656f 2061 2064 6963  e of video a dic
+000009a0: 7420 7b3c 696d 6167 652d 6461 7461 7469  t {<image-datati
+000009b0: 6d65 3e3a 3c76 616c 7565 3e2c 2e2e 2e7d  me>:<value>,...}
+000009c0: 2069 7320 7265 7475 726e 6564 2e0a 2020   is returned..  
+000009d0: 2020 2020 2020 2020 2020 5261 6973 6573            Raises
+000009e0: 2049 6664 6f45 7863 6570 7469 6f6e 2069   IfdoException i
+000009f0: 6620 6974 656d 2064 6f65 7320 6e6f 7420  f item does not 
+00000a00: 6578 6973 742e 2022 2222 0a20 2020 2020  exist. """.     
+00000a10: 2020 206b 6579 7320 3d20 6b65 7973 2e73     keys = keys.s
+00000a20: 706c 6974 2827 3a27 290a 2020 2020 2020  plit(':').      
+00000a30: 2020 7265 7475 726e 2069 4644 4f2e 5f69    return iFDO._i
+00000a40: 4644 4f5f 5f67 6574 4669 656c 6456 616c  FDO__getFieldVal
+00000a50: 7565 2873 656c 662e 6966 646f 2c6b 6579  ue(self.ifdo,key
+00000a60: 7329 0a0a 0a20 2020 2064 6566 2067 6574  s)...    def get
+00000a70: 496d 6167 6573 506f 7369 7469 6f6e 7328  ImagesPositions(
+00000a80: 7365 6c66 2c69 6d61 6765 5f74 7970 6573  self,image_types
+00000a90: 3d6d 6971 7476 2e69 6d61 6765 5f74 7970  =miqtv.image_typ
+00000aa0: 6573 293a 0a20 2020 2020 2020 2022 2222  es):.        """
+00000ab0: 2052 6574 7572 6e73 2069 6d61 6765 7320   Returns images 
+00000ac0: 6669 7273 7420 706f 7369 7469 6f6e 2873  first position(s
+00000ad0: 2920 0a20 2020 2020 2020 2020 2020 2040  ) .            @
+00000ae0: 7265 7475 726e 3a20 7b27 696d 6167 654e  return: {'imageN
+00000af0: 616d 6527 3a20 5b7b 276c 6174 273a 2076  ame': [{'lat': v
+00000b00: 616c 7565 2c20 276c 6f6e 273a 2076 616c  alue, 'lon': val
+00000b10: 7565 2c20 2764 6174 6574 696d 6527 3a20  ue, 'datetime': 
+00000b20: 7661 6c75 657d 5d7d 2c20 696d 6167 652d  value}]}, image-
+00000b30: 636f 6f72 6469 6e61 7465 2d72 6566 6572  coordinate-refer
+00000b40: 656e 6365 2d73 7973 7465 6d20 2222 220a  ence-system """.
+00000b50: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00000b60: 2072 6574 4469 6374 203d 207b 7d0a 2020   retDict = {}.  
+00000b70: 2020 2020 2020 7265 7452 6566 7379 7320        retRefsys 
+00000b80: 3d20 7365 6c66 2e69 6664 6f5b 6d69 7174  = self.ifdo[miqt
+00000b90: 762e 696d 6167 655f 7365 745f 6865 6164  v.image_set_head
+00000ba0: 6572 5f6b 6579 5d5b 2769 6d61 6765 2d63  er_key]['image-c
+00000bb0: 6f6f 7264 696e 6174 652d 7265 6665 7265  oordinate-refere
+00000bc0: 6e63 652d 7379 7374 656d 275d 0a0a 2020  nce-system']..  
+00000bd0: 2020 2020 2020 6865 6164 6572 5661 6c4c        headerValL
+00000be0: 6174 203d 204e 6f6e 650a 2020 2020 2020  at = None.      
+00000bf0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00000c00: 2020 2068 6561 6465 7256 616c 4c61 7420     headerValLat 
+00000c10: 3d20 7365 6c66 2e69 6664 6f5b 6d69 7174  = self.ifdo[miqt
+00000c20: 762e 696d 6167 655f 7365 745f 6865 6164  v.image_set_head
+00000c30: 6572 5f6b 6579 5d5b 2769 6d61 6765 2d6c  er_key]['image-l
+00000c40: 6174 6974 7564 6527 5d0a 2020 2020 2020  atitude'].      
+00000c50: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
+00000c60: 723a 0a20 2020 2020 2020 2020 2020 2070  r:.            p
+00000c70: 6173 730a 0a20 2020 2020 2020 2068 6561  ass..        hea
+00000c80: 6465 7256 616c 4c6f 6e20 3d20 4e6f 6e65  derValLon = None
+00000c90: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00000ca0: 2020 2020 2020 2020 2020 6865 6164 6572            header
+00000cb0: 5661 6c4c 6f6e 203d 2073 656c 662e 6966  ValLon = self.if
+00000cc0: 646f 5b6d 6971 7476 2e69 6d61 6765 5f73  do[miqtv.image_s
+00000cd0: 6574 5f68 6561 6465 725f 6b65 795d 5b27  et_header_key]['
+00000ce0: 696d 6167 652d 6c6f 6e67 6974 7564 6527  image-longitude'
+00000cf0: 5d0a 2020 2020 2020 2020 6578 6365 7074  ].        except
+00000d00: 204b 6579 4572 726f 723a 0a20 2020 2020   KeyError:.     
+00000d10: 2020 2020 2020 2070 6173 730a 0a0a 2020         pass...  
+00000d20: 2020 2020 2020 666f 7220 6669 6c65 4e61        for fileNa
+00000d30: 6d65 2069 6e20 7365 6c66 2e69 6664 6f5b  me in self.ifdo[
+00000d40: 6d69 7174 762e 696d 6167 655f 7365 745f  miqtv.image_set_
+00000d50: 6974 656d 735f 6b65 795d 3a0a 2020 2020  items_key]:.    
+00000d60: 2020 2020 2020 2020 6966 2066 696c 654e          if fileN
+00000d70: 616d 652e 7370 6c69 7428 272e 2729 5b2d  ame.split('.')[-
+00000d80: 315d 2e6c 6f77 6572 2829 2069 6e20 696d  1].lower() in im
+00000d90: 6167 655f 7479 7065 733a 0a20 2020 2020  age_types:.     
+00000da0: 2020 2020 2020 2020 2020 2072 6574 4469             retDi
+00000db0: 6374 5b66 696c 654e 616d 655d 203d 2073  ct[fileName] = s
+00000dc0: 656c 662e 5f5f 6765 7449 7465 6d4c 6174  elf.__getItemLat
+00000dd0: 4c6f 6e28 6669 6c65 4e61 6d65 2c68 6561  Lon(fileName,hea
+00000de0: 6465 7256 616c 4c61 742c 6865 6164 6572  derValLat,header
+00000df0: 5661 6c4c 6f6e 290a 0a20 2020 2020 2020  ValLon)..       
+00000e00: 2072 6574 7572 6e20 7265 7444 6963 742c   return retDict,
+00000e10: 2072 6574 5265 6673 7973 0a0a 0a20 2020   retRefsys...   
+00000e20: 2064 6566 2077 7269 7465 576f 726c 6446   def writeWorldF
+00000e30: 696c 6573 466f 7250 686f 746f 7328 7365  ilesForPhotos(se
+00000e40: 6c66 2c64 6573 7444 6972 3a73 7472 2c69  lf,destDir:str,i
+00000e50: 6d61 6765 536f 7572 6365 4469 723a 7374  mageSourceDir:st
+00000e60: 7229 3a0a 2020 2020 2020 2020 2222 2220  r):.        """ 
+00000e70: 5772 6974 6573 2077 6f72 6c64 2066 696c  Writes world fil
+00000e80: 6573 2066 6f72 2070 686f 746f 7320 6966  es for photos if
+00000e90: 2061 6c6c 2072 6571 7569 7265 6420 6669   all required fi
+00000ea0: 656c 6473 2061 7265 2074 6865 7265 2075  elds are there u
+00000eb0: 6e64 6572 2074 6865 2061 7373 756d 7074  nder the assumpt
+00000ec0: 696f 6e20 7468 6174 2074 6865 2063 616d  ion that the cam
+00000ed0: 6572 6120 7761 7320 6c6f 6f6b 696e 6720  era was looking 
+00000ee0: 7374 7261 6967 6874 2064 6f77 6e20 2870  straight down (p
+00000ef0: 6974 6368 2061 6e64 2072 6f6c 6c20 6172  itch and roll ar
+00000f00: 6520 6967 6e6f 7265 6421 292e 200a 2020  e ignored!). .  
+00000f10: 2020 2020 2020 2020 2020 5265 7475 726e            Return
+00000f20: 7320 6120 6c69 7374 206f 6620 6974 656d  s a list of item
+00000f30: 7320 666f 7220 7768 6963 6820 6372 6561  s for which crea
+00000f40: 7469 6f6e 2066 6169 6c65 643a 205b 5b69  tion failed: [[i
+00000f50: 7465 6d2c 6d73 675d 2c2e 2e2e 5d22 2222  tem,msg],...]"""
+00000f60: 0a0a 2020 2020 2020 2020 2320 544f 444f  ..        # TODO
+00000f70: 2067 6574 2069 6d61 6765 7320 6f6e 6c69   get images onli
+00000f80: 6e65 2066 726f 6d20 6272 6f6b 6572 0a0a  ne from broker..
+00000f90: 2020 2020 2020 2020 6946 444f 6578 6365          iFDOexce
+00000fa0: 7074 696f 6e73 203d 205b 5d0a 0a20 2020  ptions = []..   
+00000fb0: 2020 2020 2023 2067 6574 2069 6d61 6765       # get image
+00000fc0: 7320 706f 7369 7469 6f6e 0a20 2020 2020  s position.     
+00000fd0: 2020 2070 6f73 6974 696f 6e73 4c61 744c     positionsLatL
+00000fe0: 6f6e 2c20 7265 6673 7973 203d 2073 656c  on, refsys = sel
+00000ff0: 662e 6765 7449 6d61 6765 7350 6f73 6974  f.getImagesPosit
+00001000: 696f 6e73 2869 6d61 6765 5f74 7970 6573  ions(image_types
+00001010: 3d6d 6971 7476 2e70 686f 746f 5f74 7970  =miqtv.photo_typ
+00001020: 6573 290a 2020 2020 2020 2020 6372 7346  es).        crsF
+00001030: 6965 6c64 546d 7020 3d20 2727 2e6a 6f69  ieldTmp = ''.joi
+00001040: 6e28 6520 666f 7220 6520 696e 2072 6566  n(e for e in ref
+00001050: 7379 7320 6966 2065 2e69 7361 6c6e 756d  sys if e.isalnum
+00001060: 2829 292e 6c6f 7765 7228 290a 2020 2020  ()).lower().    
+00001070: 2020 2020 6966 2063 7273 4669 656c 6454      if crsFieldT
+00001080: 6d70 203d 3d20 2777 6773 3834 2720 6f72  mp == 'wgs84' or
+00001090: 2063 7273 4669 656c 6454 6d70 203d 3d20   crsFieldTmp == 
+000010a0: 2765 7073 6734 3332 3627 3a0a 2020 2020  'epsg4326':.    
+000010b0: 2020 2020 2020 2020 7265 6673 7973 203d          refsys =
+000010c0: 2022 5747 5338 3422 0a20 2020 2020 2020   "WGS84".       
+000010d0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000010e0: 2020 2069 4644 4f65 7863 6570 7469 6f6e     iFDOexception
+000010f0: 732e 6170 7065 6e64 285b 2222 2c22 436f  s.append(["","Co
+00001100: 6f72 6469 6e61 7465 7320 7265 6665 7265  ordinates refere
+00001110: 6e63 6520 7379 7374 656d 205c 2222 202b  nce system \"" +
+00001120: 2072 6566 7379 7320 2b20 225c 2220 6361   refsys + "\" ca
+00001130: 6e20 6e6f 7420 6265 2068 616e 646c 6564  n not be handled
+00001140: 2e20 5573 6520 7072 6566 6572 6162 6c79  . Use preferably
+00001150: 2045 5053 473a 3433 3236 206f 7220 5747   EPSG:4326 or WG
+00001160: 5338 3422 5d29 0a20 2020 2020 2020 2020  S84"]).         
+00001170: 2020 2072 6574 7572 6e20 6946 444f 6578     return iFDOex
+00001180: 6365 7074 696f 6e73 0a0a 0a20 2020 2020  ceptions...     
+00001190: 2020 2066 6f72 2070 686f 746f 2069 6e20     for photo in 
+000011a0: 706f 7369 7469 6f6e 734c 6174 4c6f 6e3a  positionsLatLon:
+000011b0: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
+000011c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000011d0: 2020 7365 6c66 2e63 6865 636b 4974 656d    self.checkItem
+000011e0: 4861 7368 2870 686f 746f 2c69 6d61 6765  Hash(photo,image
+000011f0: 536f 7572 6365 4469 7229 2023 2054 4f44  SourceDir) # TOD
+00001200: 4f20 636f 756c 6420 6265 2069 6e20 6469  O could be in di
+00001210: 6666 6572 656e 7420 7375 6266 6f6c 6465  fferent subfolde
+00001220: 7220 6f72 2066 726f 6d20 6f6e 6c69 6e65  r or from online
+00001230: 2062 726f 6b65 720a 0a20 2020 2020 2020   broker..       
+00001240: 2020 2020 2020 2020 2023 2063 6f6e 7665           # conve
+00001250: 7274 2074 6f20 7574 6d20 746f 2061 766f  rt to utm to avo
+00001260: 6964 2070 7265 6369 7369 6f6e 2069 7373  id precision iss
+00001270: 7565 2077 6974 6820 6c61 742f 6c6f 6e20  ue with lat/lon 
+00001280: 7661 6c75 6573 2069 6e20 776f 726c 6420  values in world 
+00001290: 6669 6c65 730a 2020 2020 2020 2020 2020  files.          
+000012a0: 2020 2020 2020 6c61 7420 3d20 706f 7369        lat = posi
+000012b0: 7469 6f6e 734c 6174 4c6f 6e5b 7068 6f74  tionsLatLon[phot
+000012c0: 6f5d 5b30 5d5b 276c 6174 275d 0a20 2020  o][0]['lat'].   
+000012d0: 2020 2020 2020 2020 2020 2020 206c 6f6e               lon
+000012e0: 203d 2070 6f73 6974 696f 6e73 4c61 744c   = positionsLatL
+000012f0: 6f6e 5b70 686f 746f 5d5b 305d 5b27 6c6f  on[photo][0]['lo
+00001300: 6e27 5d0a 2020 2020 2020 2020 2020 2020  n'].            
+00001310: 2020 2020 6561 7374 696e 672c 6e6f 7274      easting,nort
+00001320: 6869 6e67 2c7a 6f6e 652c 6973 4e6f 7274  hing,zone,isNort
+00001330: 6820 3d20 6d69 7174 672e 6c61 744c 6f6e  h = miqtg.latLon
+00001340: 3275 746d 286c 6174 2c6c 6f6e 2c72 6566  2utm(lat,lon,ref
+00001350: 7379 7329 0a20 2020 2020 2020 2020 2020  sys).           
+00001360: 2020 2020 2065 7869 6620 3d20 7365 6c66       exif = self
+00001370: 2e5f 5f67 6574 4974 656d 4465 6661 756c  .__getItemDefaul
+00001380: 7456 616c 7565 2870 686f 746f 2c27 696d  tValue(photo,'im
+00001390: 6167 652d 6163 7175 6973 6974 696f 6e2d  age-acquisition-
+000013a0: 7365 7474 696e 6773 2729 2023 2054 4f44  settings') # TOD
+000013b0: 4f20 7768 6174 2069 6620 6e6f 7420 7468  O what if not th
+000013c0: 6572 653f 2072 6561 6420 6672 6f6d 2069  ere? read from i
+000013d0: 6d61 6765 2064 6972 6563 746c 793f 2053  mage directly? S
+000013e0: 686f 756c 6420 6265 2063 6865 636b 6564  hould be checked
+000013f0: 2069 6620 6861 7368 206d 6174 6368 6573   if hash matches
+00001400: 3f20 496d 6167 6520 636f 756c 6420 6861  ? Image could ha
+00001410: 7665 2062 6565 6e20 6372 6f70 7065 6420  ve been cropped 
+00001420: 6166 7465 7220 6946 444f 2063 7265 6174  after iFDO creat
+00001430: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+00001440: 2020 2020 696d 6167 6557 6964 7468 203d      imageWidth =
+00001450: 2069 6e74 2873 7472 2865 7869 665b 2749   int(str(exif['I
+00001460: 6d61 6765 2057 6964 7468 275d 292e 7374  mage Width']).st
+00001470: 7269 7028 275c 2727 2929 0a20 2020 2020  rip('\'')).     
+00001480: 2020 2020 2020 2020 2020 2069 6d61 6765             image
+00001490: 4865 6967 6874 203d 2069 6e74 2873 7472  Height = int(str
+000014a0: 2865 7869 665b 2749 6d61 6765 2048 6569  (exif['Image Hei
+000014b0: 6768 7427 5d29 2e73 7472 6970 2827 5c27  ght']).strip('\'
+000014c0: 2729 290a 2020 2020 2020 2020 2020 2020  ')).            
+000014d0: 2020 2020 6865 6164 696e 6720 3d20 7365      heading = se
+000014e0: 6c66 2e5f 5f67 6574 4974 656d 4465 6661  lf.__getItemDefa
+000014f0: 756c 7456 616c 7565 2870 686f 746f 2c27  ultValue(photo,'
+00001500: 696d 6167 652d 6361 6d65 7261 2d79 6177  image-camera-yaw
+00001510: 2d64 6567 7265 6573 2729 0a20 2020 2020  -degrees').     
+00001520: 2020 2020 2020 2020 2020 2061 6c74 6974             altit
+00001530: 7564 6520 3d20 7365 6c66 2e5f 5f67 6574  ude = self.__get
+00001540: 4974 656d 4465 6661 756c 7456 616c 7565  ItemDefaultValue
+00001550: 2870 686f 746f 2c27 696d 6167 652d 6d65  (photo,'image-me
+00001560: 7465 7273 2d61 626f 7665 2d67 726f 756e  ters-above-groun
+00001570: 6427 290a 0a20 2020 2020 2020 2020 2020  d')..           
+00001580: 2020 2020 2064 6f6d 6550 6f72 742c 6d73       domePort,ms
+00001590: 6720 3d20 7365 6c66 2e5f 5f74 7279 4765  g = self.__tryGe
+000015a0: 7449 7344 6f6d 6550 6f72 7428 7068 6f74  tIsDomePort(phot
+000015b0: 6f29 0a20 2020 2020 2020 2020 2020 2020  o).             
+000015c0: 2020 2066 6f63 616c 4c65 6e67 6850 6978     focalLenghPix
+000015d0: 656c 732c 206d 7367 203d 2073 656c 662e  els, msg = self.
+000015e0: 5f5f 7472 7947 6574 466f 6361 6c4c 656e  __tryGetFocalLen
+000015f0: 6774 6849 6e50 6978 656c 7328 7068 6f74  gthInPixels(phot
+00001600: 6f2c 2064 6f6d 6550 6f72 7429 0a20 2020  o, domePort).   
+00001610: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00001620: 666f 6361 6c4c 656e 6768 5069 7865 6c73  focalLenghPixels
+00001630: 203d 3d20 5b2d 312c 2d31 5d20 6f72 2066   == [-1,-1] or f
+00001640: 6f63 616c 4c65 6e67 6850 6978 656c 7320  ocalLenghPixels 
+00001650: 3d3d 202d 313a 0a20 2020 2020 2020 2020  == -1:.         
+00001660: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00001670: 206d 6971 7463 2e49 6664 6f45 7863 6570   miqtc.IfdoExcep
+00001680: 7469 6f6e 286d 7367 290a 2020 2020 2020  tion(msg).      
+00001690: 2020 2020 2020 2020 2020 6d69 7174 672e            miqtg.
+000016a0: 7772 6974 6553 696d 706c 6555 746d 576f  writeSimpleUtmWo
+000016b0: 726c 6446 696c 6528 6f73 2e70 6174 682e  rldFile(os.path.
+000016c0: 6a6f 696e 2864 6573 7444 6972 2c6d 6971  join(destDir,miq
+000016d0: 7467 2e63 6f6e 7665 7274 496d 6167 654e  tg.convertImageN
+000016e0: 616d 6554 6f57 6f72 6c64 4669 6c65 4e61  ameToWorldFileNa
+000016f0: 6d65 2870 686f 746f 2929 2c65 6173 7469  me(photo)),easti
+00001700: 6e67 2c6e 6f72 7468 696e 672c 7a6f 6e65  ng,northing,zone
+00001710: 2c69 734e 6f72 7468 2c69 6d61 6765 5769  ,isNorth,imageWi
+00001720: 6474 682c 696d 6167 6548 6569 6768 742c  dth,imageHeight,
+00001730: 6865 6164 696e 672c 616c 7469 7475 6465  heading,altitude
+00001740: 2c66 6f63 616c 4c65 6e67 6850 6978 656c  ,focalLenghPixel
+00001750: 735b 305d 2c66 6f63 616c 4c65 6e67 6850  s[0],focalLenghP
+00001760: 6978 656c 735b 315d 290a 2020 2020 2020  ixels[1]).      
+00001770: 2020 2020 2020 6578 6365 7074 206d 6971        except miq
+00001780: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
+00001790: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+000017a0: 2020 2020 2020 2069 4644 4f65 7863 6570         iFDOexcep
+000017b0: 7469 6f6e 732e 6170 7065 6e64 285b 7068  tions.append([ph
+000017c0: 6f74 6f2c 7374 7228 652e 6172 6773 295d  oto,str(e.args)]
+000017d0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+000017e0: 6e20 6946 444f 6578 6365 7074 696f 6e73  n iFDOexceptions
+000017f0: 0a0a 0a20 2020 2064 6566 2063 6865 636b  ...    def check
+00001800: 4974 656d 4861 7368 2873 656c 662c 6974  ItemHash(self,it
+00001810: 656d 3a73 7472 2c66 696c 6544 6972 3a73  em:str,fileDir:s
+00001820: 7472 293a 0a20 2020 2020 2020 2022 2222  tr):.        """
+00001830: 2063 6f6d 7061 7265 7320 6669 6c65 2773   compares file's
+00001840: 2068 6173 6820 7769 7468 2068 6173 6820   hash with hash 
+00001850: 696e 2069 4644 4f20 616e 6420 7468 726f  in iFDO and thro
+00001860: 7773 2065 7863 6570 7469 6f6e 2069 6620  ws exception if 
+00001870: 7468 6579 2064 6f6e 2774 206d 6174 6368  they don't match
+00001880: 2022 2222 0a0a 2020 2020 2020 2020 6669   """..        fi
+00001890: 6c65 203d 206f 732e 7061 7468 2e6a 6f69  le = os.path.joi
+000018a0: 6e28 6669 6c65 4469 722c 6974 656d 290a  n(fileDir,item).
+000018b0: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
+000018c0: 732e 7061 7468 2e69 7366 696c 6528 6669  s.path.isfile(fi
+000018d0: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
+000018e0: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
+000018f0: 6f45 7863 6570 7469 6f6e 2822 4669 6c65  oException("File
+00001900: 205c 2222 202b 2069 7465 6d20 2b20 225c   \"" + item + "\
+00001910: 2220 6e6f 7420 666f 756e 6420 696e 2064  " not found in d
+00001920: 6972 205c 2222 202b 2066 696c 6544 6972  ir \"" + fileDir
+00001930: 202b 2022 5c22 2229 0a0a 2020 2020 2020   + "\"")..      
+00001940: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00001950: 7365 6c66 2e69 6664 6f5b 6d69 7174 762e  self.ifdo[miqtv.
+00001960: 696d 6167 655f 7365 745f 6974 656d 735f  image_set_items_
+00001970: 6b65 795d 5b69 7465 6d5d 2c6c 6973 7429  key][item],list)
+00001980: 3a20 2320 696e 2063 6173 6520 6f66 2076  : # in case of v
+00001990: 6964 656f 2077 6974 6820 6974 656d 2061  ideo with item a
+000019a0: 7320 6c69 7374 2074 6865 2066 6972 7374  s list the first
+000019b0: 2065 6e74 7279 2068 6f6c 6473 2074 6865   entry holds the
+000019c0: 2064 6566 6175 6c74 2061 6e64 2074 6865   default and the
+000019d0: 2068 6173 6820 6361 6e6e 6f74 2076 6172   hash cannot var
+000019e0: 7920 666f 7220 7468 6520 7361 6d65 2069  y for the same i
+000019f0: 6d61 6765 0a20 2020 2020 2020 2020 2020  mage.           
+00001a00: 2069 7465 6d45 6e74 7279 203d 2073 656c   itemEntry = sel
+00001a10: 662e 6966 646f 5b6d 6971 7476 2e69 6d61  f.ifdo[miqtv.ima
+00001a20: 6765 5f73 6574 5f69 7465 6d73 5f6b 6579  ge_set_items_key
+00001a30: 5d5b 6974 656d 5d5b 305d 200a 2020 2020  ][item][0] .    
+00001a40: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00001a50: 2020 2020 2020 6974 656d 456e 7472 7920        itemEntry 
+00001a60: 3d20 7365 6c66 2e69 6664 6f5b 6d69 7174  = self.ifdo[miqt
+00001a70: 762e 696d 6167 655f 7365 745f 6974 656d  v.image_set_item
+00001a80: 735f 6b65 795d 5b69 7465 6d5d 0a20 2020  s_key][item].   
+00001a90: 2020 2020 2069 6620 6e6f 7420 6974 656d       if not item
+00001aa0: 456e 7472 795b 2769 6d61 6765 2d68 6173  Entry['image-has
+00001ab0: 682d 7368 6132 3536 275d 203d 3d20 6d69  h-sha256'] == mi
+00001ac0: 7174 632e 7368 6132 3536 4861 7368 4669  qtc.sha256HashFi
+00001ad0: 6c65 2866 696c 6529 3a0a 2020 2020 2020  le(file):.      
+00001ae0: 2020 2020 2020 7261 6973 6520 6d69 7174        raise miqt
+00001af0: 632e 4966 646f 4578 6365 7074 696f 6e28  c.IfdoException(
+00001b00: 6974 656d 2c20 2269 4644 4f20 656e 7472  item, "iFDO entr
+00001b10: 7920 6973 206e 6f74 2075 7020 746f 2064  y is not up to d
+00001b20: 6174 652c 2069 6d61 6765 2068 6173 6820  ate, image hash 
+00001b30: 646f 6573 206e 6f74 206d 6174 6368 2e22  does not match."
+00001b40: 290a 0a20 2020 2064 6566 2067 6574 496d  )..    def getIm
+00001b50: 6167 6544 6972 6563 746f 7279 2873 656c  ageDirectory(sel
+00001b60: 6629 3a0a 2020 2020 2020 2020 2222 2220  f):.        """ 
+00001b70: 5265 7475 726e 7320 7468 6520 6c6f 7765  Returns the lowe
+00001b80: 726d 6f73 7420 6c6f 6361 6c20 6469 7265  rmost local dire
+00001b90: 6374 6f72 7920 636f 6e74 6169 6e69 6e67  ctory containing
+00001ba0: 2074 6865 2069 6d61 6765 2066 696c 6573   the image files
+00001bb0: 2069 6e66 6572 7265 6420 6672 6f6d 2027   inferred from '
+00001bc0: 696d 6167 652d 6c6f 6361 6c2d 7061 7468  image-local-path
+00001bd0: 272e 2049 6620 2769 6d61 6765 2d6c 6f63  '. If 'image-loc
+00001be0: 616c 2d70 6174 6827 206e 6f74 2070 726f  al-path' not pro
+00001bf0: 7669 6465 6420 666f 7220 616c 6c20 696d  vided for all im
+00001c00: 6167 6520 6974 656d 7320 7468 6520 6946  age items the iF
+00001c10: 444f 2773 2070 6172 656e 7420 6469 7265  DO's parent dire
+00001c20: 6374 6f72 7920 6973 2072 6574 7572 6e65  ctory is returne
+00001c30: 642e 2022 2222 0a20 2020 2020 2020 206c  d. """.        l
+00001c40: 6f63 616c 5061 7468 7320 3d20 5b5d 0a20  ocalPaths = []. 
+00001c50: 2020 2020 2020 2069 4644 4f46 696c 6550         iFDOFileP
+00001c60: 6172 656e 7444 6972 203d 206f 732e 7061  arentDir = os.pa
+00001c70: 7468 2e64 6972 6e61 6d65 286f 732e 7061  th.dirname(os.pa
+00001c80: 7468 2e64 6972 6e61 6d65 2873 656c 662e  th.dirname(self.
+00001c90: 6946 444f 6669 6c65 2929 0a20 2020 2020  iFDOfile)).     
+00001ca0: 2020 2066 6f72 2069 7465 6d20 696e 2073     for item in s
+00001cb0: 656c 662e 6966 646f 5b6d 6971 7476 2e69  elf.ifdo[miqtv.i
+00001cc0: 6d61 6765 5f73 6574 5f69 7465 6d73 5f6b  mage_set_items_k
+00001cd0: 6579 5d3a 0a20 2020 2020 2020 2020 2020  ey]:.           
+00001ce0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00001cf0: 2020 2020 2020 6974 656d 4c6f 6361 6c50        itemLocalP
+00001d00: 6174 6820 3d20 7365 6c66 2e5f 5f67 6574  ath = self.__get
+00001d10: 4974 656d 4465 6661 756c 7456 616c 7565  ItemDefaultValue
+00001d20: 2869 7465 6d2c 2769 6d61 6765 2d6c 6f63  (item,'image-loc
+00001d30: 616c 2d70 6174 6827 290a 2020 2020 2020  al-path').      
+00001d40: 2020 2020 2020 6578 6365 7074 206d 6971        except miq
+00001d50: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
+00001d60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00001d70: 2020 6974 656d 4c6f 6361 6c50 6174 6820    itemLocalPath 
+00001d80: 3d20 6946 444f 4669 6c65 5061 7265 6e74  = iFDOFileParent
+00001d90: 4469 720a 2020 2020 2020 2020 2020 2020  Dir.            
+00001da0: 6966 2069 7465 6d4c 6f63 616c 5061 7468  if itemLocalPath
+00001db0: 206e 6f74 2069 6e20 6c6f 6361 6c50 6174   not in localPat
+00001dc0: 6873 3a0a 2020 2020 2020 2020 2020 2020  hs:.            
+00001dd0: 2020 2020 6c6f 6361 6c50 6174 6873 2e61      localPaths.a
+00001de0: 7070 656e 6428 6974 656d 4c6f 6361 6c50  ppend(itemLocalP
+00001df0: 6174 6829 0a20 2020 2020 2020 2063 6f6d  ath).        com
+00001e00: 6d6f 6e50 6174 6820 3d20 6f73 2e70 6174  monPath = os.pat
+00001e10: 682e 636f 6d6d 6f6e 7061 7468 286c 6f63  h.commonpath(loc
+00001e20: 616c 5061 7468 7329 0a20 2020 2020 2020  alPaths).       
+00001e30: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
+00001e40: 6973 6162 7328 636f 6d6d 6f6e 5061 7468  isabs(commonPath
+00001e50: 293a 0a20 2020 2020 2020 2020 2020 2063  ):.            c
+00001e60: 6f6d 6d6f 6e50 6174 6820 3d20 6f73 2e70  ommonPath = os.p
+00001e70: 6174 682e 6e6f 726d 7061 7468 286f 732e  ath.normpath(os.
+00001e80: 7061 7468 2e6a 6f69 6e28 6f73 2e70 6174  path.join(os.pat
+00001e90: 682e 6469 726e 616d 6528 7365 6c66 2e69  h.dirname(self.i
+00001ea0: 4644 4f66 696c 6529 2c20 636f 6d6d 6f6e  FDOfile), common
+00001eb0: 5061 7468 2929 0a20 2020 2020 2020 2072  Path)).        r
+00001ec0: 6574 7572 6e20 636f 6d6d 6f6e 5061 7468  eturn commonPath
+00001ed0: 0a0a 0a20 2020 2064 6566 205f 5f74 7279  ...    def __try
+00001ee0: 4765 7449 7344 6f6d 6550 6f72 7428 7365  GetIsDomePort(se
+00001ef0: 6c66 2c69 7465 6d29 3a0a 2020 2020 2020  lf,item):.      
+00001f00: 2020 2222 2220 5472 6965 7320 746f 2072    """ Tries to r
+00001f10: 6561 6420 706f 7274 2074 7970 6520 6672  ead port type fr
+00001f20: 6f6d 2027 696d 6167 652d 6361 6d65 7261  om 'image-camera
+00001f30: 2d68 6f75 7369 6e67 2d76 6965 7770 6f72  -housing-viewpor
+00001f40: 7427 5b76 6965 7770 6f72 742d 7479 7065  t'[viewport-type
+00001f50: 5d20 6f72 2027 696d 6167 652d 666c 6174  ] or 'image-flat
+00001f60: 706f 7274 2d70 6172 616d 6574 6572 7327  port-parameters'
+00001f70: 2f27 696d 6167 652d 646f 6d65 706f 7274  /'image-domeport
+00001f80: 2d70 6172 616d 6574 6572 7327 200a 2020  -parameters' .  
+00001f90: 2020 2020 2020 2020 2020 5265 7475 726e            Return
+00001fa0: 7320 5472 7565 2c6d 7367 2069 6620 646f  s True,msg if do
+00001fb0: 6d65 2070 6f72 742c 2046 616c 7365 2c6d  me port, False,m
+00001fc0: 7367 2069 6620 666c 6174 2070 6f72 742c  sg if flat port,
+00001fd0: 204e 6f6e 652c 6d73 6720 6f74 6865 7277   None,msg otherw
+00001fe0: 6973 6520 2222 220a 0a20 2020 2020 2020  ise """..       
+00001ff0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00002000: 2020 706f 7274 5479 7065 5374 7220 3d20    portTypeStr = 
+00002010: 7365 6c66 2e5f 5f67 6574 4974 656d 4465  self.__getItemDe
+00002020: 6661 756c 7456 616c 7565 2869 7465 6d2c  faultValue(item,
+00002030: 2769 6d61 6765 2d63 616d 6572 612d 686f  'image-camera-ho
+00002040: 7573 696e 672d 7669 6577 706f 7274 2729  using-viewport')
+00002050: 0a20 2020 2020 2020 2020 2020 2070 6f72  .            por
+00002060: 7454 7970 6553 7472 203d 2070 6f72 7454  tTypeStr = portT
+00002070: 7970 6553 7472 5b27 7669 6577 706f 7274  ypeStr['viewport
+00002080: 2d74 7970 6527 5d0a 2020 2020 2020 2020  -type'].        
+00002090: 2020 2020 6966 2027 646f 6d65 2720 696e      if 'dome' in
+000020a0: 2070 6f72 7454 7970 6553 7472 2e6c 6f77   portTypeStr.low
+000020b0: 6572 2829 2061 6e64 206e 6f74 2027 666c  er() and not 'fl
+000020c0: 6174 2720 696e 2070 6f72 7454 7970 6553  at' in portTypeS
+000020d0: 7472 2e6c 6f77 6572 2829 3a0a 2020 2020  tr.lower():.    
+000020e0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000020f0: 726e 2054 7275 652c 2250 6172 7365 6420  rn True,"Parsed 
+00002100: 6672 6f6d 2027 696d 6167 652d 6361 6d65  from 'image-came
+00002110: 7261 2d68 6f75 7369 6e67 2d76 6965 7770  ra-housing-viewp
+00002120: 6f72 7427 5b27 7669 6577 706f 7274 2d74  ort'['viewport-t
+00002130: 7970 6527 5d22 0a20 2020 2020 2020 2020  ype']".         
+00002140: 2020 2065 6c69 6620 6e6f 7420 2764 6f6d     elif not 'dom
+00002150: 6527 2069 6e20 706f 7274 5479 7065 5374  e' in portTypeSt
+00002160: 722e 6c6f 7765 7228 2920 616e 6420 2766  r.lower() and 'f
+00002170: 6c61 7427 2069 6e20 706f 7274 5479 7065  lat' in portType
+00002180: 5374 722e 6c6f 7765 7228 293a 0a20 2020  Str.lower():.   
+00002190: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+000021a0: 7572 6e20 4661 6c73 652c 2250 6172 7365  urn False,"Parse
+000021b0: 6420 6672 6f6d 2027 696d 6167 652d 6361  d from 'image-ca
+000021c0: 6d65 7261 2d68 6f75 7369 6e67 2d76 6965  mera-housing-vie
+000021d0: 7770 6f72 7427 5b27 7669 6577 706f 7274  wport'['viewport
+000021e0: 2d74 7970 6527 5d22 0a20 2020 2020 2020  -type']".       
+000021f0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00002200: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00002210: 6e20 4e6f 6e65 2c22 436f 756c 6420 6e6f  n None,"Could no
+00002220: 7420 7265 6164 2070 6f72 7420 7479 7065  t read port type
+00002230: 2066 726f 6d20 2769 6d61 6765 2d63 616d   from 'image-cam
+00002240: 6572 612d 686f 7573 696e 672d 7669 6577  era-housing-view
+00002250: 706f 7274 275b 2776 6965 7770 6f72 742d  port'['viewport-
+00002260: 7479 7065 275d 2069 6e20 6974 656d 3a20  type'] in item: 
+00002270: 2220 2b20 6974 656d 0a20 2020 2020 2020  " + item.       
+00002280: 2065 7863 6570 7420 286d 6971 7463 2e49   except (miqtc.I
+00002290: 6664 6f45 7863 6570 7469 6f6e 2c20 4b65  fdoException, Ke
+000022a0: 7945 7272 6f72 293a 0a20 2020 2020 2020  yError):.       
+000022b0: 2020 2020 2070 6173 730a 0a20 2020 2020       pass..     
+000022c0: 2020 2066 6c61 7450 6f72 7450 6172 616d     flatPortParam
+000022d0: 7346 6f75 6e64 203d 2046 616c 7365 0a20  sFound = False. 
+000022e0: 2020 2020 2020 2074 7279 3a20 0a20 2020         try: .   
+000022f0: 2020 2020 2020 2020 2066 6c61 7450 6f72           flatPor
+00002300: 7450 6172 616d 7320 3d20 7365 6c66 2e5f  tParams = self._
+00002310: 5f67 6574 4974 656d 4465 6661 756c 7456  _getItemDefaultV
+00002320: 616c 7565 2869 7465 6d2c 2769 6d61 6765  alue(item,'image
+00002330: 2d66 6c61 7470 6f72 742d 7061 7261 6d65  -flatport-parame
+00002340: 7465 7273 2729 0a20 2020 2020 2020 2020  ters').         
+00002350: 2020 2066 6c61 7450 6f72 7450 6172 616d     flatPortParam
+00002360: 7346 6f75 6e64 203d 2054 7275 650a 2020  sFound = True.  
+00002370: 2020 2020 2020 6578 6365 7074 206d 6971        except miq
+00002380: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
+00002390: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
+000023a0: 7373 0a20 2020 2020 2020 2064 6f6d 6550  ss.        domeP
+000023b0: 6f72 7450 6172 616d 7346 6f75 6e64 203d  ortParamsFound =
+000023c0: 2046 616c 7365 0a20 2020 2020 2020 2074   False.        t
+000023d0: 7279 3a20 0a20 2020 2020 2020 2020 2020  ry: .           
+000023e0: 2064 6f6d 6550 6f72 7450 6172 616d 7320   domePortParams 
+000023f0: 3d20 7365 6c66 2e5f 5f67 6574 4974 656d  = self.__getItem
+00002400: 4465 6661 756c 7456 616c 7565 2869 7465  DefaultValue(ite
+00002410: 6d2c 2769 6d61 6765 2d64 6f6d 6570 6f72  m,'image-domepor
+00002420: 742d 7061 7261 6d65 7465 7273 2729 0a20  t-parameters'). 
+00002430: 2020 2020 2020 2020 2020 2064 6f6d 6550             domeP
+00002440: 6f72 7450 6172 616d 7346 6f75 6e64 203d  ortParamsFound =
+00002450: 2054 7275 650a 2020 2020 2020 2020 6578   True.        ex
+00002460: 6365 7074 206d 6971 7463 2e49 6664 6f45  cept miqtc.IfdoE
+00002470: 7863 6570 7469 6f6e 3a0a 2020 2020 2020  xception:.      
+00002480: 2020 2020 2020 7061 7373 0a0a 2020 2020        pass..    
+00002490: 2020 2020 6966 2066 6c61 7450 6f72 7450      if flatPortP
+000024a0: 6172 616d 7346 6f75 6e64 2061 6e64 2064  aramsFound and d
+000024b0: 6f6d 6550 6f72 7450 6172 616d 7346 6f75  omePortParamsFou
+000024c0: 6e64 3a0a 2020 2020 2020 2020 2020 2020  nd:.            
+000024d0: 7265 7475 726e 204e 6f6e 652c 2243 6f75  return None,"Cou
+000024e0: 6c64 206e 6f74 2072 6561 6420 706f 7274  ld not read port
+000024f0: 2074 7970 6520 6672 6f6d 2069 7465 6d20   type from item 
+00002500: 6173 2069 7420 636f 6e74 6169 6e73 2069  as it contains i
+00002510: 6e66 6f20 6f6e 2062 6f74 6820 666c 6174  nfo on both flat
+00002520: 2061 6e64 2064 6f6d 6520 706f 7274 3a20   and dome port: 
+00002530: 2220 2b20 6974 656d 0a20 2020 2020 2020  " + item.       
+00002540: 2069 6620 666c 6174 506f 7274 5061 7261   if flatPortPara
+00002550: 6d73 466f 756e 643a 0a20 2020 2020 2020  msFound:.       
+00002560: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00002570: 652c 2241 7373 756d 6564 2061 7320 666c  e,"Assumed as fl
+00002580: 6174 2070 6f72 7420 6173 2027 696d 6167  at port as 'imag
+00002590: 652d 666c 6174 706f 7274 2d70 6172 616d  e-flatport-param
+000025a0: 6574 6572 7327 2066 6f75 6e64 2069 6e20  eters' found in 
+000025b0: 6974 656d 3a20 2220 2b20 6974 656d 0a20  item: " + item. 
+000025c0: 2020 2020 2020 2069 6620 646f 6d65 506f         if domePo
+000025d0: 7274 5061 7261 6d73 466f 756e 643a 0a20  rtParamsFound:. 
+000025e0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000025f0: 6e20 5472 7565 2c22 4173 7375 6d65 6420  n True,"Assumed 
+00002600: 6173 2064 6f6d 6520 706f 7274 2061 7320  as dome port as 
+00002610: 2769 6d61 6765 2d64 6f6d 6570 6f72 742d  'image-domeport-
+00002620: 7061 7261 6d65 7465 7273 2720 666f 756e  parameters' foun
+00002630: 6420 696e 2069 7465 6d3a 2022 202b 2069  d in item: " + i
+00002640: 7465 6d0a 2020 2020 2020 2020 7265 7475  tem.        retu
+00002650: 726e 204e 6f6e 652c 2243 6f75 6c64 206e  rn None,"Could n
+00002660: 6f74 2072 6561 6420 706f 7274 2074 7970  ot read port typ
+00002670: 6520 6672 6f6d 2069 7465 6d3a 2022 202b  e from item: " +
+00002680: 2069 7465 6d0a 0a0a 2020 2020 6465 6620   item...    def 
+00002690: 5f5f 7472 7947 6574 466f 6361 6c4c 656e  __tryGetFocalLen
+000026a0: 6774 6849 6e50 6978 656c 7328 7365 6c66  gthInPixels(self
+000026b0: 2c69 7465 6d3a 7374 722c 646f 6d65 506f  ,item:str,domePo
+000026c0: 7274 3d4e 6f6e 6529 3a0a 2020 2020 2020  rt=None):.      
+000026d0: 2020 2222 2220 0a20 2020 2020 2020 2054    """ .        T
+000026e0: 7269 6573 2074 6f20 7265 6164 2f64 6574  ries to read/det
+000026f0: 6572 6d69 6e65 2066 6f63 616c 206c 656e  ermine focal len
+00002700: 6774 6820 696e 2070 6978 656c 7320 6569  gth in pixels ei
+00002710: 7468 6572 2066 726f 6d20 2769 6d61 6765  ther from 'image
+00002720: 2d63 616d 6572 612d 6361 6c69 6272 6174  -camera-calibrat
+00002730: 696f 6e2d 6d6f 6465 6c27 5b27 6361 6c69  ion-model'['cali
+00002740: 6272 6174 696f 6e2d 666f 6361 6c2d 6c65  bration-focal-le
+00002750: 6e67 7468 2d78 792d 7069 7865 6c27 5d20  ngth-xy-pixel'] 
+00002760: 6f72 2066 726f 6d20 6578 6966 2076 616c  or from exif val
+00002770: 7565 732e 0a20 2020 2020 2020 2069 6620  ues..        if 
+00002780: 646f 6d65 506f 7274 203d 2046 616c 7365  domePort = False
+00002790: 2c20 666c 6174 2070 6f72 7420 6973 2061  , flat port is a
+000027a0: 7373 756d 6564 2061 6e64 2061 2063 6f72  ssumed and a cor
+000027b0: 7265 6374 696f 6e20 6661 6374 6f72 206f  rection factor o
+000027c0: 6620 312e 3333 2069 7320 6170 706c 6965  f 1.33 is applie
+000027d0: 6420 666f 7220 666f 6361 6c20 6c65 6e67  d for focal leng
+000027e0: 7468 2064 6574 6572 6d69 6e65 6420 6672  th determined fr
+000027f0: 6f6d 2065 7869 6620 7661 6c75 6573 0a20  om exif values. 
+00002800: 2020 2020 2020 2052 6574 7572 6e73 2065         Returns e
+00002810: 6974 6865 7220 666f 6361 6c4c 656e 6774  ither focalLengt
+00002820: 682c 206d 6573 7361 6765 206f 7220 5b66  h, message or [f
+00002830: 6f63 616c 4c65 6e67 7468 582c 666f 6361  ocalLengthX,foca
+00002840: 6c4c 656e 6774 6859 5d2c 206d 6573 7361  lLengthY], messa
+00002850: 6765 2e20 4966 2075 6e73 7563 6365 7373  ge. If unsuccess
+00002860: 6675 6c20 666f 6361 6c4c 656e 6774 6820  ful focalLength 
+00002870: 3d20 2d31 0a20 2020 2020 2020 2022 2222  = -1.        """
+00002880: 0a0a 2020 2020 2020 2020 2320 7472 7920  ..        # try 
+00002890: 7265 6164 2066 726f 6d20 2769 6d61 6765  read from 'image
+000028a0: 2d63 616d 6572 612d 6361 6c69 6272 6174  -camera-calibrat
+000028b0: 696f 6e2d 6d6f 6465 6c27 5b27 6361 6c69  ion-model'['cali
+000028c0: 6272 6174 696f 6e2d 666f 6361 6c2d 6c65  bration-focal-le
+000028d0: 6e67 7468 2d78 792d 7069 7865 6c27 5d0a  ngth-xy-pixel'].
+000028e0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+000028f0: 2020 2020 2020 2020 2066 6f63 616c 4c65           focalLe
+00002900: 6e67 7468 5859 203d 2073 656c 662e 5f5f  ngthXY = self.__
+00002910: 6765 7449 7465 6d44 6566 6175 6c74 5661  getItemDefaultVa
+00002920: 6c75 6528 6974 656d 2c27 696d 6167 652d  lue(item,'image-
+00002930: 6361 6d65 7261 2d63 616c 6962 7261 7469  camera-calibrati
+00002940: 6f6e 2d6d 6f64 656c 2729 0a20 2020 2020  on-model').     
+00002950: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00002960: 2020 2020 2020 2020 2020 2020 666f 6361              foca
+00002970: 6c4c 656e 6774 6858 5920 3d20 666f 6361  lLengthXY = foca
+00002980: 6c4c 656e 6774 6858 595b 2763 616c 6962  lLengthXY['calib
+00002990: 7261 7469 6f6e 2d66 6f63 616c 2d6c 656e  ration-focal-len
+000029a0: 6774 682d 7879 2d70 6978 656c 275d 0a20  gth-xy-pixel']. 
+000029b0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+000029c0: 7420 4b65 7945 7272 6f72 3a0a 2020 2020  t KeyError:.    
+000029d0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000029e0: 6520 6d69 7174 632e 4966 646f 4578 6365  e miqtc.IfdoExce
+000029f0: 7074 696f 6e28 6974 656d 2c22 646f 6573  ption(item,"does
+00002a00: 206e 6f74 2063 6f6e 7461 696e 2027 696d   not contain 'im
+00002a10: 6167 652d 6361 6d65 7261 2d63 616c 6962  age-camera-calib
+00002a20: 7261 7469 6f6e 2d6d 6f64 656c 275b 2763  ration-model'['c
+00002a30: 616c 6962 7261 7469 6f6e 2d66 6f63 616c  alibration-focal
+00002a40: 2d6c 656e 6774 682d 7879 2d70 6978 656c  -length-xy-pixel
+00002a50: 275d 2229 0a0a 2020 2020 2020 2020 2020  ']")..          
+00002a60: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+00002a70: 6e63 6528 666f 6361 6c4c 656e 6774 6858  nce(focalLengthX
+00002a80: 592c 6c69 7374 293a 2023 2078 2061 6e64  Y,list): # x and
+00002a90: 2079 2076 616c 7565 2061 7265 2069 6465   y value are ide
+00002aa0: 6e74 6963 616c 0a20 2020 2020 2020 2020  ntical.         
+00002ab0: 2020 2020 2020 2066 6f63 616c 4c65 6e67         focalLeng
+00002ac0: 7468 5859 203d 205b 666f 6361 6c4c 656e  thXY = [focalLen
+00002ad0: 6774 6858 592c 666f 6361 6c4c 656e 6774  gthXY,focalLengt
+00002ae0: 6858 595d 0a20 2020 2020 2020 2020 2020  hXY].           
+00002af0: 2069 6620 6c65 6e28 666f 6361 6c4c 656e   if len(focalLen
+00002b00: 6774 6858 5929 2021 3d20 323a 0a20 2020  gthXY) != 2:.   
+00002b10: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+00002b20: 7365 206d 6971 7463 2e49 6664 6f45 7863  se miqtc.IfdoExc
+00002b30: 6570 7469 6f6e 2869 7465 6d2c 2249 6e76  eption(item,"Inv
+00002b40: 616c 6964 2065 6e74 7279 2066 6f72 2027  alid entry for '
+00002b50: 696d 6167 652d 6361 6d65 7261 2d63 616c  image-camera-cal
+00002b60: 6962 7261 7469 6f6e 2d6d 6f64 656c 275b  ibration-model'[
+00002b70: 2763 616c 6962 7261 7469 6f6e 2d66 6f63  'calibration-foc
+00002b80: 616c 2d6c 656e 6774 682d 7879 2d70 6978  al-length-xy-pix
+00002b90: 656c 275d 203a 2022 202b 2073 7472 2866  el'] : " + str(f
+00002ba0: 6f63 616c 4c65 6e67 7468 5859 2920 290a  ocalLengthXY) ).
+00002bb0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00002bc0: 6e6f 7420 6973 696e 7374 616e 6365 2866  not isinstance(f
+00002bd0: 6f63 616c 4c65 6e67 7468 5859 5b30 5d2c  ocalLengthXY[0],
+00002be0: 666c 6f61 7429 206f 7220 6e6f 7420 6973  float) or not is
+00002bf0: 696e 7374 616e 6365 2866 6f63 616c 4c65  instance(focalLe
+00002c00: 6e67 7468 5859 5b30 5d2c 696e 7429 206f  ngthXY[0],int) o
+00002c10: 7220 6e6f 7420 6973 696e 7374 616e 6365  r not isinstance
+00002c20: 2866 6f63 616c 4c65 6e67 7468 5859 5b31  (focalLengthXY[1
+00002c30: 5d2c 666c 6f61 7429 206f 7220 6e6f 7420  ],float) or not 
+00002c40: 6973 696e 7374 616e 6365 2866 6f63 616c  isinstance(focal
+00002c50: 4c65 6e67 7468 5859 5b31 5d2c 696e 7429  LengthXY[1],int)
+00002c60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00002c70: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00002c80: 2020 2020 2020 2020 2020 2066 6f63 616c             focal
+00002c90: 4c65 6e67 7468 5859 203d 205b 666c 6f61  LengthXY = [floa
+00002ca0: 7428 666f 6361 6c4c 656e 6774 6858 595b  t(focalLengthXY[
+00002cb0: 305d 292c 666c 6f61 7428 666f 6361 6c4c  0]),float(focalL
+00002cc0: 656e 6774 6858 595b 315d 295d 0a20 2020  engthXY[1])].   
+00002cd0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+00002ce0: 6570 7420 5661 6c75 6545 7272 6f72 3a0a  ept ValueError:.
+00002cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002d00: 2020 2020 7261 6973 6520 6d69 7174 632e      raise miqtc.
+00002d10: 4966 646f 4578 6365 7074 696f 6e28 6974  IfdoException(it
+00002d20: 656d 2c22 496e 7661 6c69 6420 656e 7472  em,"Invalid entr
+00002d30: 7920 666f 7220 2769 6d61 6765 2d63 616d  y for 'image-cam
+00002d40: 6572 612d 6361 6c69 6272 6174 696f 6e2d  era-calibration-
+00002d50: 6d6f 6465 6c27 5b27 6361 6c69 6272 6174  model'['calibrat
+00002d60: 696f 6e2d 666f 6361 6c2d 6c65 6e67 7468  ion-focal-length
+00002d70: 2d78 792d 7069 7865 6c27 5d20 3a20 2220  -xy-pixel'] : " 
+00002d80: 2b20 7374 7228 666f 6361 6c4c 656e 6774  + str(focalLengt
+00002d90: 6858 5929 2029 0a20 2020 2020 2020 2020  hXY) ).         
+00002da0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+00002db0: 7265 7475 726e 2066 6f63 616c 4c65 6e67  return focalLeng
+00002dc0: 7468 5859 2c20 2250 6172 7365 6420 6672  thXY, "Parsed fr
+00002dd0: 6f6d 2027 696d 6167 652d 6361 6d65 7261  om 'image-camera
+00002de0: 2d63 616c 6962 7261 7469 6f6e 2d6d 6f64  -calibration-mod
+00002df0: 656c 275b 2763 616c 6962 7261 7469 6f6e  el'['calibration
+00002e00: 2d66 6f63 616c 2d6c 656e 6774 682d 7879  -focal-length-xy
+00002e10: 2d70 6978 656c 275d 220a 2020 2020 2020  -pixel']".      
+00002e20: 2020 6578 6365 7074 206d 6971 7463 2e49    except miqtc.I
+00002e30: 6664 6f45 7863 6570 7469 6f6e 3a0a 2020  fdoException:.  
+00002e40: 2020 2020 2020 2020 2020 7061 7373 0a0a            pass..
+00002e50: 2020 2020 2020 2020 756e 6465 7277 6174          underwat
+00002e60: 6572 496d 6167 6520 3d20 5472 7565 0a20  erImage = True. 
+00002e70: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00002e80: 2020 2020 2020 2020 616c 7430 203d 2073          alt0 = s
+00002e90: 656c 665b 6974 656d 2b27 303a 696d 6167  elf[item+'0:imag
+00002ea0: 652d 616c 7469 7475 6465 2d6d 6574 6572  e-altitude-meter
+00002eb0: 7327 5d20 2373 656c 662e 5f5f 6765 7449  s'] #self.__getI
+00002ec0: 7465 6d44 6566 6175 6c74 5661 6c75 6528  temDefaultValue(
+00002ed0: 6974 656d 2c20 2769 6d61 6765 2d61 6c74  item, 'image-alt
+00002ee0: 6974 7564 652d 6d65 7465 7273 2729 0a20  itude-meters'). 
+00002ef0: 2020 2020 2020 2020 2020 2069 6620 616c             if al
+00002f00: 7430 203e 2030 3a0a 2020 2020 2020 2020  t0 > 0:.        
+00002f10: 2020 2020 2020 2020 756e 6465 7277 6174          underwat
+00002f20: 6572 496d 6167 6520 3d20 4661 6c73 650a  erImage = False.
+00002f30: 2020 2020 2020 2020 6578 6365 7074 206d          except m
+00002f40: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
+00002f50: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
+00002f60: 7061 7373 0a0a 2020 2020 2020 2020 2320  pass..        # 
+00002f70: 6164 6420 636f 7272 6563 7469 6f6e 2066  add correction f
+00002f80: 6163 746f 7220 666f 7220 666c 6174 2070  actor for flat p
+00002f90: 6f72 740a 2020 2020 2020 2020 6966 2064  ort.        if d
+00002fa0: 6f6d 6550 6f72 7420 6973 204e 6f6e 6520  omePort is None 
+00002fb0: 616e 6420 756e 6465 7277 6174 6572 496d  and underwaterIm
+00002fc0: 6167 653a 0a20 2020 2020 2020 2020 2020  age:.           
+00002fd0: 2072 6574 7572 6e20 5b2d 312c 2d31 5d2c   return [-1,-1],
+00002fe0: 2022 436f 756c 6420 6e6f 7420 6465 7465   "Could not dete
+00002ff0: 726d 696e 6520 666f 6361 6c20 6c65 6e67  rmine focal leng
+00003000: 7468 2066 726f 6d20 2769 6d61 6765 2d63  th from 'image-c
+00003010: 616d 6572 612d 6361 6c69 6272 6174 696f  amera-calibratio
+00003020: 6e2d 6d6f 6465 6c27 5b27 6361 6c69 6272  n-model'['calibr
+00003030: 6174 696f 6e2d 666f 6361 6c2d 6c65 6e67  ation-focal-leng
+00003040: 7468 2d78 792d 7069 7865 6c27 5d20 616e  th-xy-pixel'] an
+00003050: 6420 706f 7274 2074 7970 652c 2077 6869  d port type, whi
+00003060: 6368 2069 7320 7265 7175 6972 6564 2066  ch is required f
+00003070: 6f72 2063 6f72 7265 6374 2065 7661 6c75  or correct evalu
+00003080: 6174 696f 6e20 6f66 2065 7869 6620 7661  ation of exif va
+00003090: 6c75 6573 2c20 6973 206e 6f74 2070 726f  lues, is not pro
+000030a0: 7669 6465 6421 220a 2020 2020 2020 2020  vided!".        
+000030b0: 636f 7272 6563 7469 6f6e 466b 7420 3d20  correctionFkt = 
+000030c0: 312e 300a 2020 2020 2020 2020 6966 2064  1.0.        if d
+000030d0: 6f6d 6550 6f72 7420 3d3d 2046 616c 7365  omePort == False
+000030e0: 2061 6e64 2075 6e64 6572 7761 7465 7249   and underwaterI
+000030f0: 6d61 6765 3a0a 2020 2020 2020 2020 2020  mage:.          
+00003100: 2020 636f 7272 6563 7469 6f6e 466b 7420    correctionFkt 
+00003110: 3d20 312e 3333 0a0a 2020 2020 2020 2020  = 1.33..        
+00003120: 2320 6f74 6865 7277 6973 6520 7472 7920  # otherwise try 
+00003130: 6465 7269 7665 2066 726f 6d20 6578 6966  derive from exif
+00003140: 2074 6167 730a 2020 2020 2020 2020 6578   tags.        ex
+00003150: 6966 203d 2073 656c 662e 5f5f 6765 7449  if = self.__getI
+00003160: 7465 6d44 6566 6175 6c74 5661 6c75 6528  temDefaultValue(
+00003170: 6974 656d 2c27 696d 6167 652d 6163 7175  item,'image-acqu
+00003180: 6973 6974 696f 6e2d 7365 7474 696e 6773  isition-settings
+00003190: 2729 0a20 2020 2020 2020 2023 2320 6672  ').        ## fr
+000031a0: 6f6d 2046 6f63 616c 204c 656e 6774 682c  om Focal Length,
+000031b0: 2046 6f63 616c 2050 6c61 6e65 2058 2052   Focal Plane X R
+000031c0: 6573 6f6c 7574 696f 6e2c 2046 6f63 616c  esolution, Focal
+000031d0: 2050 6c61 6e65 2059 2052 6573 6f6c 7574   Plane Y Resolut
+000031e0: 696f 6e2c 2046 6f63 616c 2050 6c61 6e65  ion, Focal Plane
+000031f0: 2052 6573 6f6c 7574 696f 6e20 556e 6974   Resolution Unit
+00003200: 0a20 2020 2020 2020 2066 6f63 616c 4c65  .        focalLe
+00003210: 6e67 7468 5859 2c20 6d73 6720 3d20 7365  ngthXY, msg = se
+00003220: 6c66 2e5f 5f74 7279 4465 7465 726d 696e  lf.__tryDetermin
+00003230: 6546 6f63 616c 4c65 6e67 6874 496e 5069  eFocalLenghtInPi
+00003240: 7865 6c73 4672 6f6d 4578 6966 5f31 2865  xelsFromExif_1(e
+00003250: 7869 6629 0a20 2020 2020 2020 2069 6620  xif).        if 
+00003260: 666f 6361 6c4c 656e 6774 6858 5920 213d  focalLengthXY !=
+00003270: 205b 2d31 2c2d 315d 3a0a 2020 2020 2020   [-1,-1]:.      
+00003280: 2020 2020 2020 7265 7475 726e 205b 652a        return [e*
+00003290: 636f 7272 6563 7469 6f6e 466b 7420 666f  correctionFkt fo
+000032a0: 7220 6520 696e 2066 6f63 616c 4c65 6e67  r e in focalLeng
+000032b0: 7468 5859 5d2c 2027 4465 7269 7665 6420  thXY], 'Derived 
+000032c0: 6672 6f6d 2065 7869 6620 7461 6773 2046  from exif tags F
+000032d0: 6f63 616c 204c 656e 6774 682c 2046 6f63  ocal Length, Foc
+000032e0: 616c 2050 6c61 6e65 2058 2052 6573 6f6c  al Plane X Resol
+000032f0: 7574 696f 6e2c 2046 6f63 616c 2050 6c61  ution, Focal Pla
+00003300: 6e65 2059 2052 6573 6f6c 7574 696f 6e2c  ne Y Resolution,
+00003310: 2046 6f63 616c 2050 6c61 6e65 2052 6573   Focal Plane Res
+00003320: 6f6c 7574 696f 6e20 556e 6974 270a 2020  olution Unit'.  
+00003330: 2020 2020 2020 2323 2066 726f 6d20 6672        ## from fr
+00003340: 6f6d 2033 3520 6d6d 2065 7175 6976 616c  om 35 mm equival
+00003350: 656e 7420 666f 6361 6c20 6c65 6e67 7468  ent focal length
+00003360: 0a20 2020 2020 2020 2066 6f63 616c 4c65  .        focalLe
+00003370: 6e67 7468 5859 2c20 6d73 6720 3d20 7365  ngthXY, msg = se
+00003380: 6c66 2e5f 5f74 7279 4465 7465 726d 696e  lf.__tryDetermin
+00003390: 6546 6f63 616c 4c65 6e67 6874 496e 5069  eFocalLenghtInPi
+000033a0: 7865 6c73 4672 6f6d 4578 6966 5f32 2865  xelsFromExif_2(e
+000033b0: 7869 6629 0a20 2020 2020 2020 2069 6620  xif).        if 
+000033c0: 666f 6361 6c4c 656e 6774 6858 5920 213d  focalLengthXY !=
+000033d0: 205b 2d31 2c2d 315d 3a0a 2020 2020 2020   [-1,-1]:.      
+000033e0: 2020 2020 2020 7265 7475 726e 205b 652a        return [e*
+000033f0: 636f 7272 6563 7469 6f6e 466b 7420 666f  correctionFkt fo
+00003400: 7220 6520 696e 2066 6f63 616c 4c65 6e67  r e in focalLeng
+00003410: 7468 5859 5d2c 2027 4465 7269 7665 6420  thXY], 'Derived 
+00003420: 6672 6f6d 2065 7869 6620 7461 6720 466f  from exif tag Fo
+00003430: 6361 6c20 4c65 6e67 7468 2077 6974 6820  cal Length with 
+00003440: 3335 206d 6d20 6571 7569 7661 6c65 6e74  35 mm equivalent
+00003450: 270a 200a 2020 2020 2020 2020 7265 7475  '. .        retu
+00003460: 726e 205b 2d31 2c2d 315d 2c20 2243 6f75  rn [-1,-1], "Cou
+00003470: 6c64 206e 6f74 2064 6574 6572 6d69 6e65  ld not determine
+00003480: 2066 726f 6d20 666f 6361 6c20 6c65 6e67   from focal leng
+00003490: 7468 2069 6e20 7069 7865 6c73 2066 726f  th in pixels fro
+000034a0: 6d20 6e65 6974 6865 7220 2769 6d61 6765  m neither 'image
+000034b0: 2d63 616d 6572 612d 6361 6c69 6272 6174  -camera-calibrat
+000034c0: 696f 6e2d 6d6f 6465 6c27 5b27 6361 6c69  ion-model'['cali
+000034d0: 6272 6174 696f 6e2d 666f 6361 6c2d 6c65  bration-focal-le
+000034e0: 6e67 7468 2d78 792d 7069 7865 6c27 5d20  ngth-xy-pixel'] 
+000034f0: 6e6f 7220 6578 6966 2074 6167 7320 466f  nor exif tags Fo
+00003500: 6361 6c20 4c65 6e67 7468 2c20 466f 6361  cal Length, Foca
+00003510: 6c20 506c 616e 6520 5820 5265 736f 6c75  l Plane X Resolu
+00003520: 7469 6f6e 2c20 466f 6361 6c20 506c 616e  tion, Focal Plan
+00003530: 6520 5920 5265 736f 6c75 7469 6f6e 2c20  e Y Resolution, 
+00003540: 466f 6361 6c20 506c 616e 6520 5265 736f  Focal Plane Reso
+00003550: 6c75 7469 6f6e 2055 6e69 7422 0a0a 0a20  lution Unit"... 
+00003560: 2020 2064 6566 205f 5f74 7279 4465 7465     def __tryDete
+00003570: 726d 696e 6546 6f63 616c 4c65 6e67 6874  rmineFocalLenght
+00003580: 496e 5069 7865 6c73 4672 6f6d 4578 6966  InPixelsFromExif
+00003590: 5f31 2873 656c 662c 6578 6966 4469 6374  _1(self,exifDict
+000035a0: 3a64 6963 7429 3a0a 2020 2020 2020 2020  :dict):.        
+000035b0: 2222 2220 7472 7920 746f 2064 6574 6572  """ try to deter
+000035c0: 6d69 6e65 2066 6f63 616c 206c 656e 6774  mine focal lengt
+000035d0: 6820 696e 2070 6978 656c 7320 6672 6f6d  h in pixels from
+000035e0: 2065 7869 6620 7461 6773 2046 6f63 616c   exif tags Focal
+000035f0: 204c 656e 6774 682c 2046 6f63 616c 2050   Length, Focal P
+00003600: 6c61 6e65 2058 2052 6573 6f6c 7574 696f  lane X Resolutio
+00003610: 6e2c 2046 6f63 616c 2050 6c61 6e65 2059  n, Focal Plane Y
+00003620: 2052 6573 6f6c 7574 696f 6e2c 2046 6f63   Resolution, Foc
+00003630: 616c 2050 6c61 6e65 2052 6573 6f6c 7574  al Plane Resolut
+00003640: 696f 6e20 556e 6974 2e0a 2020 2020 2020  ion Unit..      
+00003650: 2020 2020 2020 5265 7472 756e 7320 5b66        Retruns [f
+00003660: 6f63 616c 4c65 6e67 7468 5069 7865 6c73  ocalLengthPixels
+00003670: 5f78 2c66 6f63 616c 4c65 6e67 7468 5069  _x,focalLengthPi
+00003680: 7865 6c73 5f79 5d2c 206d 6573 7361 6765  xels_y], message
+00003690: 0a20 2020 2020 2020 2020 2020 2052 6574  .            Ret
+000036a0: 7275 6e73 2066 6f63 616c 4c65 6e67 7468  runs focalLength
+000036b0: 5069 7865 6c73 203d 202d 3120 6966 206e  Pixels = -1 if n
+000036c0: 6f74 2073 7563 6365 7373 6675 6c6c 2022  ot successfull "
+000036d0: 2222 0a0a 2020 2020 2020 2020 7472 793a  ""..        try:
+000036e0: 0a20 2020 2020 2020 2020 2020 2066 6f63  .            foc
+000036f0: 616c 4c65 6e67 7468 203d 2073 7472 2865  alLength = str(e
+00003700: 7869 6644 6963 745b 2746 6f63 616c 204c  xifDict['Focal L
+00003710: 656e 6774 6827 5d29 0a20 2020 2020 2020  ength']).       
+00003720: 2020 2020 2066 6f63 616c 506c 616e 6552       focalPlaneR
+00003730: 6573 5f78 203d 2066 6c6f 6174 2873 7472  es_x = float(str
+00003740: 2865 7869 6644 6963 745b 2746 6f63 616c  (exifDict['Focal
+00003750: 2050 6c61 6e65 2058 2052 6573 6f6c 7574   Plane X Resolut
+00003760: 696f 6e27 5d29 2e73 7472 6970 2827 5c27  ion']).strip('\'
+00003770: 2729 290a 2020 2020 2020 2020 2020 2020  ')).            
+00003780: 666f 6361 6c50 6c61 6e65 5265 735f 7920  focalPlaneRes_y 
+00003790: 3d20 666c 6f61 7428 7374 7228 6578 6966  = float(str(exif
+000037a0: 4469 6374 5b27 466f 6361 6c20 506c 616e  Dict['Focal Plan
+000037b0: 6520 5920 5265 736f 6c75 7469 6f6e 275d  e Y Resolution']
+000037c0: 292e 7374 7269 7028 275c 2727 2929 0a20  ).strip('\'')). 
+000037d0: 2020 2020 2020 2020 2020 2066 6f63 616c             focal
+000037e0: 506c 616e 6552 6573 5f75 6e69 7420 3d20  PlaneRes_unit = 
+000037f0: 7374 7228 6578 6966 4469 6374 5b27 466f  str(exifDict['Fo
+00003800: 6361 6c20 506c 616e 6520 5265 736f 6c75  cal Plane Resolu
+00003810: 7469 6f6e 2055 6e69 7427 5d29 2e73 7472  tion Unit']).str
+00003820: 6970 2827 5c27 2729 0a20 2020 2020 2020  ip('\'').       
+00003830: 2065 7863 6570 7420 284b 6579 4572 726f   except (KeyErro
+00003840: 722c 2056 616c 7565 4572 726f 7229 3a0a  r, ValueError):.
+00003850: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00003860: 726e 205b 2d31 2c2d 315d 2c20 2243 6f75  rn [-1,-1], "Cou
+00003870: 6c64 206e 6f74 2066 696e 6420 616c 6c20  ld not find all 
+00003880: 7265 7175 6972 6564 2066 6965 6c64 7320  required fields 
+00003890: 466f 6361 6c20 4c65 6e67 7468 2c20 466f  Focal Length, Fo
+000038a0: 6361 6c20 506c 616e 6520 5820 5265 736f  cal Plane X Reso
+000038b0: 6c75 7469 6f6e 2c20 466f 6361 6c20 506c  lution, Focal Pl
+000038c0: 616e 6520 5920 5265 736f 6c75 7469 6f6e  ane Y Resolution
+000038d0: 2c20 466f 6361 6c20 506c 616e 6520 5265  , Focal Plane Re
+000038e0: 736f 6c75 7469 6f6e 2055 6e69 7422 0a20  solution Unit". 
+000038f0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00003900: 2320 7061 7273 6520 666f 6361 6c20 6c65  # parse focal le
+00003910: 6e67 7468 2066 726f 6d20 6c65 6674 2028  ngth from left (
+00003920: 6d61 7920 6265 2027 372e 3520 6d6d 2028  may be '7.5 mm (
+00003930: 2e2e 2e29 2729 0a20 2020 2020 2020 2066  ...)').        f
+00003940: 6f63 616c 4c65 6e67 7468 5374 7269 7070  ocalLengthStripp
+00003950: 6564 203d 2066 6f63 616c 4c65 6e67 7468  ed = focalLength
+00003960: 2e73 7472 6970 2829 0a20 2020 2020 2020  .strip().       
+00003970: 2066 6f63 616c 4c65 6e67 7468 466c 6f61   focalLengthFloa
+00003980: 7420 3d20 4e6f 6e65 0a20 2020 2020 2020  t = None.       
+00003990: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+000039a0: 6c65 6e28 666f 6361 6c4c 656e 6774 6853  len(focalLengthS
+000039b0: 7472 6970 7065 6429 293a 0a20 2020 2020  tripped)):.     
+000039c0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+000039d0: 2020 2020 2020 2020 2020 2020 666f 6361              foca
+000039e0: 6c4c 656e 6774 6846 6c6f 6174 203d 2066  lLengthFloat = f
+000039f0: 6c6f 6174 2866 6f63 616c 4c65 6e67 7468  loat(focalLength
+00003a00: 5374 7269 7070 6564 5b30 3a69 2b31 5d29  Stripped[0:i+1])
+00003a10: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+00003a20: 6570 7420 5661 6c75 6545 7272 6f72 3a0a  ept ValueError:.
+00003a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003a40: 7061 7373 0a20 2020 2020 2020 2069 6620  pass.        if 
+00003a50: 666f 6361 6c4c 656e 6774 6846 6c6f 6174  focalLengthFloat
+00003a60: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00003a70: 2020 2020 2020 7265 7475 726e 205b 2d31        return [-1
+00003a80: 2c2d 315d 2c20 2243 6f75 6c64 206e 6f74  ,-1], "Could not
+00003a90: 2070 6172 7365 2066 6f72 6361 6c20 6c65   parse forcal le
+00003aa0: 6e67 7468 2066 726f 6d20 2746 6f63 616c  ngth from 'Focal
+00003ab0: 204c 656e 6774 6827 3a20 2220 2b20 666f   Length': " + fo
+00003ac0: 6361 6c4c 656e 6774 680a 2020 2020 2020  calLength.      
+00003ad0: 2020 7363 616c 6546 6b74 5f66 6f63 616c    scaleFkt_focal
+00003ae0: 203d 2073 656c 662e 5f5f 756e 6974 436f   = self.__unitCo
+00003af0: 6e76 6572 7369 6f6e 4661 6374 326d 6d28  nversionFact2mm(
+00003b00: 666f 6361 6c4c 656e 6774 6829 0a20 2020  focalLength).   
+00003b10: 2020 2020 2069 6620 7363 616c 6546 6b74       if scaleFkt
+00003b20: 5f66 6f63 616c 203d 3d20 2d31 3a0a 2020  _focal == -1:.  
+00003b30: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00003b40: 205b 2d31 2c2d 315d 2c20 2243 6f75 6c64   [-1,-1], "Could
+00003b50: 206e 6f74 2070 6172 7365 2066 6f72 6361   not parse forca
+00003b60: 6c20 6c65 6e67 7468 2075 6e69 7420 6672  l length unit fr
+00003b70: 6f6d 2027 466f 6361 6c20 4c65 6e67 7468  om 'Focal Length
+00003b80: 273a 2022 202b 2066 6f63 616c 4c65 6e67  ': " + focalLeng
+00003b90: 7468 0a20 2020 2020 2020 2066 6f63 616c  th.        focal
+00003ba0: 4c65 6e67 7468 5f6d 6d20 3d20 666f 6361  Length_mm = foca
+00003bb0: 6c4c 656e 6774 6846 6c6f 6174 202a 2073  lLengthFloat * s
+00003bc0: 6361 6c65 466b 745f 666f 6361 6c0a 0a20  caleFkt_focal.. 
+00003bd0: 2020 2020 2020 2073 6361 6c65 466b 745f         scaleFkt_
+00003be0: 7265 7320 3d20 7365 6c66 2e5f 5f75 6e69  res = self.__uni
+00003bf0: 7443 6f6e 7665 7273 696f 6e46 6163 7432  tConversionFact2
+00003c00: 6d6d 2866 6f63 616c 506c 616e 6552 6573  mm(focalPlaneRes
+00003c10: 5f75 6e69 7429 0a20 2020 2020 2020 2069  _unit).        i
+00003c20: 6620 7363 616c 6546 6b74 5f72 6573 203d  f scaleFkt_res =
+00003c30: 3d20 2d31 3a0a 2020 2020 2020 2020 2020  = -1:.          
+00003c40: 2020 7265 7475 726e 205b 2d31 2c2d 315d    return [-1,-1]
+00003c50: 2c20 2243 6f75 6c64 206e 6f74 2070 6172  , "Could not par
+00003c60: 7365 2046 6f63 616c 2050 6c61 6e65 2052  se Focal Plane R
+00003c70: 6573 6f6c 7574 696f 6e20 556e 6974 2066  esolution Unit f
+00003c80: 726f 6d20 2746 6f63 616c 2050 6c61 6e65  rom 'Focal Plane
+00003c90: 2052 6573 6f6c 7574 696f 6e20 556e 6974   Resolution Unit
+00003ca0: 273a 2022 202b 2066 6f63 616c 506c 616e  ': " + focalPlan
+00003cb0: 6552 6573 5f75 6e69 740a 0a20 2020 2020  eRes_unit..     
+00003cc0: 2020 2066 6f63 616c 4c65 6e67 7468 5069     focalLengthPi
+00003cd0: 7865 6c73 5f78 203d 2066 6f63 616c 4c65  xels_x = focalLe
+00003ce0: 6e67 7468 5f6d 6d20 2a20 666f 6361 6c50  ngth_mm * focalP
+00003cf0: 6c61 6e65 5265 735f 7820 2f20 7363 616c  laneRes_x / scal
+00003d00: 6546 6b74 5f72 6573 0a20 2020 2020 2020  eFkt_res.       
+00003d10: 2066 6f63 616c 4c65 6e67 7468 5069 7865   focalLengthPixe
+00003d20: 6c73 5f79 203d 2066 6f63 616c 4c65 6e67  ls_y = focalLeng
+00003d30: 7468 5f6d 6d20 2a20 666f 6361 6c50 6c61  th_mm * focalPla
+00003d40: 6e65 5265 735f 7920 2f20 7363 616c 6546  neRes_y / scaleF
+00003d50: 6b74 5f72 6573 0a0a 2020 2020 2020 2020  kt_res..        
+00003d60: 7265 7475 726e 205b 666f 6361 6c4c 656e  return [focalLen
+00003d70: 6774 6850 6978 656c 735f 782c 666f 6361  gthPixels_x,foca
+00003d80: 6c4c 656e 6774 6850 6978 656c 735f 795d  lLengthPixels_y]
+00003d90: 2c20 2222 0a0a 0a20 2020 2064 6566 205f  , ""...    def _
+00003da0: 5f74 7279 4465 7465 726d 696e 6546 6f63  _tryDetermineFoc
+00003db0: 616c 4c65 6e67 6874 496e 5069 7865 6c73  alLenghtInPixels
+00003dc0: 4672 6f6d 4578 6966 5f32 2873 656c 662c  FromExif_2(self,
+00003dd0: 6578 6966 4469 6374 3a64 6963 7429 3a0a  exifDict:dict):.
+00003de0: 2020 2020 2020 2020 2222 2220 7472 7920          """ try 
+00003df0: 746f 2064 6574 6572 6d69 6e65 2066 6f63  to determine foc
+00003e00: 616c 206c 656e 6774 6820 696e 2070 6978  al length in pix
+00003e10: 656c 7320 6672 6f6d 2033 3520 6d6d 2065  els from 35 mm e
+00003e20: 7175 6976 616c 656e 7420 666f 6361 6c20  quivalent focal 
+00003e30: 6c65 6e67 7468 2069 6e20 6578 6966 2074  length in exif t
+00003e40: 6167 2046 6f63 616c 204c 656e 6774 6827  ag Focal Length'
+00003e50: 7320 6164 6420 6f6e 2065 2e67 2e20 2737  s add on e.g. '7
+00003e60: 2e30 206d 6d20 2833 3520 6d6d 2065 7175  .0 mm (35 mm equ
+00003e70: 6976 616c 656e 743a 2033 382e 3820 6d6d  ivalent: 38.8 mm
+00003e80: 2927 2e0a 2020 2020 2020 2020 2020 2020  )'..            
+00003e90: 5265 7472 756e 7320 5b66 6f63 616c 4c65  Retruns [focalLe
+00003ea0: 6e67 7468 5069 7865 6c73 5f78 2c66 6f63  ngthPixels_x,foc
+00003eb0: 616c 4c65 6e67 7468 5069 7865 6c73 5f79  alLengthPixels_y
+00003ec0: 5d2c 206d 6573 7361 6765 0a20 2020 2020  ], message.     
+00003ed0: 2020 2020 2020 2052 6574 7275 6e73 2066         Retruns f
+00003ee0: 6f63 616c 4c65 6e67 7468 5069 7865 6c73  ocalLengthPixels
+00003ef0: 203d 202d 3120 6966 206e 6f74 2073 7563   = -1 if not suc
+00003f00: 6365 7373 6675 6c6c 2022 2222 0a0a 2020  cessfull """..  
+00003f10: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00003f20: 2020 2020 2020 2066 6f63 616c 4c65 6e67         focalLeng
+00003f30: 7468 203d 2073 7472 2865 7869 6644 6963  th = str(exifDic
+00003f40: 745b 2746 6f63 616c 204c 656e 6774 6827  t['Focal Length'
+00003f50: 5d29 0a20 2020 2020 2020 2020 2020 2069  ]).            i
+00003f60: 6d61 6765 5769 6474 6820 3d20 696e 7428  mageWidth = int(
+00003f70: 7374 7228 6578 6966 4469 6374 5b27 496d  str(exifDict['Im
+00003f80: 6167 6520 5769 6474 6827 5d29 2e73 7472  age Width']).str
+00003f90: 6970 2827 5c27 2729 290a 2020 2020 2020  ip('\'')).      
+00003fa0: 2020 6578 6365 7074 2028 4b65 7945 7272    except (KeyErr
+00003fb0: 6f72 2c20 5661 6c75 6545 7272 6f72 293a  or, ValueError):
+00003fc0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00003fd0: 7572 6e20 5b2d 312c 2d31 5d2c 2022 436f  urn [-1,-1], "Co
+00003fe0: 756c 6420 6e6f 7420 6669 6e64 2061 6c6c  uld not find all
+00003ff0: 2072 6571 7569 7265 6420 6669 656c 6473   required fields
+00004000: 2046 6f63 616c 204c 656e 6774 682c 2049   Focal Length, I
+00004010: 6d61 6765 2057 6964 7468 220a 0a20 2020  mage Width"..   
+00004020: 2020 2020 2023 2074 7279 2070 6172 7365       # try parse
+00004030: 2033 3520 6d6d 2065 7175 6976 616c 656e   35 mm equivalen
+00004040: 7420 6672 6f6d 2065 2e67 2e3a 2020 372e  t from e.g.:  7.
+00004050: 3020 6d6d 2028 3335 206d 6d20 6571 7569  0 mm (35 mm equi
+00004060: 7661 6c65 6e74 3a20 3338 2e38 206d 6d29  valent: 38.8 mm)
+00004070: 0a20 2020 2020 2020 2063 6f6c 6f6e 496e  .        colonIn
+00004080: 6465 7820 3d20 666f 6361 6c4c 656e 6774  dex = focalLengt
+00004090: 682e 6669 6e64 2827 3a27 290a 2020 2020  h.find(':').    
+000040a0: 2020 2020 6966 2063 6f6c 6f6e 496e 6465      if colonInde
+000040b0: 7820 3d3d 202d 313a 0a20 2020 2020 2020  x == -1:.       
+000040c0: 2020 2020 2072 6574 7572 6e20 5b2d 312c       return [-1,
+000040d0: 2d31 5d2c 2022 436f 756c 6420 6e6f 7420  -1], "Could not 
+000040e0: 7061 7273 6520 3335 206d 6d20 6571 7569  parse 35 mm equi
+000040f0: 7661 6c65 6e74 2066 6f63 616c 206c 656e  valent focal len
+00004100: 6774 6820 6672 6f6d 2027 466f 6361 6c20  gth from 'Focal 
+00004110: 4c65 6e67 7468 273a 2022 202b 2066 6f63  Length': " + foc
+00004120: 616c 4c65 6e67 7468 0a20 2020 2020 2020  alLength.       
+00004130: 2066 6f63 616c 4c65 6e67 7468 4571 3335   focalLengthEq35
+00004140: 6d6d 466c 6f61 7420 3d20 4e6f 6e65 0a20  mmFloat = None. 
+00004150: 2020 2020 2020 2065 7175 616c 3335 6d6d         equal35mm
+00004160: 5061 7274 203d 2066 6f63 616c 4c65 6e67  Part = focalLeng
+00004170: 7468 5b63 6f6c 6f6e 496e 6465 782b 313a  th[colonIndex+1:
+00004180: 3a5d 2e73 7472 6970 2829 0a20 2020 2020  :].strip().     
+00004190: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+000041a0: 6528 6c65 6e28 6571 7561 6c33 356d 6d50  e(len(equal35mmP
+000041b0: 6172 7429 293a 0a20 2020 2020 2020 2020  art)):.         
+000041c0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+000041d0: 2020 2020 2020 2020 666f 6361 6c4c 656e          focalLen
+000041e0: 6774 6845 7133 356d 6d46 6c6f 6174 203d  gthEq35mmFloat =
+000041f0: 2066 6c6f 6174 2865 7175 616c 3335 6d6d   float(equal35mm
+00004200: 5061 7274 5b30 3a69 2b31 5d29 0a20 2020  Part[0:i+1]).   
+00004210: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00004220: 5661 6c75 6545 7272 6f72 3a0a 2020 2020  ValueError:.    
+00004230: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+00004240: 0a20 2020 2020 2020 2073 6361 6c65 466b  .        scaleFk
+00004250: 7420 3d20 7365 6c66 2e5f 5f75 6e69 7443  t = self.__unitC
+00004260: 6f6e 7665 7273 696f 6e46 6163 7432 6d6d  onversionFact2mm
+00004270: 2866 6f63 616c 4c65 6e67 7468 5b63 6f6c  (focalLength[col
+00004280: 6f6e 496e 6465 782b 313a 3a5d 290a 2020  onIndex+1::]).  
+00004290: 2020 2020 2020 6966 2066 6f63 616c 4c65        if focalLe
+000042a0: 6e67 7468 4571 3335 6d6d 466c 6f61 7420  ngthEq35mmFloat 
+000042b0: 6973 204e 6f6e 6520 6f72 2073 6361 6c65  is None or scale
+000042c0: 466b 7420 3d3d 202d 313a 0a20 2020 2020  Fkt == -1:.     
+000042d0: 2020 2020 2020 2072 6574 7572 6e20 5b2d         return [-
+000042e0: 312c 2d31 5d2c 2022 436f 756c 6420 6e6f  1,-1], "Could no
+000042f0: 7420 7061 7273 6520 3335 206d 6d20 6571  t parse 35 mm eq
+00004300: 7569 7661 6c65 6e74 2066 6f63 616c 206c  uivalent focal l
+00004310: 656e 6774 6820 6672 6f6d 2027 466f 6361  ength from 'Foca
+00004320: 6c20 4c65 6e67 7468 273a 2022 202b 2066  l Length': " + f
+00004330: 6f63 616c 4c65 6e67 7468 0a20 2020 2020  ocalLength.     
+00004340: 2020 200a 2020 2020 2020 2020 666f 6361     .        foca
+00004350: 6c4c 656e 6774 6850 6978 656c 7320 3d20  lLengthPixels = 
+00004360: 666f 6361 6c4c 656e 6774 6845 7133 356d  focalLengthEq35m
+00004370: 6d46 6c6f 6174 202a 2073 6361 6c65 466b  mFloat * scaleFk
+00004380: 7420 2a20 696d 6167 6557 6964 7468 202f  t * imageWidth /
+00004390: 2033 362e 300a 2020 2020 2020 2020 7265   36.0.        re
+000043a0: 7475 726e 205b 666f 6361 6c4c 656e 6774  turn [focalLengt
+000043b0: 6850 6978 656c 732c 666f 6361 6c4c 656e  hPixels,focalLen
+000043c0: 6774 6850 6978 656c 735d 2c20 2222 0a0a  gthPixels], ""..
+000043d0: 0a20 2020 2064 6566 205f 5f75 6e69 7443  .    def __unitC
+000043e0: 6f6e 7665 7273 696f 6e46 6163 7432 6d6d  onversionFact2mm
+000043f0: 2873 656c 662c 756e 6974 3a73 7472 293a  (self,unit:str):
+00004400: 0a20 2020 2020 2020 2022 2222 206c 6f6f  .        """ loo
+00004410: 6b73 2066 6f72 206c 6574 7465 7220 7365  ks for letter se
+00004420: 7175 656e 6365 2069 6e20 756e 6974 2061  quence in unit a
+00004430: 6e64 2063 6865 636b 7320 6966 2069 7427  nd checks if it'
+00004440: 7320 2769 6e63 6865 7327 2c27 6d27 2c27  s 'inches','m','
+00004450: 636d 272c 276d 6d27 2c27 756d 2720 6f72  cm','mm','um' or
+00004460: 2027 2720 616e 6420 7265 7475 726e 7320   '' and returns 
+00004470: 7265 7370 6563 7469 7665 2063 6f6e 7665  respective conve
+00004480: 7273 696f 6e20 6661 6374 6f72 2074 6f20  rsion factor to 
+00004490: 6d6d 2028 6966 2074 6865 7265 2061 7265  mm (if there are
+000044a0: 206e 6f20 6c65 7474 6572 7320 6974 2072   no letters it r
+000044b0: 6574 7572 6e73 2031 292e 204f 7468 6572  eturns 1). Other
+000044c0: 7769 7365 2072 6574 7572 6e20 2d31 2022  wise return -1 "
+000044d0: 2222 0a0a 2020 2020 2020 2020 6669 7273  ""..        firs
+000044e0: 744c 6574 7465 7253 6571 203d 2022 220a  tLetterSeq = "".
+000044f0: 2020 2020 2020 2020 6669 7273 7446 6f75          firstFou
+00004500: 6e64 203d 2046 616c 7365 0a20 2020 2020  nd = False.     
+00004510: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+00004520: 6528 6c65 6e28 756e 6974 2929 3a0a 2020  e(len(unit)):.  
+00004530: 2020 2020 2020 2020 2020 6966 2075 6e69            if uni
+00004540: 745b 695d 2e69 7361 6c70 6861 2829 3a0a  t[i].isalpha():.
+00004550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004560: 6669 7273 7446 6f75 6e64 203d 2054 7275  firstFound = Tru
+00004570: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00004580: 2020 6669 7273 744c 6574 7465 7253 6571    firstLetterSeq
+00004590: 202b 3d20 756e 6974 5b69 5d0a 2020 2020   += unit[i].    
+000045a0: 2020 2020 2020 2020 6966 206e 6f74 2075          if not u
+000045b0: 6e69 745b 695d 2e69 7361 6c70 6861 2829  nit[i].isalpha()
+000045c0: 2061 6e64 2066 6972 7374 466f 756e 6420   and firstFound 
+000045d0: 3d3d 2054 7275 653a 0a20 2020 2020 2020  == True:.       
+000045e0: 2020 2020 2020 2020 2062 7265 616b 0a0a           break..
+000045f0: 2020 2020 2020 2020 6966 2066 6972 7374          if first
+00004600: 4c65 7474 6572 5365 712e 6c6f 7765 7228  LetterSeq.lower(
+00004610: 2920 3d3d 2022 696e 6368 6573 223a 0a20  ) == "inches":. 
+00004620: 2020 2020 2020 2020 2020 2073 6361 6c65             scale
+00004630: 466b 7420 3d20 3235 2e34 0a20 2020 2020  Fkt = 25.4.     
+00004640: 2020 2065 6c69 6620 6669 7273 744c 6574     elif firstLet
+00004650: 7465 7253 6571 2e6c 6f77 6572 2829 203d  terSeq.lower() =
+00004660: 3d20 226d 223a 0a20 2020 2020 2020 2020  = "m":.         
+00004670: 2020 2073 6361 6c65 466b 7420 3d20 3130     scaleFkt = 10
+00004680: 3030 2e30 3b0a 2020 2020 2020 2020 656c  00.0;.        el
+00004690: 6966 2066 6972 7374 4c65 7474 6572 5365  if firstLetterSe
+000046a0: 712e 6c6f 7765 7228 2920 3d3d 2022 636d  q.lower() == "cm
+000046b0: 223a 0a20 2020 2020 2020 2020 2020 2073  ":.            s
+000046c0: 6361 6c65 466b 7420 3d20 3130 2e30 3b0a  caleFkt = 10.0;.
+000046d0: 2020 2020 2020 2020 656c 6966 2066 6972          elif fir
+000046e0: 7374 4c65 7474 6572 5365 712e 6c6f 7765  stLetterSeq.lowe
+000046f0: 7228 2920 3d3d 2022 6d6d 223a 0a20 2020  r() == "mm":.   
+00004700: 2020 2020 2020 2020 2073 6361 6c65 466b           scaleFk
+00004710: 7420 3d20 312e 303b 0a20 2020 2020 2020  t = 1.0;.       
+00004720: 2065 6c69 6620 6669 7273 744c 6574 7465   elif firstLette
+00004730: 7253 6571 2e6c 6f77 6572 2829 203d 3d20  rSeq.lower() == 
+00004740: 2275 6d22 3a0a 2020 2020 2020 2020 2020  "um":.          
+00004750: 2020 7363 616c 6546 6b74 203d 2031 2f31    scaleFkt = 1/1
+00004760: 3030 303b 0a20 2020 2020 2020 2065 6c69  000;.        eli
+00004770: 6620 6669 7273 744c 6574 7465 7253 6571  f firstLetterSeq
+00004780: 2e6c 6f77 6572 2829 203d 3d20 2222 3a0a  .lower() == "":.
+00004790: 2020 2020 2020 2020 2020 2020 7363 616c              scal
+000047a0: 6546 6b74 203d 2031 3b0a 2020 2020 2020  eFkt = 1;.      
+000047b0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000047c0: 2020 2020 7363 616c 6546 6b74 203d 202d      scaleFkt = -
+000047d0: 310a 0a20 2020 2020 2020 2072 6574 7572  1..        retur
+000047e0: 6e20 7363 616c 6546 6b74 0a0a 0a20 2020  n scaleFkt...   
+000047f0: 2064 6566 205f 5f67 6574 4974 656d 4465   def __getItemDe
+00004800: 6661 756c 7456 616c 7565 2873 656c 662c  faultValue(self,
+00004810: 6974 656d 3a73 7472 2c66 6965 6c64 4e61  item:str,fieldNa
+00004820: 6d65 3a73 7472 293a 0a20 2020 2020 2020  me:str):.       
+00004830: 2022 2222 2072 6574 7572 6e73 2069 7465   """ returns ite
+00004840: 6d20 7661 6c75 6573 2028 6669 7273 7420  m values (first 
+00004850: 656e 7472 7920 696e 2063 6173 6520 6f66  entry in case of
+00004860: 2076 6964 656f 7329 2e20 5468 726f 7773   videos). Throws
+00004870: 206d 6172 6971 742e 636f 7265 2e49 6664   mariqt.core.Ifd
+00004880: 6f45 7863 6570 7469 6f6e 2069 6620 6669  oException if fi
+00004890: 656c 6420 6e6f 7420 666f 756e 642e 2022  eld not found. "
+000048a0: 2222 0a0a 2020 2020 2020 2020 7265 7420  ""..        ret 
+000048b0: 3d20 7365 6c66 5b22 3a22 2e6a 6f69 6e28  = self[":".join(
+000048c0: 5b69 7465 6d2c 2730 272c 6669 656c 644e  [item,'0',fieldN
+000048d0: 616d 655d 295d 0a20 2020 2020 2020 2069  ame])].        i
+000048e0: 6620 7265 7420 3d3d 2022 223a 0a20 2020  f ret == "":.   
+000048f0: 2020 2020 2020 2020 7261 6973 6520 6d69          raise mi
+00004900: 7174 632e 4966 646f 4578 6365 7074 696f  qtc.IfdoExceptio
+00004910: 6e28 2245 7272 6f72 3a20 4669 656c 6420  n("Error: Field 
+00004920: 7b30 7d20 6e65 6974 6865 7220 666f 756e  {0} neither foun
+00004930: 6420 696e 2069 7465 6d20 7b31 7d20 6e6f  d in item {1} no
+00004940: 7220 6865 6164 6572 222e 666f 726d 6174  r header".format
+00004950: 2866 6965 6c64 4e61 6d65 2c69 7465 6d29  (fieldName,item)
+00004960: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00004970: 2072 6574 0a0a 0a20 2020 2064 6566 205f   ret...    def _
+00004980: 5f67 6574 4974 656d 4c61 744c 6f6e 2873  _getItemLatLon(s
+00004990: 656c 662c 6974 656d 3a73 7472 2c68 6561  elf,item:str,hea
+000049a0: 6465 7256 616c 4c61 742c 6865 6164 6572  derValLat,header
+000049b0: 5661 6c4c 6f6e 293a 0a20 2020 2020 2020  ValLon):.       
+000049c0: 2022 2222 2072 6574 7572 6e73 207b 276c   """ returns {'l
+000049d0: 6174 273a 2076 616c 7565 2c20 276c 6f6e  at': value, 'lon
+000049e0: 273a 2076 616c 7565 2c20 2764 6174 6574  ': value, 'datet
+000049f0: 696d 6527 3a20 7661 6c75 657d 206f 6620  ime': value} of 
+00004a00: 6c69 7374 206f 6620 7468 6f73 6520 2222  list of those ""
+00004a10: 220a 0a20 2020 2020 2020 2069 7465 6d56  "..        itemV
+00004a20: 616c 203d 2073 656c 662e 6966 646f 5b6d  al = self.ifdo[m
+00004a30: 6971 7476 2e69 6d61 6765 5f73 6574 5f69  iqtv.image_set_i
+00004a40: 7465 6d73 5f6b 6579 5d5b 6974 656d 5d0a  tems_key][item].
+00004a50: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+00004a60: 7369 6e73 7461 6e63 6528 6974 656d 5661  sinstance(itemVa
+00004a70: 6c2c 6c69 7374 293a 0a20 2020 2020 2020  l,list):.       
+00004a80: 2020 2020 2072 6574 203d 2073 656c 662e       ret = self.
+00004a90: 5f5f 7061 7273 6532 4c61 744c 6f6e 4469  __parse2LatLonDi
+00004aa0: 6374 2869 7465 6d56 616c 2c68 6561 6465  ct(itemVal,heade
+00004ab0: 7256 616c 4c61 742c 6865 6164 6572 5661  rValLat,headerVa
+00004ac0: 6c4c 6f6e 290a 2020 2020 2020 2020 656c  lLon).        el
+00004ad0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00004ae0: 7265 7420 3d20 5b5d 0a20 2020 2020 2020  ret = [].       
+00004af0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00004b00: 2020 2020 2020 2020 2020 6974 656d 4c61            itemLa
+00004b10: 7444 6566 6175 6c74 203d 2069 7465 6d56  tDefault = itemV
+00004b20: 616c 5b30 5d5b 2769 6d61 6765 2d6c 6174  al[0]['image-lat
+00004b30: 6974 7564 6527 5d0a 2020 2020 2020 2020  itude'].        
+00004b40: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
+00004b50: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
+00004b60: 2020 2020 2069 7465 6d4c 6174 4465 6661       itemLatDefa
+00004b70: 756c 7420 3d20 6865 6164 6572 5661 6c4c  ult = headerValL
+00004b80: 6174 0a20 2020 2020 2020 2020 2020 2020  at.             
+00004b90: 2020 2023 6966 2069 7465 6d4c 6174 4465     #if itemLatDe
+00004ba0: 6661 756c 7420 6973 204e 6f6e 653a 0a20  fault is None:. 
+00004bb0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00004bc0: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
+00004bd0: 696f 6e28 2245 7272 6f72 3a20 4669 656c  ion("Error: Fiel
+00004be0: 6420 7b30 7d20 6e65 6974 6865 7220 666f  d {0} neither fo
+00004bf0: 756e 6420 696e 2069 7465 6d20 7b31 7d20  und in item {1} 
+00004c00: 6e6f 7220 6865 6164 6572 222e 666f 726d  nor header".form
+00004c10: 6174 2827 696d 6167 652d 6c61 7469 7475  at('image-latitu
+00004c20: 6465 272c 6974 656d 2929 0a0a 2020 2020  de',item))..    
+00004c30: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00004c40: 2020 2020 2020 2020 2020 2020 2069 7465               ite
+00004c50: 6d4c 6f6e 4465 6661 756c 7420 3d20 6974  mLonDefault = it
+00004c60: 656d 5661 6c5b 305d 5b27 696d 6167 652d  emVal[0]['image-
+00004c70: 6c6f 6e67 6974 7564 6527 5d0a 2020 2020  longitude'].    
+00004c80: 2020 2020 2020 2020 6578 6365 7074 204b          except K
+00004c90: 6579 4572 726f 723a 0a20 2020 2020 2020  eyError:.       
+00004ca0: 2020 2020 2020 2020 2069 7465 6d4c 6f6e           itemLon
+00004cb0: 4465 6661 756c 7420 3d20 6865 6164 6572  Default = header
+00004cc0: 5661 6c4c 6f6e 0a20 2020 2020 2020 2020  ValLon.         
+00004cd0: 2020 2020 2020 2023 6966 2069 7465 6d4c         #if itemL
+00004ce0: 6f6e 4465 6661 756c 7420 6973 204e 6f6e  onDefault is Non
+00004cf0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00004d00: 2020 2023 2020 2020 7261 6973 6520 4578     #    raise Ex
+00004d10: 6365 7074 696f 6e28 2245 7272 6f72 3a20  ception("Error: 
+00004d20: 4669 656c 6420 7b30 7d20 6e65 6974 6865  Field {0} neithe
+00004d30: 7220 666f 756e 6420 696e 2069 7465 6d20  r found in item 
+00004d40: 7b31 7d20 6e6f 7220 6865 6164 6572 222e  {1} nor header".
+00004d50: 666f 726d 6174 2827 696d 6167 652d 6c61  format('image-la
+00004d60: 7469 7475 6465 272c 6974 656d 2929 0a0a  titude',item))..
+00004d70: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00004d80: 7375 6245 6e74 7279 2069 6e20 6974 656d  subEntry in item
+00004d90: 5661 6c3a 0a20 2020 2020 2020 2020 2020  Val:.           
+00004da0: 2020 2020 2072 6574 2e61 7070 656e 6428       ret.append(
+00004db0: 7365 6c66 2e5f 5f70 6172 7365 324c 6174  self.__parse2Lat
+00004dc0: 4c6f 6e44 6963 7428 7375 6245 6e74 7279  LonDict(subEntry
+00004dd0: 2c69 7465 6d4c 6174 4465 6661 756c 742c  ,itemLatDefault,
+00004de0: 6974 656d 4c6f 6e44 6566 6175 6c74 2929  itemLonDefault))
+00004df0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00004e00: 2072 6574 0a20 2020 2020 2020 2020 2020   ret.           
+00004e10: 200a 0a20 2020 2064 6566 205f 5f70 6172   ..    def __par
+00004e20: 7365 324c 6174 4c6f 6e44 6963 7428 7365  se2LatLonDict(se
+00004e30: 6c66 2c69 7465 6d56 616c 2c68 6561 6465  lf,itemVal,heade
+00004e40: 7256 616c 4c61 742c 6865 6164 6572 5661  rValLat,headerVa
+00004e50: 6c4c 6f6e 293a 0a20 2020 2020 2020 2022  lLon):.        "
+00004e60: 2222 2072 6574 7572 6e73 207b 276c 6174  "" returns {'lat
+00004e70: 273a 6c61 742c 276c 6f6e 273a 6c6f 6e2c  ':lat,'lon':lon,
+00004e80: 2764 6174 6574 696d 6527 3a64 6174 6574  'datetime':datet
+00004e90: 696d 657d 2022 2222 0a20 2020 2020 2020  ime} """.       
+00004ea0: 2064 6174 6574 696d 6520 3d20 6974 656d   datetime = item
+00004eb0: 5661 6c5b 2769 6d61 6765 2d64 6174 6574  Val['image-datet
+00004ec0: 696d 6527 5d0a 2020 2020 2020 2020 7472  ime'].        tr
+00004ed0: 793a 0a20 2020 2020 2020 2020 2020 206c  y:.            l
+00004ee0: 6174 203d 2069 7465 6d56 616c 5b27 696d  at = itemVal['im
+00004ef0: 6167 652d 6c61 7469 7475 6465 275d 0a20  age-latitude']. 
+00004f00: 2020 2020 2020 2065 7863 6570 7420 4b65         except Ke
+00004f10: 7945 7272 6f72 3a0a 2020 2020 2020 2020  yError:.        
+00004f20: 2020 2020 6c61 7420 3d20 6865 6164 6572      lat = header
+00004f30: 5661 6c4c 6174 0a20 2020 2020 2020 2020  ValLat.         
+00004f40: 2020 2069 6620 6c61 7420 6973 204e 6f6e     if lat is Non
+00004f50: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00004f60: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
+00004f70: 6f6e 2822 4572 726f 723a 2046 6965 6c64  on("Error: Field
+00004f80: 207b 307d 206e 6569 7468 6572 2066 6f75   {0} neither fou
+00004f90: 6e64 2069 6e20 6974 656d 207b 317d 206e  nd in item {1} n
+00004fa0: 6f72 2068 6561 6465 7222 2e66 6f72 6d61  or header".forma
+00004fb0: 7428 2769 6d61 6765 2d6c 6174 6974 7564  t('image-latitud
+00004fc0: 6527 2c69 7465 6d56 616c 2929 0a20 2020  e',itemVal)).   
+00004fd0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00004fe0: 2020 2020 2020 6c6f 6e20 3d20 6974 656d        lon = item
+00004ff0: 5661 6c5b 2769 6d61 6765 2d6c 6f6e 6769  Val['image-longi
+00005000: 7475 6465 275d 0a20 2020 2020 2020 2065  tude'].        e
+00005010: 7863 6570 7420 4b65 7945 7272 6f72 3a0a  xcept KeyError:.
+00005020: 2020 2020 2020 2020 2020 2020 6c6f 6e20              lon 
+00005030: 3d20 6865 6164 6572 5661 6c4c 6f6e 0a20  = headerValLon. 
+00005040: 2020 2020 2020 2020 2020 2069 6620 6c6f             if lo
+00005050: 6e20 6973 204e 6f6e 653a 0a20 2020 2020  n is None:.     
+00005060: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00005070: 2045 7863 6570 7469 6f6e 2822 4572 726f   Exception("Erro
+00005080: 723a 2046 6965 6c64 207b 307d 206e 6569  r: Field {0} nei
+00005090: 7468 6572 2066 6f75 6e64 2069 6e20 6974  ther found in it
+000050a0: 656d 207b 317d 206e 6f72 2068 6561 6465  em {1} nor heade
+000050b0: 7222 2e66 6f72 6d61 7428 2769 6d61 6765  r".format('image
+000050c0: 2d6c 6f6e 6769 7475 6465 272c 6974 656d  -longitude',item
+000050d0: 5661 6c29 290a 2020 2020 2020 2020 7265  Val)).        re
+000050e0: 7475 726e 207b 276c 6174 273a 6c61 742c  turn {'lat':lat,
+000050f0: 276c 6f6e 273a 6c6f 6e2c 2764 6174 6574  'lon':lon,'datet
+00005100: 696d 6527 3a64 6174 6574 696d 657d 0a0a  ime':datetime}..
+00005110: 0a64 6566 2069 4644 4f46 726f 6d46 696c  .def iFDOFromFil
+00005120: 6528 6946 444f 6669 6c65 3a73 7472 2c68  e(iFDOfile:str,h
+00005130: 616e 646c 655f 7072 6566 6978 3d27 3230  andle_prefix='20
+00005140: 2e35 3030 2e31 3230 3835 272c 7072 6f76  .500.12085',prov
+00005150: 656e 616e 6365 203d 204e 6f6e 652c 7665  enance = None,ve
+00005160: 7262 6f73 653d 5472 7565 2c69 676e 6f72  rbose=True,ignor
+00005170: 655f 696d 6167 655f 6669 6c65 733d 4661  e_image_files=Fa
+00005180: 6c73 652c 7772 6974 6554 6d70 5072 6f76  lse,writeTmpProv
+00005190: 4669 6c65 3d54 7275 652c 696d 6167 655f  File=True,image_
+000051a0: 6272 6f6b 6572 5f75 7569 643d 2265 6532  broker_uuid="ee2
+000051b0: 3737 3537 382d 6139 3131 2d34 3834 642d  77578-a911-484d-
+000051c0: 6135 3135 2d39 6337 3831 6437 3961 6139  a515-9c781d79aa9
+000051d0: 3122 293a 0a20 2020 2022 2222 2043 6f6e  1"):.    """ Con
+000051e0: 7665 6e69 656e 6365 2066 756e 6374 696f  venience functio
+000051f0: 6e20 746f 2063 7265 6174 6520 616e 2069  n to create an i
+00005200: 4644 4f20 6f62 6a65 6374 2064 6972 6563  FDO object direc
+00005210: 746c 7920 666f 726d 2061 6e20 6578 6973  tly form an exis
+00005220: 7469 6e67 2069 4644 4f20 6669 6c65 2e20  ting iFDO file. 
+00005230: 5472 6965 7320 746f 2069 6e66 6572 2069  Tries to infer i
+00005240: 6d61 6765 2066 696c 6573 206c 6f63 6174  mage files locat
+00005250: 696f 6e20 6672 6f6d 2027 696d 6167 652d  ion from 'image-
+00005260: 6c6f 6361 6c2d 7061 7468 272e 2052 6574  local-path'. Ret
+00005270: 7572 6e73 2069 4644 4f20 6f62 6a65 6374  urns iFDO object
+00005280: 2e20 0a20 2020 2020 2020 202d 2069 4644  . .        - iFD
+00005290: 4f66 696c 653a 2073 7472 696e 6720 7061  Ofile: string pa
+000052a0: 7468 2074 6f20 6c6f 6164 2061 6e20 6578  th to load an ex
+000052b0: 706c 6963 6974 2069 4644 4f20 6669 6c65  plicit iFDO file
+000052c0: 2e0a 2020 2020 2020 2020 2d20 6861 6e64  ..        - hand
+000052d0: 6c65 5f70 7265 6669 783a 2073 7472 696e  le_prefix: strin
+000052e0: 6720 7072 6566 6978 206f 6620 7468 6520  g prefix of the 
+000052f0: 6861 6e64 6c65 2073 6572 7665 722e 2044  handle server. D
+00005300: 6566 6175 6c74 3a20 7468 6520 6f6e 6520  efault: the one 
+00005310: 666f 7220 4765 6f6d 6172 2e0a 2020 2020  for Geomar..    
+00005320: 2020 2020 2d20 7072 6f76 656e 616e 6365      - provenance
+00005330: 3a20 6d61 7269 7174 2e70 726f 7665 6e63  : mariqt.provenc
+00005340: 616e 6365 2e50 726f 7665 6e61 6e63 6520  ance.Provenance 
+00005350: 6f62 6a65 6374 2074 6f20 7472 6163 6b20  object to track 
+00005360: 6461 7461 2070 726f 7665 6e61 6e63 652e  data provenance.
+00005370: 2044 6566 6175 6c74 3a20 6120 6e65 7720   Default: a new 
+00005380: 7072 6f76 656e 616e 6365 206f 626a 6563  provenance objec
+00005390: 7420 6973 2063 7265 6174 6564 2069 6e20  t is created in 
+000053a0: 7468 6520 2770 726f 746f 636f 6c27 2073  the 'protocol' s
+000053b0: 7562 666f 6c64 6572 2e0a 2020 2020 2020  ubfolder..      
+000053c0: 2020 2d20 7665 7262 6f73 653a 2062 6f6f    - verbose: boo
+000053d0: 6c20 7768 6574 6865 7220 746f 2070 7269  l whether to pri
+000053e0: 6e74 206f 7574 2069 6e66 6f72 6d61 7469  nt out informati
+000053f0: 6f6e 2e20 5072 6f63 6573 7369 6e67 2069  on. Processing i
+00005400: 7320 6661 7374 6572 2069 6620 7665 7262  s faster if verb
+00005410: 6f73 6520 6973 2046 616c 7365 2e20 4465  ose is False. De
+00005420: 6661 756c 743a 2054 7275 652e 0a20 2020  fault: True..   
+00005430: 2020 2020 202d 2069 676e 6f72 655f 696d       - ignore_im
+00005440: 6167 655f 6669 6c65 733a 2062 6f6f 6c20  age_files: bool 
+00005450: 7768 6574 6865 7220 6974 2773 2061 6363  whether it's acc
+00005460: 6570 7465 6420 7468 6174 2074 6865 7265  epted that there
+00005470: 2061 7265 206e 6f74 2069 6d61 6765 7320   are not images 
+00005480: 7965 7420 696e 2027 6469 7227 2e20 4465  yet in 'dir'. De
+00005490: 6661 756c 743a 2046 616c 7365 2e0a 2020  fault: False..  
+000054a0: 2020 2020 2020 2d20 7772 6974 6554 6d70        - writeTmp
+000054b0: 5072 6f76 4669 6c65 3a20 626f 6f6c 2077  ProvFile: bool w
+000054c0: 6865 7468 6572 2074 6f20 7772 6974 6520  hether to write 
+000054d0: 6120 7465 6d70 6f72 6172 7920 7072 6f76  a temporary prov
+000054e0: 656e 616e 6365 2066 696c 6520 6475 7269  enance file duri
+000054f0: 6e67 2074 6865 2069 4644 4f20 6372 6561  ng the iFDO crea
+00005500: 7469 6f6e 2070 726f 6365 7373 2077 6869  tion process whi
+00005510: 6368 2077 696c 6c20 6265 2072 6570 6c61  ch will be repla
+00005520: 6365 6420 6279 2061 2066 696e 616c 206f  ced by a final o
+00005530: 6e65 2069 6e20 7468 6520 656e 642e 2044  ne in the end. D
+00005540: 6566 6175 6c74 3a20 5472 7565 0a20 2020  efault: True.   
+00005550: 2020 2020 202d 2069 6d61 6765 5f62 726f       - image_bro
+00005560: 6b65 725f 7575 6964 3a20 7575 6964 206f  ker_uuid: uuid o
+00005570: 6620 696d 6167 6520 6272 6f6b 6572 2074  f image broker t
+00005580: 6f20 6372 6561 7465 2069 6d61 6765 2068  o create image h
+00005590: 616e 646c 6573 2061 7320 6874 7470 733a  andles as https:
+000055a0: 2f2f 6864 6c2e 6861 6e64 6c65 2e6e 6574  //hdl.handle.net
+000055b0: 2f3c 6861 6e64 6c65 5f70 7265 6669 783e  /<handle_prefix>
+000055c0: 2f3c 696d 6167 655f 6272 6f6b 6572 5f75  /<image_broker_u
+000055d0: 7569 643e 403c 696d 6167 652d 7575 6964  uid>@<image-uuid
+000055e0: 3e20 2222 220a 2020 2020 7265 6164 6572  > """.    reader
+000055f0: 203d 2069 4644 4f5f 5265 6164 6572 2869   = iFDO_Reader(i
+00005600: 4644 4f66 696c 6529 0a20 2020 2069 6d61  FDOfile).    ima
+00005610: 6765 7344 6972 203d 206d 6971 7463 2e74  gesDir = miqtc.t
+00005620: 6f55 6e69 7850 6174 6828 6f73 2e70 6174  oUnixPath(os.pat
+00005630: 682e 6e6f 726d 7061 7468 286d 6971 7463  h.normpath(miqtc
+00005640: 2e74 6f55 6e69 7850 6174 6828 7265 6164  .toUnixPath(read
+00005650: 6572 2e67 6574 496d 6167 6544 6972 6563  er.getImageDirec
+00005660: 746f 7279 2829 2929 290a 2020 2020 6261  tory()))).    ba
+00005670: 7365 4469 7220 3d20 6d69 7174 632e 746f  seDir = miqtc.to
+00005680: 556e 6978 5061 7468 286f 732e 7061 7468  UnixPath(os.path
+00005690: 2e63 6f6d 6d6f 6e70 6174 6828 5b69 4644  .commonpath([iFD
+000056a0: 4f66 696c 652c 696d 6167 6573 4469 725d  Ofile,imagesDir]
+000056b0: 2929 0a20 2020 2069 6d61 6765 4461 7461  )).    imageData
+000056c0: 5479 7065 466f 6c64 6572 203d 205b 6520  TypeFolder = [e 
+000056d0: 666f 7220 6520 696e 2069 6d61 6765 7344  for e in imagesD
+000056e0: 6972 2e72 6570 6c61 6365 2862 6173 6544  ir.replace(baseD
+000056f0: 6972 2c22 2229 2e73 706c 6974 2822 2f22  ir,"").split("/"
+00005700: 2920 6966 2065 2021 3d20 2222 5d5b 305d  ) if e != ""][0]
+00005710: 0a20 2020 2069 6620 696d 6167 6544 6174  .    if imageDat
+00005720: 6154 7970 6546 6f6c 6465 7220 6e6f 7420  aTypeFolder not 
+00005730: 696e 206d 6971 7464 2e44 6972 2e64 742e  in miqtd.Dir.dt.
+00005740: 5f5f 6d65 6d62 6572 735f 5f3a 0a20 2020  __members__:.   
+00005750: 2020 2020 2072 6169 7365 206d 6971 7463       raise miqtc
+00005760: 2e49 6664 6f45 7863 6570 7469 6f6e 2822  .IfdoException("
+00005770: 496d 6167 6573 2061 7265 206e 6f74 206c  Images are not l
+00005780: 6f63 6174 6564 2069 6e20 6120 7661 6c69  ocated in a vali
+00005790: 6420 6461 7461 2074 7970 6520 6469 7265  d data type dire
+000057a0: 6374 6f72 7920 2872 6177 2c20 696e 7465  ctory (raw, inte
+000057b0: 726d 6564 6961 7465 2c20 7072 6f63 6573  rmediate, proces
+000057c0: 7365 642c 202e 2e2e 2920 696e 2074 6865  sed, ...) in the
+000057d0: 2073 616d 6520 7072 6f6a 6563 7420 6173   same project as
+000057e0: 2069 4644 4f20 6669 6c65 2e22 290a 2020   iFDO file.").  
+000057f0: 2020 696d 6167 6573 4461 7461 5479 7065    imagesDataType
+00005800: 4469 7220 3d20 6f73 2e70 6174 682e 6a6f  Dir = os.path.jo
+00005810: 696e 2862 6173 6544 6972 2c69 6d61 6765  in(baseDir,image
+00005820: 4461 7461 5479 7065 466f 6c64 6572 290a  DataTypeFolder).
+00005830: 2020 2020 6469 724f 626a 203d 206d 6971      dirObj = miq
+00005840: 7464 2e44 6972 2822 222c 696d 6167 6573  td.Dir("",images
+00005850: 4461 7461 5479 7065 4469 722c 2063 7265  DataTypeDir, cre
+00005860: 6174 653d 4661 6c73 652c 2077 6974 685f  ate=False, with_
+00005870: 6765 6172 3d46 616c 7365 290a 2020 2020  gear=False).    
+00005880: 7265 7475 726e 2069 4644 4f28 6469 723d  return iFDO(dir=
+00005890: 6469 724f 626a 2c68 616e 646c 655f 7072  dirObj,handle_pr
+000058a0: 6566 6978 3d68 616e 646c 655f 7072 6566  efix=handle_pref
+000058b0: 6978 2c70 726f 7665 6e61 6e63 653d 7072  ix,provenance=pr
+000058c0: 6f76 656e 616e 6365 2c76 6572 626f 7365  ovenance,verbose
+000058d0: 3d76 6572 626f 7365 2c69 676e 6f72 655f  =verbose,ignore_
+000058e0: 696d 6167 655f 6669 6c65 733d 6967 6e6f  image_files=igno
+000058f0: 7265 5f69 6d61 6765 5f66 696c 6573 2c77  re_image_files,w
+00005900: 7269 7465 546d 7050 726f 7646 696c 653d  riteTmpProvFile=
+00005910: 7772 6974 6554 6d70 5072 6f76 4669 6c65  writeTmpProvFile
+00005920: 2c69 4644 4f66 696c 653d 6946 444f 6669  ,iFDOfile=iFDOfi
+00005930: 6c65 2c69 6d61 6765 5f62 726f 6b65 725f  le,image_broker_
+00005940: 7575 6964 3d69 6d61 6765 5f62 726f 6b65  uuid=image_broke
+00005950: 725f 7575 6964 290a 0a0a 636c 6173 7320  r_uuid)...class 
+00005960: 6946 444f 3a0a 2020 2020 2220 436c 6173  iFDO:.    " Clas
+00005970: 7320 666f 7220 6372 6561 7469 6e67 2061  s for creating a
+00005980: 6e64 2065 6469 7469 6e67 2069 4644 4f2e  nd editing iFDO.
+00005990: 7961 6d6c 2066 696c 6573 2022 0a0a 2020  yaml files "..  
+000059a0: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
+000059b0: 656c 662c 2064 6972 3a6d 6971 7464 2e44  elf, dir:miqtd.D
+000059c0: 6972 2c20 6861 6e64 6c65 5f70 7265 6669  ir, handle_prefi
+000059d0: 783d 2732 302e 3530 302e 3132 3038 3527  x='20.500.12085'
+000059e0: 2c70 726f 7665 6e61 6e63 6520 3d20 4e6f  ,provenance = No
+000059f0: 6e65 2c76 6572 626f 7365 3d54 7275 652c  ne,verbose=True,
+00005a00: 6967 6e6f 7265 5f69 6d61 6765 5f66 696c  ignore_image_fil
+00005a10: 6573 3d46 616c 7365 2c77 7269 7465 546d  es=False,writeTm
+00005a20: 7050 726f 7646 696c 653d 5472 7565 2c69  pProvFile=True,i
+00005a30: 4644 4f66 696c 653d 4e6f 6e65 2c69 6d61  FDOfile=None,ima
+00005a40: 6765 5f62 726f 6b65 725f 7575 6964 3d22  ge_broker_uuid="
+00005a50: 6565 3237 3735 3738 2d61 3931 312d 3438  ee277578-a911-48
+00005a60: 3464 2d61 3531 352d 3963 3738 3164 3739  4d-a515-9c781d79
+00005a70: 6161 3931 2229 3a0a 2020 2020 2020 2020  aa91"):.        
+00005a80: 2222 2220 4372 6561 7465 7320 616e 2069  """ Creates an i
+00005a90: 464f 4420 6f62 6a65 6374 2e20 5265 7175  FOD object. Requ
+00005aa0: 6972 6573 2061 2076 616c 6964 2064 6972  ires a valid dir
+00005ab0: 6563 746f 7279 2063 6f6e 7461 696e 696e  ectory containin
+00005ac0: 6720 696d 6167 6520 6461 7461 206f 722f  g image data or/
+00005ad0: 616e 6420 616e 6420 6946 444f 2066 696c  and and iFDO fil
+00005ae0: 6520 616e 6420 6120 6861 6e64 6c65 2070  e and a handle p
+00005af0: 7265 6669 7820 6966 2069 7427 7320 6e6f  refix if it's no
+00005b00: 7420 7468 6520 4765 6f6d 6172 206f 6e65  t the Geomar one
+00005b10: 2e20 4c6f 6164 7320 6469 7265 6374 6f72  . Loads director
+00005b20: 7927 7320 6946 444f 2066 696c 6520 6966  y's iFDO file if
+00005b30: 2069 7420 6578 6973 7473 2061 6c72 6561   it exists alrea
+00005b40: 6479 2e0a 2020 2020 2020 2020 2020 2020  dy..            
+00005b50: 2d20 6469 723a 206d 6172 6971 742e 6469  - dir: mariqt.di
+00005b60: 7265 6374 6f72 6965 732e 4469 7220 6f62  rectories.Dir ob
+00005b70: 6a65 6374 2070 6f69 6e74 696e 6720 746f  ject pointing to
+00005b80: 2061 2076 616c 6964 2064 6174 6120 7479   a valid data ty
+00005b90: 7065 2064 6972 6563 746f 7279 2028 7261  pe directory (ra
+00005ba0: 772c 2069 6e74 6572 6d65 6469 6174 652c  w, intermediate,
+00005bb0: 2070 726f 6365 7373 6564 2c20 2e2e 2e29   processed, ...)
+00005bc0: 2063 6f6e 7461 696e 696e 6720 7468 6520   containing the 
+00005bd0: 696d 6167 6520 6461 7461 2e0a 2020 2020  image data..    
+00005be0: 2020 2020 2020 2020 2d20 6861 6e64 6c65          - handle
+00005bf0: 5f70 7265 6669 783a 2073 7472 696e 6720  _prefix: string 
+00005c00: 7072 6566 6978 206f 6620 7468 6520 6861  prefix of the ha
+00005c10: 6e64 6c65 2073 6572 7665 722e 2044 6566  ndle server. Def
+00005c20: 6175 6c74 3a20 7468 6520 6f6e 6520 666f  ault: the one fo
+00005c30: 7220 4765 6f6d 6172 2e0a 2020 2020 2020  r Geomar..      
+00005c40: 2020 2020 2020 2d20 7072 6f76 656e 616e        - provenan
+00005c50: 6365 3a20 6d61 7269 7174 2e70 726f 7665  ce: mariqt.prove
+00005c60: 6e63 616e 6365 2e50 726f 7665 6e61 6e63  ncance.Provenanc
+00005c70: 6520 6f62 6a65 6374 2074 6f20 7472 6163  e object to trac
+00005c80: 6b20 6461 7461 2070 726f 7665 6e61 6e63  k data provenanc
+00005c90: 652e 2044 6566 6175 6c74 3a20 6120 6e65  e. Default: a ne
+00005ca0: 7720 7072 6f76 656e 616e 6365 206f 626a  w provenance obj
+00005cb0: 6563 7420 6973 2063 7265 6174 6564 2069  ect is created i
+00005cc0: 6e20 7468 6520 2770 726f 746f 636f 6c27  n the 'protocol'
+00005cd0: 2073 7562 666f 6c64 6572 2e0a 2020 2020   subfolder..    
+00005ce0: 2020 2020 2020 2020 2d20 7665 7262 6f73          - verbos
+00005cf0: 653a 2062 6f6f 6c20 7768 6574 6865 7220  e: bool whether 
+00005d00: 746f 2070 7269 6e74 206f 7574 2069 6e66  to print out inf
+00005d10: 6f72 6d61 7469 6f6e 2e20 4465 6661 756c  ormation. Defaul
+00005d20: 743a 2054 7275 652e 0a20 2020 2020 2020  t: True..       
+00005d30: 2020 2020 202d 2069 676e 6f72 655f 696d       - ignore_im
+00005d40: 6167 655f 6669 6c65 733a 2062 6f6f 6c20  age_files: bool 
+00005d50: 7768 6574 6865 7220 6974 2773 2061 6363  whether it's acc
+00005d60: 6570 7465 6420 7468 6174 2074 6865 7265  epted that there
+00005d70: 2061 7265 206e 6f74 2069 6d61 6765 7320   are not images 
+00005d80: 7965 7420 696e 2027 6469 7227 2e20 4465  yet in 'dir'. De
+00005d90: 6661 756c 743a 2046 616c 7365 2e0a 2020  fault: False..  
+00005da0: 2020 2020 2020 2020 2020 2d20 7772 6974            - writ
+00005db0: 6554 6d70 5072 6f76 4669 6c65 3a20 626f  eTmpProvFile: bo
+00005dc0: 6f6c 2077 6865 7468 6572 2074 6f20 7772  ol whether to wr
+00005dd0: 6974 6520 6120 7465 6d70 6f72 6172 7920  ite a temporary 
+00005de0: 7072 6f76 656e 616e 6365 2066 696c 6520  provenance file 
+00005df0: 6475 7269 6e67 2074 6865 2069 4644 4f20  during the iFDO 
+00005e00: 6372 6561 7469 6f6e 2070 726f 6365 7373  creation process
+00005e10: 2077 6869 6368 2077 696c 6c20 6265 2072   which will be r
+00005e20: 6570 6c61 6365 6420 6279 2061 2066 696e  eplaced by a fin
+00005e30: 616c 206f 6e65 2069 6e20 7468 6520 656e  al one in the en
+00005e40: 642e 2044 6566 6175 6c74 3a20 5472 7565  d. Default: True
+00005e50: 0a20 2020 2020 2020 2020 2020 202d 2069  .            - i
+00005e60: 4644 4f66 696c 653a 2073 7472 696e 6720  FDOfile: string 
+00005e70: 7061 7468 2074 6f20 6c6f 6164 2061 6e20  path to load an 
+00005e80: 6578 706c 6963 6974 2069 4644 4f20 6669  explicit iFDO fi
+00005e90: 6c65 2e20 4966 206e 6f74 2070 726f 7669  le. If not provi
+00005ea0: 6465 6420 6120 6d61 7463 6869 6e67 2069  ded a matching i
+00005eb0: 4644 4f20 6669 6c65 2028 6966 2069 7420  FDO file (if it 
+00005ec0: 616c 7265 6164 7920 6578 6973 7473 2920  already exists) 
+00005ed0: 7769 6c6c 2062 6520 6c6f 6164 6564 2066  will be loaded f
+00005ee0: 726f 6d20 7468 6520 2770 726f 6475 6374  rom the 'product
+00005ef0: 7327 2073 7562 6469 7265 6374 6f72 792e  s' subdirectory.
+00005f00: 2044 6566 6175 6c74 3a20 4e6f 6e65 200a   Default: None .
+00005f10: 2020 2020 2020 2020 2020 2020 2d20 696d              - im
+00005f20: 6167 655f 6272 6f6b 6572 5f75 7569 643a  age_broker_uuid:
+00005f30: 2075 7569 6420 6f66 2069 6d61 6765 2062   uuid of image b
+00005f40: 726f 6b65 7220 746f 2063 7265 6174 6520  roker to create 
+00005f50: 696d 6167 6520 6861 6e64 6c65 7320 6173  image handles as
+00005f60: 2068 7474 7073 3a2f 2f68 646c 2e68 616e   https://hdl.han
+00005f70: 646c 652e 6e65 742f 3c68 616e 646c 655f  dle.net/<handle_
+00005f80: 7072 6566 6978 3e2f 3c69 6d61 6765 5f62  prefix>/<image_b
+00005f90: 726f 6b65 725f 7575 6964 3e40 3c69 6d61  roker_uuid>@<ima
+00005fa0: 6765 2d75 7569 643e 2022 2222 0a0a 2020  ge-uuid> """..  
+00005fb0: 2020 2020 2020 2320 6368 6563 6b20 7468        # check th
+00005fc0: 6174 2061 7420 6469 7220 6f72 2069 4644  at at dir or iFD
+00005fd0: 4f66 696c 6520 7072 6f76 6964 6564 0a20  Ofile provided. 
+00005fe0: 2020 2020 2020 2069 6620 6469 7220 6973         if dir is
+00005ff0: 204e 6f6e 6520 616e 6420 6946 444f 6669   None and iFDOfi
+00006000: 6c65 2069 7320 4e6f 6e65 3a0a 2020 2020  le is None:.    
+00006010: 2020 2020 2020 2020 7261 6973 6520 6d69          raise mi
+00006020: 7174 632e 4966 646f 4578 6365 7074 696f  qtc.IfdoExceptio
+00006030: 6e28 224e 6569 7468 6572 2064 6972 206e  n("Neither dir n
+00006040: 6f72 2069 4644 4f66 696c 6520 7072 6f76  or iFDOfile prov
+00006050: 6964 6564 2066 6f72 2069 4644 4f2e 2229  ided for iFDO.")
+00006060: 0a0a 2020 2020 2020 2020 7365 6c66 2e64  ..        self.d
+00006070: 6972 203d 2064 6972 0a20 2020 2020 2020  ir = dir.       
+00006080: 2073 656c 662e 696d 6167 6573 4469 7220   self.imagesDir 
+00006090: 3d20 6469 722e 746f 7479 7065 2829 0a20  = dir.totype(). 
+000060a0: 2020 2020 2020 2073 656c 662e 6469 722e         self.dir.
+000060b0: 6372 6561 7465 5479 7065 466f 6c64 6572  createTypeFolder
+000060c0: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
+000060d0: 6861 6e64 6c65 5f70 7265 6669 7820 3d20  handle_prefix = 
+000060e0: 2268 7474 7073 3a2f 2f68 646c 2e68 616e  "https://hdl.han
+000060f0: 646c 652e 6e65 742f 2220 2b20 6861 6e64  dle.net/" + hand
+00006100: 6c65 5f70 7265 6669 780a 2020 2020 2020  le_prefix.      
+00006110: 2020 7365 6c66 2e69 6d61 6765 5f68 616e    self.image_han
+00006120: 646c 655f 7072 6566 6978 203d 2073 656c  dle_prefix = sel
+00006130: 662e 6861 6e64 6c65 5f70 7265 6669 7820  f.handle_prefix 
+00006140: 2b20 222f 2220 2b20 696d 6167 655f 6272  + "/" + image_br
+00006150: 6f6b 6572 5f75 7569 640a 2020 2020 2020  oker_uuid.      
+00006160: 2020 7365 6c66 2e69 676e 6f72 655f 696d    self.ignore_im
+00006170: 6167 655f 6669 6c65 7320 3d20 6967 6e6f  age_files = igno
+00006180: 7265 5f69 6d61 6765 5f66 696c 6573 0a0a  re_image_files..
+00006190: 2020 2020 2020 2020 7365 6c66 2e69 6d61          self.ima
+000061a0: 6765 5365 7448 6561 6465 724b 6579 203d  geSetHeaderKey =
+000061b0: 206d 6971 7476 2e69 6d61 6765 5f73 6574   miqtv.image_set
+000061c0: 5f68 6561 6465 725f 6b65 790a 2020 2020  _header_key.    
 000061d0: 2020 2020 7365 6c66 2e69 6d61 6765 5365      self.imageSe
-000061e0: 7448 6561 6465 724b 6579 203d 206d 6971  tHeaderKey = miq
-000061f0: 7476 2e69 6d61 6765 5f73 6574 5f68 6561  tv.image_set_hea
-00006200: 6465 725f 6b65 790a 2020 2020 2020 2020  der_key.        
-00006210: 7365 6c66 2e69 6d61 6765 5365 7449 7465  self.imageSetIte
-00006220: 6d73 4b65 7920 3d20 6d69 7174 762e 696d  msKey = miqtv.im
-00006230: 6167 655f 7365 745f 6974 656d 735f 6b65  age_set_items_ke
-00006240: 790a 2020 2020 2020 2020 7365 6c66 2e69  y.        self.i
-00006250: 6664 6f5f 746d 7020 3d20 7b73 656c 662e  fdo_tmp = {self.
-00006260: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
-00006270: 793a 207b 7d2c 0a20 2020 2020 2020 2020  y: {},.         
-00006280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006290: 7365 6c66 2e69 6d61 6765 5365 7449 7465  self.imageSetIte
-000062a0: 6d73 4b65 793a 207b 7d7d 0a20 2020 2020  msKey: {}}.     
-000062b0: 2020 2073 656c 662e 6966 646f 5f70 6172     self.ifdo_par
-000062c0: 7365 6420 3d20 4e6f 6e65 0a20 2020 2020  sed = None.     
-000062d0: 2020 2073 656c 662e 6966 646f 5f63 6865     self.ifdo_che
-000062e0: 636b 6564 203d 2063 6f70 792e 6465 6570  cked = copy.deep
-000062f0: 636f 7079 2873 656c 662e 6966 646f 5f74  copy(self.ifdo_t
-00006300: 6d70 2920 2023 2074 6f20 6265 2073 6574  mp)  # to be set
-00006310: 2062 7920 6372 6561 7465 6946 444f 2829   by createiFDO()
-00006320: 206f 6e6c 7921 0a20 2020 2020 2020 2073   only!.        s
-00006330: 656c 662e 5f5f 616c 6c55 5549 4473 4368  elf.__allUUIDsCh
-00006340: 6563 6b65 6420 3d20 4661 6c73 650a 2020  ecked = False.  
-00006350: 2020 2020 2020 7365 6c66 2e72 6571 4e61        self.reqNa
-00006360: 7646 6965 6c64 7320 3d20 5b27 696d 6167  vFields = ['imag
-00006370: 652d 6c6f 6e67 6974 7564 6527 2c27 696d  e-longitude','im
-00006380: 6167 652d 6c61 7469 7475 6465 272c 2769  age-latitude','i
-00006390: 6d61 6765 2d63 6f6f 7264 696e 6174 652d  mage-coordinate-
-000063a0: 756e 6365 7274 6169 6e74 792d 6d65 7465  uncertainty-mete
-000063b0: 7273 272c 5b27 696d 6167 652d 6465 7074  rs',['image-dept
-000063c0: 6827 2c27 696d 6167 652d 616c 7469 7475  h','image-altitu
-000063d0: 6465 275d 5d0a 2020 2020 2020 2020 7365  de']].        se
-000063e0: 6c66 2e70 726f 7620 3d20 7072 6f76 656e  lf.prov = proven
-000063f0: 616e 6365 0a20 2020 2020 2020 2069 6620  ance.        if 
-00006400: 7072 6f76 656e 616e 6365 203d 3d20 4e6f  provenance == No
-00006410: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00006420: 746d 7046 696c 6550 6174 6820 3d20 2222  tmpFilePath = ""
-00006430: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00006440: 7772 6974 6554 6d70 5072 6f76 4669 6c65  writeTmpProvFile
-00006450: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00006460: 2020 746d 7046 696c 6550 6174 6820 3d20    tmpFilePath = 
-00006470: 7365 6c66 2e64 6972 2e74 6f28 7365 6c66  self.dir.to(self
-00006480: 2e64 6972 2e64 742e 7072 6f74 6f63 6f6c  .dir.dt.protocol
-00006490: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-000064a0: 6c66 2e70 726f 7620 3d20 6d69 7174 702e  lf.prov = miqtp.
-000064b0: 5072 6f76 656e 616e 6365 2822 6946 444f  Provenance("iFDO
-000064c0: 222c 7665 7262 6f73 653d 7665 7262 6f73  ",verbose=verbos
-000064d0: 652c 746d 7046 696c 6550 6174 683d 746d  e,tmpFilePath=tm
-000064e0: 7046 696c 6550 6174 6829 0a20 2020 2020  pFilePath).     
-000064f0: 2020 2073 656c 662e 6d69 7373 696e 6746     self.missingF
-00006500: 6965 6c64 7346 6f72 4661 6972 6e65 7373  ieldsForFairness
-00006510: 203d 205b 5d0a 0a20 2020 2020 2020 2023   = []..        #
-00006520: 2073 6574 2067 6c6f 6261 6c20 7665 7262   set global verb
-00006530: 6f73 6974 790a 2020 2020 2020 2020 6d69  osity.        mi
-00006540: 7174 762e 7365 7447 6c6f 6261 6c56 6572  qtv.setGlobalVer
-00006550: 626f 7365 2876 6572 626f 7365 290a 0a20  bose(verbose).. 
-00006560: 2020 2020 2020 2069 6620 6e6f 7420 6469         if not di
-00006570: 722e 6578 6973 7473 2829 3a0a 2020 2020  r.exists():.    
-00006580: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
-00006590: 6365 7074 696f 6e28 2264 6972 6563 7472  ception("directr
-000065a0: 6f79 222c 2064 6972 2e73 7472 2829 2c20  oy", dir.str(), 
-000065b0: 2264 6f65 7320 6e6f 7420 6578 6973 742e  "does not exist.
-000065c0: 2229 0a0a 2020 2020 2020 2020 6966 206e  ")..        if n
-000065d0: 6f74 2064 6972 2e76 616c 6964 4461 7461  ot dir.validData
-000065e0: 4469 7228 293a 0a20 2020 2020 2020 2020  Dir():.         
-000065f0: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
-00006600: 6f6e 2822 6469 7265 6374 726f 7922 2c20  on("directroy", 
-00006610: 6469 722e 7374 7228 292c 2022 6e6f 7420  dir.str(), "not 
-00006620: 7661 6c69 642e 2044 6f65 7320 6e6f 7420  valid. Does not 
-00006630: 636f 6d70 6c79 2077 6974 6820 7374 7275  comply with stru
-00006640: 6374 7572 6520 2f62 6173 652f 7072 6f6a  cture /base/proj
-00006650: 6563 742f 5b47 6561 722f 5d65 7665 6e74  ect/[Gear/]event
-00006660: 2f73 656e 736f 722f 6461 7461 5f74 7970  /sensor/data_typ
-00006670: 652f 2229 0a0a 2020 2020 2020 2020 2320  e/")..        # 
-00006680: 6368 6563 6b20 6946 444f 2066 696c 650a  check iFDO file.
-00006690: 2020 2020 2020 2020 7365 6c66 2e69 4644          self.iFD
-000066a0: 4f66 696c 655f 203d 2022 2220 2320 6973  Ofile_ = "" # is
-000066b0: 2073 6574 2062 7920 7365 7469 4644 4f46   set by setiFDOF
-000066c0: 696c 654e 616d 6528 290a 2020 2020 2020  ileName().      
-000066d0: 2020 6c6f 6164 6564 6946 444f 203d 2046    loadediFDO = F
-000066e0: 616c 7365 0a20 2020 2020 2020 2069 6620  alse.        if 
-000066f0: 6e6f 7420 6946 444f 6669 6c65 2069 7320  not iFDOfile is 
-00006700: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00006710: 2020 6946 444f 6669 6c65 5f20 3d20 6946    iFDOfile_ = iF
-00006720: 444f 6669 6c65 0a20 2020 2020 2020 2020  DOfile.         
-00006730: 2020 2073 656c 662e 7365 7469 4644 4f46     self.setiFDOF
-00006740: 696c 654e 616d 6528 6946 444f 6669 6c65  ileName(iFDOfile
-00006750: 5f29 0a20 2020 2020 2020 2020 2020 2069  _).            i
-00006760: 6620 6e6f 7420 6f73 2e70 6174 682e 6973  f not os.path.is
-00006770: 6669 6c65 2869 4644 4f66 696c 655f 293a  file(iFDOfile_):
-00006780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006790: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
-000067a0: 6f45 7863 6570 7469 6f6e 2822 6946 444f  oException("iFDO
-000067b0: 2066 696c 6520 6e6f 7420 666f 756e 643a   file not found:
-000067c0: 2022 202b 2069 4644 4f66 696c 655f 290a   " + iFDOfile_).
-000067d0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000067e0: 2020 2020 2020 2020 2020 6946 444f 6669            iFDOfi
-000067f0: 6c65 5f20 3d20 7365 6c66 2e64 6972 2e74  le_ = self.dir.t
-00006800: 6f28 7365 6c66 2e64 6972 2e64 742e 7072  o(self.dir.dt.pr
-00006810: 6f64 7563 7473 292b 7365 6c66 2e63 6f6e  oducts)+self.con
-00006820: 7374 7275 6374 6946 444f 6669 6c65 4e61  structiFDOfileNa
-00006830: 6d65 2873 656c 662e 6469 722e 7072 6f6a  me(self.dir.proj
-00006840: 6563 7428 292c 7365 6c66 2e64 6972 2e65  ect(),self.dir.e
-00006850: 7665 6e74 2829 2c73 656c 662e 6469 722e  vent(),self.dir.
-00006860: 7365 6e73 6f72 2829 290a 0a20 2020 2020  sensor())..     
-00006870: 2020 2073 656c 662e 5f69 6d61 6765 7349     self._imagesI
-00006880: 6e49 6d61 6765 7344 6972 203d 206d 6971  nImagesDir = miq
-00006890: 7469 2e62 726f 7773 6546 6f72 496d 6167  ti.browseForImag
-000068a0: 6546 696c 6573 2873 656c 662e 696d 6167  eFiles(self.imag
-000068b0: 6573 4469 7229 0a20 2020 2020 2020 2073  esDir).        s
-000068c0: 656c 662e 5f69 6d61 6765 7349 6e49 6d61  elf._imagesInIma
-000068d0: 6765 7344 6972 536f 7274 6564 4c69 7374  gesDirSortedList
-000068e0: 203d 205b 6669 6c65 2066 6f72 2066 696c   = [file for fil
-000068f0: 6520 696e 2073 656c 662e 5f69 6d61 6765  e in self._image
-00006900: 7349 6e49 6d61 6765 7344 6972 5d0a 2020  sInImagesDir].  
-00006910: 2020 2020 2020 7365 6c66 2e5f 696d 6167        self._imag
-00006920: 6573 496e 496d 6167 6573 4469 7253 6f72  esInImagesDirSor
-00006930: 7465 644c 6973 742e 736f 7274 2829 0a20  tedList.sort(). 
-00006940: 2020 2020 2020 2073 656c 662e 5f69 6d61         self._ima
-00006950: 6765 4e61 6d65 7349 6d61 6765 7344 6972  geNamesImagesDir
-00006960: 203d 205b 6f73 2e70 6174 682e 6261 7365   = [os.path.base
-00006970: 6e61 6d65 2866 696c 6529 2066 6f72 2066  name(file) for f
-00006980: 696c 6520 696e 2073 656c 662e 5f69 6d61  ile in self._ima
-00006990: 6765 7349 6e49 6d61 6765 7344 6972 5d0a  gesInImagesDir].
-000069a0: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-000069b0: 7365 6c66 2e5f 696d 6167 6573 496e 496d  self._imagesInIm
-000069c0: 6167 6573 4469 7229 203d 3d20 3020 616e  agesDir) == 0 an
-000069d0: 6420 6e6f 7420 7374 6172 7445 6d70 7479  d not startEmpty
-000069e0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-000069f0: 6973 6520 4578 6365 7074 696f 6e28 224e  ise Exception("N
-00006a00: 6f20 696d 6167 6573 2066 696c 6573 2066  o images files f
-00006a10: 6f75 6e64 2069 6e20 2220 2b20 7365 6c66  ound in " + self
-00006a20: 2e69 6d61 6765 7344 6972 202b 2022 2061  .imagesDir + " a
-00006a30: 6e64 2069 7473 2073 7562 6469 7265 6374  nd its subdirect
-00006a40: 6f72 6965 7322 290a 0a20 2020 2020 2020  ories")..       
-00006a50: 2075 6e69 7175 652c 2064 7570 203d 206d   unique, dup = m
-00006a60: 6971 7474 2e66 696c 6573 4861 7665 556e  iqtt.filesHaveUn
-00006a70: 6971 7565 4e61 6d65 2873 656c 662e 5f69  iqueName(self._i
-00006a80: 6d61 6765 7349 6e49 6d61 6765 7344 6972  magesInImagesDir
-00006a90: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
-00006aa0: 2075 6e69 7175 653a 0a20 2020 2020 2020   unique:.       
-00006ab0: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
-00006ac0: 7469 6f6e 280a 2020 2020 2020 2020 2020  tion(.          
-00006ad0: 2020 2020 2020 224e 6f74 2061 6c6c 2066        "Not all f
-00006ae0: 696c 6573 2068 6176 6520 756e 6971 7565  iles have unique
-00006af0: 206e 616d 6573 2e20 4475 706c 6963 6174   names. Duplicat
-00006b00: 6573 3a20 2220 2b20 7374 7228 6475 7029  es: " + str(dup)
-00006b10: 290a 0a20 2020 2020 2020 2061 6c6c 7661  )..        allva
-00006b20: 6c69 642c 206d 7367 203d 206d 6971 7474  lid, msg = miqtt
-00006b30: 2e61 6c6c 496d 6167 654e 616d 6573 5661  .allImageNamesVa
-00006b40: 6c69 6428 7365 6c66 2e5f 696d 6167 6573  lid(self._images
-00006b50: 496e 496d 6167 6573 4469 7229 200a 2020  InImagesDir) .  
-00006b60: 2020 2020 2020 6966 206e 6f74 2061 6c6c        if not all
-00006b70: 7661 6c69 643a 0a20 2020 2020 2020 2020  valid:.         
-00006b80: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
-00006b90: 6f6e 286d 7367 290a 0a20 2020 2020 2020  on(msg)..       
-00006ba0: 2073 656c 662e 7072 6f76 2e6c 6f67 2873   self.prov.log(s
-00006bb0: 7472 286c 656e 2873 656c 662e 5f69 6d61  tr(len(self._ima
-00006bc0: 6765 7349 6e49 6d61 6765 7344 6972 2929  gesInImagesDir))
-00006bd0: 202b 2022 2069 6d61 6765 2066 696c 6573   + " image files
-00006be0: 2066 6f75 6e64 2e22 290a 2020 2020 2020   found.").      
-00006bf0: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
-00006c00: 2222 290a 2020 2020 2020 2020 7365 6c66  "").        self
-00006c10: 2e70 726f 762e 6c6f 6728 2246 6f6c 6c6f  .prov.log("Follo
-00006c20: 7769 6e67 2069 6e66 6f72 6d61 7469 6f6e  wing information
-00006c30: 2077 6173 2070 6172 7365 6420 6672 6f6d   was parsed from
-00006c40: 2064 6972 6563 746f 7279 2c20 706c 6561   directory, plea
-00006c50: 7365 2063 6865 636b 2066 6f72 2063 6f72  se check for cor
-00006c60: 7265 6374 6e65 7373 3a22 290a 2020 2020  rectness:").    
-00006c70: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-00006c80: 6728 2250 726f 6a65 6374 3a5c 7422 2b73  g("Project:\t"+s
-00006c90: 656c 662e 6469 722e 7072 6f6a 6563 7428  elf.dir.project(
-00006ca0: 2929 0a20 2020 2020 2020 2069 6620 7365  )).        if se
-00006cb0: 6c66 2e64 6972 2e77 6974 685f 6765 6172  lf.dir.with_gear
-00006cc0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00006cd0: 6c66 2e70 726f 762e 6c6f 6728 2247 6561  lf.prov.log("Gea
-00006ce0: 723a 5c74 5c74 222b 7365 6c66 2e64 6972  r:\t\t"+self.dir
-00006cf0: 2e67 6561 7228 2929 0a20 2020 2020 2020  .gear()).       
-00006d00: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
-00006d10: 4576 656e 743a 5c74 5c74 222b 7365 6c66  Event:\t\t"+self
-00006d20: 2e64 6972 2e65 7665 6e74 2829 290a 2020  .dir.event()).  
-00006d30: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
-00006d40: 6c6f 6728 2253 656e 736f 723a 5c74 5c74  log("Sensor:\t\t
-00006d50: 222b 7365 6c66 2e64 6972 2e73 656e 736f  "+self.dir.senso
-00006d60: 7228 2929 0a20 2020 2020 2020 2073 656c  r()).        sel
-00006d70: 662e 7072 6f76 2e6c 6f67 2822 2229 0a0a  f.prov.log("")..
-00006d80: 2020 2020 2020 2020 2320 696e 7465 726d          # interm
-00006d90: 6564 6961 7465 2066 696c 6573 0a20 2020  ediate files.   
-00006da0: 2020 2020 2073 656c 662e 5f5f 696e 6974       self.__init
-00006db0: 496e 7465 726d 6564 6961 7465 4669 6c65  IntermediateFile
-00006dc0: 7328 2920 2020 200a 0a20 2020 2020 2020  s()    ..       
-00006dd0: 2023 2074 7279 206c 6f61 6420 6578 6973   # try load exis
-00006de0: 7469 6e67 2069 4644 4f20 6669 6c65 0a20  ting iFDO file. 
-00006df0: 2020 2020 2020 2069 6628 7365 6c66 2e72         if(self.r
-00006e00: 6561 6469 4644 4f66 696c 6528 6946 444f  eadiFDOfile(iFDO
-00006e10: 6669 6c65 5f29 293a 0a20 2020 2020 2020  file_)):.       
-00006e20: 2020 2020 206c 6f61 6465 6469 4644 4f20       loadediFDO 
-00006e30: 3d20 5472 7565 0a20 2020 2020 2020 2065  = True.        e
-00006e40: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00006e50: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00006e60: 2020 2020 2020 7061 7468 203d 2073 656c        path = sel
-00006e70: 662e 6469 722e 746f 2873 656c 662e 6469  f.dir.to(self.di
-00006e80: 722e 6474 2e70 726f 6475 6374 7329 0a20  r.dt.products). 
-00006e90: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00006ea0: 6f72 2066 696c 655f 2069 6e20 6f73 2e6c  or file_ in os.l
-00006eb0: 6973 7464 6972 2870 6174 6829 3a0a 2020  istdir(path):.  
-00006ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ed0: 2020 6966 2066 696c 655f 5b2d 3130 3a3a    if file_[-10::
-00006ee0: 5d20 3d3d 2022 5f69 4644 4f2e 7961 6d6c  ] == "_iFDO.yaml
-00006ef0: 2220 616e 6420 7365 6c66 2e72 6561 6469  " and self.readi
-00006f00: 4644 4f66 696c 6528 7061 7468 2b66 696c  FDOfile(path+fil
-00006f10: 655f 293a 0a20 2020 2020 2020 2020 2020  e_):.           
-00006f20: 2020 2020 2020 2020 2020 2020 206c 6f61               loa
-00006f30: 6465 6469 4644 4f20 3d20 5472 7565 0a20  dediFDO = True. 
-00006f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006f50: 2020 2020 2020 2069 4644 4f66 696c 655f         iFDOfile_
-00006f60: 203d 2070 6174 682b 6669 6c65 5f0a 2020   = path+file_.  
-00006f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006f80: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
-00006f90: 2020 2020 2020 2020 6578 6365 7074 2046          except F
-00006fa0: 696c 654e 6f74 466f 756e 6445 7272 6f72  ileNotFoundError
-00006fb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00006fc0: 2020 7061 7373 2020 2020 2020 2020 0a0a    pass        ..
-00006fd0: 2020 2020 2020 2020 6966 206c 6f61 6465          if loade
-00006fe0: 6469 4644 4f3a 0a20 2020 2020 2020 2020  diFDO:.         
-00006ff0: 2020 2073 656c 662e 7365 7469 4644 4f46     self.setiFDOF
-00007000: 696c 654e 616d 6528 6946 444f 6669 6c65  ileName(iFDOfile
-00007010: 5f29 0a20 2020 2020 2020 2073 656c 662e  _).        self.
-00007020: 7472 7941 7574 6f53 6574 4865 6164 6572  tryAutoSetHeader
-00007030: 4669 656c 6473 2829 0a20 2020 2020 2020  Fields().       
-00007040: 2073 656c 662e 7365 7448 6561 6465 7249   self.setHeaderI
-00007050: 6d61 6765 4c6f 6361 6c50 6174 6846 6965  mageLocalPathFie
-00007060: 6c64 2829 0a0a 0a20 2020 2064 6566 2072  ld()...    def r
-00007070: 6561 6469 4644 4f66 696c 6528 7365 6c66  eadiFDOfile(self
-00007080: 2c66 696c 653a 7374 7229 3a0a 2020 2020  ,file:str):.    
-00007090: 2020 2020 2222 2220 7265 6164 7320 6946      """ reads iF
-000070a0: 444f 2066 696c 6520 2222 220a 2020 2020  DO file """.    
-000070b0: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
-000070c0: 7468 2e65 7869 7374 7328 6669 6c65 293a  th.exists(file):
-000070d0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000070e0: 7572 6e20 4661 6c73 650a 0a20 2020 2020  urn False..     
-000070f0: 2020 2073 203d 206d 6971 7463 2e50 7269     s = miqtc.Pri
-00007100: 6e74 4c6f 6164 696e 674d 7367 2822 4c6f  ntLoadingMsg("Lo
-00007110: 6164 696e 6720 6946 444f 2066 696c 6522  ading iFDO file"
-00007120: 290a 2020 2020 2020 2020 7472 793a 0a20  ).        try:. 
-00007130: 2020 2020 2020 2020 2020 2023 2027 646f             # 'do
-00007140: 6375 6d65 6e74 2e79 616d 6c27 2063 6f6e  cument.yaml' con
-00007150: 7461 696e 7320 6120 7369 6e67 6c65 2059  tains a single Y
-00007160: 414d 4c20 646f 6375 6d65 6e74 2e0a 2020  AML document..  
-00007170: 2020 2020 2020 2020 2020 6f20 3d20 6f70            o = op
-00007180: 656e 2866 696c 652c 2027 7227 290a 2020  en(file, 'r').  
-00007190: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
-000071a0: 6664 6f5f 746d 7020 3d20 7961 6d6c 2e6c  fdo_tmp = yaml.l
-000071b0: 6f61 6428 6f2c 2020 4c6f 6164 6572 3d79  oad(o,  Loader=y
-000071c0: 616d 6c2e 434c 6f61 6465 7229 0a20 2020  aml.CLoader).   
-000071d0: 2020 2020 2020 2020 2073 656c 662e 6966           self.if
-000071e0: 646f 5f70 6172 7365 6420 3d20 636f 7079  do_parsed = copy
-000071f0: 2e64 6565 7063 6f70 7928 7365 6c66 2e69  .deepcopy(self.i
-00007200: 6664 6f5f 746d 7029 0a20 2020 2020 2020  fdo_tmp).       
-00007210: 2020 2020 206f 2e63 6c6f 7365 2829 0a20       o.close(). 
-00007220: 2020 2020 2020 2020 2020 2073 2e73 746f             s.sto
-00007230: 7028 290a 2020 2020 2020 2020 2020 2020  p().            
-00007240: 7365 6c66 2e70 726f 762e 6164 6450 7265  self.prov.addPre
-00007250: 7669 6f75 7350 726f 7665 6e61 6e63 6528  viousProvenance(
-00007260: 7365 6c66 2e70 726f 762e 6765 744c 6173  self.prov.getLas
-00007270: 7450 726f 7665 6e61 6e63 6546 696c 6528  tProvenanceFile(
-00007280: 7365 6c66 2e64 6972 2e74 6f28 7365 6c66  self.dir.to(self
-00007290: 2e64 6972 2e64 742e 7072 6f74 6f63 6f6c  .dir.dt.protocol
-000072a0: 292c 7365 6c66 2e70 726f 762e 6578 6563  ),self.prov.exec
-000072b0: 7574 6162 6c65 2929 0a20 2020 2020 2020  utable)).       
-000072c0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-000072d0: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
-000072e0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-000072f0: 6728 7374 7228 652e 6172 6773 2929 0a20  g(str(e.args)). 
-00007300: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00007310: 6e20 4661 6c73 650a 2020 2020 2020 2020  n False.        
-00007320: 732e 7374 6f70 2829 0a20 2020 2020 2020  s.stop().       
-00007330: 2023 2074 7279 2074 6f20 7061 7273 6520   # try to parse 
-00007340: 652e 672e 2073 7472 696e 6773 2074 6861  e.g. strings tha
-00007350: 7420 7265 7072 6573 656e 7420 6469 6374  t represent dict
-00007360: 730a 2020 2020 2020 2020 6d69 7174 632e  s.        miqtc.
-00007370: 7265 6375 7273 6976 6545 7661 6c28 7365  recursiveEval(se
-00007380: 6c66 2e69 6664 6f5f 746d 7029 0a0a 2020  lf.ifdo_tmp)..  
-00007390: 2020 2020 2020 6966 2073 656c 662e 696d        if self.im
-000073a0: 6167 6553 6574 4865 6164 6572 4b65 7920  ageSetHeaderKey 
-000073b0: 6e6f 7420 696e 2073 656c 662e 6966 646f  not in self.ifdo
-000073c0: 5f74 6d70 3a0a 2020 2020 2020 2020 2020  _tmp:.          
-000073d0: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
-000073e0: 6e28 2245 7272 6f72 206c 6f61 6469 6e67  n("Error loading
-000073f0: 2069 4644 4f20 6669 6c65 222c 6669 6c65   iFDO file",file
-00007400: 2c22 646f 6573 206e 6f74 2063 6f6e 7461  ,"does not conta
-00007410: 696e 222c 7365 6c66 2e69 6d61 6765 5365  in",self.imageSe
-00007420: 7448 6561 6465 724b 6579 290a 2020 2020  tHeaderKey).    
-00007430: 2020 2020 6966 2073 656c 662e 696d 6167      if self.imag
-00007440: 6553 6574 4974 656d 734b 6579 206e 6f74  eSetItemsKey not
-00007450: 2069 6e20 7365 6c66 2e69 6664 6f5f 746d   in self.ifdo_tm
-00007460: 703a 0a20 2020 2020 2020 2020 2020 2072  p:.            r
-00007470: 6169 7365 2045 7863 6570 7469 6f6e 2822  aise Exception("
-00007480: 4572 726f 7220 6c6f 6164 696e 6720 6946  Error loading iF
-00007490: 444f 2066 696c 6522 2c66 696c 652c 2264  DO file",file,"d
-000074a0: 6f65 7320 6e6f 7420 636f 6e74 6169 6e22  oes not contain"
-000074b0: 2c73 656c 662e 696d 6167 6553 6574 4974  ,self.imageSetIt
-000074c0: 656d 734b 6579 290a 0a20 2020 2020 2020  emsKey)..       
-000074d0: 2069 6620 2073 656c 662e 6966 646f 5f74   if  self.ifdo_t
-000074e0: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
-000074f0: 4865 6164 6572 4b65 795d 203d 3d20 4e6f  HeaderKey] == No
-00007500: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00007510: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-00007520: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-00007530: 724b 6579 5d20 3d20 7b7d 0a20 2020 2020  rKey] = {}.     
-00007540: 2020 2069 6620 7365 6c66 2e69 6664 6f5f     if self.ifdo_
-00007550: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
-00007560: 7449 7465 6d73 4b65 795d 203d 3d20 4e6f  tItemsKey] == No
-00007570: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00007580: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-00007590: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
-000075a0: 4b65 795d 203d 207b 7d0a 0a20 2020 2020  Key] = {}..     
-000075b0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-000075c0: 2822 6946 444f 2066 696c 6520 6c6f 6164  ("iFDO file load
-000075d0: 6564 3a5c 7422 2b6f 732e 7061 7468 2e62  ed:\t"+os.path.b
-000075e0: 6173 656e 616d 6528 6669 6c65 2929 0a0a  asename(file))..
-000075f0: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
-00007600: 6946 444f 2076 6572 7369 6f6e 0a20 2020  iFDO version.   
-00007610: 2020 2020 2072 6561 6456 6572 7369 6f6e       readVersion
-00007620: 203d 2022 762e 312e 302e 3022 2023 2064   = "v.1.0.0" # d
-00007630: 6964 206e 6f74 2068 6176 6520 7468 6520  id not have the 
-00007640: 2769 6d61 6765 2d73 6574 2d69 6664 6f2d  'image-set-ifdo-
-00007650: 7665 7273 696f 6e27 2066 6965 6c64 2079  version' field y
-00007660: 6574 0a20 2020 2020 2020 2074 7279 3a20  et.        try: 
-00007670: 0a20 2020 2020 2020 2020 2020 2072 6561  .            rea
-00007680: 6456 6572 7369 6f6e 203d 2073 656c 662e  dVersion = self.
-00007690: 6669 6e64 546d 7046 6965 6c64 2827 696d  findTmpField('im
-000076a0: 6167 652d 7365 742d 6966 646f 2d76 6572  age-set-ifdo-ver
-000076b0: 7369 6f6e 2729 0a20 2020 2020 2020 2065  sion').        e
-000076c0: 7863 6570 7420 4b65 7945 7272 6f72 3a0a  xcept KeyError:.
-000076d0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-000076e0: 0a20 2020 2020 2020 2069 6e74 5265 6164  .        intRead
-000076f0: 5665 7273 696f 6e20 3d20 696e 7428 7265  Version = int(re
-00007700: 6164 5665 7273 696f 6e2e 7374 7269 7028  adVersion.strip(
-00007710: 292e 7265 706c 6163 6528 272e 272c 2727  ).replace('.',''
-00007720: 292e 7265 706c 6163 6528 2776 272c 2727  ).replace('v',''
-00007730: 292e 7265 706c 6163 6528 2761 272c 2727  ).replace('a',''
-00007740: 2929 0a20 2020 2020 2020 2069 6e74 5468  )).        intTh
-00007750: 6973 5665 7273 696f 6e20 3d20 696e 7428  isVersion = int(
-00007760: 6d69 7174 762e 6946 444f 5f76 6572 7369  miqtv.iFDO_versi
-00007770: 6f6e 2e73 7472 6970 2829 2e72 6570 6c61  on.strip().repla
-00007780: 6365 2827 2e27 2c27 2729 2e72 6570 6c61  ce('.','').repla
-00007790: 6365 2827 7627 2c27 2729 2e72 6570 6c61  ce('v','').repla
-000077a0: 6365 2827 6127 2c27 2729 290a 2020 2020  ce('a','')).    
-000077b0: 2020 2020 6966 2069 6e74 5265 6164 5665      if intReadVe
-000077c0: 7273 696f 6e20 3c20 696e 7454 6869 7356  rsion < intThisV
-000077d0: 6572 7369 6f6e 3a0a 2020 2020 2020 2020  ersion:.        
-000077e0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-000077f0: 6728 224c 6f61 6465 6420 6946 444f 2068  g("Loaded iFDO h
-00007800: 6173 2076 6572 7369 6f6e 2022 202b 2072  as version " + r
-00007810: 6561 6456 6572 7369 6f6e 202b 2022 2061  eadVersion + " a
-00007820: 6e64 2077 696c 6c20 6265 2075 7064 6174  nd will be updat
-00007830: 6564 2074 6f20 7665 7273 696f 6e20 2220  ed to version " 
-00007840: 2b20 6d69 7174 762e 6946 444f 5f76 6572  + miqtv.iFDO_ver
-00007850: 7369 6f6e 290a 2020 2020 2020 2020 6966  sion).        if
-00007860: 2069 6e74 5265 6164 5665 7273 696f 6e20   intReadVersion 
-00007870: 3e20 696e 7454 6869 7356 6572 7369 6f6e  > intThisVersion
-00007880: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00007890: 6c66 2e70 726f 762e 6c6f 6728 2243 4155  lf.prov.log("CAU
-000078a0: 5449 4f4e 3a20 4c6f 6164 6564 2069 4644  TION: Loaded iFD
-000078b0: 4f20 6861 7320 7665 7273 696f 6e20 2220  O has version " 
-000078c0: 2b20 7265 6164 5665 7273 696f 6e20 2b20  + readVersion + 
-000078d0: 2220 6973 2061 6865 6164 206f 6620 7665  " is ahead of ve
-000078e0: 7273 696f 6e20 7573 6564 2068 6572 653a  rsion used here:
-000078f0: 2022 202b 206d 6971 7476 2e69 4644 4f5f   " + miqtv.iFDO_
-00007900: 7665 7273 696f 6e29 0a0a 2020 2020 2020  version)..      
-00007910: 2020 2320 666f 7220 736f 6f6f 6f6f 6d65    # for sooooome
-00007920: 2072 6561 736f 6e20 7468 6973 2066 6978   reason this fix
-00007930: 6573 2061 2068 6963 6b75 7020 6f66 2074  es a hickup of t
-00007940: 6865 2070 726f 6720 696e 2063 7265 6174  he prog in creat
-00007950: 6569 4644 4f28 290a 2020 2020 2020 2020  eiFDO().        
-00007960: 7072 6f67 203d 206d 6971 7463 2e50 7269  prog = miqtc.Pri
-00007970: 6e74 4b6e 6f77 6e50 726f 6772 6573 734d  ntKnownProgressM
-00007980: 7367 2822 666f 6f22 2c20 312c 6d6f 6475  sg("foo", 1,modu
-00007990: 6c6f 3d31 290a 2020 2020 2020 2020 7072  lo=1).        pr
-000079a0: 6f67 2e63 6c65 6172 2829 0a20 2020 2020  og.clear().     
-000079b0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-000079c0: 2020 2020 7365 6c66 2e63 6f6e 7665 7274      self.convert
-000079d0: 546f 4465 6661 756c 7444 6174 6554 696d  ToDefaultDateTim
-000079e0: 6546 6f72 6d61 7428 7365 6c66 2e69 6664  eFormat(self.ifd
-000079f0: 6f5f 746d 7029 0a20 2020 2020 2020 2065  o_tmp).        e
-00007a00: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
-00007a10: 6173 2065 783a 0a20 2020 2020 2020 2020  as ex:.         
-00007a20: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-00007a30: 2822 4368 6563 6b69 6e67 2064 6174 6574  ("Checking datet
-00007a40: 696d 6520 666f 726d 6174 3a20 2220 2b20  ime format: " + 
-00007a50: 7374 7228 6578 2929 0a0a 2020 2020 2020  str(ex))..      
-00007a60: 2020 2320 666f 7220 736f 6f6f 6f6f 6d65    # for sooooome
-00007a70: 2072 6561 736f 6e20 7468 6973 2066 6978   reason this fix
-00007a80: 6573 2061 2068 6963 6b75 7020 6f66 2074  es a hickup of t
-00007a90: 6865 2070 726f 6720 696e 2063 7265 6174  he prog in creat
-00007aa0: 6569 4644 4f28 290a 2020 2020 2020 2020  eiFDO().        
-00007ab0: 7072 6f67 203d 206d 6971 7463 2e50 7269  prog = miqtc.Pri
-00007ac0: 6e74 4b6e 6f77 6e50 726f 6772 6573 734d  ntKnownProgressM
-00007ad0: 7367 2822 666f 6f22 2c20 312c 6d6f 6475  sg("foo", 1,modu
-00007ae0: 6c6f 3d31 290a 2020 2020 2020 2020 7072  lo=1).        pr
-00007af0: 6f67 2e63 6c65 6172 2829 0a20 2020 2020  og.clear().     
-00007b00: 2020 2023 2063 6865 636b 2072 6561 6420     # check read 
-00007b10: 6946 444f 2066 696c 650a 2020 2020 2020  iFDO file.      
-00007b20: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00007b30: 2020 2073 656c 662e 6372 6561 7465 6946     self.createiF
-00007b40: 444f 2873 656c 662e 6966 646f 5f74 6d70  DO(self.ifdo_tmp
-00007b50: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-00007b60: 6164 6572 4b65 795d 2c20 6d69 7174 692e  aderKey], miqti.
-00007b70: 6372 6561 7465 496d 6167 6549 7465 6d73  createImageItems
-00007b80: 4c69 7374 4672 6f6d 496d 6167 6549 7465  ListFromImageIte
-00007b90: 6d73 4469 6374 2873 656c 662e 6966 646f  msDict(self.ifdo
-00007ba0: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
-00007bb0: 6574 4974 656d 734b 6579 5d29 290a 2020  etItemsKey])).  
-00007bc0: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-00007bd0: 6570 7469 6f6e 2061 7320 6578 3a0a 2020  eption as ex:.  
-00007be0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-00007bf0: 726f 762e 6c6f 6728 224c 6f61 6465 6420  rov.log("Loaded 
-00007c00: 6946 444f 2066 696c 6520 6e6f 7420 7661  iFDO file not va
-00007c10: 6c69 6420 7965 743a 2022 202b 2073 7472  lid yet: " + str
-00007c20: 2865 7829 290a 0a20 2020 2020 2020 2072  (ex))..        r
-00007c30: 6574 7572 6e20 5472 7565 0a0a 0a20 2020  eturn True...   
-00007c40: 2064 6566 2077 7269 7465 6946 444f 6669   def writeiFDOfi
-00007c50: 6c65 2873 656c 6629 3a0a 2020 2020 2020  le(self):.      
-00007c60: 2020 2222 2220 5772 6974 6573 2061 6e20    """ Writes an 
-00007c70: 6946 444f 2066 696c 6520 746f 2064 6973  iFDO file to dis
-00007c80: 6b2e 204f 7665 7277 7269 7465 7320 706f  k. Overwrites po
-00007c90: 7465 6e74 6961 6c6c 7920 6578 6973 7469  tentially existi
-00007ca0: 6e67 2066 696c 652e 2222 220a 0a20 2020  ng file."""..   
-00007cb0: 2020 2020 2073 203d 206d 6971 7463 2e50       s = miqtc.P
-00007cc0: 7269 6e74 4c6f 6164 696e 674d 7367 2822  rintLoadingMsg("
-00007cd0: 5772 6974 696e 6720 6946 444f 2066 696c  Writing iFDO fil
-00007ce0: 6522 290a 0a20 2020 2020 2020 2023 2063  e")..        # c
-00007cf0: 6865 636b 2066 6965 6c64 7320 6167 6169  heck fields agai
-00007d00: 6e20 6966 2063 6861 6e67 6564 2073 696e  n if changed sin
-00007d10: 6365 206c 6173 7420 6368 6563 6b20 2863  ce last check (c
-00007d20: 7265 6174 6569 4644 4f29 0a20 2020 2020  reateiFDO).     
-00007d30: 2020 2069 6620 7365 6c66 2e69 6664 6f5f     if self.ifdo_
-00007d40: 746d 7020 213d 2073 656c 662e 6966 646f  tmp != self.ifdo
-00007d50: 5f63 6865 636b 6564 3a0a 2020 2020 2020  _checked:.      
-00007d60: 2020 2020 2020 7365 6c66 2e63 7265 6174        self.creat
-00007d70: 6569 4644 4f28 7365 6c66 2e69 6664 6f5f  eiFDO(self.ifdo_
-00007d80: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
-00007d90: 7448 6561 6465 724b 6579 5d2c 206d 6971  tHeaderKey], miq
-00007da0: 7469 2e63 7265 6174 6549 6d61 6765 4974  ti.createImageIt
-00007db0: 656d 734c 6973 7446 726f 6d49 6d61 6765  emsListFromImage
-00007dc0: 4974 656d 7344 6963 7428 7365 6c66 2e69  ItemsDict(self.i
-00007dd0: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
-00007de0: 6765 5365 7449 7465 6d73 4b65 795d 2929  geSetItemsKey]))
-00007df0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00007e00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007e10: 6c6f 674d 6973 7369 6e67 4669 656c 6473  logMissingFields
-00007e20: 2829 2023 2069 7320 616c 736f 2064 6f6e  () # is also don
-00007e30: 6520 696e 2063 7265 6174 6569 4644 4f0a  e in createiFDO.
-00007e40: 2020 2020 2020 2020 6946 444f 5f70 6174          iFDO_pat
-00007e50: 6820 3d20 7365 6c66 2e67 6574 6946 444f  h = self.getiFDO
-00007e60: 4669 6c65 4e61 6d65 286f 7665 7277 7269  FileName(overwri
-00007e70: 7465 3d54 7275 6529 0a0a 2020 2020 2020  te=True)..      
-00007e80: 2020 6f20 3d20 6f70 656e 2869 4644 4f5f    o = open(iFDO_
-00007e90: 7061 7468 2c20 2277 2229 0a20 2020 2020  path, "w").     
-00007ea0: 2020 2079 616d 6c2e 6475 6d70 2873 656c     yaml.dump(sel
-00007eb0: 662e 6966 646f 5f63 6865 636b 6564 2c20  f.ifdo_checked, 
-00007ec0: 6f2c 2064 6566 6175 6c74 5f73 7479 6c65  o, default_style
-00007ed0: 3d4e 6f6e 652c 2064 6566 6175 6c74 5f66  =None, default_f
-00007ee0: 6c6f 775f 7374 796c 653d 4e6f 6e65 2c20  low_style=None, 
-00007ef0: 616c 6c6f 775f 756e 6963 6f64 653d 5472  allow_unicode=Tr
-00007f00: 7565 2c20 7769 6474 683d 666c 6f61 7428  ue, width=float(
-00007f10: 2269 6e66 2229 290a 2020 2020 2020 2020  "inf")).        
-00007f20: 6f2e 636c 6f73 6528 290a 0a20 2020 2020  o.close()..     
-00007f30: 2020 2022 2222 0a20 2020 2020 2020 2023     """.        #
-00007f40: 2066 6f72 2069 4644 4f20 7665 7273 696f   for iFDO versio
-00007f50: 6e20 3e20 322e 300a 2020 2020 2020 2020  n > 2.0.        
-00007f60: 2320 7075 7473 2065 7665 7279 7468 696e  # puts everythin
-00007f70: 6720 696e 206f 6e65 206c 696e 650a 2020  g in one line.  
-00007f80: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
-00007f90: 6946 444f 5f70 6174 682e 7265 706c 6163  iFDO_path.replac
-00007fa0: 6528 2279 616d 6c22 2c22 6a73 6f6e 2229  e("yaml","json")
-00007fb0: 2c20 2777 2729 2061 7320 6670 3a0a 2020  , 'w') as fp:.  
-00007fc0: 2020 2020 2020 2020 2020 6a73 6f6e 2e64            json.d
-00007fd0: 756d 7028 7365 6c66 2e69 6664 6f5f 6368  ump(self.ifdo_ch
-00007fe0: 6563 6b65 642c 2066 7029 0a0a 2020 2020  ecked, fp)..    
-00007ff0: 2020 2020 2320 636f 6e76 6572 7420 6469      # convert di
-00008000: 6374 696f 6e61 7279 2074 6f20 4a53 4f4e  ctionary to JSON
-00008010: 2073 7472 696e 670a 2020 2020 2020 2020   string.        
-00008020: 6a73 6f6e 5f64 6174 6120 3d20 6a73 6f6e  json_data = json
-00008030: 2e64 756d 7073 2873 656c 662e 6966 646f  .dumps(self.ifdo
-00008040: 5f63 6865 636b 6564 2c20 696e 6465 6e74  _checked, indent
-00008050: 203d 2034 290a 0a20 2020 2020 2020 2023   = 4)..        #
-00008060: 2077 7269 7465 2074 6865 204a 534f 4e20   write the JSON 
-00008070: 7374 7269 6e67 2074 6f20 6120 6669 6c65  string to a file
-00008080: 0a20 2020 2020 2020 2077 6974 6820 6f70  .        with op
-00008090: 656e 2869 4644 4f5f 7061 7468 2e72 6570  en(iFDO_path.rep
-000080a0: 6c61 6365 2822 7961 6d6c 222c 226a 736f  lace("yaml","jso
-000080b0: 6e22 292c 2027 7727 2920 6173 2066 3a0a  n"), 'w') as f:.
-000080c0: 2020 2020 2020 2020 2020 2020 662e 7772              f.wr
-000080d0: 6974 6528 6a73 6f6e 5f64 6174 6129 0a20  ite(json_data). 
-000080e0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-000080f0: 2020 2020 2320 6c6f 6720 6368 616e 6765      # log change
-00008100: 730a 2020 2020 2020 2020 6966 206e 6f74  s.        if not
-00008110: 2073 656c 662e 6966 646f 5f70 6172 7365   self.ifdo_parse
-00008120: 6420 6973 204e 6f6e 653a 0a20 2020 2020  d is None:.     
-00008130: 2020 2020 2020 2069 6664 6f5f 7570 6461         ifdo_upda
-00008140: 7465 203d 2044 6565 7044 6966 6628 7365  te = DeepDiff(se
-00008150: 6c66 2e69 6664 6f5f 7061 7273 6564 2c73  lf.ifdo_parsed,s
-00008160: 656c 662e 6966 646f 5f63 6865 636b 6564  elf.ifdo_checked
-00008170: 290a 2020 2020 2020 2020 2020 2020 2370  ).            #p
-00008180: 7072 696e 7428 6966 646f 5f75 7064 6174  print(ifdo_updat
-00008190: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
-000081a0: 6620 6966 646f 5f75 7064 6174 6520 213d  f ifdo_update !=
-000081b0: 207b 7d3a 0a20 2020 2020 2020 2020 2020   {}:.           
-000081c0: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-000081d0: 6f67 2822 6946 444f 2075 7064 6174 6564  og("iFDO updated
-000081e0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-000081f0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-00008200: 2873 7472 2869 6664 6f5f 7570 6461 7465  (str(ifdo_update
-00008210: 292c 646f 6e74 5368 6f77 3d54 7275 6529  ),dontShow=True)
-00008220: 0a20 2020 2020 2020 2073 656c 662e 7072  .        self.pr
-00008230: 6f76 2e6c 6f67 2822 5772 6f74 6520 6946  ov.log("Wrote iF
-00008240: 444f 2074 6f20 6669 6c65 2022 202b 2069  DO to file " + i
-00008250: 4644 4f5f 7061 7468 290a 2020 2020 2020  FDO_path).      
-00008260: 2020 7365 6c66 2e70 726f 762e 7772 6974    self.prov.writ
-00008270: 6528 7365 6c66 2e64 6972 2e74 6f28 7365  e(self.dir.to(se
-00008280: 6c66 2e64 6972 2e64 742e 7072 6f74 6f63  lf.dir.dt.protoc
-00008290: 6f6c 2929 0a20 2020 2020 2020 2073 2e73  ol)).        s.s
-000082a0: 746f 7028 290a 0a0a 2020 2020 6465 6620  top()...    def 
-000082b0: 7365 7469 4644 4f46 696c 654e 616d 6528  setiFDOFileName(
-000082c0: 7365 6c66 2c69 4644 4f66 696c 653a 7374  self,iFDOfile:st
-000082d0: 7229 3a0a 2020 2020 2020 2020 2222 2220  r):.        """ 
-000082e0: 5365 7420 7468 6520 6375 7272 656e 7420  Set the current 
-000082f0: 6946 444f 2066 696c 6520 6e61 6d65 2077  iFDO file name w
-00008300: 6974 6820 7061 7468 2e20 5365 7420 746f  ith path. Set to
-00008310: 2022 2220 696e 206f 7264 6572 2074 6f20   "" in order to 
-00008320: 6765 7420 6465 6661 756c 7420 6e61 6d65  get default name
-00008330: 2061 6e64 206c 6f63 6174 696f 6e2e 2022   and location. "
-00008340: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
-00008350: 6946 444f 6669 6c65 5f20 3d20 6946 444f  iFDOfile_ = iFDO
-00008360: 6669 6c65 0a20 2020 2020 2020 2073 656c  file.        sel
-00008370: 662e 6946 444f 6669 6c65 5f20 3d20 7365  f.iFDOfile_ = se
-00008380: 6c66 2e67 6574 6946 444f 4669 6c65 4e61  lf.getiFDOFileNa
-00008390: 6d65 2829 2023 2063 6f6e 7374 7275 6374  me() # construct
-000083a0: 2064 6566 6175 6c74 206e 616d 6520 6966   default name if
-000083b0: 2065 6d70 7479 0a20 2020 2020 2020 2069   empty.        i
-000083c0: 6620 6d69 7174 632e 6173 7365 7274 536c  f miqtc.assertSl
-000083d0: 6173 6828 6f73 2e70 6174 682e 6469 726e  ash(os.path.dirn
-000083e0: 616d 6528 7365 6c66 2e69 4644 4f66 696c  ame(self.iFDOfil
-000083f0: 655f 2929 2021 3d20 6d69 7174 632e 6173  e_)) != miqtc.as
-00008400: 7365 7274 536c 6173 6828 7365 6c66 2e64  sertSlash(self.d
-00008410: 6972 2e74 6f28 7365 6c66 2e64 6972 2e64  ir.to(self.dir.d
-00008420: 742e 7072 6f64 7563 7473 2929 3a0a 2020  t.products)):.  
-00008430: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-00008440: 726f 762e 6c6f 6728 2243 6175 7469 6f6e  rov.log("Caution
-00008450: 2120 6946 444f 2066 696c 6520 7061 7468  ! iFDO file path
-00008460: 2069 7320 6e6f 7420 696e 2027 7072 6f64   is not in 'prod
-00008470: 7563 7473 2720 7375 6220 666f 6c64 6572  ucts' sub folder
-00008480: 2061 7320 7265 636f 6d6d 656e 6465 642e   as recommended.
-00008490: 2043 6f6e 7369 6465 7220 7265 7365 7474   Consider resett
-000084a0: 696e 6720 7769 7468 2073 6574 6946 444f  ing with setiFDO
-000084b0: 4669 6c65 4e61 6d65 2829 2e20 2220 2b20  FileName(). " + 
-000084c0: 6946 444f 6669 6c65 290a 2020 2020 2020  iFDOfile).      
-000084d0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-000084e0: 2020 2065 7665 6e74 203d 2073 656c 662e     event = self.
-000084f0: 6669 6e64 546d 7046 6965 6c64 2827 696d  findTmpField('im
-00008500: 6167 652d 6576 656e 7427 290a 2020 2020  age-event').    
-00008510: 2020 2020 2020 2020 7365 6e73 6f72 203d          sensor =
-00008520: 2073 656c 662e 6669 6e64 546d 7046 6965   self.findTmpFie
-00008530: 6c64 2827 696d 6167 652d 7365 6e73 6f72  ld('image-sensor
-00008540: 2729 0a20 2020 2020 2020 2065 7863 6570  ').        excep
-00008550: 7420 6d69 7174 632e 4966 646f 4578 6365  t miqtc.IfdoExce
-00008560: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
-00008570: 2020 2065 7665 6e74 203d 2073 656c 662e     event = self.
-00008580: 6469 722e 6576 656e 7428 290a 2020 2020  dir.event().    
-00008590: 2020 2020 2020 2020 7365 6e73 6f72 203d          sensor =
-000085a0: 2073 656c 662e 6469 722e 7365 6e73 6f72   self.dir.sensor
-000085b0: 2829 0a0a 2020 2020 2020 2020 6946 444f  ()..        iFDO
-000085c0: 6669 6c65 4e61 6d65 203d 206f 732e 7061  fileName = os.pa
-000085d0: 7468 2e62 6173 656e 616d 6528 7365 6c66  th.basename(self
-000085e0: 2e69 4644 4f66 696c 655f 290a 2020 2020  .iFDOfile_).    
-000085f0: 2020 2020 6966 206e 6f74 2065 7665 6e74      if not event
-00008600: 2069 6e20 6946 444f 6669 6c65 4e61 6d65   in iFDOfileName
-00008610: 206f 7220 6e6f 7420 7365 6e73 6f72 2069   or not sensor i
-00008620: 6e20 6946 444f 6669 6c65 4e61 6d65 3a0a  n iFDOfileName:.
-00008630: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00008640: 2e70 726f 762e 6c6f 6728 2243 6175 7469  .prov.log("Cauti
-00008650: 6f6e 2120 6946 444f 2066 696c 6520 6e61  on! iFDO file na
-00008660: 6d65 2064 6f65 7320 6e6f 7420 636f 6e74  me does not cont
-00008670: 6169 6e20 7072 6f6a 6563 742c 2065 7665  ain project, eve
-00008680: 6e74 2061 6e64 2073 656e 736f 7220 6e61  nt and sensor na
-00008690: 6d65 2061 7320 7265 636f 6d6d 656e 6465  me as recommende
-000086a0: 642e 2043 6f6e 7369 6465 7220 7265 7365  d. Consider rese
-000086b0: 7474 696e 6720 7769 7468 2073 6574 6946  tting with setiF
-000086c0: 444f 4669 6c65 4e61 6d65 2829 2e20 2220  DOFileName(). " 
-000086d0: 2b20 6946 444f 6669 6c65 290a 0a0a 2020  + iFDOfile)...  
-000086e0: 2020 6465 6620 6765 7469 4644 4f46 696c    def getiFDOFil
-000086f0: 654e 616d 6528 7365 6c66 2c6f 7665 7277  eName(self,overw
-00008700: 7269 7465 3d46 616c 7365 293a 0a20 2020  rite=False):.   
-00008710: 2020 2020 2022 2222 2052 6574 7572 6e73       """ Returns
-00008720: 2074 6865 2063 7572 7265 6e74 2069 4644   the current iFD
-00008730: 4f20 6669 6c65 2773 206e 616d 6520 7769  O file's name wi
-00008740: 7468 2070 6174 682e 2049 6620 6e6f 7420  th path. If not 
-00008750: 7365 7420 7965 7420 6f72 206f 7665 7277  set yet or overw
-00008760: 7269 7465 3d3d 5472 7565 2069 7420 7265  rite==True it re
-00008770: 7475 726e 7320 7468 6520 6f6e 6520 6d61  turns the one ma
-00008780: 7463 6869 6e67 2069 6d61 6765 2d73 6574  tching image-set
-00008790: 2d6e 616d 652e 2022 2222 0a20 2020 2020  -name. """.     
-000087a0: 2020 2069 6620 7365 6c66 2e69 4644 4f66     if self.iFDOf
-000087b0: 696c 655f 203d 3d20 2222 206f 7220 6f76  ile_ == "" or ov
-000087c0: 6572 7772 6974 653a 0a20 2020 2020 2020  erwrite:.       
-000087d0: 2020 2020 2073 656c 662e 6946 444f 6669       self.iFDOfi
-000087e0: 6c65 5f20 3d20 6f73 2e70 6174 682e 6a6f  le_ = os.path.jo
-000087f0: 696e 2873 656c 662e 6469 722e 746f 2873  in(self.dir.to(s
-00008800: 656c 662e 6469 722e 6474 2e70 726f 6475  elf.dir.dt.produ
-00008810: 6374 7329 2c20 7365 6c66 2e66 696e 6454  cts), self.findT
-00008820: 6d70 4669 656c 6428 2769 6d61 6765 2d73  mpField('image-s
-00008830: 6574 2d6e 616d 6527 2920 2b20 275f 6946  et-name') + '_iF
-00008840: 444f 2e79 616d 6c27 290a 2020 2020 2020  DO.yaml').      
-00008850: 2020 7265 7475 726e 2073 656c 662e 6946    return self.iF
-00008860: 444f 6669 6c65 5f0a 0a0a 2020 2020 4073  DOfile_...    @s
-00008870: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
-00008880: 6465 6620 636f 6e73 7472 7563 7449 6d61  def constructIma
-00008890: 6765 5365 744e 616d 6528 7072 6f6a 6563  geSetName(projec
-000088a0: 743a 7374 722c 6576 656e 743a 7374 722c  t:str,event:str,
-000088b0: 7365 6e73 6f72 3a73 7472 293a 0a20 2020  sensor:str):.   
-000088c0: 2020 2020 2022 2222 2072 6574 7572 6e73       """ returns
-000088d0: 203c 7072 6f6a 6563 743e 5f3c 6576 656e   <project>_<even
-000088e0: 743e 5f3c 7365 6e73 6f72 3e2c 2077 6974  t>_<sensor>, wit
-000088f0: 6820 7368 6f72 7420 7665 7273 696f 6e20  h short version 
-00008900: 6f66 203c 7365 6e73 6f72 3e20 286f 6e6c  of <sensor> (onl
-00008910: 7920 6964 292c 2070 7265 7665 6e74 696e  y id), preventin
-00008920: 6720 706f 7465 6e74 6961 6c20 646f 7562  g potential doub
-00008930: 6c69 6e67 206f 6620 3c70 726f 6a65 6374  ling of <project
-00008940: 3e20 2022 2222 0a20 2020 2020 2020 2073  >  """.        s
-00008950: 656e 736f 725f 7368 6f72 7420 3d20 6946  ensor_short = iF
-00008960: 444f 2e67 6574 5368 6f72 7445 7175 6970  DO.getShortEquip
-00008970: 6d65 6e74 4944 2873 656e 736f 7229 0a20  mentID(sensor). 
-00008980: 2020 2020 2020 2069 6620 6c65 6e28 6576         if len(ev
-00008990: 656e 7429 203e 206c 656e 2870 726f 6a65  ent) > len(proje
-000089a0: 6374 2920 616e 6420 6576 656e 745b 303a  ct) and event[0:
-000089b0: 6c65 6e28 7072 6f6a 6563 7429 5d20 3d3d  len(project)] ==
-000089c0: 2070 726f 6a65 6374 3a0a 2020 2020 2020   project:.      
-000089d0: 2020 2020 2020 696d 6167 655f 7365 745f        image_set_
-000089e0: 6e61 6d65 5f20 3d20 6576 656e 7420 2b20  name_ = event + 
-000089f0: 225f 2220 2b20 7365 6e73 6f72 5f73 686f  "_" + sensor_sho
-00008a00: 7274 0a20 2020 2020 2020 2065 6c73 653a  rt.        else:
-00008a10: 0a20 2020 2020 2020 2020 2020 2069 6d61  .            ima
-00008a20: 6765 5f73 6574 5f6e 616d 655f 203d 2070  ge_set_name_ = p
-00008a30: 726f 6a65 6374 202b 2022 5f22 202b 2065  roject + "_" + e
-00008a40: 7665 6e74 202b 2022 5f22 202b 2073 656e  vent + "_" + sen
-00008a50: 736f 725f 7368 6f72 740a 2020 2020 2020  sor_short.      
-00008a60: 2020 7265 7475 726e 2069 6d61 6765 5f73    return image_s
-00008a70: 6574 5f6e 616d 655f 2023 2054 4f44 4f20  et_name_ # TODO 
-00008a80: 696e 636c 7564 6520 6461 7461 5479 7065  include dataType
-00008a90: 3f0a 0a0a 2020 2020 4073 7461 7469 636d  ?...    @staticm
-00008aa0: 6574 686f 640a 2020 2020 6465 6620 6765  ethod.    def ge
-00008ab0: 7453 686f 7274 4571 7569 706d 656e 7449  tShortEquipmentI
-00008ac0: 4428 6571 7569 706d 656e 7449 443a 7374  D(equipmentID:st
-00008ad0: 7229 3a0a 2020 2020 2020 2020 2222 2220  r):.        """ 
-00008ae0: 7265 7475 726e 7320 6571 7569 706d 656e  returns equipmen
-00008af0: 7420 6964 2077 6974 686f 7574 2070 6f74  t id without pot
-00008b00: 656e 7469 616c 6c20 6c6f 6e67 203c 6e61  entiall long <na
-00008b10: 6d65 3e20 7061 7274 2c20 692e 652e 3a20  me> part, i.e.: 
-00008b20: 3c6f 776e 6572 3e5f 3c74 7970 653e 2d3c  <owner>_<type>-<
-00008b30: 7479 7065 2069 6e64 6578 5b5f 3c73 7562  type index[_<sub
-00008b40: 7479 7065 3e5d 2022 2222 0a20 2020 2020  type>] """.     
-00008b50: 2020 2072 6574 7572 6e20 275f 272e 6a6f     return '_'.jo
-00008b60: 696e 2865 7175 6970 6d65 6e74 4944 2e73  in(equipmentID.s
-00008b70: 706c 6974 2827 5f27 295b 303a 335d 290a  plit('_')[0:3]).
-00008b80: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
-00008b90: 6f64 0a20 2020 2064 6566 2063 6f6e 7374  od.    def const
-00008ba0: 7275 6374 6946 444f 6669 6c65 4e61 6d65  ructiFDOfileName
-00008bb0: 2870 726f 6a65 6374 3a73 7472 2c65 7665  (project:str,eve
-00008bc0: 6e74 3a73 7472 2c73 656e 736f 723a 7374  nt:str,sensor:st
-00008bd0: 7229 3a0a 2020 2020 2020 2020 2222 2220  r):.        """ 
-00008be0: 7265 7475 726e 7320 3c63 6f6e 7374 7275  returns <constru
-00008bf0: 6374 496d 6167 6553 6574 4e61 6d65 2829  ctImageSetName()
-00008c00: 3e5f 6946 444f 2e79 616d 6c20 2222 220a  >_iFDO.yaml """.
-00008c10: 2020 2020 2020 2020 7265 7475 726e 2069          return i
-00008c20: 4644 4f2e 636f 6e73 7472 7563 7449 6d61  FDO.constructIma
-00008c30: 6765 5365 744e 616d 6528 7072 6f6a 6563  geSetName(projec
-00008c40: 742c 6576 656e 742c 7365 6e73 6f72 2920  t,event,sensor) 
-00008c50: 2b20 275f 6946 444f 2e79 616d 6c27 200a  + '_iFDO.yaml' .
-00008c60: 0a20 2020 200a 2020 2020 4073 7461 7469  .    .    @stati
-00008c70: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
-00008c80: 5f5f 6765 7446 6965 6c64 5661 6c75 6528  __getFieldValue(
-00008c90: 6966 646f 3a64 6963 742c 6b65 7973 3a6c  ifdo:dict,keys:l
-00008ca0: 6973 7429 3a0a 2020 2020 2020 2020 2222  ist):.        ""
-00008cb0: 2220 7265 7475 726e 7320 636f 7079 206f  " returns copy o
-00008cc0: 6620 7365 7420 6f72 2069 7465 6d20 6669  f set or item fi
-00008cd0: 656c 6420 7661 6c75 652c 2061 6c73 6f20  eld value, also 
-00008ce0: 636f 6e73 6964 6572 6e67 2064 6566 6175  considerng defau
-00008cf0: 6c74 2076 616c 7565 7320 6672 6f6d 2068  lt values from h
-00008d00: 6561 6465 722e 0a20 2020 2020 2020 2020  eader..         
-00008d10: 2020 2055 7365 206b 6579 7320 6173 2065     Use keys as e
-00008d20: 2e67 2e20 5b3c 6974 656d 3e2c 3c6b 6579  .g. [<item>,<key
-00008d30: 3e2c 2e2e 5d2e 2043 616e 2062 6520 7573  >,..]. Can be us
-00008d40: 6564 2066 6f72 2068 6561 6465 7220 6669  ed for header fi
-00008d50: 656c 6473 2061 7320 7765 6c6c 2061 7320  elds as well as 
-00008d60: 6974 656d 2066 6965 6c64 732e 0a20 2020  item fields..   
-00008d70: 2020 2020 2020 2020 2049 7465 6d20 696e           Item in
-00008d80: 6465 7820 6361 6e20 6265 206c 6567 6c65  dex can be legle
-00008d90: 6374 6564 2c20 696e 2063 6173 6520 6f66  cted, in case of
-00008da0: 2076 6964 656f 2061 2064 6963 7420 7b3c   video a dict {<
-00008db0: 696d 6167 652d 6461 7461 7469 6d65 3e3a  image-datatime>:
-00008dc0: 3c76 616c 7565 3e2c 2e2e 2e7d 2069 7320  <value>,...} is 
-00008dd0: 7265 7475 726e 6564 2e0a 2020 2020 2020  returned..      
-00008de0: 2020 2020 2020 5261 6973 6573 2049 6664        Raises Ifd
-00008df0: 6f45 7863 6570 7469 6f6e 2069 6620 6b65  oException if ke
-00008e00: 7973 2064 6f20 6e6f 7420 6578 6973 742e  ys do not exist.
-00008e10: 2022 2222 0a0a 2020 2020 2020 2020 6966   """..        if
-00008e20: 206e 6f74 206d 6971 7476 2e69 6d61 6765   not miqtv.image
-00008e30: 5f73 6574 5f69 7465 6d73 5f6b 6579 2069  _set_items_key i
-00008e40: 6e20 6966 646f 206f 7220 6e6f 7420 6d69  n ifdo or not mi
-00008e50: 7174 762e 696d 6167 655f 7365 745f 6865  qtv.image_set_he
-00008e60: 6164 6572 5f6b 6579 2069 6e20 6966 646f  ader_key in ifdo
-00008e70: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00008e80: 6973 6520 6d69 7174 632e 4966 646f 4578  ise miqtc.IfdoEx
-00008e90: 6365 7074 696f 6e28 2249 6e76 616c 6964  ception("Invalid
-00008ea0: 2069 6664 6f20 6469 6374 2c20 6d69 7373   ifdo dict, miss
-00008eb0: 696e 6720 6974 656d 7320 6f72 2068 6561  ing items or hea
-00008ec0: 6465 7220 6b65 793a 2022 202b 2073 7472  der key: " + str
-00008ed0: 2869 6664 6f29 290a 2020 2020 2020 2020  (ifdo)).        
-00008ee0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00008ef0: 6973 696e 7374 616e 6365 286b 6579 732c  isinstance(keys,
-00008f00: 6c69 7374 293a 0a20 2020 2020 2020 2020  list):.         
-00008f10: 2020 206b 6579 7320 3d20 5b6b 6579 735d     keys = [keys]
-00008f20: 0a0a 2020 2020 2020 2020 2320 7265 6d6f  ..        # remo
-00008f30: 7665 2068 6561 6465 7220 6f72 2069 7465  ve header or ite
-00008f40: 6d20 7072 6566 6978 6573 2069 6620 7468  m prefixes if th
-00008f50: 6572 650a 2020 2020 2020 2020 6966 206b  ere.        if k
-00008f60: 6579 735b 305d 203d 3d20 6d69 7174 762e  eys[0] == miqtv.
-00008f70: 696d 6167 655f 7365 745f 6974 656d 735f  image_set_items_
-00008f80: 6b65 7920 6f72 206b 6579 735b 305d 203d  key or keys[0] =
-00008f90: 3d20 6d69 7174 762e 696d 6167 655f 7365  = miqtv.image_se
-00008fa0: 745f 6865 6164 6572 5f6b 6579 3a0a 2020  t_header_key:.  
-00008fb0: 2020 2020 2020 2020 2020 6b65 7973 203d            keys =
-00008fc0: 206b 6579 735b 313a 3a5d 0a0a 2020 2020   keys[1::]..    
-00008fd0: 2020 2020 6865 6164 6572 203d 2069 6664      header = ifd
-00008fe0: 6f5b 6d69 7174 762e 696d 6167 655f 7365  o[miqtv.image_se
-00008ff0: 745f 6865 6164 6572 5f6b 6579 5d0a 2020  t_header_key].  
-00009000: 2020 2020 2020 6974 656d 7320 3d20 6966        items = if
-00009010: 646f 5b6d 6971 7476 2e69 6d61 6765 5f73  do[miqtv.image_s
-00009020: 6574 5f69 7465 6d73 5f6b 6579 5d0a 2020  et_items_key].  
-00009030: 2020 2020 2020 2320 6c6f 6f6b 2066 6f72        # look for
-00009040: 2064 6566 6175 6c74 2076 616c 7565 0a20   default value. 
-00009050: 2020 2020 2020 2066 6f72 2073 6b69 7070         for skipp
-00009060: 6564 496e 4865 6164 6572 2069 6e20 7261  edInHeader in ra
-00009070: 6e67 6528 6c65 6e28 6b65 7973 2929 3a0a  nge(len(keys)):.
-00009080: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00009090: 756c 7456 616c 203d 2066 696e 6446 6965  ultVal = findFie
-000090a0: 6c64 2868 6561 6465 722c 6b65 7973 5b73  ld(header,keys[s
-000090b0: 6b69 7070 6564 496e 4865 6164 6572 3a3a  kippedInHeader::
-000090c0: 5d29 0a20 2020 2020 2020 2020 2020 2069  ]).            i
-000090d0: 6620 6465 6661 756c 7456 616c 2021 3d20  f defaultVal != 
-000090e0: 2222 3a0a 2020 2020 2020 2020 2020 2020  "":.            
-000090f0: 2020 2020 6272 6561 6b0a 0a20 2020 2020      break..     
-00009100: 2020 2023 2320 6c6f 6f6b 2066 6f72 2069     ## look for i
-00009110: 7465 6d20 7661 6c75 650a 2020 2020 2020  tem value.      
-00009120: 2020 2320 6865 6164 6572 206f 6e6c 7920    # header only 
-00009130: 7661 6c75 652c 2064 6f6e 2774 2063 6865  value, don't che
-00009140: 636b 2069 6e20 6974 656d 730a 2020 2020  ck in items.    
-00009150: 2020 2020 6966 2066 696e 6446 6965 6c64      if findField
-00009160: 2869 7465 6d73 2c6b 6579 735b 303a 315d  (items,keys[0:1]
-00009170: 2920 3d3d 2022 2220 616e 6420 736b 6970  ) == "" and skip
-00009180: 7065 6449 6e48 6561 6465 7220 3d3d 2030  pedInHeader == 0
-00009190: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-000091a0: 7420 3d20 6465 6661 756c 7456 616c 0a20  t = defaultVal. 
-000091b0: 2020 2020 2020 2020 2020 2069 6620 7265             if re
-000091c0: 7420 3d3d 2022 223a 0a20 2020 2020 2020  t == "":.       
-000091d0: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
-000091e0: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
-000091f0: 6f6e 2822 6b65 7920 646f 6573 206e 6f74  on("key does not
-00009200: 2065 7869 7374 3a22 202b 2073 7472 286b   exist:" + str(k
-00009210: 6579 7329 290a 2020 2020 2020 2020 656c  eys)).        el
-00009220: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00009230: 2320 6966 2066 6972 7374 206b 6579 206e  # if first key n
-00009240: 6f74 2066 6f75 6e64 2069 6e20 6974 656d  ot found in item
-00009250: 732c 2069 2e65 2e20 6973 206e 6f74 2061  s, i.e. is not a
-00009260: 2069 6d61 6765 206e 616d 652c 2061 6e64   image name, and
-00009270: 2066 6972 7374 206b 6579 2069 7320 6e6f   first key is no
-00009280: 7420 6120 6865 6164 6572 206b 6579 3a0a  t a header key:.
-00009290: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-000092a0: 696e 6446 6965 6c64 2869 7465 6d73 2c6b  indField(items,k
-000092b0: 6579 735b 303a 315d 2920 3d3d 2022 2220  eys[0:1]) == "" 
-000092c0: 616e 6420 736b 6970 7065 6449 6e48 6561  and skippedInHea
-000092d0: 6465 7220 213d 2030 3a0a 2020 2020 2020  der != 0:.      
-000092e0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000092f0: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
-00009300: 696f 6e28 2269 7465 6d20 646f 6573 206e  ion("item does n
-00009310: 6f74 2065 7869 7374 3a22 202b 2073 7472  ot exist:" + str
-00009320: 286b 6579 735b 303a 315d 2929 0a0a 2020  (keys[0:1]))..  
-00009330: 2020 2020 2020 2020 2020 2320 6368 6563            # chec
-00009340: 6b20 6966 2069 6e64 6578 2070 726f 7669  k if index provi
-00009350: 6465 640a 2020 2020 2020 2020 2020 2020  ded.            
-00009360: 696e 6465 7850 726f 7669 6465 6420 3d20  indexProvided = 
-00009370: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00009380: 2069 6620 6c65 6e28 6b65 7973 2920 3e20   if len(keys) > 
-00009390: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
-000093a0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-000093b0: 2020 2020 2020 2020 2020 2020 696e 6465              inde
-000093c0: 7820 3d20 696e 7428 6b65 7973 5b31 5d29  x = int(keys[1])
-000093d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000093e0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-000093f0: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
-00009400: 2020 2020 2020 2069 6e64 6578 5072 6f76         indexProv
-00009410: 6964 6564 203d 2046 616c 7365 0a20 2020  ided = False.   
-00009420: 2020 2020 2020 2020 2065 6c69 6620 6c65           elif le
-00009430: 6e28 6b65 7973 2920 3d3d 2031 3a0a 2020  n(keys) == 1:.  
-00009440: 2020 2020 2020 2020 2020 2020 2020 696e                in
-00009450: 6465 7850 726f 7669 6465 6420 3d20 4661  dexProvided = Fa
-00009460: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00009470: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-00009480: 2069 6d61 6765 4974 656d 5469 6d65 506f   imageItemTimePo
-00009490: 696e 7473 203d 2069 7465 6d73 5b6b 6579  ints = items[key
-000094a0: 735b 305d 5d0a 0a20 2020 2020 2020 2020  s[0]]..         
-000094b0: 2020 2069 6620 696e 6465 7850 726f 7669     if indexProvi
-000094c0: 6465 643a 0a20 2020 2020 2020 2020 2020  ded:.           
-000094d0: 2020 2020 2023 2069 6620 6b65 7920 6973       # if key is
-000094e0: 2077 686f 6c65 2069 6d61 6765 2061 6464   whole image add
-000094f0: 2061 6c6c 2076 616c 7565 7320 6672 6f6d   all values from
-00009500: 2068 6561 6465 720a 2020 2020 2020 2020   header.        
-00009510: 2020 2020 2020 2020 6966 206c 656e 286b          if len(k
-00009520: 6579 7329 203d 3d20 323a 0a20 2020 2020  eys) == 2:.     
-00009530: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00009540: 6566 6175 6c74 5661 6c20 3d20 6865 6164  efaultVal = head
-00009550: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
-00009560: 2020 2023 2061 6464 2064 6566 6175 6c74     # add default
-00009570: 2066 726f 6d20 696e 6465 7820 300a 2020   from index 0.  
-00009580: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00009590: 206c 656e 286b 6579 7329 203e 2031 2061   len(keys) > 1 a
-000095a0: 6e64 2069 6e64 6578 2021 3d20 303a 0a20  nd index != 0:. 
-000095b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000095c0: 2020 206b 6579 735f 3020 3d20 636f 7079     keys_0 = copy
-000095d0: 2e64 6565 7063 6f70 7928 6b65 7973 290a  .deepcopy(keys).
-000095e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000095f0: 2020 2020 6b65 7973 5f30 5b31 5d20 3d20      keys_0[1] = 
-00009600: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
-00009610: 2020 2020 2020 7265 745f 3020 3d20 6946        ret_0 = iF
-00009620: 444f 2e5f 5f67 6574 4974 656d 5661 6c75  DO.__getItemValu
-00009630: 6528 6974 656d 732c 6b65 7973 5f30 2c73  e(items,keys_0,s
-00009640: 6b69 7070 6564 496e 4865 6164 6572 2c64  kippedInHeader,d
-00009650: 6566 6175 6c74 5661 6c29 0a20 2020 2020  efaultVal).     
-00009660: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00009670: 6620 6973 696e 7374 616e 6365 2872 6574  f isinstance(ret
-00009680: 5f30 2c64 6963 7429 3a0a 2020 2020 2020  _0,dict):.      
-00009690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000096a0: 2020 6465 6661 756c 7456 616c 203d 207b    defaultVal = {
-000096b0: 2a2a 6465 6661 756c 7456 616c 2c2a 2a72  **defaultVal,**r
-000096c0: 6574 5f30 7d0a 2020 2020 2020 2020 2020  et_0}.          
-000096d0: 2020 2020 2020 7265 7420 3d20 6946 444f        ret = iFDO
-000096e0: 2e5f 5f67 6574 4974 656d 5661 6c75 6528  .__getItemValue(
-000096f0: 6974 656d 732c 6b65 7973 2c73 6b69 7070  items,keys,skipp
-00009700: 6564 496e 4865 6164 6572 2c64 6566 6175  edInHeader,defau
-00009710: 6c74 5661 6c29 0a20 2020 2020 2020 2020  ltVal).         
-00009720: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-00009730: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00009740: 2020 2020 2020 2320 6966 206b 6579 2069        # if key i
-00009750: 7320 7768 6f6c 6520 696d 6167 6520 6164  s whole image ad
-00009760: 6420 616c 6c20 7661 6c75 6573 2066 726f  d all values fro
-00009770: 6d20 6865 6164 6572 0a20 2020 2020 2020  m header.       
-00009780: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-00009790: 6b65 7973 2920 3d3d 2031 3a0a 2020 2020  keys) == 1:.    
-000097a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000097b0: 6465 6661 756c 7456 616c 203d 2068 6561  defaultVal = hea
-000097c0: 6465 720a 0a20 2020 2020 2020 2020 2020  der..           
-000097d0: 2020 2020 2023 2070 6963 7475 7265 202d       # picture -
-000097e0: 3e20 6a75 7374 206f 6e65 2065 6e74 7279  > just one entry
-000097f0: 2c20 696e 7365 7274 2069 6e64 6578 2030  , insert index 0
-00009800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009810: 2069 6620 6c65 6e28 696d 6167 6549 7465   if len(imageIte
-00009820: 6d54 696d 6550 6f69 6e74 7329 203d 3d20  mTimePoints) == 
-00009830: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
-00009840: 2020 2020 2020 206b 6579 7320 3d20 6b65         keys = ke
-00009850: 7973 5b30 3a31 5d20 2b20 5b30 5d20 2b20  ys[0:1] + [0] + 
-00009860: 6b65 7973 5b31 3a3a 5d0a 2020 2020 2020  keys[1::].      
-00009870: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00009880: 7420 3d20 6946 444f 2e5f 5f67 6574 4974  t = iFDO.__getIt
-00009890: 656d 5661 6c75 6528 6974 656d 732c 6b65  emValue(items,ke
-000098a0: 7973 2c73 6b69 7070 6564 496e 4865 6164  ys,skippedInHead
-000098b0: 6572 2c64 6566 6175 6c74 5661 6c29 0a20  er,defaultVal). 
-000098c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000098d0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-000098e0: 2020 2020 2320 7669 6465 6f20 2d3e 2072      # video -> r
-000098f0: 6574 7572 6e20 7661 6c75 6573 2066 6f72  eturn values for
-00009900: 2065 6163 6820 7469 6d65 2073 7461 6d70   each time stamp
-00009910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009920: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00009930: 2020 2020 2020 2020 2020 2072 6574 203d             ret =
-00009940: 207b 7d0a 2020 2020 2020 2020 2020 2020   {}.            
-00009950: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-00009960: 2072 616e 6765 286c 656e 2869 6d61 6765   range(len(image
-00009970: 4974 656d 5469 6d65 506f 696e 7473 2929  ItemTimePoints))
-00009980: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009990: 2020 2020 2020 2020 2020 7469 6d65 506f            timePo
-000099a0: 696e 7444 6174 6120 3d20 696d 6167 6549  intData = imageI
-000099b0: 7465 6d54 696d 6550 6f69 6e74 735b 695d  temTimePoints[i]
-000099c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000099d0: 2020 2020 2020 2020 206b 6579 735f 6920           keys_i 
-000099e0: 3d20 6b65 7973 5b30 3a31 5d20 2b20 5b69  = keys[0:1] + [i
-000099f0: 5d20 2b20 6b65 7973 5b31 3a3a 5d0a 2020  ] + keys[1::].  
-00009a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009a10: 2020 2020 2020 7265 745b 7469 6d65 506f        ret[timePo
-00009a20: 696e 7444 6174 615b 2769 6d61 6765 2d64  intData['image-d
-00009a30: 6174 6574 696d 6527 5d5d 203d 2069 4644  atetime']] = iFD
-00009a40: 4f2e 5f5f 6765 7449 7465 6d56 616c 7565  O.__getItemValue
-00009a50: 2869 7465 6d73 2c6b 6579 735f 692c 736b  (items,keys_i,sk
-00009a60: 6970 7065 6449 6e48 6561 6465 722c 6465  ippedInHeader,de
-00009a70: 6661 756c 7456 616c 290a 2020 2020 2020  faultVal).      
-00009a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009a90: 2020 2320 7265 6d6f 7665 2069 6d61 6765    # remove image
-00009aa0: 2d64 6174 6574 696d 6520 6966 2074 6865  -datetime if the
-00009ab0: 7265 0a20 2020 2020 2020 2020 2020 2020  re.             
-00009ac0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-00009ad0: 696e 7374 616e 6365 2872 6574 5b74 696d  instance(ret[tim
-00009ae0: 6550 6f69 6e74 4461 7461 5b27 696d 6167  ePointData['imag
-00009af0: 652d 6461 7465 7469 6d65 275d 5d2c 6469  e-datetime']],di
-00009b00: 6374 2920 616e 6420 2769 6d61 6765 2d64  ct) and 'image-d
-00009b10: 6174 6574 696d 6527 2069 6e20 7265 745b  atetime' in ret[
-00009b20: 7469 6d65 506f 696e 7444 6174 615b 2769  timePointData['i
-00009b30: 6d61 6765 2d64 6174 6574 696d 6527 5d5d  mage-datetime']]
-00009b40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009b50: 2020 2020 2020 2020 2020 2020 2020 6465                de
-00009b60: 6c20 7265 745b 7469 6d65 506f 696e 7444  l ret[timePointD
-00009b70: 6174 615b 2769 6d61 6765 2d64 6174 6574  ata['image-datet
-00009b80: 696d 6527 5d5d 5b27 696d 6167 652d 6461  ime']]['image-da
-00009b90: 7465 7469 6d65 275d 0a20 2020 2020 2020  tetime'].       
-00009ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009bb0: 2023 2076 6964 656f 2064 6566 6175 6c74   # video default
-00009bc0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00009bd0: 2020 2020 2020 2020 2020 6966 2069 203d            if i =
-00009be0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-00009bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c00: 2069 6620 6973 696e 7374 616e 6365 2872   if isinstance(r
-00009c10: 6574 5b74 696d 6550 6f69 6e74 4461 7461  et[timePointData
-00009c20: 5b27 696d 6167 652d 6461 7465 7469 6d65  ['image-datetime
-00009c30: 275d 5d2c 6469 6374 293a 0a20 2020 2020  ']],dict):.     
-00009c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c50: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00009c60: 6c74 5661 6c20 3d20 7b2a 2a64 6566 6175  ltVal = {**defau
-00009c70: 6c74 5661 6c2c 2a2a 7265 745b 7469 6d65  ltVal,**ret[time
-00009c80: 506f 696e 7444 6174 615b 2769 6d61 6765  PointData['image
-00009c90: 2d64 6174 6574 696d 6527 5d5d 7d0a 2020  -datetime']]}.  
-00009ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009cb0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00009cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ce0: 6465 6661 756c 7456 616c 203d 2072 6574  defaultVal = ret
-00009cf0: 5b74 696d 6550 6f69 6e74 4461 7461 5b27  [timePointData['
-00009d00: 696d 6167 652d 6461 7465 7469 6d65 275d  image-datetime']
-00009d10: 5d0a 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00009d20: 2020 2020 2020 2020 2020 2069 202b 3d20             i += 
-00009d30: 310a 0a20 2020 2020 2020 2069 6620 6973  1..        if is
-00009d40: 696e 7374 616e 6365 2872 6574 2c64 6963  instance(ret,dic
-00009d50: 7429 206f 7220 6973 696e 7374 616e 6365  t) or isinstance
-00009d60: 2872 6574 2c6c 6973 7429 3a0a 2020 2020  (ret,list):.    
-00009d70: 2020 2020 2020 2020 7265 7420 3d20 636f          ret = co
-00009d80: 7079 2e64 6565 7063 6f70 7928 7265 7429  py.deepcopy(ret)
-00009d90: 0a20 2020 2020 2020 2069 6620 7265 7420  .        if ret 
-00009da0: 3d3d 2022 2220 6f72 2072 6574 203d 3d20  == "" or ret == 
-00009db0: 7b7d 3a0a 2020 2020 2020 2020 2020 2020  {}:.            
-00009dc0: 7261 6973 6520 6d69 7174 632e 4966 646f  raise miqtc.Ifdo
-00009dd0: 4578 6365 7074 696f 6e28 226b 6579 7320  Exception("keys 
-00009de0: 646f 206e 6f74 2065 7869 7374 3a22 202b  do not exist:" +
-00009df0: 2073 7472 286b 6579 7329 290a 2020 2020   str(keys)).    
-00009e00: 2020 2020 7265 7475 726e 2072 6574 0a0a      return ret..
-00009e10: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
-00009e20: 6f64 0a20 2020 2064 6566 205f 5f67 6574  od.    def __get
-00009e30: 4974 656d 5661 6c75 6528 6974 656d 732c  ItemValue(items,
-00009e40: 6b65 7973 2c73 6b69 7070 6564 496e 4865  keys,skippedInHe
-00009e50: 6164 6572 2c64 6566 6175 6c74 5661 6c29  ader,defaultVal)
-00009e60: 3a0a 2020 2020 2020 2020 0a20 2020 2020  :.        .     
-00009e70: 2020 2023 2069 6e20 6361 7365 2069 7465     # in case ite
-00009e80: 6d20 6973 206e 6f74 2061 206c 6973 7420  m is not a list 
-00009e90: 2873 686f 756c 6420 6e6f 7420 6265 2070  (should not be p
-00009ea0: 6f73 7369 626c 6529 0a20 2020 2020 2020  ossible).       
-00009eb0: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
-00009ec0: 6365 2869 7465 6d73 5b6b 6579 735b 305d  ce(items[keys[0]
-00009ed0: 5d2c 6c69 7374 293a 0a20 2020 2020 2020  ],list):.       
-00009ee0: 2020 2020 2069 7465 6d73 5b6b 6579 735b       items[keys[
-00009ef0: 305d 5d20 3d20 5b69 7465 6d73 5b6b 6579  0]] = [items[key
-00009f00: 735b 305d 5d5d 0a0a 2020 2020 2020 2020  s[0]]]..        
-00009f10: 6974 656d 5661 6c75 6520 3d20 6669 6e64  itemValue = find
-00009f20: 4669 656c 6428 6974 656d 732c 6b65 7973  Field(items,keys
-00009f30: 290a 0a20 2020 2020 2020 2069 6620 6974  )..        if it
-00009f40: 656d 5661 6c75 6520 3d3d 2022 223a 0a20  emValue == "":. 
-00009f50: 2020 2020 2020 2020 2020 2072 6574 203d             ret =
-00009f60: 2064 6566 6175 6c74 5661 6c0a 2020 2020   defaultVal.    
-00009f70: 2020 2020 2320 696e 2063 6173 6520 6f66      # in case of
-00009f80: 2064 6963 7473 206a 6f69 6e74 2068 6561   dicts joint hea
-00009f90: 6465 7220 616e 6420 6974 656d 2066 6965  der and item fie
-00009fa0: 6c64 730a 2020 2020 2020 2020 656c 6966  lds.        elif
-00009fb0: 2069 7369 6e73 7461 6e63 6528 6974 656d   isinstance(item
-00009fc0: 5661 6c75 652c 6469 6374 2920 616e 6420  Value,dict) and 
-00009fd0: 6465 6661 756c 7456 616c 2021 3d20 2222  defaultVal != ""
-00009fe0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00009ff0: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-0000a000: 6465 6661 756c 7456 616c 2c64 6963 7429  defaultVal,dict)
-0000a010: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000a020: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
-0000a030: 646f 4578 6365 7074 696f 6e28 2249 7465  doException("Ite
-0000a040: 6d20 6669 656c 6420 6973 2064 6963 7420  m field is dict 
-0000a050: 6275 7420 6465 6661 756c 7420 7661 6c75  but default valu
-0000a060: 6520 696e 2068 6561 6465 7220 6973 206e  e in header is n
-0000a070: 6f74 3a20 2220 2b20 7374 7228 6b65 7973  ot: " + str(keys
-0000a080: 2929 0a20 2020 2020 2020 2020 2020 2072  )).            r
-0000a090: 6574 203d 207b 2a2a 6465 6661 756c 7456  et = {**defaultV
-0000a0a0: 616c 2c2a 2a69 7465 6d56 616c 7565 7d0a  al,**itemValue}.
-0000a0b0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000a0c0: 2020 2020 2020 2020 2020 7265 7420 3d20            ret = 
-0000a0d0: 6974 656d 5661 6c75 650a 2020 2020 2020  itemValue.      
-0000a0e0: 2020 7265 7475 726e 2072 6574 0a0a 0a20    return ret... 
-0000a0f0: 2020 2064 6566 205f 5f73 7472 5f5f 2873     def __str__(s
-0000a100: 656c 6629 202d 3e20 7374 723a 0a20 2020  elf) -> str:.   
-0000a110: 2020 2020 2022 2222 2050 7269 6e74 7320       """ Prints 
-0000a120: 6375 7272 656e 7420 6946 444f 2066 696c  current iFDO fil
-0000a130: 6520 2222 220a 2020 2020 2020 2020 7265  e """.        re
-0000a140: 7475 726e 2079 616d 6c2e 6475 6d70 2873  turn yaml.dump(s
-0000a150: 656c 662e 6966 646f 5f63 6865 636b 6564  elf.ifdo_checked
-0000a160: 2c20 6465 6661 756c 745f 7374 796c 653d  , default_style=
-0000a170: 4e6f 6e65 2c20 6465 6661 756c 745f 666c  None, default_fl
-0000a180: 6f77 5f73 7479 6c65 3d4e 6f6e 652c 2061  ow_style=None, a
-0000a190: 6c6c 6f77 5f75 6e69 636f 6465 3d54 7275  llow_unicode=Tru
-0000a1a0: 652c 2077 6964 7468 3d66 6c6f 6174 2822  e, width=float("
-0000a1b0: 696e 6622 2929 0a0a 0a20 2020 2064 6566  inf"))...    def
-0000a1c0: 205f 5f67 6574 6974 656d 5f5f 2873 656c   __getitem__(sel
-0000a1d0: 662c 206b 6579 7329 3a0a 2020 2020 2020  f, keys):.      
-0000a1e0: 2020 2222 2220 5265 7475 726e 7320 636f    """ Returns co
-0000a1f0: 7079 206f 6620 6368 6563 6b65 6420 6966  py of checked if
-0000a200: 646f 2073 6574 206f 7220 6974 656d 2066  do set or item f
-0000a210: 6965 6c64 2076 616c 7565 2c20 616c 736f  ield value, also
-0000a220: 2063 6f6e 7369 6465 726e 6720 6465 6661   considerng defa
-0000a230: 756c 7420 7661 6c75 6573 2066 726f 6d20  ult values from 
-0000a240: 6865 6164 6572 2e0a 2020 2020 2020 2020  header..        
-0000a250: 2020 2020 5573 6520 6b65 7973 2061 7320      Use keys as 
-0000a260: 652e 672e 2027 3c69 7465 6d3e 3a3c 6b65  e.g. '<item>:<ke
-0000a270: 793e 3a2e 2e2e 272e 2043 616e 2062 6520  y>:...'. Can be 
-0000a280: 7573 6564 2066 6f72 2068 6561 6465 7220  used for header 
-0000a290: 6669 656c 6473 2061 7320 7765 6c6c 2061  fields as well a
-0000a2a0: 7320 6974 656d 2066 6965 6c64 732e 0a20  s item fields.. 
-0000a2b0: 2020 2020 2020 2020 2020 2049 7465 6d20             Item 
-0000a2c0: 696e 6465 7820 6361 6e20 6265 206c 6567  index can be leg
-0000a2d0: 6c65 6374 6564 2c20 696e 2063 6173 6520  lected, in case 
-0000a2e0: 6f66 2076 6964 656f 2061 2064 6963 7420  of video a dict 
-0000a2f0: 7b3c 696d 6167 652d 6461 7461 7469 6d65  {<image-datatime
-0000a300: 3e3a 3c76 616c 7565 3e2c 2e2e 2e7d 2069  >:<value>,...} i
-0000a310: 7320 7265 7475 726e 6564 2e0a 2020 2020  s returned..    
-0000a320: 2020 2020 2020 2020 5261 6973 6573 2049          Raises I
-0000a330: 6664 6f45 7863 6570 7469 6f6e 2069 6620  fdoException if 
-0000a340: 6974 656d 2064 6f65 7320 6e6f 7420 6578  item does not ex
-0000a350: 6973 742e 2022 2222 0a20 2020 2020 2020  ist. """.       
-0000a360: 206b 6579 7320 3d20 6b65 7973 2e73 706c   keys = keys.spl
-0000a370: 6974 2827 3a27 290a 2020 2020 2020 2020  it(':').        
-0000a380: 7265 7475 726e 2073 656c 662e 5f5f 6765  return self.__ge
-0000a390: 7446 6965 6c64 5661 6c75 6528 7365 6c66  tFieldValue(self
-0000a3a0: 2e69 6664 6f5f 6368 6563 6b65 642c 6b65  .ifdo_checked,ke
-0000a3b0: 7973 290a 0a0a 2020 2020 6465 6620 6669  ys)...    def fi
-0000a3c0: 6e64 546d 7046 6965 6c64 2873 656c 662c  ndTmpField(self,
-0000a3d0: 6b65 7973 293a 0a20 2020 2020 2020 2022  keys):.        "
-0000a3e0: 2222 2052 6574 7572 6e73 2063 6f70 7920  "" Returns copy 
-0000a3f0: 6f66 2074 656d 706f 7261 7279 2075 6e63  of temporary unc
-0000a400: 6865 636b 6564 2069 6664 6f20 7365 7420  hecked ifdo set 
-0000a410: 6f72 2069 7465 6d20 6669 656c 6420 7661  or item field va
-0000a420: 6c75 652c 2061 6c73 6f20 636f 6e73 6964  lue, also consid
-0000a430: 6572 6e67 2064 6566 6175 6c74 2076 616c  erng default val
-0000a440: 7565 7320 6672 6f6d 2068 6561 6465 722e  ues from header.
-0000a450: 0a20 2020 2020 2020 2020 2020 2055 7365  .            Use
-0000a460: 206b 6579 7320 6173 2065 2e67 2e20 273c   keys as e.g. '<
-0000a470: 6974 656d 3e3a 3c6b 6579 3e3a 2e2e 2e27  item>:<key>:...'
-0000a480: 2e20 4361 6e20 6265 2075 7365 6420 666f  . Can be used fo
-0000a490: 7220 6865 6164 6572 2066 6965 6c64 7320  r header fields 
-0000a4a0: 6173 2077 656c 6c20 6173 2069 7465 6d20  as well as item 
-0000a4b0: 6669 656c 6473 2e0a 2020 2020 2020 2020  fields..        
-0000a4c0: 2020 2020 4974 656d 2069 6e64 6578 2063      Item index c
-0000a4d0: 616e 2062 6520 6c65 676c 6563 7465 642c  an be leglected,
-0000a4e0: 2069 6e20 6361 7365 206f 6620 7669 6465   in case of vide
-0000a4f0: 6f20 6120 6469 6374 207b 3c69 6d61 6765  o a dict {<image
-0000a500: 2d64 6174 6174 696d 653e 3a3c 7661 6c75  -datatime>:<valu
-0000a510: 653e 2c2e 2e2e 7d20 6973 2072 6574 7572  e>,...} is retur
-0000a520: 6e65 642e 0a20 2020 2020 2020 2020 2020  ned..           
-0000a530: 2052 6169 7365 7320 4966 646f 4578 6365   Raises IfdoExce
-0000a540: 7074 696f 6e20 6966 2069 7465 6d20 646f  ption if item do
-0000a550: 6573 206e 6f74 2065 7869 7374 2e20 2222  es not exist. ""
-0000a560: 220a 2020 2020 2020 2020 6b65 7973 203d  ".        keys =
-0000a570: 206b 6579 732e 7370 6c69 7428 273a 2729   keys.split(':')
-0000a580: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000a590: 7365 6c66 2e5f 5f67 6574 4669 656c 6456  self.__getFieldV
-0000a5a0: 616c 7565 2873 656c 662e 6966 646f 5f74  alue(self.ifdo_t
-0000a5b0: 6d70 2c6b 6579 7329 0a20 2020 200a 0a20  mp,keys).    .. 
-0000a5c0: 2020 2064 6566 2066 696e 6454 6d70 4669     def findTmpFi
-0000a5d0: 656c 6432 2873 656c 662c 6b65 7973 293a  eld2(self,keys):
-0000a5e0: 0a20 2020 2020 2020 2022 2222 2053 616d  .        """ Sam
-0000a5f0: 6520 6173 2066 696e 6454 6d70 4669 656c  e as findTmpFiel
-0000a600: 6420 696e 7374 6561 6420 6f66 2072 6169  d instead of rai
-0000a610: 7369 6e67 2065 7863 6570 7469 6f6e 2069  sing exception i
-0000a620: 7420 7265 7475 726e 2065 6d70 7479 2073  t return empty s
-0000a630: 7472 696e 672e 2022 2222 0a20 2020 2020  tring. """.     
-0000a640: 2020 206b 6579 7320 3d20 6b65 7973 2e73     keys = keys.s
-0000a650: 706c 6974 2827 3a27 290a 2020 2020 2020  plit(':').      
-0000a660: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0000a670: 2020 2072 6574 203d 2073 656c 662e 5f5f     ret = self.__
-0000a680: 6765 7446 6965 6c64 5661 6c75 6528 7365  getFieldValue(se
-0000a690: 6c66 2e69 6664 6f5f 746d 702c 6b65 7973  lf.ifdo_tmp,keys
-0000a6a0: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
-0000a6b0: 206d 6971 7463 2e49 6664 6f45 7863 6570   miqtc.IfdoExcep
-0000a6c0: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
-0000a6d0: 2020 7265 7420 3d20 2222 0a20 2020 2020    ret = "".     
-0000a6e0: 2020 2072 6574 7572 6e20 7265 740a 0a0a     return ret...
-0000a6f0: 2020 2020 6465 6620 7365 7469 4644 4f48      def setiFDOH
-0000a700: 6561 6465 7246 6965 6c64 7328 7365 6c66  eaderFields(self
-0000a710: 2c20 6865 6164 6572 3a20 6469 6374 293a  , header: dict):
-0000a720: 0a20 2020 2020 2020 2022 2222 2043 6c65  .        """ Cle
-0000a730: 6172 7320 6375 7272 656e 7420 6865 6164  ars current head
-0000a740: 6572 2066 6965 6c64 7320 756e 6420 7365  er fields und se
-0000a750: 7473 2070 726f 7669 6465 6420 6669 656c  ts provided fiel
-0000a760: 6420 7661 6c75 6573 2e20 466f 7220 7570  d values. For up
-0000a770: 6461 7469 6e67 2065 7869 7374 696e 6720  dating existing 
-0000a780: 6f6e 6573 2075 7365 2075 7064 6174 6569  ones use updatei
-0000a790: 4644 4f48 6561 6465 7246 6965 6c64 7328  FDOHeaderFields(
-0000a7a0: 2920 2222 220a 2020 2020 2020 2020 7365  ) """.        se
-0000a7b0: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-0000a7c0: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
-0000a7d0: 6579 5d20 3d20 7b7d 0a20 2020 2020 2020  ey] = {}.       
-0000a7e0: 2069 6620 7365 6c66 2e69 6d61 6765 5365   if self.imageSe
-0000a7f0: 7448 6561 6465 724b 6579 2069 6e20 6865  tHeaderKey in he
-0000a800: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
-0000a810: 2020 6865 6164 6572 203d 2068 6561 6465    header = heade
-0000a820: 725b 7365 6c66 2e69 6d61 6765 5365 7448  r[self.imageSetH
-0000a830: 6561 6465 724b 6579 5d0a 2020 2020 2020  eaderKey].      
-0000a840: 2020 666f 7220 6669 656c 6420 696e 2068    for field in h
-0000a850: 6561 6465 723a 0a20 2020 2020 2020 2020  eader:.         
-0000a860: 2020 2023 6966 2066 6965 6c64 206e 6f74     #if field not
-0000a870: 2069 6e20 6d69 7174 762e 6966 646f 5f68   in miqtv.ifdo_h
-0000a880: 6561 6465 725f 636f 7265 5f66 6965 6c64  eader_core_field
-0000a890: 733a 0a20 2020 2020 2020 2020 2020 2023  s:.            #
-0000a8a0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-0000a8b0: 6728 2243 6175 7469 6f6e 3a20 556e 6b6e  g("Caution: Unkn
-0000a8c0: 6f77 6e20 6865 6164 6572 2066 6965 6c64  own header field
-0000a8d0: 205c 2222 202b 2066 6965 6c64 202b 2022   \"" + field + "
-0000a8e0: 5c22 2e20 4d61 7962 6520 6120 7479 706f  \". Maybe a typo
-0000a8f0: 3f20 4f74 6865 7277 6973 6520 6967 6e6f  ? Otherwise igno
-0000a900: 7265 206d 652e 2229 0a20 2020 2020 2020  re me.").       
-0000a910: 2020 2020 2073 656c 662e 6966 646f 5f74       self.ifdo_t
-0000a920: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
-0000a930: 4865 6164 6572 4b65 795d 5b66 6965 6c64  HeaderKey][field
-0000a940: 5d20 3d20 6865 6164 6572 5b66 6965 6c64  ] = header[field
-0000a950: 5d0a 0a0a 2020 2020 6465 6620 7570 6461  ]...    def upda
-0000a960: 7465 6946 444f 4865 6164 6572 4669 656c  teiFDOHeaderFiel
-0000a970: 6473 2873 656c 662c 2068 6561 6465 723a  ds(self, header:
-0000a980: 2064 6963 7429 3a0a 2020 2020 2020 2020   dict):.        
-0000a990: 2222 2220 5570 6461 7465 7320 6578 6973  """ Updates exis
-0000a9a0: 7469 6e67 2068 6561 6465 7220 6669 656c  ting header fiel
-0000a9b0: 6473 2022 2222 0a20 2020 2020 2020 2069  ds """.        i
-0000a9c0: 6620 7365 6c66 2e69 6d61 6765 5365 7448  f self.imageSetH
-0000a9d0: 6561 6465 724b 6579 2069 6e20 6865 6164  eaderKey in head
-0000a9e0: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
-0000a9f0: 6865 6164 6572 203d 2068 6561 6465 725b  header = header[
-0000aa00: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-0000aa10: 6465 724b 6579 5d0a 2020 2020 2020 2020  derKey].        
-0000aa20: 6c6f 6720 3d20 6d69 7174 632e 7265 6375  log = miqtc.recu
-0000aa30: 7273 6976 656c 7955 7064 6174 6544 6963  rsivelyUpdateDic
-0000aa40: 7473 2873 656c 662e 6966 646f 5f74 6d70  ts(self.ifdo_tmp
-0000aa50: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-0000aa60: 6164 6572 4b65 795d 2c20 6865 6164 6572  aderKey], header
-0000aa70: 2c20 6d69 7174 762e 6966 646f 5f6d 7574  , miqtv.ifdo_mut
-0000aa80: 7561 6c6c 795f 6578 636c 7573 6976 655f  ually_exclusive_
-0000aa90: 6669 656c 6473 290a 2020 2020 2020 2020  fields).        
-0000aaa0: 7365 6c66 2e70 726f 762e 6c6f 6728 6c6f  self.prov.log(lo
-0000aab0: 672c 646f 6e74 5368 6f77 3d54 7275 6529  g,dontShow=True)
-0000aac0: 0a0a 0a20 2020 2064 6566 2074 7279 4175  ...    def tryAu
-0000aad0: 746f 5365 7448 6561 6465 7246 6965 6c64  toSetHeaderField
-0000aae0: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
-0000aaf0: 2022 2222 2053 6574 7320 6365 7274 6169   """ Sets certai
-0000ab00: 6e20 6865 6164 6572 2066 6965 6c64 7320  n header fields 
-0000ab10: 652e 672e 2066 726f 6d20 6469 7265 6374  e.g. from direct
-0000ab20: 6f72 7920 6966 2074 6865 7920 6172 6520  ory if they are 
-0000ab30: 6e6f 7420 7365 7420 7965 7420 2222 220a  not set yet """.
-0000ab40: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0000ab50: 2e66 696e 6454 6d70 4669 656c 6432 2827  .findTmpField2('
-0000ab60: 696d 6167 652d 7365 6e73 6f72 2729 203d  image-sensor') =
-0000ab70: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
-0000ab80: 2020 7365 6c66 2e69 6664 6f5f 746d 705b    self.ifdo_tmp[
-0000ab90: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-0000aba0: 6465 724b 6579 5d5b 2769 6d61 6765 2d73  derKey]['image-s
-0000abb0: 656e 736f 7227 5d20 3d20 7365 6c66 2e64  ensor'] = self.d
-0000abc0: 6972 2e73 656e 736f 7228 290a 2020 2020  ir.sensor().    
-0000abd0: 2020 2020 656c 6966 2073 656c 662e 6669      elif self.fi
-0000abe0: 6e64 546d 7046 6965 6c64 2827 696d 6167  ndTmpField('imag
-0000abf0: 652d 7365 6e73 6f72 2729 2021 3d20 7365  e-sensor') != se
-0000ac00: 6c66 2e64 6972 2e73 656e 736f 7228 293a  lf.dir.sensor():
-0000ac10: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000ac20: 662e 7072 6f76 2e6c 6f67 2822 4361 7574  f.prov.log("Caut
-0000ac30: 696f 6e3a 2027 696d 6167 652d 7365 6e73  ion: 'image-sens
-0000ac40: 6f72 2720 222b 2073 656c 662e 6669 6e64  or' "+ self.find
-0000ac50: 546d 7046 6965 6c64 2827 696d 6167 652d  TmpField('image-
-0000ac60: 7365 6e73 6f72 2729 2b20 2220 6469 6666  sensor')+ " diff
-0000ac70: 6572 7320 6672 6f6d 2073 656e 736f 7220  ers from sensor 
-0000ac80: 7061 7273 6564 2066 726f 6d20 6469 7265  parsed from dire
-0000ac90: 6374 6f72 793a 2022 202b 2073 656c 662e  ctory: " + self.
-0000aca0: 6469 722e 7365 6e73 6f72 2829 290a 0a20  dir.sensor()).. 
-0000acb0: 2020 2020 2020 2069 6620 7365 6c66 2e66         if self.f
-0000acc0: 696e 6454 6d70 4669 656c 6432 2827 696d  indTmpField2('im
-0000acd0: 6167 652d 6576 656e 7427 2920 3d3d 2022  age-event') == "
-0000ace0: 223a 0a20 2020 2020 2020 2020 2020 2073  ":.            s
-0000acf0: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
-0000ad00: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
-0000ad10: 4b65 795d 5b27 696d 6167 652d 6576 656e  Key]['image-even
-0000ad20: 7427 5d20 3d20 7365 6c66 2e64 6972 2e65  t'] = self.dir.e
-0000ad30: 7665 6e74 2829 0a20 2020 2020 2020 2065  vent().        e
-0000ad40: 6c69 6620 7365 6c66 2e66 696e 6454 6d70  lif self.findTmp
-0000ad50: 4669 656c 6428 2769 6d61 6765 2d65 7665  Field('image-eve
-0000ad60: 6e74 2729 2021 3d20 7365 6c66 2e64 6972  nt') != self.dir
-0000ad70: 2e65 7665 6e74 2829 3a0a 2020 2020 2020  .event():.      
-0000ad80: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
-0000ad90: 6c6f 6728 2243 6175 7469 6f6e 3a20 2769  log("Caution: 'i
-0000ada0: 6d61 6765 2d65 7665 6e74 2720 2220 2b20  mage-event' " + 
-0000adb0: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
-0000adc0: 6428 2769 6d61 6765 2d65 7665 6e74 2729  d('image-event')
-0000add0: 202b 2022 2064 6966 6665 7273 2066 726f   + " differs fro
-0000ade0: 6d20 6576 656e 7420 7061 7273 6564 2066  m event parsed f
-0000adf0: 726f 6d20 6469 7265 6374 6f72 793a 2022  rom directory: "
-0000ae00: 202b 2073 656c 662e 6469 722e 6576 656e   + self.dir.even
-0000ae10: 7428 2929 0a0a 2020 2020 2020 2020 6966  t())..        if
-0000ae20: 2073 656c 662e 6669 6e64 546d 7046 6965   self.findTmpFie
-0000ae30: 6c64 3228 2769 6d61 6765 2d70 726f 6a65  ld2('image-proje
-0000ae40: 6374 2729 203d 3d20 2222 3a0a 2020 2020  ct') == "":.    
-0000ae50: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
-0000ae60: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-0000ae70: 5365 7448 6561 6465 724b 6579 5d5b 2769  SetHeaderKey]['i
-0000ae80: 6d61 6765 2d70 726f 6a65 6374 275d 203d  mage-project'] =
-0000ae90: 2073 656c 662e 6469 722e 7072 6f6a 6563   self.dir.projec
-0000aea0: 7428 290a 2020 2020 2020 2020 656c 6966  t().        elif
-0000aeb0: 2073 656c 662e 6669 6e64 546d 7046 6965   self.findTmpFie
-0000aec0: 6c64 2827 696d 6167 652d 7072 6f6a 6563  ld('image-projec
-0000aed0: 7427 2920 213d 2073 656c 662e 6469 722e  t') != self.dir.
-0000aee0: 7072 6f6a 6563 7428 293a 0a20 2020 2020  project():.     
-0000aef0: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
-0000af00: 2e6c 6f67 2822 4361 7574 696f 6e3a 2027  .log("Caution: '
-0000af10: 696d 6167 652d 7072 6f6a 6563 7427 2022  image-project' "
-0000af20: 202b 2073 656c 662e 6669 6e64 546d 7046   + self.findTmpF
-0000af30: 6965 6c64 2827 696d 6167 652d 7072 6f6a  ield('image-proj
-0000af40: 6563 7427 2920 2b20 2220 6469 6666 6572  ect') + " differ
-0000af50: 7320 6672 6f6d 2070 726f 6a65 6374 2070  s from project p
-0000af60: 6172 7365 6420 6672 6f6d 2064 6972 6563  arsed from direc
-0000af70: 746f 7279 3a20 2220 2b20 7365 6c66 2e64  tory: " + self.d
-0000af80: 6972 2e70 726f 6a65 6374 2829 290a 0a20  ir.project()).. 
-0000af90: 2020 2020 2020 2069 6620 7365 6c66 2e66         if self.f
-0000afa0: 696e 6454 6d70 4669 656c 6432 2827 696d  indTmpField2('im
-0000afb0: 6167 652d 706c 6174 666f 726d 2729 203d  age-platform') =
-0000afc0: 3d20 2222 2061 6e64 2073 656c 662e 6469  = "" and self.di
-0000afd0: 722e 6765 6172 2829 2021 3d20 2222 3a0a  r.gear() != "":.
-0000afe0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000aff0: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
-0000b000: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
-0000b010: 5d5b 2769 6d61 6765 2d70 6c61 7466 6f72  ]['image-platfor
-0000b020: 6d27 5d20 3d20 7365 6c66 2e64 6972 2e67  m'] = self.dir.g
-0000b030: 6561 7228 290a 0a20 2020 2020 2020 2069  ear()..        i
-0000b040: 6620 6e6f 7420 2769 6d61 6765 2d73 6574  f not 'image-set
-0000b050: 2d75 7569 6427 2069 6e20 7365 6c66 2e69  -uuid' in self.i
-0000b060: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
-0000b070: 6765 5365 7448 6561 6465 724b 6579 5d3a  geSetHeaderKey]:
-0000b080: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000b090: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
-0000b0a0: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
-0000b0b0: 795d 5b27 696d 6167 652d 7365 742d 7575  y]['image-set-uu
-0000b0c0: 6964 275d 203d 2073 7472 286d 6971 7463  id'] = str(miqtc
-0000b0d0: 2e75 7569 6434 2829 290a 2020 2020 2020  .uuid4()).      
-0000b0e0: 2020 6966 206e 6f74 2027 696d 6167 652d    if not 'image-
-0000b0f0: 7365 742d 6861 6e64 6c65 2720 696e 2073  set-handle' in s
-0000b100: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
-0000b110: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
-0000b120: 4b65 795d 3a0a 2020 2020 2020 2020 2020  Key]:.          
-0000b130: 2020 7365 6c66 2e69 6664 6f5f 746d 705b    self.ifdo_tmp[
-0000b140: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-0000b150: 6465 724b 6579 5d5b 2769 6d61 6765 2d73  derKey]['image-s
-0000b160: 6574 2d68 616e 646c 6527 5d20 3d20 7365  et-handle'] = se
-0000b170: 6c66 2e68 616e 646c 655f 7072 6566 6978  lf.handle_prefix
-0000b180: 202b 2022 2f22 202b 2073 656c 662e 6669   + "/" + self.fi
-0000b190: 6e64 546d 7046 6965 6c64 2827 696d 6167  ndTmpField('imag
-0000b1a0: 652d 7365 742d 7575 6964 2729 0a20 2020  e-set-uuid').   
-0000b1b0: 2020 2020 2069 6620 6e6f 7420 2769 6d61       if not 'ima
-0000b1c0: 6765 2d73 6574 2d6e 616d 6527 2069 6e20  ge-set-name' in 
-0000b1d0: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-0000b1e0: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-0000b1f0: 724b 6579 5d20 6f72 2073 656c 662e 6669  rKey] or self.fi
-0000b200: 6e64 546d 7046 6965 6c64 3228 2769 6d61  ndTmpField2('ima
-0000b210: 6765 2d73 6574 2d6e 616d 6527 2920 3d3d  ge-set-name') ==
-0000b220: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
-0000b230: 2023 2063 6f6e 7374 7275 6374 2061 7320   # construct as 
-0000b240: 3c70 726f 6a65 6374 3e5f 3c65 7665 6e74  <project>_<event
-0000b250: 3e5f 3c73 656e 736f 723e 0a20 2020 2020  >_<sensor>.     
-0000b260: 2020 2020 2020 2070 726f 6a65 6374 5f20         project_ 
-0000b270: 3d20 7365 6c66 2e66 696e 6454 6d70 4669  = self.findTmpFi
-0000b280: 656c 6432 2822 696d 6167 652d 7072 6f6a  eld2("image-proj
-0000b290: 6563 7422 290a 2020 2020 2020 2020 2020  ect").          
-0000b2a0: 2020 6576 656e 745f 203d 2073 656c 662e    event_ = self.
-0000b2b0: 6669 6e64 546d 7046 6965 6c64 3228 2269  findTmpField2("i
-0000b2c0: 6d61 6765 2d65 7665 6e74 2229 0a20 2020  mage-event").   
-0000b2d0: 2020 2020 2020 2020 2069 6620 6576 656e           if even
-0000b2e0: 745f 203d 3d20 2222 3a0a 2020 2020 2020  t_ == "":.      
-0000b2f0: 2020 2020 2020 2020 2020 6576 656e 745f            event_
-0000b300: 203d 2073 656c 662e 6469 722e 6576 656e   = self.dir.even
-0000b310: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
-0000b320: 7365 6e73 6f72 5f20 3d20 7365 6c66 2e66  sensor_ = self.f
-0000b330: 696e 6454 6d70 4669 656c 6432 2822 696d  indTmpField2("im
-0000b340: 6167 652d 7365 6e73 6f72 2229 0a20 2020  age-sensor").   
-0000b350: 2020 2020 2020 2020 2069 6620 7365 6e73           if sens
-0000b360: 6f72 5f20 3d3d 2022 223a 0a20 2020 2020  or_ == "":.     
-0000b370: 2020 2020 2020 2020 2020 2073 656e 736f             senso
-0000b380: 725f 203d 2073 656c 662e 6469 722e 7365  r_ = self.dir.se
-0000b390: 6e73 6f72 2829 0a20 2020 2020 2020 2020  nsor().         
-0000b3a0: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
-0000b3b0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-0000b3c0: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
-0000b3d0: 7365 742d 6e61 6d65 275d 203d 2069 4644  set-name'] = iFD
-0000b3e0: 4f2e 636f 6e73 7472 7563 7449 6d61 6765  O.constructImage
-0000b3f0: 5365 744e 616d 6528 7072 6f6a 6563 745f  SetName(project_
-0000b400: 2c65 7665 6e74 5f2c 7365 6e73 6f72 5f29  ,event_,sensor_)
-0000b410: 0a0a 2020 2020 2020 2020 2320 7365 7420  ..        # set 
-0000b420: 7665 7273 696f 6e0a 2020 2020 2020 2020  version.        
-0000b430: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-0000b440: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-0000b450: 724b 6579 5d5b 2769 6d61 6765 2d73 6574  rKey]['image-set
-0000b460: 2d69 6664 6f2d 7665 7273 696f 6e27 5d20  -ifdo-version'] 
-0000b470: 3d20 6d69 7174 762e 6946 444f 5f76 6572  = miqtv.iFDO_ver
-0000b480: 7369 6f6e 0a0a 0a20 2020 2064 6566 2073  sion...    def s
-0000b490: 6574 4865 6164 6572 496d 6167 654c 6f63  etHeaderImageLoc
-0000b4a0: 616c 5061 7468 4669 656c 6428 7365 6c66  alPathField(self
-0000b4b0: 293a 0a20 2020 2020 2020 2022 2222 2053  ):.        """ S
-0000b4c0: 6574 7320 6865 6164 6572 2066 6965 6c64  ets header field
-0000b4d0: 2027 696d 6167 652d 6c6f 6361 6c2d 7061   'image-local-pa
-0000b4e0: 7468 2720 6672 6f6d 2069 6d61 6765 2064  th' from image d
-0000b4f0: 6972 2022 2222 0a20 2020 2020 2020 2073  ir """.        s
-0000b500: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
-0000b510: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
-0000b520: 4b65 795d 5b27 696d 6167 652d 6c6f 6361  Key]['image-loca
-0000b530: 6c2d 7061 7468 275d 203d 206f 732e 7061  l-path'] = os.pa
-0000b540: 7468 2e72 656c 7061 7468 2873 656c 662e  th.relpath(self.
-0000b550: 696d 6167 6573 4469 722c 206f 732e 7061  imagesDir, os.pa
-0000b560: 7468 2e64 6972 6e61 6d65 2873 656c 662e  th.dirname(self.
-0000b570: 6765 7469 4644 4f46 696c 654e 616d 6528  getiFDOFileName(
-0000b580: 2929 290a 0a0a 2020 2020 6465 6620 6372  )))...    def cr
-0000b590: 6561 7465 5f66 6965 6c64 7328 7365 6c66  eate_fields(self
-0000b5a0: 293a 0a20 2020 2020 2020 2022 2222 2043  ):.        """ C
-0000b5b0: 7265 6174 6520 616e 6420 7661 6c69 6461  reate and valida
-0000b5c0: 7465 2063 7572 7265 6e74 2068 6561 6465  te current heade
-0000b5d0: 7220 6669 656c 6473 2061 6e64 2069 7465  r fields and ite
-0000b5e0: 6d20 6669 656c 6473 2066 726f 6d20 696e  m fields from in
-0000b5f0: 7465 726d 6564 6961 7465 2066 696c 6573  termediate files
-0000b600: 2e20 4f76 6572 7772 6974 6573 2065 7869  . Overwrites exi
-0000b610: 7374 696e 6720 6669 656c 6473 2e20 2222  sting fields. ""
-0000b620: 220a 2020 2020 2020 2020 6974 656d 5f64  ".        item_d
-0000b630: 6174 6120 3d20 7365 6c66 2e5f 6765 745f  ata = self._get_
-0000b640: 6974 656d 5f64 6174 615f 6672 6f6d 5f69  item_data_from_i
-0000b650: 6e74 6572 6d65 6469 6174 655f 6669 6c65  ntermediate_file
-0000b660: 7328 290a 2020 2020 2020 2020 7265 7475  s().        retu
-0000b670: 726e 2073 656c 662e 6372 6561 7465 6946  rn self.createiF
-0000b680: 444f 2873 656c 662e 6966 646f 5f74 6d70  DO(self.ifdo_tmp
-0000b690: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-0000b6a0: 6164 6572 4b65 795d 2c20 6974 656d 5f64  aderKey], item_d
-0000b6b0: 6174 612e 7661 6c75 6573 2829 290a 0a0a  ata.values())...
-0000b6c0: 2020 2020 6465 6620 7570 6461 7465 5f66      def update_f
-0000b6d0: 6965 6c64 7328 7365 6c66 293a 0a20 2020  ields(self):.   
-0000b6e0: 2020 2020 2022 2222 2055 7064 6174 6520       """ Update 
-0000b6f0: 616e 6420 7661 6c69 6461 7465 2063 7572  and validate cur
-0000b700: 7265 6e74 2068 6561 6465 7220 6669 656c  rent header fiel
-0000b710: 6473 2061 6e64 2069 7465 6d20 6669 656c  ds and item fiel
-0000b720: 6473 2066 726f 6d20 696e 7465 726d 6564  ds from intermed
-0000b730: 6961 7465 2066 696c 6573 2e20 2222 220a  iate files. """.
-0000b740: 2020 2020 2020 2020 6974 656d 5f64 6174          item_dat
-0000b750: 6120 3d20 7365 6c66 2e5f 6765 745f 6974  a = self._get_it
-0000b760: 656d 5f64 6174 615f 6672 6f6d 5f69 6e74  em_data_from_int
-0000b770: 6572 6d65 6469 6174 655f 6669 6c65 7328  ermediate_files(
-0000b780: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0000b790: 2073 656c 662e 7570 6461 7465 6946 444f   self.updateiFDO
-0000b7a0: 2873 656c 662e 6966 646f 5f74 6d70 5b73  (self.ifdo_tmp[s
-0000b7b0: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
-0000b7c0: 6572 4b65 795d 2c20 6974 656d 5f64 6174  erKey], item_dat
-0000b7d0: 612e 7661 6c75 6573 2829 290a 0a0a 2020  a.values())...  
-0000b7e0: 2020 6465 6620 6372 6561 7465 436f 7265    def createCore
-0000b7f0: 4669 656c 6473 2873 656c 6629 3a0a 2020  Fields(self):.  
-0000b800: 2020 2020 2020 2222 2220 4445 5052 4543        """ DEPREC
-0000b810: 4144 4554 2c20 7573 6520 6372 6561 7465  ADET, use create
-0000b820: 5f66 6965 6c64 7328 2920 6f72 2075 7064  _fields() or upd
-0000b830: 6174 655f 6669 656c 6473 2829 2069 6e73  ate_fields() ins
-0000b840: 7465 642e 0a20 2020 2020 2020 2046 696c  ted..        Fil
-0000b850: 6c73 2074 6865 2069 4644 4f20 636f 7265  ls the iFDO core
-0000b860: 2066 6965 6c64 7320 6672 6f6d 2069 6e74   fields from int
-0000b870: 6572 6d65 6469 6174 6520 6669 6c65 732e  ermediate files.
-0000b880: 2057 6974 686f 7574 2074 6865 6d20 6e6f   Without them no
-0000b890: 2076 616c 6964 2069 4644 4f20 6361 6e20   valid iFDO can 
-0000b8a0: 6265 2063 7265 6174 6564 2e0a 2020 2020  be created..    
-0000b8b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000b8c0: 6974 656d 5f64 6174 6120 3d20 7365 6c66  item_data = self
-0000b8d0: 2e5f 6765 745f 6974 656d 5f64 6174 615f  ._get_item_data_
-0000b8e0: 6672 6f6d 5f69 6e74 6572 6d65 6469 6174  from_intermediat
-0000b8f0: 655f 6669 6c65 735f 636f 7265 2829 0a20  e_files_core(). 
-0000b900: 2020 2020 2020 2023 2063 6865 636b 2066         # check f
-0000b910: 6965 6c64 7320 666f 7220 7661 6c69 6469  ields for validi
-0000b920: 7479 0a20 2020 2020 2020 2023 2069 7465  ty.        # ite
-0000b930: 6d5f 6461 7461 2063 6f6e 7461 696e 7320  m_data contains 
-0000b940: 6669 656c 6420 696d 6167 652d 6669 6c65  field image-file
-0000b950: 6e61 6d65 2c20 7768 6963 6820 7768 6963  name, which whic
-0000b960: 6820 7769 6c6c 206e 6f74 2062 6520 7374  h will not be st
-0000b970: 6f72 6564 2061 7320 616e 2069 7465 6d20  ored as an item 
-0000b980: 6669 656c 6420 696e 2069 464f 4420 6275  field in iFOD bu
-0000b990: 7420 6173 2074 6865 2069 7465 6d20 6e61  t as the item na
-0000b9a0: 6d65 2069 7473 656c 660a 2020 2020 2020  me itself.      
-0000b9b0: 2020 7265 7475 726e 2073 656c 662e 7570    return self.up
-0000b9c0: 6461 7465 6946 444f 2873 656c 662e 6966  dateiFDO(self.if
-0000b9d0: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
-0000b9e0: 6553 6574 4865 6164 6572 4b65 795d 2c20  eSetHeaderKey], 
-0000b9f0: 6974 656d 5f64 6174 612e 7661 6c75 6573  item_data.values
-0000ba00: 2829 290a 0a0a 2020 2020 6465 6620 6372  ())...    def cr
-0000ba10: 6561 7465 4361 7074 7572 6541 6e64 436f  eateCaptureAndCo
-0000ba20: 6e74 656e 7446 6965 6c64 7328 7365 6c66  ntentFields(self
-0000ba30: 293a 0a20 2020 2020 2020 2022 2222 2044  ):.        """ D
-0000ba40: 4550 5245 4341 4445 542c 2075 7365 2063  EPRECADET, use c
-0000ba50: 7265 6174 655f 6669 656c 6473 2829 206f  reate_fields() o
-0000ba60: 7220 7570 6461 7465 5f66 6965 6c64 7328  r update_fields(
-0000ba70: 2920 696e 7374 6564 2e0a 2020 2020 2020  ) insted..      
-0000ba80: 2020 4669 6c6c 7320 7468 6520 6946 444f    Fills the iFDO
-0000ba90: 2063 6170 7574 7265 2061 6e64 2063 6f6e   caputre and con
-0000baa0: 7465 6e74 2066 6965 6473 2066 726f 6d20  tent fieds from 
-0000bab0: 7072 6f76 6964 6564 2064 6174 6120 6669  provided data fi
-0000bac0: 656c 6473 200a 2020 2020 2020 2020 2222  elds .        ""
-0000bad0: 220a 2020 2020 2020 2020 6974 656d 5f64  ".        item_d
-0000bae0: 6174 6120 3d20 7365 6c66 2e5f 6765 745f  ata = self._get_
-0000baf0: 6974 656d 5f64 6174 615f 6672 6f6d 5f69  item_data_from_i
-0000bb00: 6e74 6572 6d65 6469 6174 655f 6669 6c65  ntermediate_file
-0000bb10: 735f 6e6f 6e65 5f63 6f72 6528 290a 2020  s_none_core().  
-0000bb20: 2020 2020 2020 2320 6368 6563 6b20 6669        # check fi
-0000bb30: 656c 6473 2066 6f72 2076 616c 6964 6974  elds for validit
-0000bb40: 790a 2020 2020 2020 2020 2320 6974 656d  y.        # item
-0000bb50: 5f64 6174 6120 636f 6e74 6169 6e73 2066  _data contains f
-0000bb60: 6965 6c64 2069 6d61 6765 2d66 696c 656e  ield image-filen
-0000bb70: 616d 652c 2077 6869 6368 2077 6869 6368  ame, which which
-0000bb80: 2077 696c 6c20 6e6f 7420 6265 2073 746f   will not be sto
-0000bb90: 7265 6420 6173 2061 6e20 6974 656d 2066  red as an item f
-0000bba0: 6965 6c64 2069 6e20 6946 4f44 2062 7574  ield in iFOD but
-0000bbb0: 2061 7320 7468 6520 6974 656d 206e 616d   as the item nam
-0000bbc0: 6520 6974 7365 6c66 0a20 2020 2020 2020  e itself.       
-0000bbd0: 2072 6574 7572 6e20 7365 6c66 2e75 7064   return self.upd
-0000bbe0: 6174 6569 4644 4f28 7365 6c66 2e69 6664  ateiFDO(self.ifd
-0000bbf0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-0000bc00: 5365 7448 6561 6465 724b 6579 5d2c 2069  SetHeaderKey], i
-0000bc10: 7465 6d5f 6461 7461 2e76 616c 7565 7328  tem_data.values(
-0000bc20: 2929 0a0a 2020 2020 0a20 2020 2064 6566  ))..    .    def
-0000bc30: 205f 6765 745f 6974 656d 5f64 6174 615f   _get_item_data_
-0000bc40: 6672 6f6d 5f69 6e74 6572 6d65 6469 6174  from_intermediat
-0000bc50: 655f 6669 6c65 7328 7365 6c66 293a 0a20  e_files(self):. 
-0000bc60: 2020 2020 2020 2022 2222 2052 6561 6420         """ Read 
-0000bc70: 6461 7461 2066 726f 6d20 636f 7265 2061  data from core a
-0000bc80: 6e64 206e 6f6e 652d 636f 7265 2069 6e74  nd none-core int
-0000bc90: 6572 6d64 6561 7465 2066 696c 6573 2c20  ermdeate files, 
-0000bca0: 6368 6563 6b20 6669 6c65 7320 6578 6973  check files exis
-0000bcb0: 742c 2061 6464 2027 696d 6167 652d 6861  t, add 'image-ha
-0000bcc0: 6e64 6c65 272e 0a20 2020 2020 2020 2052  ndle'..        R
-0000bcd0: 6574 7572 6e73 2064 6963 7420 6f66 2066  eturns dict of f
-0000bce0: 6f72 6d20 7b69 6d61 6765 2d66 696c 652d  orm {image-file-
-0000bcf0: 6e61 6d65 3a7b 6669 656c 643a 7661 6c75  name:{field:valu
-0000bd00: 657d 2c2e 2e2e 7d20 0a20 2020 2020 2020  e},...} .       
-0000bd10: 2022 2222 0a20 2020 2020 2020 2069 7465   """.        ite
-0000bd20: 6d5f 6461 7461 5f63 6f72 6520 3d20 7365  m_data_core = se
-0000bd30: 6c66 2e5f 6765 745f 6974 656d 5f64 6174  lf._get_item_dat
-0000bd40: 615f 6672 6f6d 5f69 6e74 6572 6d65 6469  a_from_intermedi
-0000bd50: 6174 655f 6669 6c65 735f 636f 7265 2829  ate_files_core()
-0000bd60: 0a20 2020 2020 2020 2069 7465 6d5f 6461  .        item_da
-0000bd70: 7461 5f6e 6f6e 655f 636f 7265 203d 2073  ta_none_core = s
-0000bd80: 656c 662e 5f67 6574 5f69 7465 6d5f 6461  elf._get_item_da
-0000bd90: 7461 5f66 726f 6d5f 696e 7465 726d 6564  ta_from_intermed
-0000bda0: 6961 7465 5f66 696c 6573 5f6e 6f6e 655f  iate_files_none_
-0000bdb0: 636f 7265 2829 0a20 2020 2020 2020 2023  core().        #
-0000bdc0: 7070 7269 6e74 2869 7465 6d5f 6461 7461  pprint(item_data
-0000bdd0: 5f6e 6f6e 655f 636f 7265 290a 2020 2020  _none_core).    
-0000bde0: 2020 2020 2370 7072 696e 7428 6974 656d      #pprint(item
-0000bdf0: 5f64 6174 615f 636f 7265 290a 2020 2020  _data_core).    
-0000be00: 2020 2020 6974 656d 5f64 6174 6120 3d20      item_data = 
-0000be10: 6974 656d 5f64 6174 615f 636f 7265 0a20  item_data_core. 
-0000be20: 2020 2020 2020 206c 6f67 203d 206d 6971         log = miq
-0000be30: 7463 2e72 6563 7572 7369 7665 6c79 5570  tc.recursivelyUp
-0000be40: 6461 7465 4469 6374 7328 6974 656d 5f64  dateDicts(item_d
-0000be50: 6174 612c 2069 7465 6d5f 6461 7461 5f6e  ata, item_data_n
-0000be60: 6f6e 655f 636f 7265 2c20 6d69 7174 762e  one_core, miqtv.
-0000be70: 6966 646f 5f6d 7574 7561 6c6c 795f 6578  ifdo_mutually_ex
-0000be80: 636c 7573 6976 655f 6669 656c 6473 290a  clusive_fields).
-0000be90: 2020 2020 2020 2020 2370 7072 696e 7428          #pprint(
-0000bea0: 6974 656d 5f64 6174 6129 0a20 2020 2020  item_data).     
-0000beb0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-0000bec0: 286c 6f67 2c64 6f6e 7453 686f 773d 5472  (log,dontShow=Tr
-0000bed0: 7565 290a 2020 2020 2020 2020 7265 7475  ue).        retu
-0000bee0: 726e 2069 7465 6d5f 6461 7461 0a0a 2020  rn item_data..  
-0000bef0: 2020 6465 6620 5f67 6574 5f69 7465 6d5f    def _get_item_
-0000bf00: 6461 7461 5f66 726f 6d5f 696e 7465 726d  data_from_interm
-0000bf10: 6564 6961 7465 5f66 696c 6573 5f6e 6f6e  ediate_files_non
-0000bf20: 655f 636f 7265 2873 656c 6629 3a0a 2020  e_core(self):.  
-0000bf30: 2020 2020 2020 2222 2220 5265 6164 2064        """ Read d
-0000bf40: 6174 6120 6672 6f6d 206e 6f6e 2d63 6f72  ata from non-cor
-0000bf50: 6520 696e 7465 726d 6465 6174 6520 6669  e intermdeate fi
-0000bf60: 6c65 732e 0a20 2020 2020 2020 2052 6574  les..        Ret
-0000bf70: 7572 6e73 2064 6963 7420 6f66 2066 6f72  urns dict of for
-0000bf80: 6d20 7b69 6d61 6765 2d66 696c 652d 6e61  m {image-file-na
-0000bf90: 6d65 3a7b 6669 656c 643a 7661 6c75 657d  me:{field:value}
-0000bfa0: 2c2e 2e2e 7d20 0a20 2020 2020 2020 2022  ,...} .        "
-0000bfb0: 2222 0a20 2020 2020 2020 2072 6571 203d  "".        req =
-0000bfc0: 2073 656c 662e 6e6f 6e43 6f72 6546 6965   self.nonCoreFie
-0000bfd0: 6c64 496e 7465 726d 6564 6961 7465 4974  ldIntermediateIt
-0000bfe0: 656d 496e 666f 4669 6c65 730a 0a20 2020  emInfoFiles..   
-0000bff0: 2020 2020 2069 7465 6d5f 6461 7461 203d       item_data =
-0000c000: 207b 7d0a 2020 2020 2020 2020 666f 7220   {}.        for 
-0000c010: 7220 696e 2072 6571 3a0a 2020 2020 2020  r in req:.      
-0000c020: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
-0000c030: 2e65 7869 7374 7328 722e 6669 6c65 4e61  .exists(r.fileNa
-0000c040: 6d65 293a 0a20 2020 2020 2020 2020 2020  me):.           
-0000c050: 2020 2020 2073 656c 662e 7072 6173 6549       self.praseI
-0000c060: 7465 6d44 6174 6146 726f 6d46 696c 6528  temDataFromFile(
-0000c070: 6974 656d 5f64 6174 612c 722e 6669 6c65  item_data,r.file
-0000c080: 4e61 6d65 2c72 2e73 6570 6172 6174 6f72  Name,r.separator
-0000c090: 2c72 2e68 6561 6465 722c 2072 2e64 6174  ,r.header, r.dat
-0000c0a0: 6574 696d 655f 666f 726d 6174 290a 2020  etime_format).  
-0000c0b0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000c0c0: 6c66 2e70 726f 762e 6c6f 6728 2250 6172  lf.prov.log("Par
-0000c0d0: 7365 6420 6974 656d 2064 6174 6120 6672  sed item data fr
-0000c0e0: 6f6d 3a20 2220 2b20 722e 6669 6c65 4e61  om: " + r.fileNa
-0000c0f0: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-0000c100: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000c110: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
-0000c120: 6c6f 6728 2246 696c 6520 646f 6573 206e  log("File does n
-0000c130: 6f74 2065 7869 7374 733a 2022 202b 2072  ot exists: " + r
-0000c140: 2e66 696c 654e 616d 6529 0a0a 2020 2020  .fileName)..    
-0000c150: 2020 2020 7265 7475 726e 2069 7465 6d5f      return item_
-0000c160: 6461 7461 0a0a 0a20 2020 2064 6566 205f  data...    def _
+000061e0: 7449 7465 6d73 4b65 7920 3d20 6d69 7174  tItemsKey = miqt
+000061f0: 762e 696d 6167 655f 7365 745f 6974 656d  v.image_set_item
+00006200: 735f 6b65 790a 2020 2020 2020 2020 7365  s_key.        se
+00006210: 6c66 2e69 6664 6f5f 746d 7020 3d20 7b73  lf.ifdo_tmp = {s
+00006220: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+00006230: 6572 4b65 793a 207b 7d2c 0a20 2020 2020  erKey: {},.     
+00006240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006250: 2020 2020 7365 6c66 2e69 6d61 6765 5365      self.imageSe
+00006260: 7449 7465 6d73 4b65 793a 207b 7d7d 0a20  tItemsKey: {}}. 
+00006270: 2020 2020 2020 2073 656c 662e 6966 646f         self.ifdo
+00006280: 5f70 6172 7365 6420 3d20 4e6f 6e65 0a20  _parsed = None. 
+00006290: 2020 2020 2020 2073 656c 662e 6966 646f         self.ifdo
+000062a0: 5f63 6865 636b 6564 203d 2063 6f70 792e  _checked = copy.
+000062b0: 6465 6570 636f 7079 2873 656c 662e 6966  deepcopy(self.if
+000062c0: 646f 5f74 6d70 2920 2023 2074 6f20 6265  do_tmp)  # to be
+000062d0: 2073 6574 2062 7920 6372 6561 7465 6946   set by createiF
+000062e0: 444f 2829 206f 6e6c 7921 0a20 2020 2020  DO() only!.     
+000062f0: 2020 2073 656c 662e 5f5f 616c 6c55 5549     self.__allUUI
+00006300: 4473 4368 6563 6b65 6420 3d20 4661 6c73  DsChecked = Fals
+00006310: 650a 2020 2020 2020 2020 7365 6c66 2e70  e.        self.p
+00006320: 726f 7620 3d20 7072 6f76 656e 616e 6365  rov = provenance
+00006330: 0a20 2020 2020 2020 2069 6620 7072 6f76  .        if prov
+00006340: 656e 616e 6365 203d 3d20 4e6f 6e65 3a0a  enance == None:.
+00006350: 2020 2020 2020 2020 2020 2020 746d 7046              tmpF
+00006360: 696c 6550 6174 6820 3d20 2222 0a20 2020  ilePath = "".   
+00006370: 2020 2020 2020 2020 2069 6620 7772 6974           if writ
+00006380: 6554 6d70 5072 6f76 4669 6c65 3a0a 2020  eTmpProvFile:.  
+00006390: 2020 2020 2020 2020 2020 2020 2020 746d                tm
+000063a0: 7046 696c 6550 6174 6820 3d20 7365 6c66  pFilePath = self
+000063b0: 2e64 6972 2e74 6f28 7365 6c66 2e64 6972  .dir.to(self.dir
+000063c0: 2e64 742e 7072 6f74 6f63 6f6c 290a 2020  .dt.protocol).  
+000063d0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+000063e0: 726f 7620 3d20 6d69 7174 702e 5072 6f76  rov = miqtp.Prov
+000063f0: 656e 616e 6365 2822 6946 444f 222c 7665  enance("iFDO",ve
+00006400: 7262 6f73 653d 7665 7262 6f73 652c 746d  rbose=verbose,tm
+00006410: 7046 696c 6550 6174 683d 746d 7046 696c  pFilePath=tmpFil
+00006420: 6550 6174 6829 0a0a 2020 2020 2020 2020  ePath)..        
+00006430: 2320 7365 7420 676c 6f62 616c 2076 6572  # set global ver
+00006440: 626f 7369 7479 0a20 2020 2020 2020 206d  bosity.        m
+00006450: 6971 7476 2e73 6574 476c 6f62 616c 5665  iqtv.setGlobalVe
+00006460: 7262 6f73 6528 7665 7262 6f73 6529 0a0a  rbose(verbose)..
+00006470: 2020 2020 2020 2020 6966 206e 6f74 2064          if not d
+00006480: 6972 2e65 7869 7374 7328 293a 0a20 2020  ir.exists():.   
+00006490: 2020 2020 2020 2020 2072 6169 7365 2045           raise E
+000064a0: 7863 6570 7469 6f6e 2822 6469 7265 6374  xception("direct
+000064b0: 726f 7922 2c20 6469 722e 7374 7228 292c  roy", dir.str(),
+000064c0: 2022 646f 6573 206e 6f74 2065 7869 7374   "does not exist
+000064d0: 2e22 290a 0a20 2020 2020 2020 2069 6620  .")..        if 
+000064e0: 6e6f 7420 6469 722e 7661 6c69 6444 6174  not dir.validDat
+000064f0: 6144 6972 2829 3a0a 2020 2020 2020 2020  aDir():.        
+00006500: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
+00006510: 696f 6e28 2264 6972 6563 7472 6f79 222c  ion("directroy",
+00006520: 2064 6972 2e73 7472 2829 2c20 226e 6f74   dir.str(), "not
+00006530: 2076 616c 6964 2e20 446f 6573 206e 6f74   valid. Does not
+00006540: 2063 6f6d 706c 7920 7769 7468 2073 7472   comply with str
+00006550: 7563 7475 7265 202f 6261 7365 2f70 726f  ucture /base/pro
+00006560: 6a65 6374 2f5b 4765 6172 2f5d 6576 656e  ject/[Gear/]even
+00006570: 742f 7365 6e73 6f72 2f64 6174 615f 7479  t/sensor/data_ty
+00006580: 7065 2f22 290a 0a20 2020 2020 2020 2023  pe/")..        #
+00006590: 2063 6865 636b 2069 4644 4f20 6669 6c65   check iFDO file
+000065a0: 0a20 2020 2020 2020 2073 656c 662e 6946  .        self.iF
+000065b0: 444f 6669 6c65 5f20 3d20 2222 2023 2069  DOfile_ = "" # i
+000065c0: 7320 7365 7420 6279 2073 6574 6946 444f  s set by setiFDO
+000065d0: 4669 6c65 4e61 6d65 2829 0a20 2020 2020  FileName().     
+000065e0: 2020 206c 6f61 6465 6469 4644 4f20 3d20     loadediFDO = 
+000065f0: 4661 6c73 650a 2020 2020 2020 2020 6966  False.        if
+00006600: 206e 6f74 2069 4644 4f66 696c 6520 6973   not iFDOfile is
+00006610: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00006620: 2020 2069 4644 4f66 696c 655f 203d 2069     iFDOfile_ = i
+00006630: 4644 4f66 696c 650a 2020 2020 2020 2020  FDOfile.        
+00006640: 2020 2020 7365 6c66 2e73 6574 6946 444f      self.setiFDO
+00006650: 4669 6c65 4e61 6d65 2869 4644 4f66 696c  FileName(iFDOfil
+00006660: 655f 290a 2020 2020 2020 2020 2020 2020  e_).            
+00006670: 6966 206e 6f74 206f 732e 7061 7468 2e69  if not os.path.i
+00006680: 7366 696c 6528 6946 444f 6669 6c65 5f29  sfile(iFDOfile_)
+00006690: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000066a0: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
+000066b0: 646f 4578 6365 7074 696f 6e28 2269 4644  doException("iFD
+000066c0: 4f20 6669 6c65 206e 6f74 2066 6f75 6e64  O file not found
+000066d0: 3a20 2220 2b20 6946 444f 6669 6c65 5f29  : " + iFDOfile_)
+000066e0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+000066f0: 2020 2020 2020 2020 2020 2069 4644 4f66             iFDOf
+00006700: 696c 655f 203d 2073 656c 662e 6469 722e  ile_ = self.dir.
+00006710: 746f 2873 656c 662e 6469 722e 6474 2e70  to(self.dir.dt.p
+00006720: 726f 6475 6374 7329 2b73 656c 662e 636f  roducts)+self.co
+00006730: 6e73 7472 7563 7469 4644 4f66 696c 654e  nstructiFDOfileN
+00006740: 616d 6528 7365 6c66 2e64 6972 2e70 726f  ame(self.dir.pro
+00006750: 6a65 6374 2829 2c73 656c 662e 6469 722e  ject(),self.dir.
+00006760: 6576 656e 7428 292c 7365 6c66 2e64 6972  event(),self.dir
+00006770: 2e73 656e 736f 7228 2929 0a0a 2020 2020  .sensor())..    
+00006780: 2020 2020 7365 6c66 2e5f 696d 6167 6573      self._images
+00006790: 496e 496d 6167 6573 4469 7220 3d20 6d69  InImagesDir = mi
+000067a0: 7174 692e 6272 6f77 7365 466f 7249 6d61  qti.browseForIma
+000067b0: 6765 4669 6c65 7328 7365 6c66 2e69 6d61  geFiles(self.ima
+000067c0: 6765 7344 6972 290a 2020 2020 2020 2020  gesDir).        
+000067d0: 7365 6c66 2e5f 696d 6167 6573 496e 496d  self._imagesInIm
+000067e0: 6167 6573 4469 7253 6f72 7465 644c 6973  agesDirSortedLis
+000067f0: 7420 3d20 5b66 696c 6520 666f 7220 6669  t = [file for fi
+00006800: 6c65 2069 6e20 7365 6c66 2e5f 696d 6167  le in self._imag
+00006810: 6573 496e 496d 6167 6573 4469 725d 0a20  esInImagesDir]. 
+00006820: 2020 2020 2020 2073 656c 662e 5f69 6d61         self._ima
+00006830: 6765 7349 6e49 6d61 6765 7344 6972 536f  gesInImagesDirSo
+00006840: 7274 6564 4c69 7374 2e73 6f72 7428 290a  rtedList.sort().
+00006850: 2020 2020 2020 2020 7365 6c66 2e5f 696d          self._im
+00006860: 6167 654e 616d 6573 496d 6167 6573 4469  ageNamesImagesDi
+00006870: 7220 3d20 5b6f 732e 7061 7468 2e62 6173  r = [os.path.bas
+00006880: 656e 616d 6528 6669 6c65 2920 666f 7220  ename(file) for 
+00006890: 6669 6c65 2069 6e20 7365 6c66 2e5f 696d  file in self._im
+000068a0: 6167 6573 496e 496d 6167 6573 4469 725d  agesInImagesDir]
+000068b0: 0a0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
+000068c0: 2873 656c 662e 5f69 6d61 6765 7349 6e49  (self._imagesInI
+000068d0: 6d61 6765 7344 6972 2920 3d3d 2030 2061  magesDir) == 0 a
+000068e0: 6e64 206e 6f74 2069 676e 6f72 655f 696d  nd not ignore_im
+000068f0: 6167 655f 6669 6c65 733a 0a20 2020 2020  age_files:.     
+00006900: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
+00006910: 6570 7469 6f6e 2822 4e6f 2069 6d61 6765  eption("No image
+00006920: 7320 6669 6c65 7320 666f 756e 6420 696e  s files found in
+00006930: 2022 202b 2073 656c 662e 696d 6167 6573   " + self.images
+00006940: 4469 7220 2b20 2220 616e 6420 6974 7320  Dir + " and its 
+00006950: 7375 6264 6972 6563 746f 7269 6573 2229  subdirectories")
+00006960: 0a0a 2020 2020 2020 2020 756e 6971 7565  ..        unique
+00006970: 2c20 6475 7020 3d20 6d69 7174 742e 6669  , dup = miqtt.fi
+00006980: 6c65 7348 6176 6555 6e69 7175 654e 616d  lesHaveUniqueNam
+00006990: 6528 7365 6c66 2e5f 696d 6167 6573 496e  e(self._imagesIn
+000069a0: 496d 6167 6573 4469 7229 0a20 2020 2020  ImagesDir).     
+000069b0: 2020 2069 6620 6e6f 7420 756e 6971 7565     if not unique
+000069c0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+000069d0: 6973 6520 4578 6365 7074 696f 6e28 0a20  ise Exception(. 
+000069e0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000069f0: 4e6f 7420 616c 6c20 6669 6c65 7320 6861  Not all files ha
+00006a00: 7665 2075 6e69 7175 6520 6e61 6d65 732e  ve unique names.
+00006a10: 2044 7570 6c69 6361 7465 733a 2022 202b   Duplicates: " +
+00006a20: 2073 7472 2864 7570 2929 0a0a 2020 2020   str(dup))..    
+00006a30: 2020 2020 616c 6c76 616c 6964 2c20 6d73      allvalid, ms
+00006a40: 6720 3d20 6d69 7174 742e 616c 6c49 6d61  g = miqtt.allIma
+00006a50: 6765 4e61 6d65 7356 616c 6964 2873 656c  geNamesValid(sel
+00006a60: 662e 5f69 6d61 6765 7349 6e49 6d61 6765  f._imagesInImage
+00006a70: 7344 6972 2920 0a20 2020 2020 2020 2069  sDir) .        i
+00006a80: 6620 6e6f 7420 616c 6c76 616c 6964 3a0a  f not allvalid:.
+00006a90: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00006aa0: 6520 4578 6365 7074 696f 6e28 6d73 6729  e Exception(msg)
+00006ab0: 0a0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+00006ac0: 726f 762e 6c6f 6728 7374 7228 6c65 6e28  rov.log(str(len(
+00006ad0: 7365 6c66 2e5f 696d 6167 6573 496e 496d  self._imagesInIm
+00006ae0: 6167 6573 4469 7229 2920 2b20 2220 696d  agesDir)) + " im
+00006af0: 6167 6520 6669 6c65 7320 666f 756e 642e  age files found.
+00006b00: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
+00006b10: 7072 6f76 2e6c 6f67 2822 2229 0a20 2020  prov.log("").   
+00006b20: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+00006b30: 6f67 2822 466f 6c6c 6f77 696e 6720 696e  og("Following in
+00006b40: 666f 726d 6174 696f 6e20 7761 7320 7061  formation was pa
+00006b50: 7273 6564 2066 726f 6d20 6469 7265 6374  rsed from direct
+00006b60: 6f72 792c 2070 6c65 6173 6520 6368 6563  ory, please chec
+00006b70: 6b20 666f 7220 636f 7272 6563 746e 6573  k for correctnes
+00006b80: 733a 2229 0a20 2020 2020 2020 2073 656c  s:").        sel
+00006b90: 662e 7072 6f76 2e6c 6f67 2822 5072 6f6a  f.prov.log("Proj
+00006ba0: 6563 743a 5c74 222b 7365 6c66 2e64 6972  ect:\t"+self.dir
+00006bb0: 2e70 726f 6a65 6374 2829 290a 2020 2020  .project()).    
+00006bc0: 2020 2020 6966 2073 656c 662e 6469 722e      if self.dir.
+00006bd0: 7769 7468 5f67 6561 723a 0a20 2020 2020  with_gear:.     
+00006be0: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+00006bf0: 2e6c 6f67 2822 4765 6172 3a5c 745c 7422  .log("Gear:\t\t"
+00006c00: 2b73 656c 662e 6469 722e 6765 6172 2829  +self.dir.gear()
+00006c10: 290a 2020 2020 2020 2020 7365 6c66 2e70  ).        self.p
+00006c20: 726f 762e 6c6f 6728 2245 7665 6e74 3a5c  rov.log("Event:\
+00006c30: 745c 7422 2b73 656c 662e 6469 722e 6576  t\t"+self.dir.ev
+00006c40: 656e 7428 2929 0a20 2020 2020 2020 2073  ent()).        s
+00006c50: 656c 662e 7072 6f76 2e6c 6f67 2822 5365  elf.prov.log("Se
+00006c60: 6e73 6f72 3a5c 745c 7422 2b73 656c 662e  nsor:\t\t"+self.
+00006c70: 6469 722e 7365 6e73 6f72 2829 290a 2020  dir.sensor()).  
+00006c80: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
+00006c90: 6c6f 6728 2222 290a 0a20 2020 2020 2020  log("")..       
+00006ca0: 2023 2069 6e74 6572 6d65 6469 6174 6520   # intermediate 
+00006cb0: 6669 6c65 730a 2020 2020 2020 2020 7365  files.        se
+00006cc0: 6c66 2e5f 5f69 6e69 7449 6e74 6572 6d65  lf.__initInterme
+00006cd0: 6469 6174 6546 696c 6573 2829 2020 2020  diateFiles()    
+00006ce0: 0a0a 2020 2020 2020 2020 2320 7472 7920  ..        # try 
+00006cf0: 6c6f 6164 2065 7869 7374 696e 6720 6946  load existing iF
+00006d00: 444f 2066 696c 650a 2020 2020 2020 2020  DO file.        
+00006d10: 6966 2873 656c 662e 7265 6164 6946 444f  if(self.readiFDO
+00006d20: 6669 6c65 2869 4644 4f66 696c 655f 2929  file(iFDOfile_))
+00006d30: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
+00006d40: 6164 6564 6946 444f 203d 2054 7275 650a  adediFDO = True.
+00006d50: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00006d60: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+00006d70: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00006d80: 6174 6820 3d20 7365 6c66 2e64 6972 2e74  ath = self.dir.t
+00006d90: 6f28 7365 6c66 2e64 6972 2e64 742e 7072  o(self.dir.dt.pr
+00006da0: 6f64 7563 7473 290a 2020 2020 2020 2020  oducts).        
+00006db0: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
+00006dc0: 5f20 696e 206f 732e 6c69 7374 6469 7228  _ in os.listdir(
+00006dd0: 7061 7468 293a 0a20 2020 2020 2020 2020  path):.         
+00006de0: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
+00006df0: 6c65 5f5b 2d31 303a 2d34 5d20 3d3d 2022  le_[-10:-4] == "
+00006e00: 5f69 4644 4f2e 2220 616e 6420 7365 6c66  _iFDO." and self
+00006e10: 2e72 6561 6469 4644 4f66 696c 6528 7061  .readiFDOfile(pa
+00006e20: 7468 2b66 696c 655f 293a 0a20 2020 2020  th+file_):.     
+00006e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006e40: 2020 206c 6f61 6465 6469 4644 4f20 3d20     loadediFDO = 
+00006e50: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+00006e60: 2020 2020 2020 2020 2020 2020 2069 4644               iFD
+00006e70: 4f66 696c 655f 203d 2070 6174 682b 6669  Ofile_ = path+fi
+00006e80: 6c65 5f0a 2020 2020 2020 2020 2020 2020  le_.            
+00006e90: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+00006ea0: 6b0a 2020 2020 2020 2020 2020 2020 6578  k.            ex
+00006eb0: 6365 7074 2046 696c 654e 6f74 466f 756e  cept FileNotFoun
+00006ec0: 6445 7272 6f72 3a0a 2020 2020 2020 2020  dError:.        
+00006ed0: 2020 2020 2020 2020 7061 7373 2020 2020          pass    
+00006ee0: 2020 2020 0a0a 2020 2020 2020 2020 7365      ..        se
+00006ef0: 6c66 2e74 7279 4175 746f 5365 7448 6561  lf.tryAutoSetHea
+00006f00: 6465 7246 6965 6c64 7328 290a 2020 2020  derFields().    
+00006f10: 2020 2020 7365 6c66 2e73 6574 4865 6164      self.setHead
+00006f20: 6572 496d 6167 654c 6f63 616c 5061 7468  erImageLocalPath
+00006f30: 4669 656c 6428 290a 2020 2020 2020 2020  Field().        
+00006f40: 6966 206c 6f61 6465 6469 4644 4f3a 0a20  if loadediFDO:. 
+00006f50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006f60: 7365 7469 4644 4f46 696c 654e 616d 6528  setiFDOFileName(
+00006f70: 6946 444f 6669 6c65 5f29 0a0a 0a20 2020  iFDOfile_)...   
+00006f80: 2064 6566 2072 6561 6469 4644 4f66 696c   def readiFDOfil
+00006f90: 6528 7365 6c66 2c66 696c 653a 7374 7229  e(self,file:str)
+00006fa0: 3a0a 2020 2020 2020 2020 2222 2220 7265  :.        """ re
+00006fb0: 6164 7320 6946 444f 2066 696c 6520 2222  ads iFDO file ""
+00006fc0: 220a 2020 2020 2020 2020 7472 795f 7961  ".        try_ya
+00006fd0: 6d6c 203d 2046 616c 7365 0a0a 2020 2020  ml = False..    
+00006fe0: 2020 2020 2320 6966 2066 696c 6520 6973      # if file is
+00006ff0: 2079 616d 6c20 6669 6c65 206c 6f61 6420   yaml file load 
+00007000: 6974 2061 7320 7375 6368 0a20 2020 2020  it as such.     
+00007010: 2020 2069 6620 6669 6c65 2e73 706c 6974     if file.split
+00007020: 2827 2e27 295b 2d31 5d20 3d3d 2027 7961  ('.')[-1] == 'ya
+00007030: 6d6c 273a 0a20 2020 2020 2020 2020 2020  ml':.           
+00007040: 2074 7279 5f79 616d 6c20 3d20 5472 7565   try_yaml = True
+00007050: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
+00007060: 655f 7961 6d6c 203d 2066 696c 650a 0a20  e_yaml = file.. 
+00007070: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
+00007080: 2e70 6174 682e 6973 6669 6c65 2866 696c  .path.isfile(fil
+00007090: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+000070a0: 2320 6966 2066 696c 6520 646f 6573 206e  # if file does n
+000070b0: 6f74 2065 7869 7374 2063 6865 636b 2069  ot exist check i
+000070c0: 6620 7961 6d6c 2076 6572 7369 6f6e 2065  f yaml version e
+000070d0: 7873 6973 7420 616e 6420 7472 7920 746f  xsist and try to
+000070e0: 206c 6f61 6420 7468 6174 206f 6e65 0a20   load that one. 
+000070f0: 2020 2020 2020 2020 2020 2066 696c 655f             file_
+00007100: 7961 6d6c 203d 2066 696c 652e 7265 706c  yaml = file.repl
+00007110: 6163 6528 272e 6a73 6f6e 272c 272e 7961  ace('.json','.ya
+00007120: 6d6c 2729 0a20 2020 2020 2020 2020 2020  ml').           
+00007130: 2069 6620 6f73 2e70 6174 682e 6973 6669   if os.path.isfi
+00007140: 6c65 2866 696c 655f 7961 6d6c 293a 0a20  le(file_yaml):. 
+00007150: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00007160: 7279 5f79 616d 6c20 3d20 5472 7565 0a20  ry_yaml = True. 
+00007170: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00007180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007190: 2072 6574 7572 6e20 4661 6c73 650a 0a20   return False.. 
+000071a0: 2020 2020 2020 2073 203d 206d 6971 7463         s = miqtc
+000071b0: 2e50 7269 6e74 4c6f 6164 696e 674d 7367  .PrintLoadingMsg
+000071c0: 2822 4c6f 6164 696e 6720 6946 444f 2066  ("Loading iFDO f
+000071d0: 696c 6522 290a 2020 2020 2020 2020 7472  ile").        tr
+000071e0: 793a 0a20 2020 2020 2020 2020 2020 2023  y:.            #
+000071f0: 2074 7279 206c 6f61 6420 6a73 6f6e 2c20   try load json, 
+00007200: 6f74 6865 7277 6973 6520 7472 7920 7961  otherwise try ya
+00007210: 6d6c 0a20 2020 2020 2020 2020 2020 2069  ml.            i
+00007220: 6620 7472 795f 7961 6d6c 3a0a 2020 2020  f try_yaml:.    
+00007230: 2020 2020 2020 2020 2020 2020 6f20 3d20              o = 
+00007240: 6f70 656e 2866 696c 655f 7961 6d6c 2c20  open(file_yaml, 
+00007250: 2772 2729 0a20 2020 2020 2020 2020 2020  'r').           
+00007260: 2020 2020 2073 656c 662e 6966 646f 5f74       self.ifdo_t
+00007270: 6d70 203d 2079 616d 6c2e 6c6f 6164 286f  mp = yaml.load(o
+00007280: 2c20 204c 6f61 6465 723d 7961 6d6c 2e43  ,  Loader=yaml.C
+00007290: 4c6f 6164 6572 290a 2020 2020 2020 2020  Loader).        
+000072a0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000072b0: 2020 2020 2020 2020 2020 6f20 3d20 6f70            o = op
+000072c0: 656e 2866 696c 652c 2027 7227 290a 2020  en(file, 'r').  
+000072d0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000072e0: 6c66 2e69 6664 6f5f 746d 7020 3d20 6a73  lf.ifdo_tmp = js
+000072f0: 6f6e 2e6c 6f61 6428 6f29 0a0a 2020 2020  on.load(o)..    
+00007300: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
+00007310: 6f5f 7061 7273 6564 203d 2063 6f70 792e  o_parsed = copy.
+00007320: 6465 6570 636f 7079 2873 656c 662e 6966  deepcopy(self.if
+00007330: 646f 5f74 6d70 290a 2020 2020 2020 2020  do_tmp).        
+00007340: 2020 2020 6f2e 636c 6f73 6528 290a 2020      o.close().  
+00007350: 2020 2020 2020 2020 2020 732e 7374 6f70            s.stop
+00007360: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
+00007370: 656c 662e 7072 6f76 2e61 6464 5072 6576  elf.prov.addPrev
+00007380: 696f 7573 5072 6f76 656e 616e 6365 2873  iousProvenance(s
+00007390: 656c 662e 7072 6f76 2e67 6574 4c61 7374  elf.prov.getLast
+000073a0: 5072 6f76 656e 616e 6365 4669 6c65 2873  ProvenanceFile(s
+000073b0: 656c 662e 6469 722e 746f 2873 656c 662e  elf.dir.to(self.
+000073c0: 6469 722e 6474 2e70 726f 746f 636f 6c29  dir.dt.protocol)
+000073d0: 2c73 656c 662e 7072 6f76 2e65 7865 6375  ,self.prov.execu
+000073e0: 7461 626c 6529 290a 2020 2020 2020 2020  table)).        
+000073f0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+00007400: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+00007410: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+00007420: 2873 7472 2865 2e61 7267 7329 290a 2020  (str(e.args)).  
+00007430: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00007440: 2046 616c 7365 0a20 2020 2020 2020 2073   False.        s
+00007450: 2e73 746f 7028 290a 0a20 2020 2020 2020  .stop()..       
+00007460: 2023 2074 7279 2074 6f20 7061 7273 6520   # try to parse 
+00007470: 652e 672e 2073 7472 696e 6773 2074 6861  e.g. strings tha
+00007480: 7420 7265 7072 6573 656e 7420 6469 6374  t represent dict
+00007490: 730a 2020 2020 2020 2020 6d69 7174 632e  s.        miqtc.
+000074a0: 7265 6375 7273 6976 6545 7661 6c28 7365  recursiveEval(se
+000074b0: 6c66 2e69 6664 6f5f 746d 7029 0a0a 2020  lf.ifdo_tmp)..  
+000074c0: 2020 2020 2020 6966 2073 656c 662e 696d        if self.im
+000074d0: 6167 6553 6574 4865 6164 6572 4b65 7920  ageSetHeaderKey 
+000074e0: 6e6f 7420 696e 2073 656c 662e 6966 646f  not in self.ifdo
+000074f0: 5f74 6d70 3a0a 2020 2020 2020 2020 2020  _tmp:.          
+00007500: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
+00007510: 6e28 2245 7272 6f72 206c 6f61 6469 6e67  n("Error loading
+00007520: 2069 4644 4f20 6669 6c65 222c 6669 6c65   iFDO file",file
+00007530: 2c22 646f 6573 206e 6f74 2063 6f6e 7461  ,"does not conta
+00007540: 696e 222c 7365 6c66 2e69 6d61 6765 5365  in",self.imageSe
+00007550: 7448 6561 6465 724b 6579 290a 2020 2020  tHeaderKey).    
+00007560: 2020 2020 6966 2073 656c 662e 696d 6167      if self.imag
+00007570: 6553 6574 4974 656d 734b 6579 206e 6f74  eSetItemsKey not
+00007580: 2069 6e20 7365 6c66 2e69 6664 6f5f 746d   in self.ifdo_tm
+00007590: 703a 0a20 2020 2020 2020 2020 2020 2072  p:.            r
+000075a0: 6169 7365 2045 7863 6570 7469 6f6e 2822  aise Exception("
+000075b0: 4572 726f 7220 6c6f 6164 696e 6720 6946  Error loading iF
+000075c0: 444f 2066 696c 6522 2c66 696c 652c 2264  DO file",file,"d
+000075d0: 6f65 7320 6e6f 7420 636f 6e74 6169 6e22  oes not contain"
+000075e0: 2c73 656c 662e 696d 6167 6553 6574 4974  ,self.imageSetIt
+000075f0: 656d 734b 6579 290a 0a20 2020 2020 2020  emsKey)..       
+00007600: 2069 6620 2073 656c 662e 6966 646f 5f74   if  self.ifdo_t
+00007610: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
+00007620: 4865 6164 6572 4b65 795d 203d 3d20 4e6f  HeaderKey] == No
+00007630: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00007640: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+00007650: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+00007660: 724b 6579 5d20 3d20 7b7d 0a20 2020 2020  rKey] = {}.     
+00007670: 2020 2069 6620 7365 6c66 2e69 6664 6f5f     if self.ifdo_
+00007680: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
+00007690: 7449 7465 6d73 4b65 795d 203d 3d20 4e6f  tItemsKey] == No
+000076a0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000076b0: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+000076c0: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
+000076d0: 4b65 795d 203d 207b 7d0a 0a20 2020 2020  Key] = {}..     
+000076e0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+000076f0: 2822 6946 444f 2066 696c 6520 6c6f 6164  ("iFDO file load
+00007700: 6564 3a5c 7422 2b6f 732e 7061 7468 2e62  ed:\t"+os.path.b
+00007710: 6173 656e 616d 6528 6669 6c65 2929 0a0a  asename(file))..
+00007720: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
+00007730: 6946 444f 2076 6572 7369 6f6e 0a20 2020  iFDO version.   
+00007740: 2020 2020 2072 6561 6456 6572 7369 6f6e       readVersion
+00007750: 203d 2022 762e 312e 302e 3022 2023 2064   = "v.1.0.0" # d
+00007760: 6964 206e 6f74 2068 6176 6520 7468 6520  id not have the 
+00007770: 2769 6d61 6765 2d73 6574 2d69 6664 6f2d  'image-set-ifdo-
+00007780: 7665 7273 696f 6e27 2066 6965 6c64 2079  version' field y
+00007790: 6574 0a20 2020 2020 2020 2074 7279 3a20  et.        try: 
+000077a0: 0a20 2020 2020 2020 2020 2020 2072 6561  .            rea
+000077b0: 6456 6572 7369 6f6e 203d 2073 656c 662e  dVersion = self.
+000077c0: 6669 6e64 546d 7046 6965 6c64 2827 696d  findTmpField('im
+000077d0: 6167 652d 7365 742d 6966 646f 2d76 6572  age-set-ifdo-ver
+000077e0: 7369 6f6e 2729 0a20 2020 2020 2020 2065  sion').        e
+000077f0: 7863 6570 7420 4b65 7945 7272 6f72 3a0a  xcept KeyError:.
+00007800: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+00007810: 0a20 2020 2020 2020 2069 6e74 5265 6164  .        intRead
+00007820: 5665 7273 696f 6e20 3d20 5665 7273 696f  Version = Versio
+00007830: 6e28 7265 6164 5665 7273 696f 6e29 0a20  n(readVersion). 
+00007840: 2020 2020 2020 2069 6e74 5468 6973 5665         intThisVe
+00007850: 7273 696f 6e20 3d20 5665 7273 696f 6e28  rsion = Version(
+00007860: 6d69 7174 762e 6946 444f 5f76 6572 7369  miqtv.iFDO_versi
+00007870: 6f6e 290a 2020 2020 2020 2020 6966 2069  on).        if i
+00007880: 6e74 5265 6164 5665 7273 696f 6e20 3c20  ntReadVersion < 
+00007890: 696e 7454 6869 7356 6572 7369 6f6e 3a0a  intThisVersion:.
+000078a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000078b0: 2e70 726f 762e 6c6f 6728 224c 6f61 6465  .prov.log("Loade
+000078c0: 6420 6946 444f 2068 6173 2076 6572 7369  d iFDO has versi
+000078d0: 6f6e 2022 202b 2072 6561 6456 6572 7369  on " + readVersi
+000078e0: 6f6e 202b 2022 2061 6e64 2077 696c 6c20  on + " and will 
+000078f0: 6265 2075 7064 6174 6564 2074 6f20 7665  be updated to ve
+00007900: 7273 696f 6e20 2220 2b20 6d69 7174 762e  rsion " + miqtv.
+00007910: 6946 444f 5f76 6572 7369 6f6e 290a 2020  iFDO_version).  
+00007920: 2020 2020 2020 6966 2069 6e74 5265 6164        if intRead
+00007930: 5665 7273 696f 6e20 3e20 696e 7454 6869  Version > intThi
+00007940: 7356 6572 7369 6f6e 3a0a 2020 2020 2020  sVersion:.      
+00007950: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
+00007960: 6c6f 6728 2243 4155 5449 4f4e 3a20 4c6f  log("CAUTION: Lo
+00007970: 6164 6564 2069 4644 4f20 6861 7320 7665  aded iFDO has ve
+00007980: 7273 696f 6e20 2220 2b20 7265 6164 5665  rsion " + readVe
+00007990: 7273 696f 6e20 2b20 2220 6973 2061 6865  rsion + " is ahe
+000079a0: 6164 206f 6620 7665 7273 696f 6e20 7573  ad of version us
+000079b0: 6564 2068 6572 653a 2022 202b 206d 6971  ed here: " + miq
+000079c0: 7476 2e69 4644 4f5f 7665 7273 696f 6e29  tv.iFDO_version)
+000079d0: 0a0a 2020 2020 2020 2020 2320 666f 7220  ..        # for 
+000079e0: 736f 6f6f 6f6f 6d65 2072 6561 736f 6e20  sooooome reason 
+000079f0: 7468 6973 2066 6978 6573 2061 2068 6963  this fixes a hic
+00007a00: 6b75 7020 6f66 2074 6865 2070 726f 6720  kup of the prog 
+00007a10: 696e 2063 7265 6174 6569 4644 4f28 290a  in createiFDO().
+00007a20: 2020 2020 2020 2020 7072 6f67 203d 206d          prog = m
+00007a30: 6971 7463 2e50 7269 6e74 4b6e 6f77 6e50  iqtc.PrintKnownP
+00007a40: 726f 6772 6573 734d 7367 2822 666f 6f22  rogressMsg("foo"
+00007a50: 2c20 312c 6d6f 6475 6c6f 3d31 290a 2020  , 1,modulo=1).  
+00007a60: 2020 2020 2020 7072 6f67 2e63 6c65 6172        prog.clear
+00007a70: 2829 0a20 2020 2020 2020 2074 7279 3a0a  ().        try:.
+00007a80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00007a90: 2e63 6f6e 7665 7274 546f 4465 6661 756c  .convertToDefaul
+00007aa0: 7444 6174 6554 696d 6546 6f72 6d61 7428  tDateTimeFormat(
+00007ab0: 7365 6c66 2e69 6664 6f5f 746d 7029 0a20  self.ifdo_tmp). 
+00007ac0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+00007ad0: 6365 7074 696f 6e20 6173 2065 783a 0a20  ception as ex:. 
+00007ae0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00007af0: 7072 6f76 2e6c 6f67 2822 4368 6563 6b69  prov.log("Checki
+00007b00: 6e67 2064 6174 6574 696d 6520 666f 726d  ng datetime form
+00007b10: 6174 3a20 2220 2b20 7374 7228 6578 2929  at: " + str(ex))
+00007b20: 0a0a 2020 2020 2020 2020 2320 666f 7220  ..        # for 
+00007b30: 736f 6f6f 6f6f 6d65 2072 6561 736f 6e20  sooooome reason 
+00007b40: 7468 6973 2066 6978 6573 2061 2068 6963  this fixes a hic
+00007b50: 6b75 7020 6f66 2074 6865 2070 726f 6720  kup of the prog 
+00007b60: 696e 2063 7265 6174 6569 4644 4f28 290a  in createiFDO().
+00007b70: 2020 2020 2020 2020 7072 6f67 203d 206d          prog = m
+00007b80: 6971 7463 2e50 7269 6e74 4b6e 6f77 6e50  iqtc.PrintKnownP
+00007b90: 726f 6772 6573 734d 7367 2822 666f 6f22  rogressMsg("foo"
+00007ba0: 2c20 312c 6d6f 6475 6c6f 3d31 290a 2020  , 1,modulo=1).  
+00007bb0: 2020 2020 2020 7072 6f67 2e63 6c65 6172        prog.clear
+00007bc0: 2829 0a0a 2020 2020 2020 2020 7365 6c66  ()..        self
+00007bd0: 2e5f 7472 795f 7570 6772 6164 655f 746f  ._try_upgrade_to
+00007be0: 5f69 6664 6f5f 7665 7273 696f 6e5f 3278  _ifdo_version_2x
+00007bf0: 2829 0a0a 2020 2020 2020 2020 2320 6368  ()..        # ch
+00007c00: 6563 6b20 7265 6164 2069 4644 4f20 6669  eck read iFDO fi
+00007c10: 6c65 0a20 2020 2020 2020 2074 7279 3a0a  le.        try:.
+00007c20: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00007c30: 2e63 7265 6174 6569 4644 4f28 7365 6c66  .createiFDO(self
+00007c40: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
+00007c50: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
+00007c60: 5d2c 206d 6971 7469 2e63 7265 6174 6549  ], miqti.createI
+00007c70: 6d61 6765 4974 656d 734c 6973 7446 726f  mageItemsListFro
+00007c80: 6d49 6d61 6765 4974 656d 7344 6963 7428  mImageItemsDict(
+00007c90: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+00007ca0: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
+00007cb0: 4b65 795d 2929 0a20 2020 2020 2020 2065  Key])).        e
+00007cc0: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
+00007cd0: 6173 2065 783a 0a20 2020 2020 2020 2020  as ex:.         
+00007ce0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+00007cf0: 2822 4c6f 6164 6564 2069 4644 4f20 6669  ("Loaded iFDO fi
+00007d00: 6c65 206e 6f74 2076 616c 6964 2079 6574  le not valid yet
+00007d10: 3a20 2220 2b20 7374 7228 6578 2929 0a0a  : " + str(ex))..
+00007d20: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+00007d30: 7275 650a 0a0a 2020 2020 6465 6620 7772  rue...    def wr
+00007d40: 6974 655f 6966 646f 5f66 696c 6528 7365  ite_ifdo_file(se
+00007d50: 6c66 2c61 6c6c 6f77 5f6d 6973 7369 6e67  lf,allow_missing
+00007d60: 5f72 6571 7569 7265 643d 4661 6c73 6529  _required=False)
+00007d70: 3a0a 2020 2020 2020 2020 2222 2220 5772  :.        """ Wr
+00007d80: 6974 6573 2061 6e20 6946 444f 2066 696c  ites an iFDO fil
+00007d90: 6520 746f 2064 6973 6b2e 204f 7665 7277  e to disk. Overw
+00007da0: 7269 7465 7320 706f 7465 6e74 6961 6c6c  rites potentiall
+00007db0: 7920 6578 6973 7469 6e67 2066 696c 652e  y existing file.
+00007dc0: 2222 220a 0a20 2020 2020 2020 2073 203d  """..        s =
+00007dd0: 206d 6971 7463 2e50 7269 6e74 4c6f 6164   miqtc.PrintLoad
+00007de0: 696e 674d 7367 2822 5772 6974 696e 6720  ingMsg("Writing 
+00007df0: 6946 444f 2066 696c 6522 290a 0a20 2020  iFDO file")..   
+00007e00: 2020 2020 2023 2063 6865 636b 2066 6965       # check fie
+00007e10: 6c64 7320 6167 6169 6e20 6966 2063 6861  lds again if cha
+00007e20: 6e67 6564 2073 696e 6365 206c 6173 7420  nged since last 
+00007e30: 6368 6563 6b20 2863 7265 6174 6569 4644  check (createiFD
+00007e40: 4f29 0a20 2020 2020 2020 2069 6620 7365  O).        if se
+00007e50: 6c66 2e69 6664 6f5f 746d 7020 213d 2073  lf.ifdo_tmp != s
+00007e60: 656c 662e 6966 646f 5f63 6865 636b 6564  elf.ifdo_checked
+00007e70: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00007e80: 6c66 2e63 7265 6174 6569 4644 4f28 7365  lf.createiFDO(se
+00007e90: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+00007ea0: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
+00007eb0: 6579 5d2c 206d 6971 7469 2e63 7265 6174  ey], miqti.creat
+00007ec0: 6549 6d61 6765 4974 656d 734c 6973 7446  eImageItemsListF
+00007ed0: 726f 6d49 6d61 6765 4974 656d 7344 6963  romImageItemsDic
+00007ee0: 7428 7365 6c66 2e69 6664 6f5f 746d 705b  t(self.ifdo_tmp[
+00007ef0: 7365 6c66 2e69 6d61 6765 5365 7449 7465  self.imageSetIte
+00007f00: 6d73 4b65 795d 292c 0a20 2020 2020 2020  msKey]),.       
+00007f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007f20: 2020 2020 2061 6c6c 6f77 5f6d 6973 7369       allow_missi
+00007f30: 6e67 5f72 6571 7569 7265 643d 616c 6c6f  ng_required=allo
+00007f40: 775f 6d69 7373 696e 675f 7265 7175 6972  w_missing_requir
+00007f50: 6564 290a 2020 2020 2020 2020 0a20 2020  ed).        .   
+00007f60: 2020 2020 2023 2061 6464 2022 2473 6368       # add "$sch
+00007f70: 656d 6122 0a20 2020 2020 2020 2073 656c  ema".        sel
+00007f80: 662e 6966 646f 5f63 6865 636b 6564 5b22  f.ifdo_checked["
+00007f90: 2473 6368 656d 6122 5d20 3d20 6d69 7174  $schema"] = miqt
+00007fa0: 762e 6966 646f 5f73 6368 656d 615b 2724  v.ifdo_schema['$
+00007fb0: 6964 275d 0a20 2020 2020 2020 200a 2020  id'].        .  
+00007fc0: 2020 2020 2020 6946 444f 5f70 6174 6820        iFDO_path 
+00007fd0: 3d20 7365 6c66 2e67 6574 6946 444f 4669  = self.getiFDOFi
+00007fe0: 6c65 4e61 6d65 286f 7665 7277 7269 7465  leName(overwrite
+00007ff0: 3d54 7275 6529 0a0a 2020 2020 2020 2020  =True)..        
+00008000: 2320 7075 7473 2065 7665 7279 7468 696e  # puts everythin
+00008010: 6720 696e 206f 6e65 206c 696e 650a 2020  g in one line.  
+00008020: 2020 2020 2020 2377 6974 6820 6f70 656e        #with open
+00008030: 2869 4644 4f5f 7061 7468 2e72 6570 6c61  (iFDO_path.repla
+00008040: 6365 2822 7961 6d6c 222c 226a 736f 6e22  ce("yaml","json"
+00008050: 292c 2027 7727 2920 6173 2066 703a 0a20  ), 'w') as fp:. 
+00008060: 2020 2020 2020 2023 2020 2020 6a73 6f6e         #    json
+00008070: 2e64 756d 7028 7365 6c66 2e69 6664 6f5f  .dump(self.ifdo_
+00008080: 6368 6563 6b65 642c 2066 7029 0a0a 2020  checked, fp)..  
+00008090: 2020 2020 2020 2320 636f 6e76 6572 7420        # convert 
+000080a0: 6469 6374 696f 6e61 7279 2074 6f20 4a53  dictionary to JS
+000080b0: 4f4e 2073 7472 696e 670a 2020 2020 2020  ON string.      
+000080c0: 2020 6a73 6f6e 5f64 6174 6120 3d20 6a73    json_data = js
+000080d0: 6f6e 2e64 756d 7073 2873 656c 662e 6966  on.dumps(self.if
+000080e0: 646f 5f63 6865 636b 6564 2c20 696e 6465  do_checked, inde
+000080f0: 6e74 203d 2034 2c20 736f 7274 5f6b 6579  nt = 4, sort_key
+00008100: 733d 5472 7565 290a 0a20 2020 2020 2020  s=True)..       
+00008110: 2023 2077 7269 7465 2074 6865 204a 534f   # write the JSO
+00008120: 4e20 7374 7269 6e67 2074 6f20 6120 6669  N string to a fi
+00008130: 6c65 0a20 2020 2020 2020 2077 6974 6820  le.        with 
+00008140: 6f70 656e 2869 4644 4f5f 7061 7468 2c20  open(iFDO_path, 
+00008150: 2777 2729 2061 7320 663a 0a20 2020 2020  'w') as f:.     
+00008160: 2020 2020 2020 2066 2e77 7269 7465 286a         f.write(j
+00008170: 736f 6e5f 6461 7461 290a 2020 2020 2020  son_data).      
+00008180: 2020 0a20 2020 2020 2020 2023 206c 6f67    .        # log
+00008190: 2063 6861 6e67 6573 0a20 2020 2020 2020   changes.       
+000081a0: 2069 6620 6e6f 7420 7365 6c66 2e69 6664   if not self.ifd
+000081b0: 6f5f 7061 7273 6564 2069 7320 4e6f 6e65  o_parsed is None
+000081c0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+000081d0: 646f 5f75 7064 6174 6520 3d20 4465 6570  do_update = Deep
+000081e0: 4469 6666 2873 656c 662e 6966 646f 5f70  Diff(self.ifdo_p
+000081f0: 6172 7365 642c 7365 6c66 2e69 6664 6f5f  arsed,self.ifdo_
+00008200: 6368 6563 6b65 6429 0a20 2020 2020 2020  checked).       
+00008210: 2020 2020 2023 7070 7269 6e74 2869 6664       #pprint(ifd
+00008220: 6f5f 7570 6461 7465 290a 2020 2020 2020  o_update).      
+00008230: 2020 2020 2020 6966 2069 6664 6f5f 7570        if ifdo_up
+00008240: 6461 7465 2021 3d20 7b7d 3a0a 2020 2020  date != {}:.    
+00008250: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00008260: 2e70 726f 762e 6c6f 6728 2269 4644 4f20  .prov.log("iFDO 
+00008270: 7570 6461 7465 6422 290a 2020 2020 2020  updated").      
+00008280: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+00008290: 726f 762e 6c6f 6728 7374 7228 6966 646f  rov.log(str(ifdo
+000082a0: 5f75 7064 6174 6529 2c64 6f6e 7453 686f  _update),dontSho
+000082b0: 773d 5472 7565 290a 2020 2020 2020 2020  w=True).        
+000082c0: 7365 6c66 2e70 726f 762e 6c6f 6728 2257  self.prov.log("W
+000082d0: 726f 7465 2069 4644 4f20 746f 2066 696c  rote iFDO to fil
+000082e0: 6520 2220 2b20 6946 444f 5f70 6174 6829  e " + iFDO_path)
+000082f0: 0a20 2020 2020 2020 2073 656c 662e 7072  .        self.pr
+00008300: 6f76 2e77 7269 7465 2873 656c 662e 6469  ov.write(self.di
+00008310: 722e 746f 2873 656c 662e 6469 722e 6474  r.to(self.dir.dt
+00008320: 2e70 726f 746f 636f 6c29 290a 2020 2020  .protocol)).    
+00008330: 2020 2020 732e 7374 6f70 2829 0a0a 2020      s.stop()..  
+00008340: 2020 6465 6620 7772 6974 6569 4644 4f66    def writeiFDOf
+00008350: 696c 6528 7365 6c66 2c61 6c6c 6f77 5f6d  ile(self,allow_m
+00008360: 6973 7369 6e67 5f72 6571 7569 7265 643d  issing_required=
+00008370: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
+00008380: 2222 2220 4465 7072 6563 6174 6564 202d  """ Deprecated -
+00008390: 2075 7365 2077 7269 7465 5f69 6664 6f5f   use write_ifdo_
+000083a0: 6669 6c65 2022 2222 0a20 2020 2020 2020  file """.       
+000083b0: 2073 656c 662e 7772 6974 655f 6966 646f   self.write_ifdo
+000083c0: 5f66 696c 6528 616c 6c6f 775f 6d69 7373  _file(allow_miss
+000083d0: 696e 675f 7265 7175 6972 6564 290a 0a0a  ing_required)...
+000083e0: 2020 2020 6465 6620 7365 7469 4644 4f46      def setiFDOF
+000083f0: 696c 654e 616d 6528 7365 6c66 2c69 4644  ileName(self,iFD
+00008400: 4f66 696c 653a 7374 7229 3a0a 2020 2020  Ofile:str):.    
+00008410: 2020 2020 2222 2220 5365 7420 7468 6520      """ Set the 
+00008420: 6375 7272 656e 7420 6946 444f 2066 696c  current iFDO fil
+00008430: 6520 6e61 6d65 2077 6974 6820 7061 7468  e name with path
+00008440: 2e20 5365 7420 746f 2022 2220 696e 206f  . Set to "" in o
+00008450: 7264 6572 2074 6f20 6765 7420 6465 6661  rder to get defa
+00008460: 756c 7420 6e61 6d65 2061 6e64 206c 6f63  ult name and loc
+00008470: 6174 696f 6e2e 2022 2222 0a20 2020 2020  ation. """.     
+00008480: 2020 2073 656c 662e 6946 444f 6669 6c65     self.iFDOfile
+00008490: 5f20 3d20 6946 444f 6669 6c65 0a20 2020  _ = iFDOfile.   
+000084a0: 2020 2020 2073 656c 662e 6946 444f 6669       self.iFDOfi
+000084b0: 6c65 5f20 3d20 7365 6c66 2e67 6574 6946  le_ = self.getiF
+000084c0: 444f 4669 6c65 4e61 6d65 2829 2023 2063  DOFileName() # c
+000084d0: 6f6e 7374 7275 6374 2064 6566 6175 6c74  onstruct default
+000084e0: 206e 616d 6520 6966 2065 6d70 7479 0a20   name if empty. 
+000084f0: 2020 2020 2020 2069 6620 6d69 7174 632e         if miqtc.
+00008500: 6173 7365 7274 536c 6173 6828 6f73 2e70  assertSlash(os.p
+00008510: 6174 682e 6469 726e 616d 6528 7365 6c66  ath.dirname(self
+00008520: 2e69 4644 4f66 696c 655f 2929 2021 3d20  .iFDOfile_)) != 
+00008530: 6d69 7174 632e 6173 7365 7274 536c 6173  miqtc.assertSlas
+00008540: 6828 7365 6c66 2e64 6972 2e74 6f28 7365  h(self.dir.to(se
+00008550: 6c66 2e64 6972 2e64 742e 7072 6f64 7563  lf.dir.dt.produc
+00008560: 7473 2929 3a0a 2020 2020 2020 2020 2020  ts)):.          
+00008570: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
+00008580: 2243 6175 7469 6f6e 2120 6946 444f 2066  "Caution! iFDO f
+00008590: 696c 6520 7061 7468 2069 7320 6e6f 7420  ile path is not 
+000085a0: 696e 2027 7072 6f64 7563 7473 2720 7375  in 'products' su
+000085b0: 6220 666f 6c64 6572 2061 7320 7265 636f  b folder as reco
+000085c0: 6d6d 656e 6465 642e 2043 6f6e 7369 6465  mmended. Conside
+000085d0: 7220 7265 7365 7474 696e 6720 7769 7468  r resetting with
+000085e0: 2073 6574 6946 444f 4669 6c65 4e61 6d65   setiFDOFileName
+000085f0: 2829 2e20 2220 2b20 6946 444f 6669 6c65  (). " + iFDOfile
+00008600: 290a 2020 2020 2020 2020 7472 793a 0a20  ).        try:. 
+00008610: 2020 2020 2020 2020 2020 2065 7665 6e74             event
+00008620: 203d 2073 656c 662e 6669 6e64 546d 7046   = self.findTmpF
+00008630: 6965 6c64 2827 696d 6167 652d 6576 656e  ield('image-even
+00008640: 7427 295b 276e 616d 6527 5d0a 2020 2020  t')['name'].    
+00008650: 2020 2020 2020 2020 7365 6e73 6f72 203d          sensor =
+00008660: 2073 656c 662e 6669 6e64 546d 7046 6965   self.findTmpFie
+00008670: 6c64 2827 696d 6167 652d 7365 6e73 6f72  ld('image-sensor
+00008680: 2729 5b27 6e61 6d65 275d 0a20 2020 2020  ')['name'].     
+00008690: 2020 2065 7863 6570 7420 6d69 7174 632e     except miqtc.
+000086a0: 4966 646f 4578 6365 7074 696f 6e3a 0a20  IfdoException:. 
+000086b0: 2020 2020 2020 2020 2020 2065 7665 6e74             event
+000086c0: 203d 2073 656c 662e 6469 722e 6576 656e   = self.dir.even
+000086d0: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+000086e0: 7365 6e73 6f72 203d 2073 656c 662e 6469  sensor = self.di
+000086f0: 722e 7365 6e73 6f72 2829 0a0a 2020 2020  r.sensor()..    
+00008700: 2020 2020 6946 444f 6669 6c65 4e61 6d65      iFDOfileName
+00008710: 203d 206f 732e 7061 7468 2e62 6173 656e   = os.path.basen
+00008720: 616d 6528 7365 6c66 2e69 4644 4f66 696c  ame(self.iFDOfil
+00008730: 655f 290a 2020 2020 2020 2020 6966 206e  e_).        if n
+00008740: 6f74 2065 7665 6e74 2069 6e20 6946 444f  ot event in iFDO
+00008750: 6669 6c65 4e61 6d65 206f 7220 6e6f 7420  fileName or not 
+00008760: 7365 6e73 6f72 2069 6e20 6946 444f 6669  sensor in iFDOfi
+00008770: 6c65 4e61 6d65 3a0a 2020 2020 2020 2020  leName:.        
+00008780: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+00008790: 6728 2243 6175 7469 6f6e 2120 6946 444f  g("Caution! iFDO
+000087a0: 2066 696c 6520 6e61 6d65 2064 6f65 7320   file name does 
+000087b0: 6e6f 7420 636f 6e74 6169 6e20 7072 6f6a  not contain proj
+000087c0: 6563 742c 2065 7665 6e74 2061 6e64 2073  ect, event and s
+000087d0: 656e 736f 7220 6e61 6d65 2061 7320 7265  ensor name as re
+000087e0: 636f 6d6d 656e 6465 642e 2043 6f6e 7369  commended. Consi
+000087f0: 6465 7220 7265 7365 7474 696e 6720 7769  der resetting wi
+00008800: 7468 2073 6574 6946 444f 4669 6c65 4e61  th setiFDOFileNa
+00008810: 6d65 2829 2e20 2220 2b20 6946 444f 6669  me(). " + iFDOfi
+00008820: 6c65 290a 0a0a 2020 2020 6465 6620 6765  le)...    def ge
+00008830: 7469 4644 4f46 696c 654e 616d 6528 7365  tiFDOFileName(se
+00008840: 6c66 2c6f 7665 7277 7269 7465 3d46 616c  lf,overwrite=Fal
+00008850: 7365 293a 0a20 2020 2020 2020 2022 2222  se):.        """
+00008860: 2052 6574 7572 6e73 2074 6865 2063 7572   Returns the cur
+00008870: 7265 6e74 2069 4644 4f20 6669 6c65 2773  rent iFDO file's
+00008880: 206e 616d 6520 7769 7468 2070 6174 682e   name with path.
+00008890: 2049 6620 6e6f 7420 7365 7420 7965 7420   If not set yet 
+000088a0: 6f72 206f 7665 7277 7269 7465 3d3d 5472  or overwrite==Tr
+000088b0: 7565 2069 7420 7265 7475 726e 7320 7468  ue it returns th
+000088c0: 6520 6f6e 6520 6d61 7463 6869 6e67 2069  e one matching i
+000088d0: 6d61 6765 2d73 6574 2d6e 616d 652e 2022  mage-set-name. "
+000088e0: 2222 0a20 2020 2020 2020 2069 6620 7365  "".        if se
+000088f0: 6c66 2e69 4644 4f66 696c 655f 203d 3d20  lf.iFDOfile_ == 
+00008900: 2222 206f 7220 6f76 6572 7772 6974 653a  "" or overwrite:
+00008910: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
+00008920: 655f 6e61 6d65 203d 2073 656c 662e 6669  e_name = self.fi
+00008930: 6e64 546d 7046 6965 6c64 2827 696d 6167  ndTmpField('imag
+00008940: 652d 7365 742d 6e61 6d65 2729 202b 2027  e-set-name') + '
+00008950: 5f69 4644 4f2e 6a73 6f6e 270a 2020 2020  _iFDO.json'.    
+00008960: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00008970: 6946 444f 6669 6c65 5f20 213d 2022 223a  iFDOfile_ != "":
+00008980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008990: 2023 2072 656e 616d 6520 6669 6c65 2062   # rename file b
+000089a0: 7574 206b 6565 7020 6c6f 6361 7469 6f6e  ut keep location
+000089b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000089c0: 2069 6620 6669 6c65 5f6e 616d 6520 213d   if file_name !=
+000089d0: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
+000089e0: 6528 7365 6c66 2e69 4644 4f66 696c 655f  e(self.iFDOfile_
+000089f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00008a00: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+00008a10: 2e6c 6f67 2822 4361 7574 696f 6e2c 2069  .log("Caution, i
+00008a20: 6664 6f20 6669 6c65 2072 656e 616d 6564  fdo file renamed
+00008a30: 2074 6f20 2220 2b20 6669 6c65 5f6e 616d   to " + file_nam
+00008a40: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00008a50: 2020 2073 656c 662e 6946 444f 6669 6c65     self.iFDOfile
+00008a60: 5f20 3d20 6f73 2e70 6174 682e 6a6f 696e  _ = os.path.join
+00008a70: 286f 732e 7061 7468 2e64 6972 6e61 6d65  (os.path.dirname
+00008a80: 2873 656c 662e 6946 444f 6669 6c65 5f29  (self.iFDOfile_)
+00008a90: 2c66 696c 655f 6e61 6d65 290a 2020 2020  ,file_name).    
+00008aa0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00008ab0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00008ac0: 6c66 2e69 4644 4f66 696c 655f 203d 206f  lf.iFDOfile_ = o
+00008ad0: 732e 7061 7468 2e6a 6f69 6e28 7365 6c66  s.path.join(self
+00008ae0: 2e64 6972 2e74 6f28 7365 6c66 2e64 6972  .dir.to(self.dir
+00008af0: 2e64 742e 7072 6f64 7563 7473 292c 2066  .dt.products), f
+00008b00: 696c 655f 6e61 6d65 290a 2020 2020 2020  ile_name).      
+00008b10: 2020 7265 7475 726e 2073 656c 662e 6946    return self.iF
+00008b20: 444f 6669 6c65 5f0a 0a0a 2020 2020 4073  DOfile_...    @s
+00008b30: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
+00008b40: 6465 6620 636f 6e73 7472 7563 7449 6d61  def constructIma
+00008b50: 6765 5365 744e 616d 6528 7072 6f6a 6563  geSetName(projec
+00008b60: 743a 7374 722c 6576 656e 743a 7374 722c  t:str,event:str,
+00008b70: 7365 6e73 6f72 3a73 7472 293a 0a20 2020  sensor:str):.   
+00008b80: 2020 2020 2022 2222 2072 6574 7572 6e73       """ returns
+00008b90: 203c 7072 6f6a 6563 743e 5f3c 6576 656e   <project>_<even
+00008ba0: 743e 5f3c 7365 6e73 6f72 3e2c 2077 6974  t>_<sensor>, wit
+00008bb0: 6820 7368 6f72 7420 7665 7273 696f 6e20  h short version 
+00008bc0: 6f66 203c 7365 6e73 6f72 3e20 286f 6e6c  of <sensor> (onl
+00008bd0: 7920 6964 292c 2070 7265 7665 6e74 696e  y id), preventin
+00008be0: 6720 706f 7465 6e74 6961 6c20 646f 7562  g potential doub
+00008bf0: 6c69 6e67 206f 6620 3c70 726f 6a65 6374  ling of <project
+00008c00: 3e20 2022 2222 0a20 2020 2020 2020 2073  >  """.        s
+00008c10: 656e 736f 725f 7368 6f72 7420 3d20 6946  ensor_short = iF
+00008c20: 444f 2e67 6574 5368 6f72 7445 7175 6970  DO.getShortEquip
+00008c30: 6d65 6e74 4944 2873 656e 736f 7229 0a20  mentID(sensor). 
+00008c40: 2020 2020 2020 2069 6620 6c65 6e28 6576         if len(ev
+00008c50: 656e 7429 203e 206c 656e 2870 726f 6a65  ent) > len(proje
+00008c60: 6374 2920 616e 6420 6576 656e 745b 303a  ct) and event[0:
+00008c70: 6c65 6e28 7072 6f6a 6563 7429 5d20 3d3d  len(project)] ==
+00008c80: 2070 726f 6a65 6374 3a0a 2020 2020 2020   project:.      
+00008c90: 2020 2020 2020 696d 6167 655f 7365 745f        image_set_
+00008ca0: 6e61 6d65 5f20 3d20 6576 656e 7420 2b20  name_ = event + 
+00008cb0: 225f 2220 2b20 7365 6e73 6f72 5f73 686f  "_" + sensor_sho
+00008cc0: 7274 0a20 2020 2020 2020 2065 6c73 653a  rt.        else:
+00008cd0: 0a20 2020 2020 2020 2020 2020 2069 6d61  .            ima
+00008ce0: 6765 5f73 6574 5f6e 616d 655f 203d 2070  ge_set_name_ = p
+00008cf0: 726f 6a65 6374 202b 2022 5f22 202b 2065  roject + "_" + e
+00008d00: 7665 6e74 202b 2022 5f22 202b 2073 656e  vent + "_" + sen
+00008d10: 736f 725f 7368 6f72 740a 2020 2020 2020  sor_short.      
+00008d20: 2020 7265 7475 726e 2069 6d61 6765 5f73    return image_s
+00008d30: 6574 5f6e 616d 655f 2023 2054 4f44 4f20  et_name_ # TODO 
+00008d40: 696e 636c 7564 6520 6461 7461 5479 7065  include dataType
+00008d50: 3f0a 0a0a 2020 2020 4073 7461 7469 636d  ?...    @staticm
+00008d60: 6574 686f 640a 2020 2020 6465 6620 6765  ethod.    def ge
+00008d70: 7453 686f 7274 4571 7569 706d 656e 7449  tShortEquipmentI
+00008d80: 4428 6571 7569 706d 656e 7449 443a 7374  D(equipmentID:st
+00008d90: 7229 3a0a 2020 2020 2020 2020 2222 2220  r):.        """ 
+00008da0: 7265 7475 726e 7320 6571 7569 706d 656e  returns equipmen
+00008db0: 7420 6964 2077 6974 686f 7574 2070 6f74  t id without pot
+00008dc0: 656e 7469 616c 6c20 6c6f 6e67 203c 6e61  entiall long <na
+00008dd0: 6d65 3e20 7061 7274 2c20 692e 652e 3a20  me> part, i.e.: 
+00008de0: 3c6f 776e 6572 3e5f 3c74 7970 653e 2d3c  <owner>_<type>-<
+00008df0: 7479 7065 2069 6e64 6578 5b5f 3c73 7562  type index[_<sub
+00008e00: 7479 7065 3e5d 2022 2222 0a20 2020 2020  type>] """.     
+00008e10: 2020 2072 6574 7572 6e20 275f 272e 6a6f     return '_'.jo
+00008e20: 696e 2865 7175 6970 6d65 6e74 4944 2e73  in(equipmentID.s
+00008e30: 706c 6974 2827 5f27 295b 303a 335d 290a  plit('_')[0:3]).
+00008e40: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
+00008e50: 6f64 0a20 2020 2064 6566 2063 6f6e 7374  od.    def const
+00008e60: 7275 6374 6946 444f 6669 6c65 4e61 6d65  ructiFDOfileName
+00008e70: 2870 726f 6a65 6374 3a73 7472 2c65 7665  (project:str,eve
+00008e80: 6e74 3a73 7472 2c73 656e 736f 723a 7374  nt:str,sensor:st
+00008e90: 7229 3a0a 2020 2020 2020 2020 2222 2220  r):.        """ 
+00008ea0: 7265 7475 726e 7320 3c63 6f6e 7374 7275  returns <constru
+00008eb0: 6374 496d 6167 6553 6574 4e61 6d65 2829  ctImageSetName()
+00008ec0: 3e5f 6946 444f 2e6a 736f 6e20 2222 220a  >_iFDO.json """.
+00008ed0: 2020 2020 2020 2020 7265 7475 726e 2069          return i
+00008ee0: 4644 4f2e 636f 6e73 7472 7563 7449 6d61  FDO.constructIma
+00008ef0: 6765 5365 744e 616d 6528 7072 6f6a 6563  geSetName(projec
+00008f00: 742c 6576 656e 742c 7365 6e73 6f72 2920  t,event,sensor) 
+00008f10: 2b20 275f 6946 444f 2e6a 736f 6e27 200a  + '_iFDO.json' .
+00008f20: 0a20 2020 200a 2020 2020 4073 7461 7469  .    .    @stati
+00008f30: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
+00008f40: 5f5f 6765 7446 6965 6c64 5661 6c75 6528  __getFieldValue(
+00008f50: 6966 646f 3a64 6963 742c 6b65 7973 3a6c  ifdo:dict,keys:l
+00008f60: 6973 742c 6465 6661 756c 745f 6f6e 6c79  ist,default_only
+00008f70: 203d 2046 616c 7365 293a 0a20 2020 2020   = False):.     
+00008f80: 2020 2022 2222 2072 6574 7572 6e73 2063     """ returns c
+00008f90: 6f70 7920 6f66 2073 6574 206f 7220 6974  opy of set or it
+00008fa0: 656d 2066 6965 6c64 2076 616c 7565 2c20  em field value, 
+00008fb0: 616c 736f 2063 6f6e 7369 6465 726e 6720  also considerng 
+00008fc0: 6465 6661 756c 7420 7661 6c75 6573 2066  default values f
+00008fd0: 726f 6d20 6865 6164 6572 2e0a 2020 2020  rom header..    
+00008fe0: 2020 2020 2020 2020 5573 6520 6b65 7973          Use keys
+00008ff0: 2061 7320 652e 672e 205b 3c69 7465 6d3e   as e.g. [<item>
+00009000: 2c3c 6b65 793e 2c2e 2e5d 2e20 4361 6e20  ,<key>,..]. Can 
+00009010: 6265 2075 7365 6420 666f 7220 6865 6164  be used for head
+00009020: 6572 2066 6965 6c64 7320 6173 2077 656c  er fields as wel
+00009030: 6c20 6173 2069 7465 6d20 6669 656c 6473  l as item fields
+00009040: 2e0a 2020 2020 2020 2020 2020 2020 4974  ..            It
+00009050: 656d 2069 6e64 6578 2063 616e 2062 6520  em index can be 
+00009060: 6e65 676c 6563 7465 642c 2069 6e20 6361  neglected, in ca
+00009070: 7365 206f 6620 7669 6465 6f20 6120 6469  se of video a di
+00009080: 6374 207b 3c69 6d61 6765 2d64 6174 6174  ct {<image-datat
+00009090: 696d 653e 3a3c 7661 6c75 653e 2c2e 2e2e  ime>:<value>,...
+000090a0: 7d20 6973 2072 6574 7572 6e65 640a 2020  } is returned.  
+000090b0: 2020 2020 2020 2020 2020 756e 6c65 7373            unless
+000090c0: 2064 6566 6175 6c74 5f6f 6e6c 7920 3d20   default_only = 
+000090d0: 4661 6c73 652c 2074 6865 6e20 6465 6661  False, then defa
+000090e0: 756c 7420 7661 6c75 6573 2061 7420 696e  ult values at in
+000090f0: 6465 7820 3020 6973 2072 6574 7572 6e65  dex 0 is returne
+00009100: 642e 0a20 2020 2020 2020 2020 2020 2052  d..            R
+00009110: 6169 7365 7320 4966 646f 4578 6365 7074  aises IfdoExcept
+00009120: 696f 6e20 6966 206b 6579 7320 646f 206e  ion if keys do n
+00009130: 6f74 2065 7869 7374 2e20 2222 220a 0a20  ot exist. """.. 
+00009140: 2020 2020 2020 2069 6620 6e6f 7420 6d69         if not mi
+00009150: 7174 762e 696d 6167 655f 7365 745f 6974  qtv.image_set_it
+00009160: 656d 735f 6b65 7920 696e 2069 6664 6f20  ems_key in ifdo 
+00009170: 6f72 206e 6f74 206d 6971 7476 2e69 6d61  or not miqtv.ima
+00009180: 6765 5f73 6574 5f68 6561 6465 725f 6b65  ge_set_header_ke
+00009190: 7920 696e 2069 6664 6f3a 0a20 2020 2020  y in ifdo:.     
+000091a0: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
+000091b0: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
+000091c0: 2822 496e 7661 6c69 6420 6966 646f 2064  ("Invalid ifdo d
+000091d0: 6963 742c 206d 6973 7369 6e67 2069 7465  ict, missing ite
+000091e0: 6d73 206f 7220 6865 6164 6572 206b 6579  ms or header key
+000091f0: 3a20 2220 2b20 7374 7228 6966 646f 2929  : " + str(ifdo))
+00009200: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+00009210: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+00009220: 6e63 6528 6b65 7973 2c6c 6973 7429 3a0a  nce(keys,list):.
+00009230: 2020 2020 2020 2020 2020 2020 6b65 7973              keys
+00009240: 203d 205b 6b65 7973 5d0a 0a20 2020 2020   = [keys]..     
+00009250: 2020 2023 2072 656d 6f76 6520 6865 6164     # remove head
+00009260: 6572 206f 7220 6974 656d 2070 7265 6669  er or item prefi
+00009270: 7865 7320 6966 2074 6865 7265 0a20 2020  xes if there.   
+00009280: 2020 2020 2069 6620 6b65 7973 5b30 5d20       if keys[0] 
+00009290: 3d3d 206d 6971 7476 2e69 6d61 6765 5f73  == miqtv.image_s
+000092a0: 6574 5f69 7465 6d73 5f6b 6579 206f 7220  et_items_key or 
+000092b0: 6b65 7973 5b30 5d20 3d3d 206d 6971 7476  keys[0] == miqtv
+000092c0: 2e69 6d61 6765 5f73 6574 5f68 6561 6465  .image_set_heade
+000092d0: 725f 6b65 793a 0a20 2020 2020 2020 2020  r_key:.         
+000092e0: 2020 206b 6579 7320 3d20 6b65 7973 5b31     keys = keys[1
+000092f0: 3a3a 5d0a 0a20 2020 2020 2020 2068 6561  ::]..        hea
+00009300: 6465 7220 3d20 6966 646f 5b6d 6971 7476  der = ifdo[miqtv
+00009310: 2e69 6d61 6765 5f73 6574 5f68 6561 6465  .image_set_heade
+00009320: 725f 6b65 795d 0a20 2020 2020 2020 2069  r_key].        i
+00009330: 7465 6d73 203d 2069 6664 6f5b 6d69 7174  tems = ifdo[miqt
+00009340: 762e 696d 6167 655f 7365 745f 6974 656d  v.image_set_item
+00009350: 735f 6b65 795d 0a20 2020 2020 2020 2023  s_key].        #
+00009360: 206c 6f6f 6b20 666f 7220 6465 6661 756c   look for defaul
+00009370: 7420 7661 6c75 650a 2020 2020 2020 2020  t value.        
+00009380: 666f 7220 736b 6970 7065 6449 6e48 6561  for skippedInHea
+00009390: 6465 7220 696e 2072 616e 6765 286c 656e  der in range(len
+000093a0: 286b 6579 7329 293a 0a20 2020 2020 2020  (keys)):.       
+000093b0: 2020 2020 2064 6566 6175 6c74 5661 6c20       defaultVal 
+000093c0: 3d20 6669 6e64 4669 656c 6428 6865 6164  = findField(head
+000093d0: 6572 2c6b 6579 735b 736b 6970 7065 6449  er,keys[skippedI
+000093e0: 6e48 6561 6465 723a 3a5d 290a 2020 2020  nHeader::]).    
+000093f0: 2020 2020 2020 2020 6966 2064 6566 6175          if defau
+00009400: 6c74 5661 6c20 213d 2022 223a 0a20 2020  ltVal != "":.   
+00009410: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+00009420: 616b 0a0a 2020 2020 2020 2020 2323 206c  ak..        ## l
+00009430: 6f6f 6b20 666f 7220 6974 656d 2076 616c  ook for item val
+00009440: 7565 0a20 2020 2020 2020 2023 2068 6561  ue.        # hea
+00009450: 6465 7220 6f6e 6c79 2076 616c 7565 2c20  der only value, 
+00009460: 646f 6e27 7420 6368 6563 6b20 696e 2069  don't check in i
+00009470: 7465 6d73 0a20 2020 2020 2020 2069 6620  tems.        if 
+00009480: 6669 6e64 4669 656c 6428 6974 656d 732c  findField(items,
+00009490: 6b65 7973 5b30 3a31 5d29 203d 3d20 2222  keys[0:1]) == ""
+000094a0: 2061 6e64 2073 6b69 7070 6564 496e 4865   and skippedInHe
+000094b0: 6164 6572 203d 3d20 303a 0a20 2020 2020  ader == 0:.     
+000094c0: 2020 2020 2020 2072 6574 203d 2064 6566         ret = def
+000094d0: 6175 6c74 5661 6c0a 2020 2020 2020 2020  aultVal.        
+000094e0: 2020 2020 6966 2072 6574 203d 3d20 2222      if ret == ""
+000094f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00009500: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
+00009510: 646f 4578 6365 7074 696f 6e28 226b 6579  doException("key
+00009520: 2064 6f65 7320 6e6f 7420 6578 6973 743a   does not exist:
+00009530: 2220 2b20 7374 7228 6b65 7973 2929 0a20  " + str(keys)). 
+00009540: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00009550: 2020 2020 2020 2020 2023 2069 6620 6669           # if fi
+00009560: 7273 7420 6b65 7920 6e6f 7420 666f 756e  rst key not foun
+00009570: 6420 696e 2069 7465 6d73 2c20 692e 652e  d in items, i.e.
+00009580: 2069 7320 6e6f 7420 6120 696d 6167 6520   is not a image 
+00009590: 6e61 6d65 2c20 616e 6420 6669 7273 7420  name, and first 
+000095a0: 6b65 7920 6973 206e 6f74 2061 2068 6561  key is not a hea
+000095b0: 6465 7220 6b65 793a 0a20 2020 2020 2020  der key:.       
+000095c0: 2020 2020 2069 6620 6669 6e64 4669 656c       if findFiel
+000095d0: 6428 6974 656d 732c 6b65 7973 5b30 3a31  d(items,keys[0:1
+000095e0: 5d29 203d 3d20 2222 2061 6e64 2073 6b69  ]) == "" and ski
+000095f0: 7070 6564 496e 4865 6164 6572 2021 3d20  ppedInHeader != 
+00009600: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+00009610: 2020 2072 6169 7365 206d 6971 7463 2e49     raise miqtc.I
+00009620: 6664 6f45 7863 6570 7469 6f6e 2822 6974  fdoException("it
+00009630: 656d 2064 6f65 7320 6e6f 7420 6578 6973  em does not exis
+00009640: 743a 2220 2b20 7374 7228 6b65 7973 5b30  t:" + str(keys[0
+00009650: 3a31 5d29 290a 0a20 2020 2020 2020 2020  :1]))..         
+00009660: 2020 2023 2063 6865 636b 2069 6620 696e     # check if in
+00009670: 6465 7820 7072 6f76 6964 6564 0a20 2020  dex provided.   
+00009680: 2020 2020 2020 2020 2069 6e64 6578 5072           indexPr
+00009690: 6f76 6964 6564 203d 2054 7275 650a 2020  ovided = True.  
+000096a0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+000096b0: 286b 6579 7329 203e 2031 3a0a 2020 2020  (keys) > 1:.    
+000096c0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+000096d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000096e0: 2020 2020 2069 6e64 6578 203d 2069 6e74       index = int
+000096f0: 286b 6579 735b 315d 290a 2020 2020 2020  (keys[1]).      
+00009700: 2020 2020 2020 2020 2020 6578 6365 7074            except
+00009710: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
+00009720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009730: 696e 6465 7850 726f 7669 6465 6420 3d20  indexProvided = 
+00009740: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+00009750: 2020 656c 6966 206c 656e 286b 6579 7329    elif len(keys)
+00009760: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
+00009770: 2020 2020 2020 2069 6e64 6578 5072 6f76         indexProv
+00009780: 6964 6564 203d 2046 616c 7365 0a20 2020  ided = False.   
+00009790: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+000097a0: 2020 2020 2020 2020 2020 696d 6167 6549            imageI
+000097b0: 7465 6d54 696d 6550 6f69 6e74 7320 3d20  temTimePoints = 
+000097c0: 6974 656d 735b 6b65 7973 5b30 5d5d 0a0a  items[keys[0]]..
+000097d0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+000097e0: 6e64 6578 5072 6f76 6964 6564 3a0a 2020  ndexProvided:.  
+000097f0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00009800: 6966 206b 6579 2069 7320 7768 6f6c 6520  if key is whole 
+00009810: 696d 6167 6520 6164 6420 616c 6c20 7661  image add all va
+00009820: 6c75 6573 2066 726f 6d20 6865 6164 6572  lues from header
+00009830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009840: 2069 6620 6c65 6e28 6b65 7973 2920 3d3d   if len(keys) ==
+00009850: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
+00009860: 2020 2020 2020 2020 6465 6661 756c 7456          defaultV
+00009870: 616c 203d 2068 6561 6465 720a 2020 2020  al = header.    
+00009880: 2020 2020 2020 2020 2020 2020 2320 6164              # ad
+00009890: 6420 6465 6661 756c 7420 6672 6f6d 2069  d default from i
+000098a0: 6e64 6578 2030 0a20 2020 2020 2020 2020  ndex 0.         
+000098b0: 2020 2020 2020 2069 6620 6c65 6e28 6b65         if len(ke
+000098c0: 7973 2920 3e20 3120 616e 6420 696e 6465  ys) > 1 and inde
+000098d0: 7820 213d 2030 3a0a 2020 2020 2020 2020  x != 0:.        
+000098e0: 2020 2020 2020 2020 2020 2020 6b65 7973              keys
+000098f0: 5f30 203d 2063 6f70 792e 6465 6570 636f  _0 = copy.deepco
+00009900: 7079 286b 6579 7329 0a20 2020 2020 2020  py(keys).       
+00009910: 2020 2020 2020 2020 2020 2020 206b 6579               key
+00009920: 735f 305b 315d 203d 2030 0a20 2020 2020  s_0[1] = 0.     
+00009930: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00009940: 6574 5f30 203d 2069 4644 4f2e 5f5f 6765  et_0 = iFDO.__ge
+00009950: 7449 7465 6d56 616c 7565 2869 7465 6d73  tItemValue(items
+00009960: 2c6b 6579 735f 302c 736b 6970 7065 6449  ,keys_0,skippedI
+00009970: 6e48 6561 6465 722c 6465 6661 756c 7456  nHeader,defaultV
+00009980: 616c 290a 2020 2020 2020 2020 2020 2020  al).            
+00009990: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+000099a0: 7461 6e63 6528 7265 745f 302c 6469 6374  tance(ret_0,dict
+000099b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000099c0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+000099d0: 6c74 5661 6c20 3d20 7b2a 2a64 6566 6175  ltVal = {**defau
+000099e0: 6c74 5661 6c2c 2a2a 7265 745f 307d 0a20  ltVal,**ret_0}. 
+000099f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00009a00: 6574 203d 2069 4644 4f2e 5f5f 6765 7449  et = iFDO.__getI
+00009a10: 7465 6d56 616c 7565 2869 7465 6d73 2c6b  temValue(items,k
+00009a20: 6579 732c 736b 6970 7065 6449 6e48 6561  eys,skippedInHea
+00009a30: 6465 722c 6465 6661 756c 7456 616c 290a  der,defaultVal).
+00009a40: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00009a50: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00009a60: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00009a70: 2069 6620 6b65 7920 6973 2077 686f 6c65   if key is whole
+00009a80: 2069 6d61 6765 2061 6464 2061 6c6c 2076   image add all v
+00009a90: 616c 7565 7320 6672 6f6d 2068 6561 6465  alues from heade
+00009aa0: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
+00009ab0: 2020 6966 206c 656e 286b 6579 7329 203d    if len(keys) =
+00009ac0: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
+00009ad0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00009ae0: 5661 6c20 3d20 6865 6164 6572 0a0a 2020  Val = header..  
+00009af0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00009b00: 7069 6374 7572 6520 2d3e 206a 7573 7420  picture -> just 
+00009b10: 6f6e 6520 656e 7472 792c 2069 6e73 6572  one entry, inser
+00009b20: 7420 696e 6465 7820 300a 2020 2020 2020  t index 0.      
+00009b30: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00009b40: 2869 6d61 6765 4974 656d 5469 6d65 506f  (imageItemTimePo
+00009b50: 696e 7473 2920 3d3d 2031 3a0a 2020 2020  ints) == 1:.    
+00009b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009b70: 6b65 7973 203d 206b 6579 735b 303a 315d  keys = keys[0:1]
+00009b80: 202b 205b 305d 202b 206b 6579 735b 313a   + [0] + keys[1:
+00009b90: 3a5d 0a20 2020 2020 2020 2020 2020 2020  :].             
+00009ba0: 2020 2020 2020 2072 6574 203d 2069 4644         ret = iFD
+00009bb0: 4f2e 5f5f 6765 7449 7465 6d56 616c 7565  O.__getItemValue
+00009bc0: 2869 7465 6d73 2c6b 6579 732c 736b 6970  (items,keys,skip
+00009bd0: 7065 6449 6e48 6561 6465 722c 6465 6661  pedInHeader,defa
+00009be0: 756c 7456 616c 290a 2020 2020 2020 2020  ultVal).        
+00009bf0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00009c00: 2020 2020 2020 2020 2020 2020 2023 2076               # v
+00009c10: 6964 656f 202d 3e20 7265 7475 726e 2076  ideo -> return v
+00009c20: 616c 7565 7320 666f 7220 6561 6368 2074  alues for each t
+00009c30: 696d 6520 7374 616d 700a 2020 2020 2020  ime stamp.      
+00009c40: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00009c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c60: 2020 2020 7265 7420 3d20 7b7d 0a20 2020      ret = {}.   
+00009c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c80: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+00009c90: 6c65 6e28 696d 6167 6549 7465 6d54 696d  len(imageItemTim
+00009ca0: 6550 6f69 6e74 7329 293a 0a20 2020 2020  ePoints)):.     
+00009cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009cc0: 2020 2074 696d 6550 6f69 6e74 4461 7461     timePointData
+00009cd0: 203d 2069 6d61 6765 4974 656d 5469 6d65   = imageItemTime
+00009ce0: 506f 696e 7473 5b69 5d0a 2020 2020 2020  Points[i].      
+00009cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009d00: 2020 6b65 7973 5f69 203d 206b 6579 735b    keys_i = keys[
+00009d10: 303a 315d 202b 205b 695d 202b 206b 6579  0:1] + [i] + key
+00009d20: 735b 313a 3a5d 0a20 2020 2020 2020 2020  s[1::].         
+00009d30: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00009d40: 616c 5f69 203d 2069 4644 4f2e 5f5f 6765  al_i = iFDO.__ge
+00009d50: 7449 7465 6d56 616c 7565 2869 7465 6d73  tItemValue(items
+00009d60: 2c6b 6579 735f 692c 736b 6970 7065 6449  ,keys_i,skippedI
+00009d70: 6e48 6561 6465 722c 6465 6661 756c 7456  nHeader,defaultV
+00009d80: 616c 290a 2020 2020 2020 2020 2020 2020  al).            
+00009d90: 2020 2020 2020 2020 2020 2020 2320 6465              # de
+00009da0: 6661 756c 7420 6f6e 6c79 0a20 2020 2020  fault only.     
+00009db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009dc0: 2020 2069 6620 6465 6661 756c 745f 6f6e     if default_on
+00009dd0: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
+00009de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009df0: 7265 7420 3d20 7661 6c5f 690a 2020 2020  ret = val_i.    
+00009e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009e10: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
+00009e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009e30: 2020 2020 2020 7265 745b 7469 6d65 506f        ret[timePo
+00009e40: 696e 7444 6174 615b 2769 6d61 6765 2d64  intData['image-d
+00009e50: 6174 6574 696d 6527 5d5d 203d 2076 616c  atetime']] = val
+00009e60: 5f69 0a20 2020 2020 2020 2020 2020 2020  _i.             
+00009e70: 2020 2020 2020 2020 2020 2023 2072 656d             # rem
+00009e80: 6f76 6520 696d 6167 652d 6461 7465 7469  ove image-dateti
+00009e90: 6d65 2069 6620 7468 6572 650a 2020 2020  me if there.    
+00009ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009eb0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00009ec0: 6528 7265 745b 7469 6d65 506f 696e 7444  e(ret[timePointD
+00009ed0: 6174 615b 2769 6d61 6765 2d64 6174 6574  ata['image-datet
+00009ee0: 696d 6527 5d5d 2c64 6963 7429 2061 6e64  ime']],dict) and
+00009ef0: 2027 696d 6167 652d 6461 7465 7469 6d65   'image-datetime
+00009f00: 2720 696e 2072 6574 5b74 696d 6550 6f69  ' in ret[timePoi
+00009f10: 6e74 4461 7461 5b27 696d 6167 652d 6461  ntData['image-da
+00009f20: 7465 7469 6d65 275d 5d3a 0a20 2020 2020  tetime']]:.     
+00009f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009f40: 2020 2020 2020 2064 656c 2072 6574 5b74         del ret[t
+00009f50: 696d 6550 6f69 6e74 4461 7461 5b27 696d  imePointData['im
+00009f60: 6167 652d 6461 7465 7469 6d65 275d 5d5b  age-datetime']][
+00009f70: 2769 6d61 6765 2d64 6174 6574 696d 6527  'image-datetime'
+00009f80: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00009f90: 2020 2020 2020 2020 2020 2320 7669 6465            # vide
+00009fa0: 6f20 6465 6661 756c 7473 0a20 2020 2020  o defaults.     
+00009fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009fc0: 2020 2069 6620 6920 3d3d 2030 3a0a 2020     if i == 0:.  
+00009fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009fe0: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+00009ff0: 6e73 7461 6e63 6528 7265 745b 7469 6d65  nstance(ret[time
+0000a000: 506f 696e 7444 6174 615b 2769 6d61 6765  PointData['image
+0000a010: 2d64 6174 6574 696d 6527 5d5d 2c64 6963  -datetime']],dic
+0000a020: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+0000a030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a040: 2020 2020 6465 6661 756c 7456 616c 203d      defaultVal =
+0000a050: 207b 2a2a 6465 6661 756c 7456 616c 2c2a   {**defaultVal,*
+0000a060: 2a72 6574 5b74 696d 6550 6f69 6e74 4461  *ret[timePointDa
+0000a070: 7461 5b27 696d 6167 652d 6461 7465 7469  ta['image-dateti
+0000a080: 6d65 275d 5d7d 0a20 2020 2020 2020 2020  me']]}.         
+0000a090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a0a0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000a0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a0c0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+0000a0d0: 5661 6c20 3d20 7265 745b 7469 6d65 506f  Val = ret[timePo
+0000a0e0: 696e 7444 6174 615b 2769 6d61 6765 2d64  intData['image-d
+0000a0f0: 6174 6574 696d 6527 5d5d 0a0a 2020 2020  atetime']]..    
+0000a100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a110: 2020 2020 6920 2b3d 2031 0a0a 2020 2020      i += 1..    
+0000a120: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0000a130: 6528 7265 742c 6469 6374 2920 6f72 2069  e(ret,dict) or i
+0000a140: 7369 6e73 7461 6e63 6528 7265 742c 6c69  sinstance(ret,li
+0000a150: 7374 293a 0a20 2020 2020 2020 2020 2020  st):.           
+0000a160: 2072 6574 203d 2063 6f70 792e 6465 6570   ret = copy.deep
+0000a170: 636f 7079 2872 6574 290a 2020 2020 2020  copy(ret).      
+0000a180: 2020 6966 2072 6574 203d 3d20 2222 206f    if ret == "" o
+0000a190: 7220 7265 7420 3d3d 207b 7d3a 0a20 2020  r ret == {}:.   
+0000a1a0: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
+0000a1b0: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
+0000a1c0: 6f6e 2822 6b65 7973 2064 6f20 6e6f 7420  on("keys do not 
+0000a1d0: 6578 6973 743a 2220 2b20 7374 7228 6b65  exist:" + str(ke
+0000a1e0: 7973 2929 0a20 2020 2020 2020 2072 6574  ys)).        ret
+0000a1f0: 7572 6e20 7265 740a 0a0a 2020 2020 4073  urn ret...    @s
+0000a200: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
+0000a210: 6465 6620 5f5f 6765 7449 7465 6d56 616c  def __getItemVal
+0000a220: 7565 2869 7465 6d73 2c6b 6579 732c 736b  ue(items,keys,sk
+0000a230: 6970 7065 6449 6e48 6561 6465 722c 6465  ippedInHeader,de
+0000a240: 6661 756c 7456 616c 293a 0a20 2020 2020  faultVal):.     
+0000a250: 2020 200a 2020 2020 2020 2020 2320 696e     .        # in
+0000a260: 2063 6173 6520 6974 656d 2069 7320 6e6f   case item is no
+0000a270: 7420 6120 6c69 7374 2028 7368 6f75 6c64  t a list (should
+0000a280: 206e 6f74 2062 6520 706f 7373 6962 6c65   not be possible
+0000a290: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
+0000a2a0: 2069 7369 6e73 7461 6e63 6528 6974 656d   isinstance(item
+0000a2b0: 735b 6b65 7973 5b30 5d5d 2c6c 6973 7429  s[keys[0]],list)
+0000a2c0: 3a0a 2020 2020 2020 2020 2020 2020 6974  :.            it
+0000a2d0: 656d 735b 6b65 7973 5b30 5d5d 203d 205b  ems[keys[0]] = [
+0000a2e0: 6974 656d 735b 6b65 7973 5b30 5d5d 5d0a  items[keys[0]]].
+0000a2f0: 0a20 2020 2020 2020 2069 7465 6d56 616c  .        itemVal
+0000a300: 7565 203d 2066 696e 6446 6965 6c64 2869  ue = findField(i
+0000a310: 7465 6d73 2c6b 6579 7329 0a0a 2020 2020  tems,keys)..    
+0000a320: 2020 2020 6966 2069 7465 6d56 616c 7565      if itemValue
+0000a330: 203d 3d20 2222 3a0a 2020 2020 2020 2020   == "":.        
+0000a340: 2020 2020 7265 7420 3d20 6465 6661 756c      ret = defaul
+0000a350: 7456 616c 0a20 2020 2020 2020 2023 2069  tVal.        # i
+0000a360: 6e20 6361 7365 206f 6620 6469 6374 7320  n case of dicts 
+0000a370: 6a6f 696e 7420 6865 6164 6572 2061 6e64  joint header and
+0000a380: 2069 7465 6d20 6669 656c 6473 0a20 2020   item fields.   
+0000a390: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
+0000a3a0: 616e 6365 2869 7465 6d56 616c 7565 2c64  ance(itemValue,d
+0000a3b0: 6963 7429 2061 6e64 2064 6566 6175 6c74  ict) and default
+0000a3c0: 5661 6c20 213d 2022 223a 0a20 2020 2020  Val != "":.     
+0000a3d0: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+0000a3e0: 696e 7374 616e 6365 2864 6566 6175 6c74  instance(default
+0000a3f0: 5661 6c2c 6469 6374 293a 0a20 2020 2020  Val,dict):.     
+0000a400: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000a410: 206d 6971 7463 2e49 6664 6f45 7863 6570   miqtc.IfdoExcep
+0000a420: 7469 6f6e 2822 4974 656d 2066 6965 6c64  tion("Item field
+0000a430: 2069 7320 6469 6374 2062 7574 2064 6566   is dict but def
+0000a440: 6175 6c74 2076 616c 7565 2069 6e20 6865  ault value in he
+0000a450: 6164 6572 2069 7320 6e6f 743a 2022 202b  ader is not: " +
+0000a460: 2073 7472 286b 6579 7329 290a 2020 2020   str(keys)).    
+0000a470: 2020 2020 2020 2020 7265 7420 3d20 7b2a          ret = {*
+0000a480: 2a64 6566 6175 6c74 5661 6c2c 2a2a 6974  *defaultVal,**it
+0000a490: 656d 5661 6c75 657d 0a20 2020 2020 2020  emValue}.       
+0000a4a0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000a4b0: 2020 2072 6574 203d 2069 7465 6d56 616c     ret = itemVal
+0000a4c0: 7565 0a20 2020 2020 2020 2072 6574 7572  ue.        retur
+0000a4d0: 6e20 7265 740a 0a0a 2020 2020 6465 6620  n ret...    def 
+0000a4e0: 5f5f 7374 725f 5f28 7365 6c66 2920 2d3e  __str__(self) ->
+0000a4f0: 2073 7472 3a0a 2020 2020 2020 2020 2222   str:.        ""
+0000a500: 2220 5072 696e 7473 2063 7572 7265 6e74  " Prints current
+0000a510: 2069 4644 4f20 6669 6c65 2022 2222 0a20   iFDO file """. 
+0000a520: 2020 2020 2020 2072 6574 7572 6e20 7961         return ya
+0000a530: 6d6c 2e64 756d 7028 7365 6c66 2e69 6664  ml.dump(self.ifd
+0000a540: 6f5f 6368 6563 6b65 642c 2064 6566 6175  o_checked, defau
+0000a550: 6c74 5f73 7479 6c65 3d4e 6f6e 652c 2064  lt_style=None, d
+0000a560: 6566 6175 6c74 5f66 6c6f 775f 7374 796c  efault_flow_styl
+0000a570: 653d 4e6f 6e65 2c20 616c 6c6f 775f 756e  e=None, allow_un
+0000a580: 6963 6f64 653d 5472 7565 2c20 7769 6474  icode=True, widt
+0000a590: 683d 666c 6f61 7428 2269 6e66 2229 290a  h=float("inf")).
+0000a5a0: 0a0a 2020 2020 6465 6620 5f5f 6765 7469  ..    def __geti
+0000a5b0: 7465 6d5f 5f28 7365 6c66 2c20 6b65 7973  tem__(self, keys
+0000a5c0: 293a 0a20 2020 2020 2020 2022 2222 2052  ):.        """ R
+0000a5d0: 6574 7572 6e73 2063 6f70 7920 6f66 2063  eturns copy of c
+0000a5e0: 6865 636b 6564 2069 6664 6f20 7365 7420  hecked ifdo set 
+0000a5f0: 6f72 2069 7465 6d20 6669 656c 6420 7661  or item field va
+0000a600: 6c75 652c 2061 6c73 6f20 636f 6e73 6964  lue, also consid
+0000a610: 6572 6e67 2064 6566 6175 6c74 2076 616c  erng default val
+0000a620: 7565 7320 6672 6f6d 2068 6561 6465 722e  ues from header.
+0000a630: 0a20 2020 2020 2020 2020 2020 2055 7365  .            Use
+0000a640: 206b 6579 7320 6173 2065 2e67 2e20 273c   keys as e.g. '<
+0000a650: 6974 656d 3e3a 3c6b 6579 3e3a 2e2e 2e27  item>:<key>:...'
+0000a660: 2e20 4361 6e20 6265 2075 7365 6420 666f  . Can be used fo
+0000a670: 7220 6865 6164 6572 2066 6965 6c64 7320  r header fields 
+0000a680: 6173 2077 656c 6c20 6173 2069 7465 6d20  as well as item 
+0000a690: 6669 656c 6473 2e0a 2020 2020 2020 2020  fields..        
+0000a6a0: 2020 2020 4974 656d 2069 6e64 6578 2063      Item index c
+0000a6b0: 616e 2062 6520 6c65 676c 6563 7465 642c  an be leglected,
+0000a6c0: 2069 6e20 6361 7365 206f 6620 7669 6465   in case of vide
+0000a6d0: 6f20 6120 6469 6374 207b 3c69 6d61 6765  o a dict {<image
+0000a6e0: 2d64 6174 6174 696d 653e 3a3c 7661 6c75  -datatime>:<valu
+0000a6f0: 653e 2c2e 2e2e 7d20 6973 2072 6574 7572  e>,...} is retur
+0000a700: 6e65 642e 0a20 2020 2020 2020 2020 2020  ned..           
+0000a710: 2052 6169 7365 7320 4966 646f 4578 6365   Raises IfdoExce
+0000a720: 7074 696f 6e20 6966 2069 7465 6d20 646f  ption if item do
+0000a730: 6573 206e 6f74 2065 7869 7374 2e20 2222  es not exist. ""
+0000a740: 220a 2020 2020 2020 2020 6b65 7973 203d  ".        keys =
+0000a750: 206b 6579 732e 7370 6c69 7428 273a 2729   keys.split(':')
+0000a760: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000a770: 7365 6c66 2e5f 5f67 6574 4669 656c 6456  self.__getFieldV
+0000a780: 616c 7565 2873 656c 662e 6966 646f 5f63  alue(self.ifdo_c
+0000a790: 6865 636b 6564 2c6b 6579 7329 0a0a 0a20  hecked,keys)... 
+0000a7a0: 2020 2064 6566 2066 696e 6454 6d70 4669     def findTmpFi
+0000a7b0: 656c 6428 7365 6c66 2c6b 6579 7329 3a0a  eld(self,keys):.
+0000a7c0: 2020 2020 2020 2020 2222 2220 5265 7475          """ Retu
+0000a7d0: 726e 7320 636f 7079 206f 6620 7465 6d70  rns copy of temp
+0000a7e0: 6f72 6172 7920 756e 6368 6563 6b65 6420  orary unchecked 
+0000a7f0: 6966 646f 2073 6574 206f 7220 6974 656d  ifdo set or item
+0000a800: 2066 6965 6c64 2076 616c 7565 2c20 616c   field value, al
+0000a810: 736f 2063 6f6e 7369 6465 726e 6720 6465  so considerng de
+0000a820: 6661 756c 7420 7661 6c75 6573 2066 726f  fault values fro
+0000a830: 6d20 6865 6164 6572 2e0a 2020 2020 2020  m header..      
+0000a840: 2020 2020 2020 5573 6520 6b65 7973 2061        Use keys a
+0000a850: 7320 652e 672e 2027 3c69 7465 6d3e 3a3c  s e.g. '<item>:<
+0000a860: 6b65 793e 3a2e 2e2e 272e 2043 616e 2062  key>:...'. Can b
+0000a870: 6520 7573 6564 2066 6f72 2068 6561 6465  e used for heade
+0000a880: 7220 6669 656c 6473 2061 7320 7765 6c6c  r fields as well
+0000a890: 2061 7320 6974 656d 2066 6965 6c64 732e   as item fields.
+0000a8a0: 0a20 2020 2020 2020 2020 2020 2049 7465  .            Ite
+0000a8b0: 6d20 696e 6465 7820 6361 6e20 6265 206c  m index can be l
+0000a8c0: 6567 6c65 6374 6564 2c20 696e 2063 6173  eglected, in cas
+0000a8d0: 6520 6f66 2076 6964 656f 2061 2064 6963  e of video a dic
+0000a8e0: 7420 7b3c 696d 6167 652d 6461 7461 7469  t {<image-datati
+0000a8f0: 6d65 3e3a 3c76 616c 7565 3e2c 2e2e 2e7d  me>:<value>,...}
+0000a900: 2069 7320 7265 7475 726e 6564 2e0a 2020   is returned..  
+0000a910: 2020 2020 2020 2020 2020 5261 6973 6573            Raises
+0000a920: 2049 6664 6f45 7863 6570 7469 6f6e 2069   IfdoException i
+0000a930: 6620 6974 656d 2064 6f65 7320 6e6f 7420  f item does not 
+0000a940: 6578 6973 742e 2022 2222 0a20 2020 2020  exist. """.     
+0000a950: 2020 206b 6579 7320 3d20 6b65 7973 2e73     keys = keys.s
+0000a960: 706c 6974 2827 3a27 290a 2020 2020 2020  plit(':').      
+0000a970: 2020 7265 7475 726e 2073 656c 662e 5f5f    return self.__
+0000a980: 6765 7446 6965 6c64 5661 6c75 6528 7365  getFieldValue(se
+0000a990: 6c66 2e69 6664 6f5f 746d 702c 6b65 7973  lf.ifdo_tmp,keys
+0000a9a0: 290a 2020 2020 0a0a 2020 2020 6465 6620  ).    ..    def 
+0000a9b0: 6669 6e64 546d 7046 6965 6c64 3228 7365  findTmpField2(se
+0000a9c0: 6c66 2c6b 6579 7329 3a0a 2020 2020 2020  lf,keys):.      
+0000a9d0: 2020 2222 2220 5361 6d65 2061 7320 6669    """ Same as fi
+0000a9e0: 6e64 546d 7046 6965 6c64 2069 6e73 7465  ndTmpField inste
+0000a9f0: 6164 206f 6620 7261 6973 696e 6720 6578  ad of raising ex
+0000aa00: 6365 7074 696f 6e20 6974 2072 6574 7572  ception it retur
+0000aa10: 6e20 656d 7074 7920 7374 7269 6e67 2e20  n empty string. 
+0000aa20: 2222 220a 2020 2020 2020 2020 6b65 7973  """.        keys
+0000aa30: 203d 206b 6579 732e 7370 6c69 7428 273a   = keys.split(':
+0000aa40: 2729 0a20 2020 2020 2020 2074 7279 3a0a  ').        try:.
+0000aa50: 2020 2020 2020 2020 2020 2020 7265 7420              ret 
+0000aa60: 3d20 7365 6c66 2e5f 5f67 6574 4669 656c  = self.__getFiel
+0000aa70: 6456 616c 7565 2873 656c 662e 6966 646f  dValue(self.ifdo
+0000aa80: 5f74 6d70 2c6b 6579 7329 0a20 2020 2020  _tmp,keys).     
+0000aa90: 2020 2065 7863 6570 7420 6d69 7174 632e     except miqtc.
+0000aaa0: 4966 646f 4578 6365 7074 696f 6e3a 0a20  IfdoException:. 
+0000aab0: 2020 2020 2020 2020 2020 2072 6574 203d             ret =
+0000aac0: 2022 220a 2020 2020 2020 2020 7265 7475   "".        retu
+0000aad0: 726e 2072 6574 0a0a 0a20 2020 2064 6566  rn ret...    def
+0000aae0: 2073 6574 6946 444f 4865 6164 6572 4669   setiFDOHeaderFi
+0000aaf0: 656c 6473 2873 656c 662c 2068 6561 6465  elds(self, heade
+0000ab00: 723a 2064 6963 7429 3a0a 2020 2020 2020  r: dict):.      
+0000ab10: 2020 2222 2220 436c 6561 7273 2063 7572    """ Clears cur
+0000ab20: 7265 6e74 2068 6561 6465 7220 6669 656c  rent header fiel
+0000ab30: 6473 2075 6e64 2073 6574 7320 7072 6f76  ds und sets prov
+0000ab40: 6964 6564 2066 6965 6c64 2076 616c 7565  ided field value
+0000ab50: 732e 2046 6f72 2075 7064 6174 696e 6720  s. For updating 
+0000ab60: 6578 6973 7469 6e67 206f 6e65 7320 7573  existing ones us
+0000ab70: 6520 7570 6461 7465 5f69 6664 6f5f 6865  e update_ifdo_he
+0000ab80: 6164 6572 5f66 6965 6c64 7328 2920 2222  ader_fields() ""
+0000ab90: 220a 2020 2020 2020 2020 7365 6c66 2e69  ".        self.i
+0000aba0: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
+0000abb0: 6765 5365 7448 6561 6465 724b 6579 5d20  geSetHeaderKey] 
+0000abc0: 3d20 7b7d 0a20 2020 2020 2020 2069 6620  = {}.        if 
+0000abd0: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+0000abe0: 6465 724b 6579 2069 6e20 6865 6164 6572  derKey in header
+0000abf0: 3a0a 2020 2020 2020 2020 2020 2020 6865  :.            he
+0000ac00: 6164 6572 203d 2068 6561 6465 725b 7365  ader = header[se
+0000ac10: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+0000ac20: 724b 6579 5d0a 2020 2020 2020 2020 666f  rKey].        fo
+0000ac30: 7220 6669 656c 6420 696e 2068 6561 6465  r field in heade
+0000ac40: 723a 0a20 2020 2020 2020 2020 2020 2023  r:.            #
+0000ac50: 6966 2066 6965 6c64 206e 6f74 2069 6e20  if field not in 
+0000ac60: 6d69 7174 762e 6966 646f 5f68 6561 6465  miqtv.ifdo_heade
+0000ac70: 725f 636f 7265 5f66 6965 6c64 733a 0a20  r_core_fields:. 
+0000ac80: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+0000ac90: 7365 6c66 2e70 726f 762e 6c6f 6728 2243  self.prov.log("C
+0000aca0: 6175 7469 6f6e 3a20 556e 6b6e 6f77 6e20  aution: Unknown 
+0000acb0: 6865 6164 6572 2066 6965 6c64 205c 2222  header field \""
+0000acc0: 202b 2066 6965 6c64 202b 2022 5c22 2e20   + field + "\". 
+0000acd0: 4d61 7962 6520 6120 7479 706f 3f20 4f74  Maybe a typo? Ot
+0000ace0: 6865 7277 6973 6520 6967 6e6f 7265 206d  herwise ignore m
+0000acf0: 652e 2229 0a20 2020 2020 2020 2020 2020  e.").           
+0000ad00: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
+0000ad10: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+0000ad20: 6572 4b65 795d 5b66 6965 6c64 5d20 3d20  erKey][field] = 
+0000ad30: 6865 6164 6572 5b66 6965 6c64 5d0a 0a0a  header[field]...
+0000ad40: 2020 2020 6465 6620 7570 6461 7465 5f69      def update_i
+0000ad50: 6664 6f5f 6865 6164 6572 5f66 6965 6c64  fdo_header_field
+0000ad60: 7328 7365 6c66 2c20 6865 6164 6572 3a20  s(self, header: 
+0000ad70: 6469 6374 293a 0a20 2020 2020 2020 2022  dict):.        "
+0000ad80: 2222 2055 7064 6174 6573 2065 7869 7374  "" Updates exist
+0000ad90: 696e 6720 6865 6164 6572 2066 6965 6c64  ing header field
+0000ada0: 7320 2222 220a 2020 2020 2020 2020 6966  s """.        if
+0000adb0: 2073 656c 662e 696d 6167 6553 6574 4865   self.imageSetHe
+0000adc0: 6164 6572 4b65 7920 696e 2068 6561 6465  aderKey in heade
+0000add0: 723a 0a20 2020 2020 2020 2020 2020 2068  r:.            h
+0000ade0: 6561 6465 7220 3d20 6865 6164 6572 5b73  eader = header[s
+0000adf0: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+0000ae00: 6572 4b65 795d 0a20 2020 2020 2020 206c  erKey].        l
+0000ae10: 6f67 203d 206d 6971 7463 2e72 6563 7572  og = miqtc.recur
+0000ae20: 7369 7665 6c79 5570 6461 7465 4469 6374  sivelyUpdateDict
+0000ae30: 7328 7365 6c66 2e69 6664 6f5f 746d 705b  s(self.ifdo_tmp[
+0000ae40: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+0000ae50: 6465 724b 6579 5d2c 2068 6561 6465 7229  derKey], header)
+0000ae60: 0a20 2020 2020 2020 2073 656c 662e 7072  .        self.pr
+0000ae70: 6f76 2e6c 6f67 286c 6f67 2c64 6f6e 7453  ov.log(log,dontS
+0000ae80: 686f 773d 5472 7565 290a 0a20 2020 2064  how=True)..    d
+0000ae90: 6566 2075 7064 6174 6569 4644 4f48 6561  ef updateiFDOHea
+0000aea0: 6465 7246 6965 6c64 7328 7365 6c66 2c20  derFields(self, 
+0000aeb0: 6865 6164 6572 3a20 6469 6374 293a 0a20  header: dict):. 
+0000aec0: 2020 2020 2020 2022 2222 2044 6570 7265         """ Depre
+0000aed0: 6361 7465 6420 2d20 7573 6520 7570 6461  cated - use upda
+0000aee0: 7465 5f69 6664 6f5f 6865 6164 6572 5f66  te_ifdo_header_f
+0000aef0: 6965 6c64 7320 2222 220a 2020 2020 2020  ields """.      
+0000af00: 2020 7365 6c66 2e75 7064 6174 655f 6966    self.update_if
+0000af10: 646f 5f68 6561 6465 725f 6669 656c 6473  do_header_fields
+0000af20: 2868 6561 6465 7229 0a0a 0a20 2020 2064  (header)...    d
+0000af30: 6566 205f 7472 795f 7570 6772 6164 655f  ef _try_upgrade_
+0000af40: 746f 5f69 6664 6f5f 7665 7273 696f 6e5f  to_ifdo_version_
+0000af50: 3278 2873 656c 6629 3a0a 2020 2020 2020  2x(self):.      
+0000af60: 2020 2222 2220 5472 7920 746f 2063 6f6e    """ Try to con
+0000af70: 7665 7274 2066 6965 6c64 7320 6672 6f6d  vert fields from
+0000af80: 2069 4644 4f20 7665 7273 696f 6e20 3c20   iFDO version < 
+0000af90: 322e 302e 3020 746f 2032 2e78 2022 2222  2.0.0 to 2.x """
+0000afa0: 0a20 2020 2020 2020 2072 6561 645f 7665  .        read_ve
+0000afb0: 7273 696f 6e5f 7374 7220 3d20 2276 312e  rsion_str = "v1.
+0000afc0: 302e 3022 2023 2064 6964 206e 6f74 2068  0.0" # did not h
+0000afd0: 6176 6520 7468 6520 2769 6d61 6765 2d73  ave the 'image-s
+0000afe0: 6574 2d69 6664 6f2d 7665 7273 696f 6e27  et-ifdo-version'
+0000aff0: 2066 6965 6c64 2079 6574 0a20 2020 2020   field yet.     
+0000b000: 2020 2074 7279 3a20 0a20 2020 2020 2020     try: .       
+0000b010: 2020 2020 2072 6561 645f 7665 7273 696f       read_versio
+0000b020: 6e5f 7374 7220 3d20 7365 6c66 2e66 696e  n_str = self.fin
+0000b030: 6454 6d70 4669 656c 6428 2769 6d61 6765  dTmpField('image
+0000b040: 2d73 6574 2d69 6664 6f2d 7665 7273 696f  -set-ifdo-versio
+0000b050: 6e27 290a 2020 2020 2020 2020 6578 6365  n').        exce
+0000b060: 7074 206d 6971 7463 2e49 6664 6f45 7863  pt miqtc.IfdoExc
+0000b070: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
+0000b080: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
+0000b090: 2072 6561 645f 7665 7273 696f 6e20 3d20   read_version = 
+0000b0a0: 5665 7273 696f 6e28 7265 6164 5f76 6572  Version(read_ver
+0000b0b0: 7369 6f6e 5f73 7472 290a 0a20 2020 2020  sion_str)..     
+0000b0c0: 2020 2069 6620 7265 6164 5f76 6572 7369     if read_versi
+0000b0d0: 6f6e 203c 2056 6572 7369 6f6e 2822 322e  on < Version("2.
+0000b0e0: 302e 3022 293a 0a20 2020 2020 2020 2020  0.0"):.         
+0000b0f0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+0000b100: 2320 6e65 7720 5552 4920 6f62 6a65 6374  # new URI object
+0000b110: 2066 6965 6c64 730a 2020 2020 2020 2020   fields.        
+0000b120: 2020 2020 6e65 775f 7572 695f 6669 656c      new_uri_fiel
+0000b130: 6473 203d 205b 2769 6d61 6765 2d73 656e  ds = ['image-sen
+0000b140: 736f 7227 2c27 696d 6167 652d 6576 656e  sor','image-even
+0000b150: 7427 2c27 696d 6167 652d 7072 6f6a 6563  t','image-projec
+0000b160: 7427 2c27 696d 6167 652d 636f 6e74 6578  t','image-contex
+0000b170: 7427 2c27 696d 6167 652d 6c69 6365 6e73  t','image-licens
+0000b180: 6527 2c27 696d 6167 652d 706c 6174 666f  e','image-platfo
+0000b190: 726d 275d 0a20 2020 2020 2020 2020 2020  rm'].           
+0000b1a0: 2066 6f72 2075 7269 5f66 6965 6c64 2069   for uri_field i
+0000b1b0: 6e20 6e65 775f 7572 695f 6669 656c 6473  n new_uri_fields
+0000b1c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000b1d0: 2020 6f6c 645f 7374 725f 7661 6c20 3d20    old_str_val = 
+0000b1e0: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
+0000b1f0: 6432 2875 7269 5f66 6965 6c64 290a 2020  d2(uri_field).  
+0000b200: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000b210: 2069 7369 6e73 7461 6e63 6528 6f6c 645f   isinstance(old_
+0000b220: 7374 725f 7661 6c2c 7374 7229 2061 6e64  str_val,str) and
+0000b230: 206f 6c64 5f73 7472 5f76 616c 2021 3d20   old_str_val != 
+0000b240: 2222 3a20 2020 2020 2020 2020 2020 2020  "":             
+0000b250: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+0000b260: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+0000b270: 6f62 6a5f 7661 6c20 3d20 7b27 6e61 6d65  obj_val = {'name
+0000b280: 273a 206f 6c64 5f73 7472 5f76 616c 7d0a  ': old_str_val}.
+0000b290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b2a0: 2020 2020 6973 5f75 7269 2c20 6d73 6720      is_uri, msg 
+0000b2b0: 3d20 6d69 7174 742e 7661 6c69 6461 7465  = miqtt.validate
+0000b2c0: 5f61 6761 696e 7374 5f73 6368 656d 6128  _against_schema(
+0000b2d0: 6f6c 645f 7374 725f 7661 6c2c 7b22 7479  old_str_val,{"ty
+0000b2e0: 7065 223a 2022 7374 7269 6e67 222c 2266  pe": "string","f
+0000b2f0: 6f72 6d61 7422 3a20 2275 7269 227d 290a  ormat": "uri"}).
+0000b300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b310: 2020 2020 6966 2069 735f 7572 693a 0a20      if is_uri:. 
+0000b320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b330: 2020 2020 2020 206e 6577 5f6f 626a 5f76         new_obj_v
+0000b340: 616c 5b27 7572 6927 5d20 3d20 6f6c 645f  al['uri'] = old_
+0000b350: 7374 725f 7661 6c0a 2020 2020 2020 2020  str_val.        
+0000b360: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000b370: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
+0000b380: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
+0000b390: 5d5b 7572 695f 6669 656c 645d 203d 206e  ][uri_field] = n
+0000b3a0: 6577 5f6f 626a 5f76 616c 0a20 2020 2020  ew_obj_val.     
+0000b3b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000b3c0: 656c 662e 7072 6f76 2e6c 6f67 2822 4175  elf.prov.log("Au
+0000b3d0: 746f 2d75 7067 7261 6465 6420 2220 2b20  to-upgraded " + 
+0000b3e0: 7572 695f 6669 656c 6420 2b20 2220 6672  uri_field + " fr
+0000b3f0: 6f6d 2022 202b 206f 6c64 5f73 7472 5f76  om " + old_str_v
+0000b400: 616c 202b 2022 2074 6f20 2220 2b20 7374  al + " to " + st
+0000b410: 7228 6e65 775f 6f62 6a5f 7661 6c29 290a  r(new_obj_val)).
+0000b420: 0a0a 0a20 2020 2064 6566 2074 7279 4175  ...    def tryAu
+0000b430: 746f 5365 7448 6561 6465 7246 6965 6c64  toSetHeaderField
+0000b440: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+0000b450: 2022 2222 2053 6574 7320 6365 7274 6169   """ Sets certai
+0000b460: 6e20 6865 6164 6572 2066 6965 6c64 7320  n header fields 
+0000b470: 652e 672e 2066 726f 6d20 6469 7265 6374  e.g. from direct
+0000b480: 6f72 7920 6966 2074 6865 7920 6172 6520  ory if they are 
+0000b490: 6e6f 7420 7365 7420 7965 7420 2222 220a  not set yet """.
+0000b4a0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0000b4b0: 2e66 696e 6454 6d70 4669 656c 6432 2827  .findTmpField2('
+0000b4c0: 696d 6167 652d 7365 6e73 6f72 2729 203d  image-sensor') =
+0000b4d0: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
+0000b4e0: 2020 7365 6c66 2e69 6664 6f5f 746d 705b    self.ifdo_tmp[
+0000b4f0: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+0000b500: 6465 724b 6579 5d5b 2769 6d61 6765 2d73  derKey]['image-s
+0000b510: 656e 736f 7227 5d20 3d20 7b27 6e61 6d65  ensor'] = {'name
+0000b520: 273a 2073 656c 662e 6469 722e 7365 6e73  ': self.dir.sens
+0000b530: 6f72 2829 7d0a 2020 2020 2020 2020 656c  or()}.        el
+0000b540: 6966 2073 656c 662e 6669 6e64 546d 7046  if self.findTmpF
+0000b550: 6965 6c64 2827 696d 6167 652d 7365 6e73  ield('image-sens
+0000b560: 6f72 2729 5b27 6e61 6d65 275d 2021 3d20  or')['name'] != 
+0000b570: 7365 6c66 2e64 6972 2e73 656e 736f 7228  self.dir.sensor(
+0000b580: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
+0000b590: 656c 662e 7072 6f76 2e6c 6f67 2822 4361  elf.prov.log("Ca
+0000b5a0: 7574 696f 6e3a 2027 696d 6167 652d 7365  ution: 'image-se
+0000b5b0: 6e73 6f72 2720 222b 2073 7472 2873 656c  nsor' "+ str(sel
+0000b5c0: 662e 6669 6e64 546d 7046 6965 6c64 2827  f.findTmpField('
+0000b5d0: 696d 6167 652d 7365 6e73 6f72 2729 2920  image-sensor')) 
+0000b5e0: 2b20 2220 6469 6666 6572 7320 6672 6f6d  + " differs from
+0000b5f0: 2073 656e 736f 7220 7061 7273 6564 2066   sensor parsed f
+0000b600: 726f 6d20 6469 7265 6374 6f72 793a 2022  rom directory: "
+0000b610: 202b 2073 656c 662e 6469 722e 7365 6e73   + self.dir.sens
+0000b620: 6f72 2829 290a 0a20 2020 2020 2020 2069  or())..        i
+0000b630: 6620 7365 6c66 2e66 696e 6454 6d70 4669  f self.findTmpFi
+0000b640: 656c 6432 2827 696d 6167 652d 6576 656e  eld2('image-even
+0000b650: 7427 2920 3d3d 2022 223a 0a20 2020 2020  t') == "":.     
+0000b660: 2020 2020 2020 2073 656c 662e 6966 646f         self.ifdo
+0000b670: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
+0000b680: 6574 4865 6164 6572 4b65 795d 5b27 696d  etHeaderKey]['im
+0000b690: 6167 652d 6576 656e 7427 5d20 3d20 7b27  age-event'] = {'
+0000b6a0: 6e61 6d65 273a 2073 656c 662e 6469 722e  name': self.dir.
+0000b6b0: 6576 656e 7428 297d 0a20 2020 2020 2020  event()}.       
+0000b6c0: 2065 6c69 6620 7365 6c66 2e66 696e 6454   elif self.findT
+0000b6d0: 6d70 4669 656c 6428 2769 6d61 6765 2d65  mpField('image-e
+0000b6e0: 7665 6e74 2729 5b27 6e61 6d65 275d 2021  vent')['name'] !
+0000b6f0: 3d20 7365 6c66 2e64 6972 2e65 7665 6e74  = self.dir.event
+0000b700: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+0000b710: 7365 6c66 2e70 726f 762e 6c6f 6728 2243  self.prov.log("C
+0000b720: 6175 7469 6f6e 3a20 2769 6d61 6765 2d65  aution: 'image-e
+0000b730: 7665 6e74 2720 2220 2b20 7374 7228 7365  vent' " + str(se
+0000b740: 6c66 2e66 696e 6454 6d70 4669 656c 6428  lf.findTmpField(
+0000b750: 2769 6d61 6765 2d65 7665 6e74 2729 2920  'image-event')) 
+0000b760: 2b20 2220 6469 6666 6572 7320 6672 6f6d  + " differs from
+0000b770: 2065 7665 6e74 2070 6172 7365 6420 6672   event parsed fr
+0000b780: 6f6d 2064 6972 6563 746f 7279 3a20 2220  om directory: " 
+0000b790: 2b20 7365 6c66 2e64 6972 2e65 7665 6e74  + self.dir.event
+0000b7a0: 2829 290a 0a20 2020 2020 2020 2069 6620  ())..        if 
+0000b7b0: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
+0000b7c0: 6432 2827 696d 6167 652d 7072 6f6a 6563  d2('image-projec
+0000b7d0: 7427 2920 3d3d 2022 223a 0a20 2020 2020  t') == "":.     
+0000b7e0: 2020 2020 2020 2073 656c 662e 6966 646f         self.ifdo
+0000b7f0: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
+0000b800: 6574 4865 6164 6572 4b65 795d 5b27 696d  etHeaderKey]['im
+0000b810: 6167 652d 7072 6f6a 6563 7427 5d20 3d20  age-project'] = 
+0000b820: 207b 276e 616d 6527 3a20 7365 6c66 2e64   {'name': self.d
+0000b830: 6972 2e70 726f 6a65 6374 2829 7d0a 2020  ir.project()}.  
+0000b840: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
+0000b850: 6669 6e64 546d 7046 6965 6c64 2827 696d  findTmpField('im
+0000b860: 6167 652d 7072 6f6a 6563 7427 295b 276e  age-project')['n
+0000b870: 616d 6527 5d20 213d 2073 656c 662e 6469  ame'] != self.di
+0000b880: 722e 7072 6f6a 6563 7428 293a 0a20 2020  r.project():.   
+0000b890: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+0000b8a0: 6f76 2e6c 6f67 2822 4361 7574 696f 6e3a  ov.log("Caution:
+0000b8b0: 2027 696d 6167 652d 7072 6f6a 6563 7427   'image-project'
+0000b8c0: 2022 202b 2073 7472 2873 656c 662e 6669   " + str(self.fi
+0000b8d0: 6e64 546d 7046 6965 6c64 2827 696d 6167  ndTmpField('imag
+0000b8e0: 652d 7072 6f6a 6563 7427 2929 202b 2022  e-project')) + "
+0000b8f0: 2064 6966 6665 7273 2066 726f 6d20 7072   differs from pr
+0000b900: 6f6a 6563 7420 7061 7273 6564 2066 726f  oject parsed fro
+0000b910: 6d20 6469 7265 6374 6f72 793a 2022 202b  m directory: " +
+0000b920: 2073 656c 662e 6469 722e 7072 6f6a 6563   self.dir.projec
+0000b930: 7428 2929 0a0a 2020 2020 2020 2020 6966  t())..        if
+0000b940: 2073 656c 662e 6669 6e64 546d 7046 6965   self.findTmpFie
+0000b950: 6c64 3228 2769 6d61 6765 2d70 6c61 7466  ld2('image-platf
+0000b960: 6f72 6d27 2920 3d3d 2022 2220 616e 6420  orm') == "" and 
+0000b970: 7365 6c66 2e64 6972 2e67 6561 7228 2920  self.dir.gear() 
+0000b980: 213d 2022 223a 0a20 2020 2020 2020 2020  != "":.         
+0000b990: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
+0000b9a0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+0000b9b0: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
+0000b9c0: 706c 6174 666f 726d 275d 203d 207b 276e  platform'] = {'n
+0000b9d0: 616d 6527 3a20 7365 6c66 2e64 6972 2e67  ame': self.dir.g
+0000b9e0: 6561 7228 297d 0a0a 2020 2020 2020 2020  ear()}..        
+0000b9f0: 6966 206e 6f74 2027 696d 6167 652d 7365  if not 'image-se
+0000ba00: 742d 7575 6964 2720 696e 2073 656c 662e  t-uuid' in self.
+0000ba10: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
+0000ba20: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
+0000ba30: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0000ba40: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+0000ba50: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
+0000ba60: 6579 5d5b 2769 6d61 6765 2d73 6574 2d75  ey]['image-set-u
+0000ba70: 7569 6427 5d20 3d20 7374 7228 6d69 7174  uid'] = str(miqt
+0000ba80: 632e 7575 6964 3428 2929 0a20 2020 2020  c.uuid4()).     
+0000ba90: 2020 2069 6620 6e6f 7420 2769 6d61 6765     if not 'image
+0000baa0: 2d73 6574 2d68 616e 646c 6527 2069 6e20  -set-handle' in 
+0000bab0: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+0000bac0: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+0000bad0: 724b 6579 5d3a 0a20 2020 2020 2020 2020  rKey]:.         
+0000bae0: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
+0000baf0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+0000bb00: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
+0000bb10: 7365 742d 6861 6e64 6c65 275d 203d 2073  set-handle'] = s
+0000bb20: 656c 662e 6861 6e64 6c65 5f70 7265 6669  elf.handle_prefi
+0000bb30: 7820 2b20 222f 2220 2b20 7365 6c66 2e66  x + "/" + self.f
+0000bb40: 696e 6454 6d70 4669 656c 6428 2769 6d61  indTmpField('ima
+0000bb50: 6765 2d73 6574 2d75 7569 6427 290a 2020  ge-set-uuid').  
+0000bb60: 2020 2020 2020 6966 206e 6f74 2027 696d        if not 'im
+0000bb70: 6167 652d 7365 742d 6e61 6d65 2720 696e  age-set-name' in
+0000bb80: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
+0000bb90: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+0000bba0: 6572 4b65 795d 206f 7220 7365 6c66 2e66  erKey] or self.f
+0000bbb0: 696e 6454 6d70 4669 656c 6432 2827 696d  indTmpField2('im
+0000bbc0: 6167 652d 7365 742d 6e61 6d65 2729 203d  age-set-name') =
+0000bbd0: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
+0000bbe0: 2020 2320 636f 6e73 7472 7563 7420 6173    # construct as
+0000bbf0: 203c 7072 6f6a 6563 743e 5f3c 6576 656e   <project>_<even
+0000bc00: 743e 5f3c 7365 6e73 6f72 3e0a 2020 2020  t>_<sensor>.    
+0000bc10: 2020 2020 2020 2020 7072 6f6a 6563 745f          project_
+0000bc20: 203d 2073 656c 662e 6669 6e64 546d 7046   = self.findTmpF
+0000bc30: 6965 6c64 3228 2269 6d61 6765 2d70 726f  ield2("image-pro
+0000bc40: 6a65 6374 2229 5b27 6e61 6d65 275d 0a20  ject")['name']. 
+0000bc50: 2020 2020 2020 2020 2020 2065 7665 6e74             event
+0000bc60: 5f20 3d20 7365 6c66 2e66 696e 6454 6d70  _ = self.findTmp
+0000bc70: 4669 656c 6432 2822 696d 6167 652d 6576  Field2("image-ev
+0000bc80: 656e 7422 295b 276e 616d 6527 5d0a 2020  ent")['name'].  
+0000bc90: 2020 2020 2020 2020 2020 6966 2065 7665            if eve
+0000bca0: 6e74 5f20 3d3d 2022 223a 0a20 2020 2020  nt_ == "":.     
+0000bcb0: 2020 2020 2020 2020 2020 2065 7665 6e74             event
+0000bcc0: 5f20 3d20 7365 6c66 2e64 6972 2e65 7665  _ = self.dir.eve
+0000bcd0: 6e74 2829 0a20 2020 2020 2020 2020 2020  nt().           
+0000bce0: 2073 656e 736f 725f 203d 2073 656c 662e   sensor_ = self.
+0000bcf0: 6669 6e64 546d 7046 6965 6c64 3228 2269  findTmpField2("i
+0000bd00: 6d61 6765 2d73 656e 736f 7222 295b 276e  mage-sensor")['n
+0000bd10: 616d 6527 5d0a 2020 2020 2020 2020 2020  ame'].          
+0000bd20: 2020 6966 2073 656e 736f 725f 203d 3d20    if sensor_ == 
+0000bd30: 2222 3a0a 2020 2020 2020 2020 2020 2020  "":.            
+0000bd40: 2020 2020 7365 6e73 6f72 5f20 3d20 7365      sensor_ = se
+0000bd50: 6c66 2e64 6972 2e73 656e 736f 7228 290a  lf.dir.sensor().
+0000bd60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000bd70: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
+0000bd80: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
+0000bd90: 5d5b 2769 6d61 6765 2d73 6574 2d6e 616d  ]['image-set-nam
+0000bda0: 6527 5d20 3d20 6946 444f 2e63 6f6e 7374  e'] = iFDO.const
+0000bdb0: 7275 6374 496d 6167 6553 6574 4e61 6d65  ructImageSetName
+0000bdc0: 2870 726f 6a65 6374 5f2c 6576 656e 745f  (project_,event_
+0000bdd0: 2c73 656e 736f 725f 290a 0a20 2020 2020  ,sensor_)..     
+0000bde0: 2020 2023 2073 6574 2076 6572 7369 6f6e     # set version
+0000bdf0: 0a20 2020 2020 2020 2073 656c 662e 6966  .        self.if
+0000be00: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+0000be10: 6553 6574 4865 6164 6572 4b65 795d 5b27  eSetHeaderKey]['
+0000be20: 696d 6167 652d 7365 742d 6966 646f 2d76  image-set-ifdo-v
+0000be30: 6572 7369 6f6e 275d 203d 206d 6971 7476  ersion'] = miqtv
+0000be40: 2e69 4644 4f5f 7665 7273 696f 6e0a 0a0a  .iFDO_version...
+0000be50: 2020 2020 6465 6620 7365 7448 6561 6465      def setHeade
+0000be60: 7249 6d61 6765 4c6f 6361 6c50 6174 6846  rImageLocalPathF
+0000be70: 6965 6c64 2873 656c 6629 3a0a 2020 2020  ield(self):.    
+0000be80: 2020 2020 2222 2220 5365 7473 2068 6561      """ Sets hea
+0000be90: 6465 7220 6669 656c 6420 2769 6d61 6765  der field 'image
+0000bea0: 2d6c 6f63 616c 2d70 6174 6827 2066 726f  -local-path' fro
+0000beb0: 6d20 696d 6167 6520 6469 7220 2222 220a  m image dir """.
+0000bec0: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
+0000bed0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
+0000bee0: 5365 7448 6561 6465 724b 6579 5d5b 2769  SetHeaderKey]['i
+0000bef0: 6d61 6765 2d6c 6f63 616c 2d70 6174 6827  mage-local-path'
+0000bf00: 5d20 3d20 6f73 2e70 6174 682e 7265 6c70  ] = os.path.relp
+0000bf10: 6174 6828 7365 6c66 2e69 6d61 6765 7344  ath(self.imagesD
+0000bf20: 6972 2c20 6f73 2e70 6174 682e 6469 726e  ir, os.path.dirn
+0000bf30: 616d 6528 7365 6c66 2e67 6574 6946 444f  ame(self.getiFDO
+0000bf40: 4669 6c65 4e61 6d65 2829 2929 0a0a 0a20  FileName()))... 
+0000bf50: 2020 2064 6566 2063 7265 6174 655f 6669     def create_fi
+0000bf60: 656c 6473 2873 656c 662c 2061 6c6c 6f77  elds(self, allow
+0000bf70: 5f6d 6973 7369 6e67 5f72 6571 7569 7265  _missing_require
+0000bf80: 643d 4661 6c73 6529 3a0a 2020 2020 2020  d=False):.      
+0000bf90: 2020 2222 2220 4372 6561 7465 2061 6e64    """ Create and
+0000bfa0: 2076 616c 6964 6174 6520 6375 7272 656e   validate curren
+0000bfb0: 7420 6865 6164 6572 2066 6965 6c64 7320  t header fields 
+0000bfc0: 616e 6420 6974 656d 2066 6965 6c64 7320  and item fields 
+0000bfd0: 6672 6f6d 2069 6e74 6572 6d65 6469 6174  from intermediat
+0000bfe0: 6520 6669 6c65 732e 204f 7665 7277 7269  e files. Overwri
+0000bff0: 7465 7320 6578 6973 7469 6e67 2066 6965  tes existing fie
+0000c000: 6c64 732e 2022 2222 0a20 2020 2020 2020  lds. """.       
+0000c010: 2069 7465 6d5f 6461 7461 203d 2073 656c   item_data = sel
+0000c020: 662e 5f67 6574 5f69 7465 6d5f 6461 7461  f._get_item_data
+0000c030: 5f66 726f 6d5f 696e 7465 726d 6564 6961  _from_intermedia
+0000c040: 7465 5f66 696c 6573 2829 0a20 2020 2020  te_files().     
+0000c050: 2020 2072 6574 7572 6e20 7365 6c66 2e63     return self.c
+0000c060: 7265 6174 6569 4644 4f28 7365 6c66 2e69  reateiFDO(self.i
+0000c070: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
+0000c080: 6765 5365 7448 6561 6465 724b 6579 5d2c  geSetHeaderKey],
+0000c090: 2069 7465 6d5f 6461 7461 2e76 616c 7565   item_data.value
+0000c0a0: 7328 292c 2061 6c6c 6f77 5f6d 6973 7369  s(), allow_missi
+0000c0b0: 6e67 5f72 6571 7569 7265 643d 616c 6c6f  ng_required=allo
+0000c0c0: 775f 6d69 7373 696e 675f 7265 7175 6972  w_missing_requir
+0000c0d0: 6564 290a 0a0a 2020 2020 6465 6620 7570  ed)...    def up
+0000c0e0: 6461 7465 5f66 6965 6c64 7328 7365 6c66  date_fields(self
+0000c0f0: 293a 0a20 2020 2020 2020 2022 2222 2055  ):.        """ U
+0000c100: 7064 6174 6520 616e 6420 7661 6c69 6461  pdate and valida
+0000c110: 7465 2063 7572 7265 6e74 2068 6561 6465  te current heade
+0000c120: 7220 6669 656c 6473 2061 6e64 2069 7465  r fields and ite
+0000c130: 6d20 6669 656c 6473 2066 726f 6d20 696e  m fields from in
+0000c140: 7465 726d 6564 6961 7465 2066 696c 6573  termediate files
+0000c150: 2e20 2222 220a 2020 2020 2020 2020 6974  . """.        it
+0000c160: 656d 5f64 6174 6120 3d20 7365 6c66 2e5f  em_data = self._
 0000c170: 6765 745f 6974 656d 5f64 6174 615f 6672  get_item_data_fr
 0000c180: 6f6d 5f69 6e74 6572 6d65 6469 6174 655f  om_intermediate_
-0000c190: 6669 6c65 735f 636f 7265 2873 656c 6629  files_core(self)
-0000c1a0: 3a0a 2020 2020 2020 2020 2222 2220 5265  :.        """ Re
-0000c1b0: 6164 2064 6174 6120 6672 6f6d 2063 6f72  ad data from cor
-0000c1c0: 6520 696e 7465 726d 6465 6174 6520 6669  e intermdeate fi
-0000c1d0: 6c65 732c 2063 6865 636b 2066 696c 6573  les, check files
-0000c1e0: 2065 7869 7374 2c20 6164 6420 2769 6d61   exist, add 'ima
-0000c1f0: 6765 2d68 616e 646c 6527 2e0a 2020 2020  ge-handle'..    
-0000c200: 2020 2020 5265 7475 726e 7320 6469 6374      Returns dict
-0000c210: 206f 6620 666f 726d 207b 696d 6167 652d   of form {image-
-0000c220: 6669 6c65 2d6e 616d 653a 7b66 6965 6c64  file-name:{field
-0000c230: 3a76 616c 7565 7d2c 2e2e 2e7d 200a 2020  :value},...} .  
-0000c240: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-0000c250: 2020 2023 2057 6869 6368 2066 696c 6573     # Which files
-0000c260: 2063 6f6e 7461 696e 2074 6865 2069 6e66   contain the inf
-0000c270: 6f72 6d61 7469 6f6e 206e 6565 6465 6420  ormation needed 
-0000c280: 746f 2063 7265 6174 6520 7468 6520 6946  to create the iF
-0000c290: 444f 2069 7465 6d73 2063 6f72 6520 696e  DO items core in
-0000c2a0: 666f 726d 6174 696f 6e20 616e 6420 7768  formation and wh
-0000c2b0: 6963 6820 636f 6c75 6d6e 7320 7368 616c  ich columns shal
-0000c2c0: 6c20 6265 2075 7365 640a 2020 2020 2020  l be used.      
-0000c2d0: 2020 7265 7120 3d20 7365 6c66 2e69 6e74    req = self.int
-0000c2e0: 6572 6d65 6469 6174 6546 696c 6573 4465  ermediateFilesDe
-0000c2f0: 665f 636f 7265 0a0a 2020 2020 2020 2020  f_core..        
-0000c300: 6974 656d 5f64 6174 6120 3d20 7b7d 0a20  item_data = {}. 
-0000c310: 2020 2020 2020 2070 726f 6720 3d20 6d69         prog = mi
-0000c320: 7174 632e 5072 696e 744b 6e6f 776e 5072  qtc.PrintKnownPr
-0000c330: 6f67 7265 7373 4d73 6728 2250 6172 7369  ogressMsg("Parsi
-0000c340: 6e67 2069 6e74 6572 6d65 6469 6174 6520  ng intermediate 
-0000c350: 6461 7461 222c 206c 656e 2872 6571 2929  data", len(req))
-0000c360: 0a20 2020 2020 2020 2066 6f72 2072 2069  .        for r i
-0000c370: 6e20 7265 713a 0a20 2020 2020 2020 2020  n req:.         
-0000c380: 2020 2070 726f 672e 7072 6f67 7265 7373     prog.progress
-0000c390: 2829 0a20 2020 2020 2020 2020 2020 2066  ().            f
-0000c3a0: 696c 6520 3d20 7365 6c66 2e5f 5f67 6574  ile = self.__get
-0000c3b0: 5f69 6e74 5f66 696c 655f 7072 6566 6978  _int_file_prefix
-0000c3c0: 2829 202b 2072 6571 5b72 5d5b 2773 7566  () + req[r]['suf
-0000c3d0: 6669 7827 5d0a 2020 2020 2020 2020 2020  fix'].          
-0000c3e0: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
-0000c3f0: 2e65 7869 7374 7328 6669 6c65 293a 0a20  .exists(file):. 
-0000c400: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000c410: 656c 662e 7072 6f76 2e6c 6f67 2822 5741  elf.prov.log("WA
-0000c420: 524e 494e 4721 2046 6f72 2061 6368 6965  RNING! For achie
-0000c430: 7669 6e67 2046 4149 526e 6573 7320 616e  ving FAIRness an
-0000c440: 2069 6e74 6572 6d65 6469 6174 6520 696d   intermediate im
-0000c450: 6167 6520 696e 666f 2066 696c 6520 6973  age info file is
-0000c460: 206d 6973 7369 6e67 3a20 222b 2073 656c   missing: "+ sel
-0000c470: 662e 5f5f 6765 745f 696e 745f 6669 6c65  f.__get_int_file
-0000c480: 5f70 7265 6669 7828 2920 2b20 7265 715b  _prefix() + req[
-0000c490: 725d 5b27 7375 6666 6978 275d 2b20 2220  r]['suffix']+ " 
-0000c4a0: 7275 6e20 6669 7273 743a 2022 202b 2072  run first: " + r
-0000c4b0: 6571 5b72 5d5b 2763 7265 6174 696f 6e46  eq[r]['creationF
-0000c4c0: 6374 275d 290a 2020 2020 2020 2020 2020  ct']).          
-0000c4d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000c4e0: 2020 2020 2020 2020 7365 6c66 2e70 6172          self.par
-0000c4f0: 7365 4974 656d 4461 7461 6672 6f6d 5461  seItemDatafromTa
-0000c500: 6246 696c 6544 6174 6128 6974 656d 5f64  bFileData(item_d
-0000c510: 6174 612c 2066 696c 652c 2072 6571 5b72  ata, file, req[r
-0000c520: 5d5b 2763 6f6c 7327 5d2c 2072 6571 5b72  ]['cols'], req[r
-0000c530: 5d5b 276f 7074 696f 6e61 6c27 5d29 0a20  ]['optional']). 
-0000c540: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000c550: 656c 662e 7072 6f76 2e6c 6f67 2822 5061  elf.prov.log("Pa
-0000c560: 7273 6564 2069 7465 6d20 6461 7461 2066  rsed item data f
-0000c570: 726f 6d3a 2022 202b 2066 696c 6529 0a0a  rom: " + file)..
-0000c580: 2020 2020 2020 2020 7072 6f67 2e63 6c65          prog.cle
-0000c590: 6172 2829 0a20 2020 2020 2020 2069 6620  ar().        if 
-0000c5a0: 6c65 6e28 6974 656d 5f64 6174 6129 203d  len(item_data) =
-0000c5b0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-0000c5c0: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
-0000c5d0: 2822 4e6f 2069 4644 4f20 6974 656d 7322  ("No iFDO items"
-0000c5e0: 290a 0a20 2020 2020 2020 2023 2063 6865  )..        # che
-0000c5f0: 636b 2066 696c 6573 2065 7869 7374 0a20  ck files exist. 
-0000c600: 2020 2020 2020 2072 656d 6f76 6520 3d20         remove = 
-0000c610: 5b5d 0a20 2020 2020 2020 2066 6f72 2069  [].        for i
-0000c620: 6d67 2069 6e20 6974 656d 5f64 6174 613a  mg in item_data:
-0000c630: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000c640: 6e6f 7420 696d 6720 696e 2073 656c 662e  not img in self.
-0000c650: 5f69 6d61 6765 4e61 6d65 7349 6d61 6765  _imageNamesImage
-0000c660: 7344 6972 3a0a 2020 2020 2020 2020 2020  sDir:.          
-0000c670: 2020 2020 2020 7265 6d6f 7665 2e61 7070        remove.app
-0000c680: 656e 6428 696d 6729 0a20 2020 2020 2020  end(img).       
-0000c690: 2066 6f72 2069 6d67 2069 6e20 7265 6d6f   for img in remo
-0000c6a0: 7665 3a0a 2020 2020 2020 2020 2020 2020  ve:.            
-0000c6b0: 6465 6c20 6974 656d 5f64 6174 615b 696d  del item_data[im
-0000c6c0: 675d 0a0a 2020 2020 2020 2020 2320 6164  g]..        # ad
-0000c6d0: 6420 696d 6167 652d 7572 6c0a 2020 2020  d image-url.    
-0000c6e0: 2020 2020 666f 7220 696d 6720 696e 2069      for img in i
-0000c6f0: 7465 6d5f 6461 7461 3a0a 2020 2020 2020  tem_data:.      
-0000c700: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0000c710: 6e63 6528 6974 656d 5f64 6174 615b 696d  nce(item_data[im
-0000c720: 675d 2c6c 6973 7429 3a20 2320 6974 656d  g],list): # item
-0000c730: 2069 7320 616c 7265 6164 7920 6120 6c69   is already a li
-0000c740: 7374 2028 7669 6465 6f29 2062 7574 2070  st (video) but p
-0000c750: 6172 7365 6420 6461 7461 2069 7320 6e6f  arsed data is no
-0000c760: 742c 2069 2e65 2e20 7061 7273 6564 2064  t, i.e. parsed d
-0000c770: 6174 6120 7265 6665 7273 2074 6f20 7768  ata refers to wh
-0000c780: 6f6c 6520 7669 6465 6f20 2874 696d 6520  ole video (time 
-0000c790: 696e 6465 7065 6e64 656e 7429 2c20 692e  independent), i.
-0000c7a0: 652e 2077 7269 7465 2074 6f20 6669 7273  e. write to firs
-0000c7b0: 7420 656e 7472 790a 2020 2020 2020 2020  t entry.        
-0000c7c0: 2020 2020 2020 2020 7575 6964 203d 2066          uuid = f
-0000c7d0: 696e 6446 6965 6c64 2869 7465 6d5f 6461  indField(item_da
-0000c7e0: 7461 5b69 6d67 5d5b 305d 2c27 696d 6167  ta[img][0],'imag
-0000c7f0: 652d 7575 6964 2729 0a20 2020 2020 2020  e-uuid').       
-0000c800: 2020 2020 2020 2020 2069 6620 7575 6964           if uuid
-0000c810: 203d 3d20 2222 3a0a 2020 2020 2020 2020   == "":.        
-0000c820: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0000c830: 7428 6974 656d 5f64 6174 615b 696d 675d  t(item_data[img]
-0000c840: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000c850: 2020 2020 2020 7261 6973 6520 6d69 7174        raise miqt
-0000c860: 632e 4966 646f 4578 6365 7074 696f 6e28  c.IfdoException(
-0000c870: 2275 7569 6420 6e6f 7420 666f 756e 6420  "uuid not found 
-0000c880: 2861 2922 290a 2020 2020 2020 2020 2020  (a)").          
-0000c890: 2020 2020 2020 6974 656d 5f64 6174 615b        item_data[
-0000c8a0: 696d 675d 5b30 5d5b 2769 6d61 6765 2d68  img][0]['image-h
-0000c8b0: 616e 646c 6527 5d20 3d20 7365 6c66 2e69  andle'] = self.i
-0000c8c0: 6d61 6765 5f68 616e 646c 655f 7072 6566  mage_handle_pref
-0000c8d0: 6978 202b 2027 4027 202b 2075 7569 640a  ix + '@' + uuid.
-0000c8e0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0000c8f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000c900: 2020 7575 6964 203d 2066 696e 6446 6965    uuid = findFie
-0000c910: 6c64 2869 7465 6d5f 6461 7461 5b69 6d67  ld(item_data[img
-0000c920: 5d2c 2769 6d61 6765 2d75 7569 6427 290a  ],'image-uuid').
-0000c930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c940: 6966 2075 7569 6420 3d3d 2022 223a 0a20  if uuid == "":. 
-0000c950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c960: 2020 2072 6169 7365 206d 6971 7463 2e49     raise miqtc.I
-0000c970: 6664 6f45 7863 6570 7469 6f6e 2822 7575  fdoException("uu
-0000c980: 6964 206e 6f74 2066 6f75 6e64 2028 6229  id not found (b)
-0000c990: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0000c9a0: 2020 2069 7465 6d5f 6461 7461 5b69 6d67     item_data[img
-0000c9b0: 5d5b 2769 6d61 6765 2d68 616e 646c 6527  ]['image-handle'
-0000c9c0: 5d20 3d20 7365 6c66 2e69 6d61 6765 5f68  ] = self.image_h
-0000c9d0: 616e 646c 655f 7072 6566 6978 202b 2027  andle_prefix + '
-0000c9e0: 4027 202b 2075 7569 640a 0a20 2020 2020  @' + uuid..     
-0000c9f0: 2020 2072 6574 7572 6e20 6974 656d 5f64     return item_d
-0000ca00: 6174 610a 0a0a 2020 2020 6465 6620 6164  ata...    def ad
-0000ca10: 6449 7465 6d49 6e66 6f54 6162 4669 6c65  dItemInfoTabFile
-0000ca20: 2873 656c 662c 2066 696c 654e 616d 653a  (self, fileName:
-0000ca30: 2073 7472 2c20 7365 7061 7261 746f 723a   str, separator:
-0000ca40: 7374 722c 2068 6561 6465 723a 6469 6374  str, header:dict
-0000ca50: 2c20 6461 7465 7469 6d65 5f66 6f72 6d61  , datetime_forma
-0000ca60: 7420 3d20 6d69 7174 762e 6461 7465 5f66  t = miqtv.date_f
-0000ca70: 6f72 6d61 7473 5b27 6d61 7269 7174 275d  ormats['mariqt']
-0000ca80: 293a 0a20 2020 2020 2020 2022 2222 2041  ):.        """ A
-0000ca90: 6464 2061 2063 6f6c 756d 6e20 7365 7065  dd a column sepe
-0000caa0: 7261 7465 6420 7465 7874 2066 696c 6520  rated text file 
-0000cab0: 746f 2070 6172 7365 2069 7465 6d20 6461  to parse item da
-0000cac0: 7461 2066 726f 6d20 6279 2063 7265 6174  ta from by creat
-0000cad0: 6543 6170 7475 7265 416e 6443 6f6e 7465  eCaptureAndConte
-0000cae0: 6e74 4669 656c 6473 2829 2e20 0a20 2020  ntFields(). .   
-0000caf0: 2020 2020 2043 6f6c 756d 6e73 2068 6561       Columns hea
-0000cb00: 6465 7273 2077 696c 6c20 6265 2073 6574  ders will be set
-0000cb10: 2061 7320 6974 656d 2066 6965 6c64 206e   as item field n
-0000cb20: 616d 6573 2e20 4d75 7374 2063 6f6e 7461  ames. Must conta
-0000cb30: 696e 2063 6f6c 756d 6e20 2769 6d61 6765  in column 'image
-0000cb40: 2d66 696c 656e 616d 6527 2e0a 2020 2020  -filename'..    
-0000cb50: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000cb60: 6966 2066 696c 654e 616d 6520 3d3d 204e  if fileName == N
-0000cb70: 6f6e 6520 6f72 206e 6f74 206f 732e 7061  one or not os.pa
-0000cb80: 7468 2e65 7869 7374 7328 6669 6c65 4e61  th.exists(fileNa
-0000cb90: 6d65 293a 0a20 2020 2020 2020 2020 2020  me):.           
-0000cba0: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
-0000cbb0: 2822 4669 6c65 222c 6669 6c65 4e61 6d65  ("File",fileName
-0000cbc0: 2c22 6e6f 7420 666f 756e 6422 290a 0a20  ,"not found").. 
-0000cbd0: 2020 2020 2020 2066 6f72 2066 6965 6c64         for field
-0000cbe0: 2069 6e20 6865 6164 6572 3a0a 2020 2020   in header:.    
-0000cbf0: 2020 2020 2020 2020 6966 2068 6561 6465          if heade
-0000cc00: 725b 6669 656c 645d 206e 6f74 2069 6e20  r[field] not in 
-0000cc10: 6d69 7174 662e 7461 6246 696c 6543 6f6c  miqtf.tabFileCol
-0000cc20: 756d 6e4e 616d 6573 2866 696c 654e 616d  umnNames(fileNam
-0000cc30: 652c 636f 6c5f 7365 7061 7261 746f 723d  e,col_separator=
-0000cc40: 7365 7061 7261 746f 7229 3a0a 2020 2020  separator):.    
-0000cc50: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000cc60: 6520 4578 6365 7074 696f 6e28 2243 6f6c  e Exception("Col
-0000cc70: 756d 6e22 2c20 6865 6164 6572 5b66 6965  umn", header[fie
-0000cc80: 6c64 5d2c 2022 6e6f 7420 696e 2066 696c  ld], "not in fil
-0000cc90: 6522 2c20 6669 6c65 4e61 6d65 290a 0a20  e", fileName).. 
-0000cca0: 2020 2020 2020 2069 6620 6d69 7174 632e         if miqtc.
-0000ccb0: 6173 7365 7274 536c 6173 6828 6f73 2e70  assertSlash(os.p
-0000ccc0: 6174 682e 6469 726e 616d 6528 6669 6c65  ath.dirname(file
-0000ccd0: 4e61 6d65 2929 2021 3d20 6d69 7174 632e  Name)) != miqtc.
-0000cce0: 6173 7365 7274 536c 6173 6828 7365 6c66  assertSlash(self
-0000ccf0: 2e64 6972 2e74 6f28 7365 6c66 2e64 6972  .dir.to(self.dir
-0000cd00: 2e64 742e 696e 7465 726d 6564 6961 7465  .dt.intermediate
-0000cd10: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-0000cd20: 7365 6c66 2e70 726f 762e 6c6f 6728 2022  self.prov.log( "
-0000cd30: 4361 7574 696f 6e3a 2049 7420 6973 2072  Caution: It is r
-0000cd40: 6563 6f6d 6d65 6e64 6564 2074 6f20 7075  ecommended to pu
-0000cd50: 7420 6669 6c65 2069 6e20 7468 6520 6469  t file in the di
-0000cd60: 7265 6374 6f72 7927 7320 2769 6e74 6572  rectory's 'inter
-0000cd70: 6d65 6469 6174 6527 2066 6f6c 6465 723a  mediate' folder:
-0000cd80: 2022 202b 2066 696c 654e 616d 6529 0a20   " + fileName). 
-0000cd90: 2020 2020 2020 206e 6366 6969 6620 3d20         ncfiif = 
-0000cda0: 6e6f 6e43 6f72 6546 6965 6c64 496e 7465  nonCoreFieldInte
-0000cdb0: 726d 6564 6961 7465 4974 656d 496e 666f  rmediateItemInfo
-0000cdc0: 4669 6c65 2866 696c 654e 616d 652c 2073  File(fileName, s
-0000cdd0: 6570 6172 6174 6f72 2c20 6865 6164 6572  eparator, header
-0000cde0: 2c20 6461 7465 7469 6d65 5f66 6f72 6d61  , datetime_forma
-0000cdf0: 7429 0a20 2020 2020 2020 2069 6620 6e63  t).        if nc
-0000ce00: 6669 6966 206e 6f74 2069 6e20 7365 6c66  fiif not in self
-0000ce10: 2e6e 6f6e 436f 7265 4669 656c 6449 6e74  .nonCoreFieldInt
-0000ce20: 6572 6d65 6469 6174 6549 7465 6d49 6e66  ermediateItemInf
-0000ce30: 6f46 696c 6573 3a20 0a20 2020 2020 2020  oFiles: .       
-0000ce40: 2020 2020 2073 656c 662e 6e6f 6e43 6f72       self.nonCor
-0000ce50: 6546 6965 6c64 496e 7465 726d 6564 6961  eFieldIntermedia
-0000ce60: 7465 4974 656d 496e 666f 4669 6c65 732e  teItemInfoFiles.
-0000ce70: 6170 7065 6e64 286e 6366 6969 6629 0a0a  append(ncfiif)..
-0000ce80: 2020 2020 2020 2020 0a20 2020 2064 6566          .    def
-0000ce90: 2072 656d 6f76 6549 7465 6d49 6e66 6f54   removeItemInfoT
-0000cea0: 6162 4669 6c65 2873 656c 662c 2066 696c  abFile(self, fil
-0000ceb0: 654e 616d 653a 2073 7472 2c20 7365 7061  eName: str, sepa
-0000cec0: 7261 746f 723a 7374 722c 2068 6561 6465  rator:str, heade
-0000ced0: 723a 6469 6374 2c20 6461 7465 7469 6d65  r:dict, datetime
-0000cee0: 5f66 6f72 6d61 743a 7374 7229 3a0a 2020  _format:str):.  
-0000cef0: 2020 2020 2020 2222 2220 7265 6d6f 7665        """ remove
-0000cf00: 7320 6669 6c65 2069 7465 6d20 6672 6f6d  s file item from
-0000cf10: 206c 6973 7420 6f66 2066 696c 6573 2074   list of files t
-0000cf20: 6f20 7061 7273 6520 6974 656d 2064 6174  o parse item dat
-0000cf30: 6120 6672 6f6d 2062 7920 6372 6561 7465  a from by create
-0000cf40: 4361 7074 7572 6541 6e64 436f 6e74 656e  CaptureAndConten
-0000cf50: 7446 6965 6c64 7328 2920 2222 220a 2020  tFields() """.  
-0000cf60: 2020 2020 2020 6e63 6669 6966 203d 206e        ncfiif = n
-0000cf70: 6f6e 436f 7265 4669 656c 6449 6e74 6572  onCoreFieldInter
-0000cf80: 6d65 6469 6174 6549 7465 6d49 6e66 6f46  mediateItemInfoF
-0000cf90: 696c 6528 6669 6c65 4e61 6d65 2c20 7365  ile(fileName, se
-0000cfa0: 7061 7261 746f 722c 2068 6561 6465 722c  parator, header,
-0000cfb0: 2064 6174 6574 696d 655f 666f 726d 6174   datetime_format
-0000cfc0: 290a 2020 2020 2020 2020 6966 206e 6366  ).        if ncf
-0000cfd0: 6969 6620 696e 2073 656c 662e 6e6f 6e43  iif in self.nonC
-0000cfe0: 6f72 6546 6965 6c64 496e 7465 726d 6564  oreFieldIntermed
-0000cff0: 6961 7465 4974 656d 496e 666f 4669 6c65  iateItemInfoFile
-0000d000: 733a 200a 2020 2020 2020 2020 2020 2020  s: .            
-0000d010: 7365 6c66 2e6e 6f6e 436f 7265 4669 656c  self.nonCoreFiel
-0000d020: 6449 6e74 6572 6d65 6469 6174 6549 7465  dIntermediateIte
-0000d030: 6d49 6e66 6f46 696c 6573 2e72 656d 6f76  mInfoFiles.remov
-0000d040: 6528 6e63 6669 6966 290a 0a0a 2020 2020  e(ncfiif)...    
-0000d050: 6465 6620 7570 6461 7465 6946 444f 2873  def updateiFDO(s
-0000d060: 656c 662c 2068 6561 6465 723a 2064 6963  elf, header: dic
-0000d070: 742c 2069 7465 6d73 3a20 6c69 7374 293a  t, items: list):
-0000d080: 0a20 2020 2020 2020 2022 2222 2055 7064  .        """ Upd
-0000d090: 6174 6573 2074 6865 2063 7572 7265 6e74  ates the current
-0000d0a0: 2076 616c 7565 7320 6946 444f 2077 6974   values iFDO wit
-0000d0b0: 6820 7468 6520 7072 6f76 6964 6564 206e  h the provided n
-0000d0c0: 6577 2076 616c 7565 7320 2222 220a 2020  ew values """.  
-0000d0d0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000d0e0: 662e 6372 6561 7465 6946 444f 2868 6561  f.createiFDO(hea
-0000d0f0: 6465 722c 2069 7465 6d73 2c20 7570 6461  der, items, upda
-0000d100: 7465 4578 6973 7469 6e67 3d54 7275 6529  teExisting=True)
-0000d110: 0a0a 0a20 2020 2064 6566 2063 7265 6174  ...    def creat
-0000d120: 6569 4644 4f28 7365 6c66 2c20 6865 6164  eiFDO(self, head
-0000d130: 6572 3a20 6469 6374 2c20 6974 656d 733a  er: dict, items:
-0000d140: 206c 6973 742c 2075 7064 6174 6545 7869   list, updateExi
-0000d150: 7374 696e 673d 4661 6c73 652c 6865 6164  sting=False,head
-0000d160: 6572 4f6e 6c79 3d46 616c 7365 293a 0a20  erOnly=False):. 
-0000d170: 2020 2020 2020 2022 2222 2043 7265 6174         """ Creat
-0000d180: 6573 2046 4149 5220 6469 6769 7461 6c20  es FAIR digital 
-0000d190: 6f62 6a65 6374 2066 6f72 2074 6865 2069  object for the i
-0000d1a0: 6d61 6765 2064 6174 6120 6974 7365 6c66  mage data itself
-0000d1b0: 2e20 5468 6973 2063 6f6e 7369 7374 7320  . This consists 
-0000d1c0: 6f66 2068 6561 6465 7220 696e 666f 726d  of header inform
-0000d1d0: 6174 696f 6e20 616e 6420 6974 656d 2069  ation and item i
-0000d1e0: 6e66 6f72 6d61 7469 6f6e 2e20 2222 220a  nformation. """.
-0000d1f0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0000d200: 7570 6461 7465 4578 6973 7469 6e67 2061  updateExisting a
-0000d210: 6e64 206c 656e 2869 7465 6d73 2920 3d3d  nd len(items) ==
-0000d220: 2030 2061 6e64 206e 6f74 2068 6561 6465   0 and not heade
-0000d230: 724f 6e6c 793a 0a20 2020 2020 2020 2020  rOnly:.         
-0000d240: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
-0000d250: 6f6e 2827 4e6f 2069 7465 6d20 696e 666f  on('No item info
-0000d260: 726d 6174 696f 6e20 6769 7665 6e27 290a  rmation given').
-0000d270: 0a20 2020 2020 2020 2069 6620 7570 6461  .        if upda
-0000d280: 7465 4578 6973 7469 6e67 3a0a 2020 2020  teExisting:.    
-0000d290: 2020 2020 2020 2020 2320 6865 6164 6572          # header
-0000d2a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000d2b0: 662e 7570 6461 7465 6946 444f 4865 6164  f.updateiFDOHead
-0000d2c0: 6572 4669 656c 6473 2868 6561 6465 7229  erFields(header)
-0000d2d0: 0a20 2020 2020 2020 2020 2020 2023 2069  .            # i
-0000d2e0: 7465 6d73 0a20 2020 2020 2020 2020 2020  tems.           
-0000d2f0: 2023 2075 7064 6174 6520 636f 7079 206f   # update copy o
-0000d300: 6620 6375 7272 656e 7420 6974 656d 7320  f current items 
-0000d310: 7769 7468 206e 6577 2069 7465 6d73 2066  with new items f
-0000d320: 6965 6c64 730a 2020 2020 2020 2020 2020  ields.          
-0000d330: 2020 6974 656d 7344 6963 7420 3d20 6d69    itemsDict = mi
-0000d340: 7174 692e 6372 6561 7465 496d 6167 6549  qti.createImageI
-0000d350: 7465 6d73 4469 6374 4672 6f6d 496d 6167  temsDictFromImag
-0000d360: 6549 7465 6d73 4c69 7374 2869 7465 6d73  eItemsList(items
-0000d370: 290a 2020 2020 2020 2020 2020 2020 7570  ).            up
-0000d380: 6461 7465 6449 7465 6d73 5f63 6f70 7920  datedItems_copy 
-0000d390: 3d20 636f 7079 2e64 6565 7063 6f70 7928  = copy.deepcopy(
-0000d3a0: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-0000d3b0: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
-0000d3c0: 4b65 795d 290a 2020 2020 2020 2020 2020  Key]).          
-0000d3d0: 2020 6c6f 6720 3d20 6d69 7174 632e 7265    log = miqtc.re
-0000d3e0: 6375 7273 6976 656c 7955 7064 6174 6544  cursivelyUpdateD
-0000d3f0: 6963 7473 2875 7064 6174 6564 4974 656d  icts(updatedItem
-0000d400: 735f 636f 7079 2c20 6974 656d 7344 6963  s_copy, itemsDic
-0000d410: 742c 206d 6971 7476 2e69 6664 6f5f 6d75  t, miqtv.ifdo_mu
-0000d420: 7475 616c 6c79 5f65 7863 6c75 7369 7665  tually_exclusive
-0000d430: 5f66 6965 6c64 7329 0a20 2020 2020 2020  _fields).       
-0000d440: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-0000d450: 6f67 286c 6f67 2c64 6f6e 7453 686f 773d  og(log,dontShow=
-0000d460: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-0000d470: 2020 6974 656d 7320 3d20 6d69 7174 692e    items = miqti.
-0000d480: 6372 6561 7465 496d 6167 6549 7465 6d73  createImageItems
-0000d490: 4c69 7374 4672 6f6d 496d 6167 6549 7465  ListFromImageIte
-0000d4a0: 6d73 4469 6374 2875 7064 6174 6564 4974  msDict(updatedIt
-0000d4b0: 656d 735f 636f 7079 290a 0a20 2020 2020  ems_copy)..     
-0000d4c0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000d4d0: 2020 2020 2073 656c 662e 7365 7469 4644       self.setiFD
-0000d4e0: 4f48 6561 6465 7246 6965 6c64 7328 6865  OHeaderFields(he
-0000d4f0: 6164 6572 290a 0a20 2020 2020 2020 2023  ader)..        #
-0000d500: 2050 6172 7365 2069 6d61 6765 2d61 6273   Parse image-abs
-0000d510: 7472 6163 7420 616e 6420 6669 6c6c 2069  tract and fill i
-0000d520: 7473 2070 6c61 6365 686f 6c64 6572 7320  ts placeholders 
-0000d530: 7769 7468 2069 6e66 6f72 6d61 7469 6f6e  with information
-0000d540: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-0000d550: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
-0000d560: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
-0000d570: 6765 5365 7448 6561 6465 724b 6579 5d5b  geSetHeaderKey][
-0000d580: 2769 6d61 6765 2d61 6273 7472 6163 7427  'image-abstract'
-0000d590: 5d20 3d20 6d69 7174 732e 7061 7273 6552  ] = miqts.parseR
-0000d5a0: 6570 6c61 6365 5661 6c28 7365 6c66 2e69  eplaceVal(self.i
-0000d5b0: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
-0000d5c0: 6765 5365 7448 6561 6465 724b 6579 5d2c  geSetHeaderKey],
-0000d5d0: 2027 696d 6167 652d 6162 7374 7261 6374   'image-abstract
-0000d5e0: 2729 0a20 2020 2020 2020 2065 7863 6570  ').        excep
-0000d5f0: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-0000d600: 783a 0a20 2020 2020 2020 2020 2020 2073  x:.            s
-0000d610: 656c 662e 7072 6f76 2e6c 6f67 2822 436f  elf.prov.log("Co
-0000d620: 756c 6420 6e6f 7420 7265 706c 6163 6520  uld not replace 
-0000d630: 6b65 7973 2069 6e20 5c27 696d 6167 652d  keys in \'image-
-0000d640: 6162 7374 7261 6374 5c27 3a20 2220 2b20  abstract\': " + 
-0000d650: 7374 7228 6578 2929 0a0a 0a20 2020 2020  str(ex))...     
-0000d660: 2020 2023 2073 6574 2076 6572 7369 6f6e     # set version
-0000d670: 2028 736f 2069 7420 6361 6e6e 6f74 2062   (so it cannot b
-0000d680: 6520 6368 616e 6765 6420 6279 2075 7365  e changed by use
-0000d690: 7229 0a20 2020 2020 2020 2073 656c 662e  r).        self.
-0000d6a0: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
-0000d6b0: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
-0000d6c0: 5b27 696d 6167 652d 7365 742d 6966 646f  ['image-set-ifdo
-0000d6d0: 2d76 6572 7369 6f6e 275d 203d 206d 6971  -version'] = miq
-0000d6e0: 7476 2e69 4644 4f5f 7665 7273 696f 6e0a  tv.iFDO_version.
-0000d6f0: 0a20 2020 2020 2020 2023 2056 616c 6964  .        # Valid
-0000d700: 6174 6520 6974 656d 2069 6e66 6f72 6d61  ate item informa
-0000d710: 7469 6f6e 0a20 2020 2020 2020 2069 6e76  tion.        inv
-0000d720: 616c 6964 5f69 7465 6d73 203d 2030 0a20  alid_items = 0. 
-0000d730: 2020 2020 2020 2069 6d61 6765 5f73 6574         image_set
-0000d740: 5f69 7465 6d73 203d 207b 7d0a 0a20 2020  _items = {}..   
-0000d750: 2020 2020 2073 656c 662e 6d69 7373 696e       self.missin
-0000d760: 6746 6965 6c64 7346 6f72 4661 6972 6e65  gFieldsForFairne
-0000d770: 7373 203d 205b 5d0a 2020 2020 2020 2020  ss = [].        
-0000d780: 7072 6f67 203d 206d 6971 7463 2e50 7269  prog = miqtc.Pri
-0000d790: 6e74 4b6e 6f77 6e50 726f 6772 6573 734d  ntKnownProgressM
-0000d7a0: 7367 2822 4368 6563 6b69 6e67 2069 7465  sg("Checking ite
-0000d7b0: 6d73 222c 206c 656e 2869 7465 6d73 292c  ms", len(items),
-0000d7c0: 6d6f 6475 6c6f 3d35 290a 2020 2020 2020  modulo=5).      
-0000d7d0: 2020 666f 7220 6974 656d 2069 6e20 6974    for item in it
-0000d7e0: 656d 733a 0a20 2020 2020 2020 2020 2020  ems:.           
-0000d7f0: 2070 726f 672e 7072 6f67 7265 7373 2829   prog.progress()
-0000d800: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
-0000d810: 6865 636b 2069 6620 616c 6c20 636f 7265  heck if all core
-0000d820: 2066 6965 6c64 7320 6172 6520 6669 6c6c   fields are fill
-0000d830: 6564 2061 6e64 2061 7265 2066 696c 6c65  ed and are fille
-0000d840: 6420 7661 6c69 646c 790a 2020 2020 2020  d validly.      
-0000d850: 2020 2020 2020 7472 793a 0a0a 2020 2020        try:..    
-0000d860: 2020 2020 2020 2020 2020 2020 2320 6368              # ch
-0000d870: 6563 6b20 6974 656d 2069 6d61 6765 2065  eck item image e
-0000d880: 7869 7374 730a 2020 2020 2020 2020 2020  xists.          
-0000d890: 2020 2020 2020 2320 6966 2069 7465 6d20        # if item 
-0000d8a0: 6973 2061 206c 6973 7420 2876 6964 656f  is a list (video
-0000d8b0: 292c 206f 6e65 2077 6f75 6c64 2068 6176  ), one would hav
-0000d8c0: 6520 746f 2063 6865 636b 2069 6620 6561  e to check if ea
-0000d8d0: 6368 2065 6e74 7279 2069 7320 7661 6c69  ch entry is vali
-0000d8e0: 6420 6769 7665 6e20 7468 6520 6465 6661  d given the defa
-0000d8f0: 756c 7420 7661 6c75 6573 2069 6e20 6669  ult values in fi
-0000d900: 7273 7420 656e 7472 7920 706c 7573 2067  rst entry plus g
-0000d910: 6976 656e 2064 6566 6175 6c74 2076 616c  iven default val
-0000d920: 7565 7320 696e 2068 6561 6465 720a 2020  ues in header.  
-0000d930: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000d940: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-0000d950: 6974 656d 2c6c 6973 7429 3a0a 2020 2020  item,list):.    
-0000d960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d970: 6974 656d 203d 205b 6974 656d 5d0a 2020  item = [item].  
-0000d980: 2020 2020 2020 2020 2020 2020 2020 7375                su
-0000d990: 6249 7465 6d44 6566 6175 6c74 203d 2069  bItemDefault = i
-0000d9a0: 7465 6d5b 305d 200a 2020 2020 2020 2020  tem[0] .        
-0000d9b0: 2020 2020 2020 2020 666f 7220 7375 6249          for subI
-0000d9c0: 7465 6d20 696e 2069 7465 6d3a 0a20 2020  tem in item:.   
-0000d9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d9e0: 2069 6620 7375 6249 7465 6d5b 2769 6d61   if subItem['ima
-0000d9f0: 6765 2d66 696c 656e 616d 6527 5d20 6e6f  ge-filename'] no
-0000da00: 7420 696e 2073 656c 662e 5f69 6d61 6765  t in self._image
-0000da10: 4e61 6d65 7349 6d61 6765 7344 6972 3a0a  NamesImagesDir:.
-0000da20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000da30: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
-0000da40: 6365 7074 696f 6e28 2249 7465 6d20 2722  ception("Item '"
-0000da50: 202b 2073 7562 4974 656d 5b27 696d 6167   + subItem['imag
-0000da60: 652d 6669 6c65 6e61 6d65 275d 202b 2022  e-filename'] + "
-0000da70: 2720 6e6f 7420 666f 756e 6420 696e 202f  ' not found in /
-0000da80: 7261 7720 6469 7265 6374 6f72 792e 2229  raw directory.")
-0000da90: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000daa0: 2020 2020 2020 6d69 7373 696e 6720 3d20        missing = 
-0000dab0: 6d69 7174 742e 6973 5661 6c69 6469 4644  miqtt.isValidiFD
-0000dac0: 4f49 7465 6d28 7375 6249 7465 6d2c 207b  OItem(subItem, {
-0000dad0: 2a2a 7365 6c66 2e69 6664 6f5f 746d 705b  **self.ifdo_tmp[
-0000dae0: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-0000daf0: 6465 724b 6579 5d2c 202a 2a73 7562 4974  derKey], **subIt
-0000db00: 656d 4465 6661 756c 747d 290a 2020 2020  emDefault}).    
-0000db10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000db20: 6966 206c 656e 286d 6973 7369 6e67 2920  if len(missing) 
-0000db30: 213d 2030 3a0a 2020 2020 2020 2020 2020  != 0:.          
-0000db40: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000db50: 6c66 2e6d 6973 7369 6e67 4669 656c 6473  lf.missingFields
-0000db60: 466f 7246 6169 726e 6573 732e 6170 7065  ForFairness.appe
-0000db70: 6e64 2873 7562 4974 656d 5b27 696d 6167  nd(subItem['imag
-0000db80: 652d 6669 6c65 6e61 6d65 275d 202b 2022  e-filename'] + "
-0000db90: 2022 202b 2073 7562 4974 656d 5b27 696d   " + subItem['im
-0000dba0: 6167 652d 6461 7465 7469 6d65 275d 202b  age-datetime'] +
-0000dbb0: 2022 3a20 2220 2b20 7374 7228 6d69 7373   ": " + str(miss
-0000dbc0: 696e 6729 290a 2020 2020 2020 2020 2020  ing)).          
-0000dbd0: 2020 2020 2020 2020 2020 0a0a 2020 2020            ..    
-0000dbe0: 2020 2020 2020 2020 2020 2020 696d 6167              imag
-0000dbf0: 655f 7365 745f 6974 656d 735b 7375 6249  e_set_items[subI
-0000dc00: 7465 6d44 6566 6175 6c74 5b27 696d 6167  temDefault['imag
-0000dc10: 652d 6669 6c65 6e61 6d65 275d 5d20 3d20  e-filename']] = 
-0000dc20: 5b5d 2023 2063 6f75 6c64 206d 616b 6520  [] # could make 
-0000dc30: 616e 2065 7874 7261 2063 6173 6520 666f  an extra case fo
-0000dc40: 7220 696d 6167 6573 206f 6d69 7474 696e  r images omittin
-0000dc50: 6720 7468 6520 6c69 7374 0a20 2020 2020  g the list.     
-0000dc60: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
-0000dc70: 7562 4974 656d 2069 6e20 6974 656d 3a0a  ubItem in item:.
-0000dc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dc90: 2020 2020 7375 6249 7465 6d44 6963 7420      subItemDict 
-0000dca0: 3d20 7b7d 0a20 2020 2020 2020 2020 2020  = {}.           
-0000dcb0: 2020 2020 2020 2020 2066 6f72 2069 7420           for it 
-0000dcc0: 696e 2073 7562 4974 656d 3a0a 2020 2020  in subItem:.    
-0000dcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dce0: 2020 2020 6966 2069 7420 213d 2027 696d      if it != 'im
-0000dcf0: 6167 652d 6669 6c65 6e61 6d65 273a 0a20  age-filename':. 
-0000dd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dd10: 2020 2020 2020 2020 2020 2073 7562 4974             subIt
-0000dd20: 656d 4469 6374 5b69 745d 203d 2073 7562  emDict[it] = sub
-0000dd30: 4974 656d 5b69 745d 0a20 2020 2020 2020  Item[it].       
-0000dd40: 2020 2020 2020 2020 2020 2020 2069 6d61               ima
-0000dd50: 6765 5f73 6574 5f69 7465 6d73 5b73 7562  ge_set_items[sub
-0000dd60: 4974 656d 4465 6661 756c 745b 2769 6d61  ItemDefault['ima
-0000dd70: 6765 2d66 696c 656e 616d 6527 5d5d 2e61  ge-filename']].a
-0000dd80: 7070 656e 6428 7375 6249 7465 6d44 6963  ppend(subItemDic
-0000dd90: 7429 0a20 2020 2020 2020 2020 2020 200a  t).            .
-0000dda0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-0000ddb0: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
-0000ddc0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000ddd0: 2020 2069 6e76 616c 6964 5f69 7465 6d73     invalid_items
-0000dde0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-0000ddf0: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
-0000de00: 6c6f 6728 2249 6e76 616c 6964 2069 6d61  log("Invalid ima
-0000de10: 6765 2069 7465 6d3a 2022 2b20 7374 7228  ge item: "+ str(
-0000de20: 6974 656d 292c 646f 6e74 5368 6f77 3d54  item),dontShow=T
-0000de30: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-0000de40: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-0000de50: 6f67 2822 4578 6365 7074 696f 6e3a 5c6e  og("Exception:\n
-0000de60: 222b 2073 7472 2865 2e61 7267 7329 2c64  "+ str(e.args),d
-0000de70: 6f6e 7453 686f 773d 5472 7565 290a 2020  ontShow=True).  
-0000de80: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-0000de90: 6973 6520 6d69 7174 632e 4966 646f 4578  ise miqtc.IfdoEx
-0000dea0: 6365 7074 696f 6e28 2249 6e76 616c 6964  ception("Invalid
-0000deb0: 2069 6d61 6765 2069 7465 6d3a 2022 2b20   image item: "+ 
-0000dec0: 7374 7228 6974 656d 2920 2b20 225c 6e45  str(item) + "\nE
-0000ded0: 7863 6570 7469 6f6e 3a5c 6e22 2b20 7374  xception:\n"+ st
-0000dee0: 7228 652e 6172 6773 2929 2023 206f 7468  r(e.args)) # oth
-0000def0: 6572 7769 7365 2c20 696e 2063 6173 6520  erwise, in case 
-0000df00: 6f66 206d 616e 7920 696d 6167 6573 2c20  of many images, 
-0000df10: 6974 206d 6179 206b 6565 7020 7275 6e6e  it may keep runn
-0000df20: 696e 6720 616e 6420 7468 726f 7769 6e67  ing and throwing
-0000df30: 2065 7272 6f72 7320 666f 7220 7175 6974   errors for quit
-0000df40: 2073 6f6d 6520 7469 6d65 0a20 2020 2020   some time.     
-0000df50: 2020 2070 726f 672e 636c 6561 7228 290a     prog.clear().
-0000df60: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-0000df70: 6974 656d 7329 2021 3d20 3020 616e 6420  items) != 0 and 
-0000df80: 696e 7661 6c69 645f 6974 656d 7320 3d3d  invalid_items ==
-0000df90: 206c 656e 2869 7465 6d73 293a 0a20 2020   len(items):.   
-0000dfa0: 2020 2020 2020 2020 2072 6169 7365 2045           raise E
-0000dfb0: 7863 6570 7469 6f6e 2822 416c 6c20 6974  xception("All it
-0000dfc0: 656d 7320 6172 6520 696e 7661 6c69 6422  ems are invalid"
-0000dfd0: 290a 2020 2020 2020 2020 656c 6966 2069  ).        elif i
-0000dfe0: 6e76 616c 6964 5f69 7465 6d73 203e 2030  nvalid_items > 0
-0000dff0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0000e000: 6c66 2e70 726f 762e 6c6f 6728 2241 7420  lf.prov.log("At 
-0000e010: 6c65 6173 7420 2220 2b20 7374 7228 696e  least " + str(in
-0000e020: 7661 6c69 645f 6974 656d 7329 202b 2022  valid_items) + "
-0000e030: 2069 7465 6d73 2077 6572 6520 696e 7661   items were inva
-0000e040: 6c69 6420 286f 6622 202b 2073 7472 286c  lid (of" + str(l
-0000e050: 656e 2869 7465 6d73 2929 2b20 2229 2229  en(items))+ ")")
-0000e060: 0a0a 2020 2020 2020 2020 2320 5661 6c69  ..        # Vali
-0000e070: 6461 7465 2068 6561 6465 7220 696e 666f  date header info
-0000e080: 726d 6174 696f 6e0a 2020 2020 2020 2020  rmation.        
-0000e090: 7365 6c66 2e6d 6973 7369 6e67 4669 656c  self.missingFiel
-0000e0a0: 6473 466f 7246 6169 726e 6573 7320 2b3d  dsForFairness +=
-0000e0b0: 206d 6971 7474 2e69 7356 616c 6964 6946   miqtt.isValidiF
-0000e0c0: 444f 436f 7265 4865 6164 6572 2873 656c  DOCoreHeader(sel
-0000e0d0: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
-0000e0e0: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
-0000e0f0: 795d 2923 2c20 616c 6c5f 6974 656d 735f  y])#, all_items_
-0000e100: 6861 7665 290a 2020 2020 2020 2020 7365  have).        se
-0000e110: 6c66 2e6c 6f67 4d69 7373 696e 6746 6965  lf.logMissingFie
-0000e120: 6c64 7328 290a 0a0a 2020 2020 2020 2020  lds()...        
-0000e130: 7320 3d20 6d69 7174 632e 5072 696e 744c  s = miqtc.PrintL
-0000e140: 6f61 6469 6e67 4d73 6728 2255 7064 6174  oadingMsg("Updat
-0000e150: 696e 6722 290a 2020 2020 2020 2020 6c6f  ing").        lo
-0000e160: 6720 3d20 6d69 7174 632e 7265 6375 7273  g = miqtc.recurs
-0000e170: 6976 656c 7955 7064 6174 6544 6963 7473  ivelyUpdateDicts
-0000e180: 2873 656c 662e 6966 646f 5f74 6d70 5b73  (self.ifdo_tmp[s
-0000e190: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
-0000e1a0: 734b 6579 5d2c 2069 6d61 6765 5f73 6574  sKey], image_set
-0000e1b0: 5f69 7465 6d73 2c20 6d69 7174 762e 6966  _items, miqtv.if
-0000e1c0: 646f 5f6d 7574 7561 6c6c 795f 6578 636c  do_mutually_excl
-0000e1d0: 7573 6976 655f 6669 656c 6473 290a 2020  usive_fields).  
-0000e1e0: 2020 2020 2020 732e 7374 6f70 2829 0a20        s.stop(). 
-0000e1f0: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
-0000e200: 2e6c 6f67 286c 6f67 290a 0a20 2020 2020  .log(log)..     
-0000e210: 2020 2023 2072 656d 6f76 6520 656d 7470     # remove emtp
-0000e220: 7920 6669 656c 6473 0a20 2020 2020 2020  y fields.       
-0000e230: 2073 203d 206d 6971 7463 2e50 7269 6e74   s = miqtc.Print
-0000e240: 4c6f 6164 696e 674d 7367 2822 5265 6d6f  LoadingMsg("Remo
-0000e250: 7669 6e67 2065 6d70 7479 2066 6965 6c64  ving empty field
-0000e260: 7322 290a 2020 2020 2020 2020 7365 6c66  s").        self
-0000e270: 2e69 6664 6f5f 746d 7020 3d20 6d69 7174  .ifdo_tmp = miqt
-0000e280: 632e 7265 6375 7273 6976 656c 7952 656d  c.recursivelyRem
-0000e290: 6f76 6545 6d70 7479 4669 656c 6473 2873  oveEmptyFields(s
-0000e2a0: 656c 662e 6966 646f 5f74 6d70 290a 2020  elf.ifdo_tmp).  
-0000e2b0: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-0000e2c0: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
-0000e2d0: 6579 2069 6e20 7365 6c66 2e69 6664 6f5f  ey in self.ifdo_
-0000e2e0: 746d 703a 0a20 2020 2020 2020 2020 2020  tmp:.           
-0000e2f0: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
-0000e300: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
-0000e310: 734b 6579 5d20 3d20 5b5d 0a20 2020 2020  sKey] = [].     
-0000e320: 2020 2023 2072 656d 6f76 6520 6669 656c     # remove fiel
-0000e330: 6473 2074 6861 7420 636f 6e74 6169 6e20  ds that contain 
-0000e340: 2769 6d61 6765 2d64 6174 6574 696d 6527  'image-datetime'
-0000e350: 206f 6e6c 790a 2020 2020 2020 2020 7365   only.        se
-0000e360: 6c66 2e72 656d 6f76 6549 7465 6d46 6965  lf.removeItemFie
-0000e370: 6c64 7357 6974 684f 6e6c 7944 6174 6554  ldsWithOnlyDateT
-0000e380: 696d 6528 290a 2020 2020 2020 2020 732e  ime().        s.
-0000e390: 7374 6f70 2829 0a0a 2020 2020 2020 2020  stop()..        
-0000e3a0: 7365 6c66 2e63 6865 636b 416c 6c49 7465  self.checkAllIte
-0000e3b0: 6d48 6173 6865 7328 290a 0a20 2020 2020  mHashes()..     
-0000e3c0: 2020 2023 2063 6865 636b 2061 6c6c 206f     # check all o
-0000e3d0: 7468 6572 206b 6e6f 776e 2066 696c 6c65  ther known fille
-0000e3e0: 6420 6669 656c 6473 2061 7265 2066 696c  d fields are fil
-0000e3f0: 6c65 6420 7661 6c69 646c 790a 2020 2020  led validly.    
-0000e400: 2020 2020 6d69 7174 742e 6973 5661 6c69      miqtt.isVali
-0000e410: 6469 4644 4f43 6170 7475 7265 2873 656c  diFDOCapture(sel
-0000e420: 662e 6966 646f 5f74 6d70 290a 2020 2020  f.ifdo_tmp).    
-0000e430: 2020 2020 6d69 7174 742e 6973 5661 6c69      miqtt.isVali
-0000e440: 6469 4644 4f43 6f6e 7465 6e74 2873 656c  diFDOContent(sel
-0000e450: 662e 6966 646f 5f74 6d70 290a 0a20 2020  f.ifdo_tmp)..   
-0000e460: 2020 2020 2023 2073 6574 2066 696e 616c       # set final
-0000e470: 206f 6e65 0a20 2020 2020 2020 2073 656c   one.        sel
-0000e480: 662e 6966 646f 5f63 6865 636b 6564 203d  f.ifdo_checked =
-0000e490: 2063 6f70 792e 6465 6570 636f 7079 2873   copy.deepcopy(s
-0000e4a0: 656c 662e 6966 646f 5f74 6d70 290a 2020  elf.ifdo_tmp).  
-0000e4b0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000e4c0: 662e 6966 646f 5f63 6865 636b 6564 0a0a  f.ifdo_checked..
-0000e4d0: 0a20 2020 2064 6566 206c 6f67 4d69 7373  .    def logMiss
-0000e4e0: 696e 6746 6965 6c64 7328 7365 6c66 293a  ingFields(self):
-0000e4f0: 0a20 2020 2020 2020 2022 2222 2057 7269  .        """ Wri
-0000e500: 7465 7320 6669 656c 6473 206d 6973 7369  tes fields missi
-0000e510: 6e67 2074 6f20 6163 6869 6576 6520 4641  ng to achieve FA
-0000e520: 4952 6e65 7373 2074 6f20 6c6f 6720 2222  IRness to log ""
-0000e530: 220a 2020 2020 2020 2020 6f75 7453 7472  ".        outStr
-0000e540: 203d 2022 5741 524e 494e 4721 2069 4644   = "WARNING! iFD
-0000e550: 4f20 646f 6573 206e 6f74 2061 6368 6965  O does not achie
-0000e560: 7665 2046 4149 526e 6573 7320 7965 7421  ve FAIRness yet!
-0000e570: 2046 6f6c 6c6f 7769 6e67 2066 6965 6c64   Following field
-0000e580: 7320 6172 6520 6d69 7373 696e 673a 5c6e  s are missing:\n
-0000e590: 220a 2020 2020 2020 2020 6920 3d20 300a  ".        i = 0.
-0000e5a0: 2020 2020 2020 2020 6d61 784e 724c 696e          maxNrLin
-0000e5b0: 6573 203d 2031 300a 2020 2020 2020 2020  es = 10.        
-0000e5c0: 666f 7220 6d69 7373 696e 6746 6965 6c64  for missingField
-0000e5d0: 2069 6e20 7365 6c66 2e6d 6973 7369 6e67   in self.missing
-0000e5e0: 4669 656c 6473 466f 7246 6169 726e 6573  FieldsForFairnes
-0000e5f0: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
-0000e600: 6620 6920 3e3d 206d 6178 4e72 4c69 6e65  f i >= maxNrLine
-0000e610: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0000e620: 2020 206f 7574 5374 7220 2b3d 2022 5c74     outStr += "\t
-0000e630: 2220 2b20 7374 7228 6c65 6e28 7365 6c66  " + str(len(self
-0000e640: 2e6d 6973 7369 6e67 4669 656c 6473 466f  .missingFieldsFo
-0000e650: 7246 6169 726e 6573 7329 202d 206d 6178  rFairness) - max
-0000e660: 4e72 4c69 6e65 7329 202b 2022 206d 6f72  NrLines) + " mor
-0000e670: 652e 2e2e 220a 2020 2020 2020 2020 2020  e...".          
-0000e680: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
-0000e690: 2020 2020 2020 2020 6f75 7453 7472 202b          outStr +
-0000e6a0: 3d20 225c 7422 202b 206d 6973 7369 6e67  = "\t" + missing
-0000e6b0: 4669 656c 6420 2b20 225c 6e22 0a20 2020  Field + "\n".   
-0000e6c0: 2020 2020 2020 2020 2069 202b 3d20 310a           i += 1.
-0000e6d0: 2020 2020 2020 2020 6966 2069 203e 2030          if i > 0
-0000e6e0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0000e6f0: 6c66 2e70 726f 762e 6c6f 6728 6f75 7453  lf.prov.log(outS
-0000e700: 7472 290a 0a0a 2020 2020 6465 6620 6661  tr)...    def fa
-0000e710: 6972 6e65 7373 4163 6869 6576 6564 2873  irnessAchieved(s
-0000e720: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-0000e730: 2220 7265 7475 726e 7320 7768 6574 6865  " returns whethe
-0000e740: 7220 616c 6c20 6669 656c 6473 2072 6571  r all fields req
-0000e750: 7569 7265 6420 746f 2061 6368 6976 6520  uired to achive 
-0000e760: 4641 4952 6e65 7373 2061 7265 2076 616c  FAIRness are val
-0000e770: 6964 6c79 2066 696c 6c65 642e 2052 756e  idly filled. Run
-0000e780: 2063 7265 6174 6543 6f72 6546 6965 6c64   createCoreField
-0000e790: 7328 2920 6669 7273 7421 2022 2222 0a20  s() first! """. 
-0000e7a0: 2020 2020 2020 2069 6620 6c65 6e28 7365         if len(se
-0000e7b0: 6c66 2e6d 6973 7369 6e67 4669 656c 6473  lf.missingFields
-0000e7c0: 466f 7246 6169 726e 6573 7329 2021 3d20  ForFairness) != 
-0000e7d0: 303a 0a20 2020 2020 2020 2020 2020 2072  0:.            r
-0000e7e0: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
-0000e7f0: 2020 2020 7265 7475 726e 2054 7275 650a      return True.
-0000e800: 0a0a 2020 2020 6465 6620 7265 6d6f 7665  ..    def remove
-0000e810: 4974 656d 4669 656c 6473 5769 7468 4f6e  ItemFieldsWithOn
-0000e820: 6c79 4461 7465 5469 6d65 2873 656c 6629  lyDateTime(self)
-0000e830: 3a0a 2020 2020 2020 2020 2222 2220 6974  :.        """ it
-0000e840: 2063 616e 2068 6170 7065 6e20 7468 6174   can happen that
-0000e850: 2061 6e20 696d 6167 6520 7469 6d65 7374   an image timest
-0000e860: 616d 7020 646f 6573 206e 6f74 2063 6f6e  amp does not con
-0000e870: 7461 696e 2061 6e79 2066 6965 6c64 7320  tain any fields 
-0000e880: 6275 7420 7468 6520 7469 6d65 7374 616d  but the timestam
-0000e890: 7020 616e 7920 6d6f 7265 2e20 5468 6f73  p any more. Thos
-0000e8a0: 6520 6172 6520 7265 6d6f 7665 6420 6865  e are removed he
-0000e8b0: 7265 2e20 2222 2220 0a20 2020 2020 2020  re. """ .       
-0000e8c0: 2066 6f72 2069 7465 6d20 696e 2073 656c   for item in sel
-0000e8d0: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
-0000e8e0: 696d 6167 6553 6574 4974 656d 734b 6579  imageSetItemsKey
-0000e8f0: 5d3a 0a20 2020 2020 2020 2020 2020 2069  ]:.            i
-0000e900: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-0000e910: 2873 656c 662e 6966 646f 5f74 6d70 5b73  (self.ifdo_tmp[s
-0000e920: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
-0000e930: 734b 6579 5d5b 6974 656d 5d2c 6c69 7374  sKey][item],list
-0000e940: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000e950: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
-0000e960: 5b73 656c 662e 696d 6167 6553 6574 4974  [self.imageSetIt
-0000e970: 656d 734b 6579 5d5b 6974 656d 5d20 3d20  emsKey][item] = 
-0000e980: 5b73 656c 662e 6966 646f 5f74 6d70 5b73  [self.ifdo_tmp[s
-0000e990: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
-0000e9a0: 734b 6579 5d5b 6974 656d 5d5d 0a20 2020  sKey][item]].   
-0000e9b0: 2020 2020 2020 2020 2074 6f42 6552 656d           toBeRem
-0000e9c0: 6f76 6564 203d 205b 5d0a 2020 2020 2020  oved = [].      
-0000e9d0: 2020 2020 2020 666f 7220 656e 7472 7920        for entry 
-0000e9e0: 696e 2073 656c 662e 6966 646f 5f74 6d70  in self.ifdo_tmp
-0000e9f0: 5b73 656c 662e 696d 6167 6553 6574 4974  [self.imageSetIt
-0000ea00: 656d 734b 6579 5d5b 6974 656d 5d3a 0a20  emsKey][item]:. 
-0000ea10: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000ea20: 7072 696e 7428 656e 7472 7929 0a20 2020  print(entry).   
-0000ea30: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000ea40: 6c65 6e28 656e 7472 7929 203d 3d20 3120  len(entry) == 1 
-0000ea50: 616e 6420 2769 6d61 6765 2d64 6174 6574  and 'image-datet
-0000ea60: 696d 6527 2069 6e20 656e 7472 793a 0a20  ime' in entry:. 
-0000ea70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea80: 2020 2074 6f42 6552 656d 6f76 6564 2e61     toBeRemoved.a
-0000ea90: 7070 656e 6428 656e 7472 7929 0a20 2020  ppend(entry).   
-0000eaa0: 2020 2020 2020 2020 2066 6f72 2065 6e74           for ent
-0000eab0: 7279 2069 6e20 746f 4265 5265 6d6f 7665  ry in toBeRemove
-0000eac0: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
-0000ead0: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
-0000eae0: 5b73 656c 662e 696d 6167 6553 6574 4974  [self.imageSetIt
-0000eaf0: 656d 734b 6579 5d5b 6974 656d 5d2e 7265  emsKey][item].re
-0000eb00: 6d6f 7665 2865 6e74 7279 2920 0a0a 0a20  move(entry) ... 
-0000eb10: 2020 2064 6566 2063 6865 636b 416c 6c49     def checkAllI
-0000eb20: 7465 6d48 6173 6865 7328 7365 6c66 2c20  temHashes(self, 
-0000eb30: 6861 7264 3d46 616c 7365 2c20 7261 6973  hard=False, rais
-0000eb40: 6545 7863 6570 7469 6f6e 203d 2054 7275  eException = Tru
-0000eb50: 6529 3a0a 2020 2020 2020 2020 2222 2220  e):.        """ 
-0000eb60: 0a20 2020 2020 2020 2043 6865 636b 7320  .        Checks 
-0000eb70: 6966 2068 6173 6865 7320 696e 2069 4644  if hashes in iFD
-0000eb80: 4f20 6d61 7463 6820 6861 7368 6573 2069  O match hashes i
-0000eb90: 6e20 696e 7465 726d 6569 6461 7465 2068  n intermeidate h
-0000eba0: 6173 6820 6669 6c65 2069 6620 7468 6520  ash file if the 
-0000ebb0: 6c61 7474 6572 2077 6173 2063 6861 6e67  latter was chang
-0000ebc0: 6564 206c 6173 7420 6166 7465 7220 7468  ed last after th
-0000ebd0: 6520 696d 6167 6573 2068 6173 2063 6861  e images has cha
-0000ebe0: 6e67 6564 2e0a 2020 2020 2020 2020 4f74  nged..        Ot
-0000ebf0: 6865 7277 6973 6520 6f72 2069 6620 6861  herwise or if ha
-0000ec00: 7264 3d3d 5472 7565 2069 7420 7265 6465  rd==True it rede
-0000ec10: 7465 726d 696e 6573 2074 6865 2061 6374  termines the act
-0000ec20: 7561 6c6c 2066 696c 6527 7320 6861 7368  uall file's hash
-0000ec30: 2061 6e64 2063 6f6d 7061 7265 7320 7468   and compares th
-0000ec40: 6520 6946 444f 2069 7465 6d27 7320 6861  e iFDO item's ha
-0000ec50: 7368 2077 6974 6820 7468 6174 2e0a 2020  sh with that..  
-0000ec60: 2020 2020 2020 4966 2068 6173 6865 7320        If hashes 
-0000ec70: 646f 206e 6f74 206d 6174 6368 2061 206d  do not match a m
-0000ec80: 6172 6971 742e 636f 7265 2e49 6664 6f45  ariqt.core.IfdoE
-0000ec90: 7863 6570 7469 6f6e 2069 7320 7269 7365  xception is rise
-0000eca0: 6e20 756e 736c 6573 7320 7261 6973 6545  n unsless raiseE
-0000ecb0: 7863 6570 7469 6f6e 203d 3d20 4661 6c73  xception == Fals
-0000ecc0: 652c 2074 6865 6e20 6120 6c69 7374 206f  e, then a list o
-0000ecd0: 6620 6c69 7374 7320 5b3c 6669 6c65 3e2c  f lists [<file>,
-0000ece0: 3c65 7863 6570 7469 6f6e 3e5d 2069 7320  <exception>] is 
-0000ecf0: 7265 7475 726e 6564 2e0a 2020 2020 2020  returned..      
-0000ed00: 2020 2222 220a 2020 2020 2020 2020 6861    """.        ha
-0000ed10: 7368 6573 203d 207b 7d0a 2020 2020 2020  shes = {}.      
-0000ed20: 2020 6861 7368 4669 6c65 4d6f 6454 696d    hashFileModTim
-0000ed30: 6520 3d20 3130 652b 3130 300a 2020 2020  e = 10e+100.    
-0000ed40: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
-0000ed50: 7869 7374 7328 7365 6c66 2e67 6574 5f69  xists(self.get_i
-0000ed60: 6e74 5f68 6173 685f 6669 6c65 2829 293a  nt_hash_file()):
-0000ed70: 0a20 2020 2020 2020 2020 2020 2068 6173  .            has
-0000ed80: 6865 7320 3d20 6d69 7174 662e 7461 6246  hes = miqtf.tabF
-0000ed90: 696c 6544 6174 6128 7365 6c66 2e67 6574  ileData(self.get
-0000eda0: 5f69 6e74 5f68 6173 685f 6669 6c65 2829  _int_hash_file()
-0000edb0: 2c20 5b6d 6971 7476 2e63 6f6c 5f68 6561  , [miqtv.col_hea
-0000edc0: 6465 725b 276d 6172 6971 7427 5d5b 2769  der['mariqt']['i
-0000edd0: 6d67 275d 2c20 6d69 7174 762e 636f 6c5f  mg'], miqtv.col_
-0000ede0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-0000edf0: 5b27 6861 7368 275d 5d2c 206b 6579 5f63  ['hash']], key_c
-0000ee00: 6f6c 3d6d 6971 7476 2e63 6f6c 5f68 6561  ol=miqtv.col_hea
-0000ee10: 6465 725b 276d 6172 6971 7427 5d5b 2769  der['mariqt']['i
-0000ee20: 6d67 275d 290a 2020 2020 2020 2020 2020  mg']).          
-0000ee30: 2020 6861 7368 4669 6c65 4d6f 6454 696d    hashFileModTim
-0000ee40: 6520 3d20 6f73 2e70 6174 682e 6765 746d  e = os.path.getm
-0000ee50: 7469 6d65 2873 656c 662e 6765 745f 696e  time(self.get_in
-0000ee60: 745f 6861 7368 5f66 696c 6528 2929 0a0a  t_hash_file())..
-0000ee70: 2020 2020 2020 2020 6578 6365 7074 696f          exceptio
-0000ee80: 6e4c 6973 7420 3d20 5b5d 0a0a 2020 2020  nList = []..    
-0000ee90: 2020 2020 6861 7368 556e 6368 6563 6b49      hashUncheckI
-0000eea0: 6d61 6765 7349 6e52 6177 203d 2073 656c  magesInRaw = sel
-0000eeb0: 662e 696d 6167 6573 496e 496d 6167 6573  f.imagesInImages
-0000eec0: 4469 7228 290a 2020 2020 2020 2020 7072  Dir().        pr
-0000eed0: 6f67 203d 206d 6971 7463 2e50 7269 6e74  og = miqtc.Print
-0000eee0: 4b6e 6f77 6e50 726f 6772 6573 734d 7367  KnownProgressMsg
-0000eef0: 2822 4368 6563 6b69 6e67 2069 7465 6d20  ("Checking item 
-0000ef00: 6861 7368 6573 222c 206c 656e 2873 656c  hashes", len(sel
-0000ef10: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
-0000ef20: 696d 6167 6553 6574 4974 656d 734b 6579  imageSetItemsKey
-0000ef30: 5d29 290a 2020 2020 2020 2020 666f 7220  ])).        for 
-0000ef40: 6974 656d 2069 6e20 7365 6c66 2e69 6664  item in self.ifd
-0000ef50: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-0000ef60: 5365 7449 7465 6d73 4b65 795d 3a0a 2020  SetItemsKey]:.  
-0000ef70: 2020 2020 2020 2020 2020 7072 6f67 2e70            prog.p
-0000ef80: 726f 6772 6573 7328 290a 0a20 2020 2020  rogress()..     
-0000ef90: 2020 2020 2020 2066 6f75 6e64 203d 2046         found = F
-0000efa0: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-0000efb0: 2066 6f72 2069 6d61 6765 2069 6e20 6861   for image in ha
-0000efc0: 7368 556e 6368 6563 6b49 6d61 6765 7349  shUncheckImagesI
-0000efd0: 6e52 6177 3a0a 2020 2020 2020 2020 2020  nRaw:.          
-0000efe0: 2020 2020 2020 6669 6c65 4e61 6d65 203d        fileName =
-0000eff0: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
-0000f000: 6528 696d 6167 6529 0a20 2020 2020 2020  e(image).       
-0000f010: 2020 2020 2020 2020 2069 6620 6669 6c65           if file
-0000f020: 4e61 6d65 203d 3d20 6974 656d 3a0a 2020  Name == item:.  
-0000f030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f040: 2020 666f 756e 6420 3d20 5472 7565 0a20    found = True. 
-0000f050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f060: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0000f070: 2873 656c 662e 6966 646f 5f74 6d70 5b73  (self.ifdo_tmp[s
-0000f080: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
-0000f090: 734b 6579 5d5b 6974 656d 5d2c 6c69 7374  sKey][item],list
-0000f0a0: 293a 2023 2069 6e20 6361 7365 206f 6620  ): # in case of 
-0000f0b0: 7669 6465 6f20 7769 7468 2069 7465 6d20  video with item 
-0000f0c0: 6173 206c 6973 7420 7468 6520 6669 7273  as list the firs
-0000f0d0: 7420 656e 7472 7920 686f 6c64 7320 7468  t entry holds th
-0000f0e0: 6520 6465 6661 756c 7420 616e 6420 7468  e default and th
-0000f0f0: 6520 6861 7368 2063 616e 6e6f 7420 7661  e hash cannot va
-0000f100: 7279 2066 6f72 2074 6865 2073 616d 6520  ry for the same 
-0000f110: 696d 6167 650a 2020 2020 2020 2020 2020  image.          
-0000f120: 2020 2020 2020 2020 2020 2020 2020 6974                it
-0000f130: 656d 456e 7472 7920 3d20 7365 6c66 2e69  emEntry = self.i
-0000f140: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
-0000f150: 6765 5365 7449 7465 6d73 4b65 795d 5b69  geSetItemsKey][i
-0000f160: 7465 6d5d 5b30 5d20 0a20 2020 2020 2020  tem][0] .       
-0000f170: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0000f180: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000f190: 2020 2020 2020 2020 2020 2069 7465 6d45             itemE
-0000f1a0: 6e74 7279 203d 2073 656c 662e 6966 646f  ntry = self.ifdo
-0000f1b0: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
-0000f1c0: 6574 4974 656d 734b 6579 5d5b 6974 656d  etItemsKey][item
-0000f1d0: 5d0a 0a20 2020 2020 2020 2020 2020 2020  ]..             
-0000f1e0: 2020 2020 2020 2069 6d61 6765 4d6f 6454         imageModT
-0000f1f0: 696d 6520 3d20 6f73 2e70 6174 682e 6765  ime = os.path.ge
-0000f200: 746d 7469 6d65 2869 6d61 6765 290a 2020  tmtime(image).  
-0000f210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f220: 2020 6966 206e 6f74 2068 6172 6420 616e    if not hard an
-0000f230: 6420 696d 6167 654d 6f64 5469 6d65 203c  d imageModTime <
-0000f240: 2068 6173 6846 696c 654d 6f64 5469 6d65   hashFileModTime
-0000f250: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000f260: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0000f270: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
-0000f280: 6528 696d 6167 6529 2069 6e20 6861 7368  e(image) in hash
-0000f290: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0000f2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f2b0: 6966 2072 6169 7365 4578 6365 7074 696f  if raiseExceptio
-0000f2c0: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
-0000f2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f2e0: 2020 2072 6169 7365 206d 6971 7463 2e49     raise miqtc.I
-0000f2f0: 6664 6f45 7863 6570 7469 6f6e 2869 7465  fdoException(ite
-0000f300: 6d2c 2022 6e6f 7420 666f 756e 6420 696e  m, "not found in
-0000f310: 2069 6e74 6572 6d65 6964 6174 6520 6861   intermeidate ha
-0000f320: 7368 2066 696c 6522 2c73 656c 662e 6765  sh file",self.ge
-0000f330: 745f 696e 745f 6861 7368 5f66 696c 6528  t_int_hash_file(
-0000f340: 292c 2220 7275 6e20 6372 6561 7465 496d  )," run createIm
-0000f350: 6167 6553 4841 3235 3646 696c 6528 2920  ageSHA256File() 
-0000f360: 6669 7273 7422 2920 0a20 2020 2020 2020  first") .       
-0000f370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f380: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000f390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f3a0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-0000f3b0: 7469 6f6e 4c69 7374 2e61 7070 656e 6428  tionList.append(
-0000f3c0: 5b66 696c 654e 616d 652c 226e 6f74 2066  [fileName,"not f
-0000f3d0: 6f75 6e64 2069 6e20 696e 7465 726d 6569  ound in intermei
-0000f3e0: 6461 7465 2068 6173 6820 6669 6c65 2022  date hash file "
-0000f3f0: 202b 2073 7472 2873 656c 662e 6765 745f   + str(self.get_
-0000f400: 696e 745f 6861 7368 5f66 696c 6528 2929  int_hash_file())
-0000f410: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-0000f420: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0000f430: 7420 6974 656d 456e 7472 795b 2769 6d61  t itemEntry['ima
-0000f440: 6765 2d68 6173 682d 7368 6132 3536 275d  ge-hash-sha256']
-0000f450: 203d 3d20 6861 7368 6573 5b6f 732e 7061   == hashes[os.pa
-0000f460: 7468 2e62 6173 656e 616d 6528 696d 6167  th.basename(imag
-0000f470: 6529 5d5b 2769 6d61 6765 2d68 6173 682d  e)]['image-hash-
-0000f480: 7368 6132 3536 275d 3a0a 2020 2020 2020  sha256']:.      
-0000f490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f4a0: 2020 2020 2020 6966 2072 6169 7365 4578        if raiseEx
-0000f4b0: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
-0000f4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f4d0: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
-0000f4e0: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
-0000f4f0: 6f6e 2869 7465 6d2c 2022 696e 636f 7272  on(item, "incorr
-0000f500: 6563 7420 7368 6132 3536 2068 6173 6822  ect sha256 hash"
-0000f510: 2c20 6974 656d 456e 7472 795b 2769 6d61  , itemEntry['ima
-0000f520: 6765 2d68 6173 682d 7368 6132 3536 275d  ge-hash-sha256']
-0000f530: 2c22 666f 7220 6669 6c65 222c 6669 6c65  ,"for file",file
-0000f540: 4e61 6d65 2c22 2072 756e 2063 7265 6174  Name," run creat
-0000f550: 6549 6d61 6765 5348 4132 3536 4669 6c65  eImageSHA256File
-0000f560: 2829 2066 6972 7374 2229 0a20 2020 2020  () first").     
-0000f570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f580: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000f590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f5a0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-0000f5b0: 6570 7469 6f6e 4c69 7374 2e61 7070 656e  eptionList.appen
-0000f5c0: 6428 5b66 696c 654e 616d 652c 2269 6e63  d([fileName,"inc
-0000f5d0: 6f72 7265 6374 2073 6861 3235 3620 6861  orrect sha256 ha
-0000f5e0: 7368 225d 290a 2020 2020 2020 2020 2020  sh"]).          
-0000f5f0: 2020 2020 2020 2020 2020 656c 6966 206e            elif n
-0000f600: 6f74 2069 7465 6d45 6e74 7279 5b27 696d  ot itemEntry['im
-0000f610: 6167 652d 6861 7368 2d73 6861 3235 3627  age-hash-sha256'
-0000f620: 5d20 3d3d 206d 6971 7463 2e73 6861 3235  ] == miqtc.sha25
-0000f630: 3648 6173 6846 696c 6528 696d 6167 6529  6HashFile(image)
-0000f640: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000f650: 2020 2020 2020 2020 2020 6966 2072 6169            if rai
-0000f660: 7365 4578 6365 7074 696f 6e3a 0a20 2020  seException:.   
-0000f670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f680: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
-0000f690: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
-0000f6a0: 6f6e 2869 7465 6d2c 2022 696e 636f 7272  on(item, "incorr
-0000f6b0: 6563 7420 7368 6132 3536 2068 6173 6822  ect sha256 hash"
-0000f6c0: 2c20 6974 656d 456e 7472 795b 2769 6d61  , itemEntry['ima
-0000f6d0: 6765 2d68 6173 682d 7368 6132 3536 275d  ge-hash-sha256']
-0000f6e0: 2c22 666f 7220 6669 6c65 222c 6669 6c65  ,"for file",file
-0000f6f0: 4e61 6d65 2c22 2072 756e 2063 7265 6174  Name," run creat
-0000f700: 6549 6d61 6765 5348 4132 3536 4669 6c65  eImageSHA256File
-0000f710: 2829 2066 6972 7374 2229 0a20 2020 2020  () first").     
-0000f720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f730: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000f740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f750: 2020 2020 2065 7863 6570 7469 6f6e 4c69       exceptionLi
-0000f760: 7374 2e61 7070 656e 6428 5b66 696c 654e  st.append([fileN
-0000f770: 616d 652c 2269 6e63 6f72 7265 6374 2073  ame,"incorrect s
-0000f780: 6861 3235 3620 6861 7368 225d 290a 2020  ha256 hash"]).  
-0000f790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f7a0: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
-0000f7b0: 2020 2020 6966 2066 6f75 6e64 3a0a 2020      if found:.  
-0000f7c0: 2020 2020 2020 2020 2020 2020 2020 6465                de
-0000f7d0: 6c20 6861 7368 556e 6368 6563 6b49 6d61  l hashUncheckIma
-0000f7e0: 6765 7349 6e52 6177 5b69 6d61 6765 5d0a  gesInRaw[image].
-0000f7f0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0000f800: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000f810: 2020 6966 2072 6169 7365 4578 6365 7074    if raiseExcept
-0000f820: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
-0000f830: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
-0000f840: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
-0000f850: 6f6e 2820 2269 6d61 6765 222c 2069 7465  on( "image", ite
-0000f860: 6d2c 2022 6e6f 7420 666f 756e 6420 696e  m, "not found in
-0000f870: 2064 6972 6563 746f 7279 2773 2072 6177   directory's raw
-0000f880: 2066 6f6c 6465 7221 2229 0a20 2020 2020   folder!").     
-0000f890: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000f8a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f8b0: 2020 2020 2065 7863 6570 7469 6f6e 4c69       exceptionLi
-0000f8c0: 7374 2e61 7070 656e 6428 5b66 696c 654e  st.append([fileN
-0000f8d0: 616d 652c 2266 696c 6520 6e6f 7420 666f  ame,"file not fo
-0000f8e0: 756e 6422 5d29 0a20 2020 2020 2020 2070  und"]).        p
-0000f8f0: 726f 672e 636c 6561 7228 290a 2020 2020  rog.clear().    
-0000f900: 2020 2020 6966 206e 6f74 2072 6169 7365      if not raise
-0000f910: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
-0000f920: 2020 2020 2020 2072 6574 7572 6e20 6578         return ex
-0000f930: 6365 7074 696f 6e4c 6973 740a 0a0a 2020  ceptionList...  
-0000f940: 2020 6465 6620 6372 6561 7465 5555 4944    def createUUID
-0000f950: 4669 6c65 2873 656c 662c 636c 6561 6e3d  File(self,clean=
-0000f960: 5472 7565 293a 0a20 2020 2020 2020 2022  True):.        "
-0000f970: 2222 2043 7265 6174 6573 2069 6e20 2f69  "" Creates in /i
-0000f980: 6e74 6572 6d65 6469 6174 6520 6120 7465  ntermediate a te
-0000f990: 7874 2066 696c 6520 636f 6e74 6169 6e69  xt file containi
-0000f9a0: 6e67 2070 6572 2069 6d61 6765 2061 2063  ng per image a c
-0000f9b0: 7265 6174 6564 2075 7569 6420 2876 6572  reated uuid (ver
-0000f9c0: 7369 6f6e 2034 292e 0a0a 2020 2020 2020  sion 4)...      
-0000f9d0: 2020 5468 6520 5555 4944 2069 7320 6f6e    The UUID is on
-0000f9e0: 6c79 202a 7461 6b65 6e2a 2066 726f 6d20  ly *taken* from 
-0000f9f0: 7468 6520 6d65 7461 6461 7461 206f 6620  the metadata of 
-0000fa00: 7468 6520 696d 6167 6573 2e20 4974 2064  the images. It d
-0000fa10: 6f65 7320 6e6f 7420 7772 6974 6520 5555  oes not write UU
-0000fa20: 4944 7320 746f 2074 6865 206d 6574 6164  IDs to the metad
-0000fa30: 6174 6120 696e 2063 6173 6520 736f 6d65  ata in case some
-0000fa40: 2066 696c 6573 2061 7265 206d 6973 7369   files are missi
-0000fa50: 6e67 2069 742e 0a20 2020 2020 2020 2042  ng it..        B
-0000fa60: 7574 2c20 6974 2063 7265 6174 6573 2061  ut, it creates a
-0000fa70: 2043 5356 2066 696c 6520 696e 2074 6861   CSV file in tha
-0000fa80: 7420 6361 7365 2074 6861 7420 796f 7520  t case that you 
-0000fa90: 6361 6e20 7573 6520 746f 6765 7468 6572  can use together
-0000faa0: 2077 6974 6820 6578 6966 746f 6f6c 2074   with exiftool t
-0000fab0: 6f20 6164 6420 7468 6520 5555 4944 2074  o add the UUID t
-0000fac0: 6f20 796f 7572 2064 6174 612e 2042 6577  o your data. Bew
-0000fad0: 6172 6521 2074 6869 7320 6361 6e20 6465  are! this can de
-0000fae0: 7374 726f 7920 796f 7572 2069 6d61 6765  stroy your image
-0000faf0: 730a 2020 2020 2020 2020 6966 206e 6f74  s.        if not
-0000fb00: 2064 6f6e 6520 7072 6f70 6572 6c79 2120   done properly! 
-0000fb10: 4e6f 2067 7561 7261 6e74 6565 2069 7320  No guarantee is 
-0000fb20: 6769 7665 6e20 6974 2077 696c 6c20 776f  given it will wo
-0000fb30: 726b 2e20 4265 2063 6172 6566 756c 210a  rk. Be careful!.
-0000fb40: 0a20 2020 2020 2020 2055 7365 2063 6c65  .        Use cle
-0000fb50: 616e 3d46 616c 7365 2074 6f20 6e6f 7420  an=False to not 
-0000fb60: 6368 6563 6b20 7468 6f73 6520 6669 6c65  check those file
-0000fb70: 7320 6167 6169 6e20 7768 6963 6820 6172  s again which ar
-0000fb80: 6520 616c 7265 6164 7920 666f 756e 6420  e already found 
-0000fb90: 696e 2069 6e74 6572 6d65 6469 6174 6520  in intermediate 
-0000fba0: 7575 6964 2066 696c 650a 2020 2020 2020  uuid file.      
-0000fbb0: 2020 2222 220a 0a20 2020 2020 2020 2075    """..        u
-0000fbc0: 7569 6473 203d 207b 7d0a 2020 2020 2020  uids = {}.      
-0000fbd0: 2020 2320 4368 6563 6b20 7768 6574 6865    # Check whethe
-0000fbe0: 7220 6120 6669 6c65 2077 6974 6820 5555  r a file with UU
-0000fbf0: 4944 7320 6578 6973 7473 2c20 7468 656e  IDs exists, then
-0000fc00: 2072 6561 6420 6974 0a20 2020 2020 2020   read it.       
-0000fc10: 2069 6620 6e6f 7420 636c 6561 6e20 616e   if not clean an
-0000fc20: 6420 6f73 2e70 6174 682e 6578 6973 7473  d os.path.exists
-0000fc30: 2873 656c 662e 6765 745f 696e 745f 7575  (self.get_int_uu
-0000fc40: 6964 5f66 696c 6528 2929 3a0a 2020 2020  id_file()):.    
-0000fc50: 2020 2020 2020 2020 7575 6964 7320 3d20          uuids = 
-0000fc60: 6d69 7174 662e 7461 6246 696c 6544 6174  miqtf.tabFileDat
-0000fc70: 6128 7365 6c66 2e67 6574 5f69 6e74 5f75  a(self.get_int_u
-0000fc80: 7569 645f 6669 6c65 2829 2c20 5b6d 6971  uid_file(), [miq
-0000fc90: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-0000fca0: 6172 6971 7427 5d5b 2769 6d67 275d 2c20  ariqt']['img'], 
-0000fcb0: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-0000fcc0: 5b27 6d61 7269 7174 275d 5b27 7575 6964  ['mariqt']['uuid
-0000fcd0: 275d 5d2c 206b 6579 5f63 6f6c 3d6d 6971  ']], key_col=miq
-0000fce0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-0000fcf0: 6172 6971 7427 5d5b 2769 6d67 275d 290a  ariqt']['img']).
-0000fd00: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-0000fd10: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
-0000fd20: 6578 6973 7473 2873 656c 662e 696d 6167  exists(self.imag
-0000fd30: 6573 4469 7229 3a0a 0a20 2020 2020 2020  esDir):..       
-0000fd40: 2020 2020 206d 6973 7369 6e67 5f75 7569       missing_uui
-0000fd50: 6473 203d 207b 7d0a 2020 2020 2020 2020  ds = {}.        
-0000fd60: 2020 2020 6164 6465 645f 7575 6964 7320      added_uuids 
-0000fd70: 3d20 300a 0a20 2020 2020 2020 2020 2020  = 0..           
-0000fd80: 2075 6e6b 6e6f 776e 4669 6c65 7320 3d20   unknownFiles = 
-0000fd90: 5b5d 0a20 2020 2020 2020 2020 2020 2066  [].            f
-0000fda0: 6f72 2066 696c 6520 696e 2073 656c 662e  or file in self.
-0000fdb0: 696d 6167 6573 496e 496d 6167 6573 4469  imagesInImagesDi
-0000fdc0: 7228 293a 0a20 2020 2020 2020 2020 2020  r():.           
-0000fdd0: 2020 2020 2066 696c 655f 6e61 6d65 203d       file_name =
-0000fde0: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
-0000fdf0: 6528 6669 6c65 290a 2020 2020 2020 2020  e(file).        
-0000fe00: 2020 2020 2020 2020 6966 2066 696c 655f          if file_
-0000fe10: 6e61 6d65 206e 6f74 2069 6e20 7575 6964  name not in uuid
-0000fe20: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0000fe30: 2020 2020 2020 2075 6e6b 6e6f 776e 4669         unknownFi
-0000fe40: 6c65 732e 6170 7065 6e64 2866 696c 6529  les.append(file)
-0000fe50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fe60: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000fe70: 2020 2020 2020 2020 2020 2075 7569 6473             uuids
-0000fe80: 5b66 696c 655f 6e61 6d65 5d20 3d20 7575  [file_name] = uu
-0000fe90: 6964 735b 6669 6c65 5f6e 616d 655d 5b6d  ids[file_name][m
-0000fea0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-0000feb0: 276d 6172 6971 7427 5d5b 2775 7569 6427  'mariqt']['uuid'
-0000fec0: 5d5d 0a0a 2020 2020 2020 2020 2020 2020  ]]..            
-0000fed0: 756e 6b6e 6f77 6e46 696c 6573 5555 4944  unknownFilesUUID
-0000fee0: 7320 3d20 6d69 7174 692e 696d 6167 6573  s = miqti.images
-0000fef0: 436f 6e74 6169 6e56 616c 6964 5555 4944  ContainValidUUID
-0000ff00: 2875 6e6b 6e6f 776e 4669 6c65 7329 0a20  (unknownFiles). 
-0000ff10: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
-0000ff20: 696c 6520 696e 2075 6e6b 6e6f 776e 4669  ile in unknownFi
-0000ff30: 6c65 7355 5549 4473 3a0a 2020 2020 2020  lesUUIDs:.      
-0000ff40: 2020 2020 2020 2020 2020 6669 6c65 5f6e            file_n
-0000ff50: 616d 6520 3d20 6f73 2e70 6174 682e 6261  ame = os.path.ba
-0000ff60: 7365 6e61 6d65 2866 696c 6529 0a20 2020  sename(file).   
-0000ff70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000ff80: 6e6f 7420 756e 6b6e 6f77 6e46 696c 6573  not unknownFiles
-0000ff90: 5555 4944 735b 6669 6c65 5d5b 2776 616c  UUIDs[file]['val
-0000ffa0: 6964 275d 3a0a 2020 2020 2020 2020 2020  id']:.          
-0000ffb0: 2020 2020 2020 2020 2020 7575 6964 203d            uuid =
-0000ffc0: 206d 6971 7463 2e75 7569 6434 2829 0a20   miqtc.uuid4(). 
-0000ffd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ffe0: 2020 206d 6973 7369 6e67 5f75 7569 6473     missing_uuids
-0000fff0: 5b66 696c 655d 203d 2075 7569 640a 2020  [file] = uuid.  
-00010000: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00010010: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00010020: 2020 2020 2020 2020 7575 6964 735b 6669          uuids[fi
-00010030: 6c65 5f6e 616d 655d 203d 2075 6e6b 6e6f  le_name] = unkno
-00010040: 776e 4669 6c65 7355 5549 4473 5b66 696c  wnFilesUUIDs[fil
-00010050: 655d 5b27 7575 6964 275d 0a20 2020 2020  e]['uuid'].     
-00010060: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00010070: 6464 6564 5f75 7569 6473 202b 3d20 310a  dded_uuids += 1.
-00010080: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
-00010090: 6620 7072 6576 696f 7573 6c79 2075 6e6b  f previously unk
-000100a0: 6e6f 776e 2055 5549 4473 2077 6572 6520  nown UUIDs were 
-000100b0: 666f 756e 6420 696e 2074 6865 2066 696c  found in the fil
-000100c0: 6520 6865 6164 6572 732c 2061 6464 2074  e headers, add t
-000100d0: 6865 6d20 746f 2074 6865 2055 5549 4420  hem to the UUID 
-000100e0: 6669 6c65 0a20 2020 2020 2020 2020 2020  file.           
-000100f0: 2069 6620 6164 6465 645f 7575 6964 7320   if added_uuids 
-00010100: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
-00010110: 2020 2020 2072 6573 203d 206f 7065 6e28       res = open(
-00010120: 7365 6c66 2e67 6574 5f69 6e74 5f75 7569  self.get_int_uui
-00010130: 645f 6669 6c65 2829 2c20 2277 2229 0a20  d_file(), "w"). 
-00010140: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00010150: 6573 2e77 7269 7465 286d 6971 7476 2e63  es.write(miqtv.c
-00010160: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-00010170: 7427 5d5b 2769 6d67 275d 202b 225c 7422  t']['img'] +"\t"
-00010180: 2b6d 6971 7476 2e63 6f6c 5f68 6561 6465  +miqtv.col_heade
-00010190: 725b 276d 6172 6971 7427 5d5b 2775 7569  r['mariqt']['uui
-000101a0: 6427 5d2b 225c 6e22 290a 2020 2020 2020  d']+"\n").      
-000101b0: 2020 2020 2020 2020 2020 666f 7220 6669            for fi
-000101c0: 6c65 2069 6e20 7575 6964 733a 0a20 2020  le in uuids:.   
-000101d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000101e0: 2072 6573 2e77 7269 7465 2866 696c 652b   res.write(file+
-000101f0: 225c 7422 2b73 7472 2875 7569 6473 5b66  "\t"+str(uuids[f
-00010200: 696c 655d 292b 225c 6e22 290a 2020 2020  ile])+"\n").    
-00010210: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-00010220: 636c 6f73 6528 290a 0a20 2020 2020 2020  close()..       
-00010230: 2020 2020 2069 6620 6c65 6e28 6d69 7373       if len(miss
-00010240: 696e 675f 7575 6964 7329 203e 2030 3a0a  ing_uuids) > 0:.
-00010250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010260: 6563 7376 5f70 6174 6820 3d20 7365 6c66  ecsv_path = self
-00010270: 2e5f 5f67 6574 5f69 6e74 5f66 696c 655f  .__get_int_file_
-00010280: 7072 6566 6978 2829 202b 2022 5f65 7869  prefix() + "_exi
-00010290: 662d 6164 642d 7575 6964 2e63 7376 220a  f-add-uuid.csv".
-000102a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000102b0: 6373 7620 3d20 6f70 656e 2865 6373 765f  csv = open(ecsv_
-000102c0: 7061 7468 2c20 2277 2229 0a20 2020 2020  path, "w").     
-000102d0: 2020 2020 2020 2020 2020 2063 7376 2e77             csv.w
-000102e0: 7269 7465 286d 6971 7476 2e63 6f6c 5f68  rite(miqtv.col_h
-000102f0: 6561 6465 725b 2765 7869 6627 5d5b 2769  eader['exif']['i
-00010300: 6d67 275d 202b 0a20 2020 2020 2020 2020  mg'] +.         
-00010310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010320: 2022 2c22 2b6d 6971 7476 2e63 6f6c 5f68   ","+miqtv.col_h
-00010330: 6561 6465 725b 2765 7869 6627 5d5b 2775  eader['exif']['u
-00010340: 7569 6427 5d2b 225c 6e22 290a 2020 2020  uid']+"\n").    
-00010350: 2020 2020 2020 2020 2020 2020 6469 6666              diff
-00010360: 6572 656e 745f 7061 7468 7320 3d20 5b5d  erent_paths = []
-00010370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010380: 2066 6f72 2069 6d67 2069 6e20 6d69 7373   for img in miss
-00010390: 696e 675f 7575 6964 733a 0a20 2020 2020  ing_uuids:.     
-000103a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000103b0: 6620 6f73 2e70 6174 682e 6261 7365 6e61  f os.path.basena
-000103c0: 6d65 2869 6d67 2920 6e6f 7420 696e 2064  me(img) not in d
-000103d0: 6966 6665 7265 6e74 5f70 6174 6873 3a0a  ifferent_paths:.
-000103e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000103f0: 2020 2020 2020 2020 6469 6666 6572 656e          differen
-00010400: 745f 7061 7468 732e 6170 7065 6e64 286f  t_paths.append(o
-00010410: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
-00010420: 696d 6729 290a 2020 2020 2020 2020 2020  img)).          
-00010430: 2020 2020 2020 2020 2020 6373 762e 7772            csv.wr
-00010440: 6974 6528 696d 672b 222c 222b 7374 7228  ite(img+","+str(
-00010450: 6d69 7373 696e 675f 7575 6964 735b 696d  missing_uuids[im
-00010460: 675d 292b 225c 6e22 290a 2020 2020 2020  g])+"\n").      
-00010470: 2020 2020 2020 2020 2020 2372 6574 7572            #retur
-00010480: 6e20 4661 6c73 652c 2022 6578 6966 746f  n False, "exifto
-00010490: 6f6c 202d 6373 763d 222b 6563 7376 5f70  ol -csv="+ecsv_p
-000104a0: 6174 682b 2220 222b 2220 222e 6a6f 696e  ath+" "+" ".join
-000104b0: 2864 6966 6665 7265 6e74 5f70 6174 6873  (different_paths
-000104c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000104d0: 2020 7265 7475 726e 2046 616c 7365 2c20    return False, 
-000104e0: 224e 6f74 2061 6c6c 2069 6d61 6765 7320  "Not all images 
-000104f0: 6861 7665 2076 616c 6964 2055 5549 4473  have valid UUIDs
-00010500: 2e20 4d69 7373 696e 6720 666f 7220 666f  . Missing for fo
-00010510: 6c6c 6f77 696e 6720 6669 6c65 733a 5c6e  llowing files:\n
-00010520: 222b 225c c586 222e 6a6f 696e 2864 6966  "+"\..".join(dif
-00010530: 6665 7265 6e74 5f70 6174 6873 290a 2020  ferent_paths).  
-00010540: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-00010550: 2020 2020 2020 2073 656c 662e 5f5f 616c         self.__al
-00010560: 6c55 5549 4473 4368 6563 6b65 6420 3d20  lUUIDsChecked = 
-00010570: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00010580: 2072 6574 7572 6e20 5472 7565 2c20 2241   return True, "A
-00010590: 6c6c 2069 6d61 6765 7320 6861 7665 2061  ll images have a
-000105a0: 2055 5549 4422 0a20 2020 2020 2020 2072   UUID".        r
-000105b0: 6574 7572 6e20 4661 6c73 652c 2022 5061  eturn False, "Pa
-000105c0: 7468 2022 2b73 656c 662e 696d 6167 6573  th "+self.images
-000105d0: 4469 7220 2b20 2220 6e6f 7420 666f 756e  Dir + " not foun
-000105e0: 642e 220a 0a0a 2020 2020 6465 6620 7365  d."...    def se
-000105f0: 7449 6d61 6765 5365 7441 7474 6974 7564  tImageSetAttitud
-00010600: 6528 7365 6c66 2c79 6177 5f66 7261 6d65  e(self,yaw_frame
-00010610: 3a66 6c6f 6174 2c70 6974 6368 5f66 7261  :float,pitch_fra
-00010620: 6d65 3a66 6c6f 6174 2c72 6f6c 6c5f 6672  me:float,roll_fr
-00010630: 616d 653a 666c 6f61 742c 7961 775f 6361  ame:float,yaw_ca
-00010640: 6d32 6672 616d 653a 666c 6f61 742c 7069  m2frame:float,pi
-00010650: 7463 685f 6361 6d32 6672 616d 653a 666c  tch_cam2frame:fl
-00010660: 6f61 742c 726f 6c6c 5f63 616d 3266 7261  oat,roll_cam2fra
-00010670: 6d65 3a66 6c6f 6174 293a 0a20 2020 2020  me:float):.     
-00010680: 2020 2022 2222 2063 616c 6375 6c61 7465     """ calculate
-00010690: 7320 7468 6520 7468 6520 6361 6d65 7261  s the the camera
-000106a0: 7320 6162 736f 6c75 7465 2061 7474 6974  s absolute attit
-000106b0: 7564 6520 616e 6420 7365 7473 2069 7420  ude and sets it 
-000106c0: 746f 2069 6d61 6765 2073 6574 2068 6561  to image set hea
-000106d0: 6465 722e 2041 6c6c 2061 6e67 6c65 7320  der. All angles 
-000106e0: 6172 6520 6578 7065 6374 6564 2069 6e20  are expected in 
-000106f0: 6465 6772 6565 732e 200a 2020 2020 2020  degrees. .      
-00010700: 2020 6361 6d65 7261 3266 7261 6d65 2061    camera2frame a
-00010710: 6e67 6c65 733a 2072 6f74 6174 696f 6e20  ngles: rotation 
-00010720: 6f66 2063 616d 6572 6120 636f 6f72 6469  of camera coordi
-00010730: 6e61 7465 7320 2878 2c79 2c7a 203d 2074  nates (x,y,z = t
-00010740: 6f70 2c20 7269 6768 742c 206c 696e 6520  op, right, line 
-00010750: 6f66 2073 6967 6874 2920 7769 7468 2072  of sight) with r
-00010760: 6573 7065 6374 2074 6f20 7665 6869 636c  espect to vehicl
-00010770: 6520 636f 6f72 6469 6e61 7465 7320 2878  e coordinates (x
-00010780: 2c79 2c7a 203d 2066 6f72 7761 7264 2c72  ,y,z = forward,r
-00010790: 6967 6874 2c64 6f77 6e29 200a 2020 2020  ight,down) .    
-000107a0: 2020 2020 696e 2061 6363 6f72 6461 6e63      in accordanc
-000107b0: 6520 7769 7468 2074 6865 2079 6177 2c70  e with the yaw,p
-000107c0: 6974 6368 2c72 6f6c 6c20 726f 7461 7469  itch,roll rotati
-000107d0: 6f6e 206f 7264 6572 2063 6f6e 7665 6e74  on order convent
-000107e0: 696f 6e3a 0a0a 2020 2020 2020 2020 312e  ion:..        1.
-000107f0: 2079 6177 2061 726f 756e 6420 7a2c 0a20   yaw around z,. 
-00010800: 2020 2020 2020 2032 2e20 7069 7463 6820         2. pitch 
-00010810: 6172 6f75 6e64 2072 6f74 6174 6564 2079  around rotated y
-00010820: 2c0a 2020 2020 2020 2020 332e 2072 6f6c  ,.        3. rol
-00010830: 6c20 6172 6f75 6e64 2072 6f74 6174 6564  l around rotated
-00010840: 2078 0a0a 2020 2020 2020 2020 526f 7461   x..        Rota
-00010850: 7469 6f6e 2064 6972 6563 7469 6f6e 7320  tion directions 
-00010860: 6163 636f 7264 696e 6720 746f 205c 2772  according to \'r
-00010870: 6967 6874 2d68 616e 6420 7275 6c65 5c27  ight-hand rule\'
-00010880: 2e0a 0a20 2020 2020 2020 2049 2e65 2e20  ...        I.e. 
-00010890: 6361 6d65 7261 3246 7261 6d65 2061 6e67  camera2Frame ang
-000108a0: 6c65 7320 3d20 302c 302c 3020 6361 6d65  les = 0,0,0 came
-000108b0: 7261 2069 7320 6661 6369 6e67 2064 6f77  ra is facing dow
-000108c0: 6e77 6172 6420 7769 7468 2074 6f70 2073  nward with top s
-000108d0: 6964 6520 746f 7761 7264 7320 7665 6869  ide towards vehi
-000108e0: 636c 6527 7320 666f 7277 6172 6420 6469  cle's forward di
-000108f0: 7265 6374 696f 6e27 2022 2222 0a0a 2020  rection' """..  
-00010900: 2020 2020 2020 525f 6672 616d 6532 6e65        R_frame2ne
-00010910: 6420 3d20 6d69 7174 672e 525f 5961 7750  d = miqtg.R_YawP
-00010920: 6974 6368 526f 6c6c 2879 6177 5f66 7261  itchRoll(yaw_fra
-00010930: 6d65 2c70 6974 6368 5f66 7261 6d65 2c72  me,pitch_frame,r
-00010940: 6f6c 6c5f 6672 616d 6529 0a20 2020 2020  oll_frame).     
-00010950: 2020 2052 5f63 616d 3266 7261 6d65 203d     R_cam2frame =
-00010960: 206d 6971 7467 2e52 5f59 6177 5069 7463   miqtg.R_YawPitc
-00010970: 6852 6f6c 6c28 7961 775f 6361 6d32 6672  hRoll(yaw_cam2fr
-00010980: 616d 652c 7069 7463 685f 6361 6d32 6672  ame,pitch_cam2fr
-00010990: 616d 652c 726f 6c6c 5f63 616d 3266 7261  ame,roll_cam2fra
-000109a0: 6d65 290a 2020 2020 2020 2020 525f 6361  me).        R_ca
-000109b0: 6d32 6e65 6420 3d20 525f 6672 616d 6532  m2ned = R_frame2
-000109c0: 6e65 642e 646f 7428 525f 6361 6d32 6672  ned.dot(R_cam2fr
-000109d0: 616d 6529 0a20 2020 2020 2020 2079 6177  ame).        yaw
-000109e0: 2c70 6974 6368 2c72 6f6c 6c20 3d20 6d69  ,pitch,roll = mi
-000109f0: 7174 672e 7961 7750 6974 6368 526f 6c6c  qtg.yawPitchRoll
-00010a00: 2852 5f63 616d 326e 6564 290a 0a20 2020  (R_cam2ned)..   
-00010a10: 2020 2020 2023 2070 6f73 6520 6d61 7472       # pose matr
-00010a20: 6978 2063 616d 3275 746d 0a20 2020 2020  ix cam2utm.     
-00010a30: 2020 2052 5f63 616d 5374 6432 7574 6d20     R_camStd2utm 
-00010a40: 3d20 7365 6c66 2e67 6574 5f52 5f63 616d  = self.get_R_cam
-00010a50: 5374 6432 7574 6d28 525f 6361 6d32 6672  Std2utm(R_cam2fr
-00010a60: 616d 652c 525f 6672 616d 6532 6e65 6429  ame,R_frame2ned)
-00010a70: 0a0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00010a80: 2020 2020 2020 7820 3d20 6e70 2e61 7272        x = np.arr
-00010a90: 6179 285b 312c 302c 305d 290a 2020 2020  ay([1,0,0]).    
-00010aa0: 2020 2020 7920 3d20 6e70 2e61 7272 6179      y = np.array
-00010ab0: 285b 302c 312c 305d 290a 2020 2020 2020  ([0,1,0]).      
-00010ac0: 2020 7a20 3d20 6e70 2e61 7272 6179 285b    z = np.array([
-00010ad0: 302c 302c 315d 290a 2020 2020 2020 2020  0,0,1]).        
-00010ae0: 7072 696e 7428 2778 272c 525f 6361 6d53  print('x',R_camS
-00010af0: 7464 3275 746d 2e64 6f74 2878 292e 726f  td2utm.dot(x).ro
-00010b00: 756e 6428 3529 290a 2020 2020 2020 2020  und(5)).        
-00010b10: 7072 696e 7428 2779 272c 525f 6361 6d53  print('y',R_camS
-00010b20: 7464 3275 746d 2e64 6f74 2879 292e 726f  td2utm.dot(y).ro
-00010b30: 756e 6428 3529 290a 2020 2020 2020 2020  und(5)).        
-00010b40: 7072 696e 7428 277a 272c 525f 6361 6d53  print('z',R_camS
-00010b50: 7464 3275 746d 2e64 6f74 287a 292e 726f  td2utm.dot(z).ro
-00010b60: 756e 6428 3529 290a 2020 2020 2020 2020  und(5)).        
-00010b70: 2222 220a 0a20 2020 2020 2020 2068 6561  """..        hea
-00010b80: 6465 7255 7064 6174 6520 3d20 7b0a 2020  derUpdate = {.  
-00010b90: 2020 2020 2020 2020 2020 6d69 7174 762e            miqtv.
-00010ba0: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00010bb0: 7174 275d 5b27 7961 7727 5d3a 7961 772c  qt']['yaw']:yaw,
-00010bc0: 0a20 2020 2020 2020 2020 2020 206d 6971  .            miq
-00010bd0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00010be0: 6172 6971 7427 5d5b 2770 6974 6368 275d  ariqt']['pitch']
-00010bf0: 3a70 6974 6368 2c0a 2020 2020 2020 2020  :pitch,.        
-00010c00: 2020 2020 6d69 7174 762e 636f 6c5f 6865      miqtv.col_he
-00010c10: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00010c20: 726f 6c6c 275d 3a72 6f6c 6c2c 0a20 2020  roll']:roll,.   
-00010c30: 2020 2020 2020 2020 206d 6971 7476 2e63           miqtv.c
-00010c40: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-00010c50: 7427 5d5b 2770 6f73 6527 5d3a 7b27 706f  t']['pose']:{'po
-00010c60: 7365 2d61 6273 6f6c 7574 652d 6f72 6965  se-absolute-orie
-00010c70: 6e74 6174 696f 6e2d 7574 6d2d 6d61 7472  ntation-utm-matr
-00010c80: 6978 273a 525f 6361 6d53 7464 3275 746d  ix':R_camStd2utm
-00010c90: 2e66 6c61 7474 656e 2829 2e74 6f6c 6973  .flatten().tolis
-00010ca0: 7428 297d 0a20 2020 2020 2020 207d 0a20  t()}.        }. 
-00010cb0: 2020 2020 2020 2073 656c 662e 7570 6461         self.upda
-00010cc0: 7465 6946 444f 4865 6164 6572 4669 656c  teiFDOHeaderFiel
-00010cd0: 6473 2868 6561 6465 7255 7064 6174 6529  ds(headerUpdate)
-00010ce0: 0a0a 0a20 2020 2064 6566 2063 7265 6174  ...    def creat
-00010cf0: 6549 6d61 6765 4174 7469 7475 6465 4669  eImageAttitudeFi
-00010d00: 6c65 2873 656c 662c 2061 7474 5f70 6174  le(self, att_pat
-00010d10: 683a 7374 722c 2066 7261 6d65 5f61 7474  h:str, frame_att
-00010d20: 5f68 6561 6465 723a 6469 6374 2c20 6361  _header:dict, ca
-00010d30: 6d65 7261 3246 7261 6d65 5f79 6177 3a66  mera2Frame_yaw:f
-00010d40: 6c6f 6174 2c63 616d 6572 6132 4672 616d  loat,camera2Fram
-00010d50: 655f 7069 7463 683a 666c 6f61 742c 6361  e_pitch:float,ca
-00010d60: 6d65 7261 3246 7261 6d65 5f72 6f6c 6c3a  mera2Frame_roll:
-00010d70: 666c 6f61 742c 0a20 2020 2020 2020 2020  float,.         
-00010d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d90: 2020 2020 2020 2064 6174 655f 666f 726d         date_form
-00010da0: 6174 3d6d 6971 7476 2e64 6174 655f 666f  at=miqtv.date_fo
-00010db0: 726d 6174 735b 2770 616e 6761 6561 275d  rmats['pangaea']
-00010dc0: 2c20 636f 6e73 745f 7661 6c75 6573 203d  , const_values =
-00010dd0: 207b 7d2c 206f 7665 7277 7269 7465 3d46   {}, overwrite=F
-00010de0: 616c 7365 2c20 636f 6c5f 7365 7061 7261  alse, col_separa
-00010df0: 746f 7220 3d20 225c 7422 2c0a 2020 2020  tor = "\t",.    
-00010e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e10: 2020 2020 2020 2020 2020 2020 6174 745f              att_
-00010e20: 7061 7468 5f61 6e67 6c65 735f 696e 5f72  path_angles_in_r
-00010e30: 6164 203d 2046 616c 7365 2c20 7669 6465  ad = False, vide
-00010e40: 6f53 616d 706c 6553 6563 6f6e 6473 3d31  oSampleSeconds=1
-00010e50: 2c72 6563 6f72 6473 3262 6549 6e76 6572  ,records2beInver
-00010e60: 7465 643d 5b5d 293a 0a20 2020 2020 2020  ted=[]):.       
-00010e70: 2022 2222 2043 7265 6174 6573 2069 6e20   """ Creates in 
-00010e80: 2f69 6e74 6572 6d65 6469 6174 6520 6120  /intermediate a 
-00010e90: 7465 7874 2066 696c 6520 7769 7468 2063  text file with c
-00010ea0: 616d 6572 6120 6174 7469 7475 6465 2064  amera attitude d
-00010eb0: 6174 6120 666f 7220 6561 6368 2069 6d61  ata for each ima
-00010ec0: 6765 2e20 416c 6c20 616e 676c 6573 2061  ge. All angles a
-00010ed0: 7265 2065 7870 6563 7465 6420 696e 2064  re expected in d
-00010ee0: 6567 7265 6573 2e20 5573 6520 6174 745f  egrees. Use att_
-00010ef0: 7061 7468 5f61 6e67 6c65 735f 696e 5f72  path_angles_in_r
-00010f00: 6164 2069 6620 6e65 6365 7373 6172 792e  ad if necessary.
-00010f10: 200a 2020 2020 2020 2020 6361 6d65 7261   .        camera
-00010f20: 3246 7261 6d65 2061 6e67 6c65 733a 2072  2Frame angles: r
-00010f30: 6f74 6174 696f 6e20 6f66 2063 616d 6572  otation of camer
-00010f40: 6120 636f 6f72 6469 6e61 7465 7320 2878  a coordinates (x
-00010f50: 2c79 2c7a 203d 2074 6f70 2c20 7269 6768  ,y,z = top, righ
-00010f60: 742c 206c 696e 6520 6f66 2073 6967 6874  t, line of sight
-00010f70: 2920 7769 7468 2072 6573 7065 6374 2074  ) with respect t
-00010f80: 6f20 7665 6869 636c 6520 636f 6f72 6469  o vehicle coordi
-00010f90: 6e61 7465 7320 2878 2c79 2c7a 203d 2066  nates (x,y,z = f
-00010fa0: 6f72 7761 7264 2c72 6967 6874 2c64 6f77  orward,right,dow
-00010fb0: 6e29 200a 2020 2020 2020 2020 696e 2061  n) .        in a
-00010fc0: 6363 6f72 6461 6e63 6520 7769 7468 2074  ccordance with t
-00010fd0: 6865 2079 6177 2c70 6974 6368 2c72 6f6c  he yaw,pitch,rol
-00010fe0: 6c20 726f 7461 7469 6f6e 206f 7264 6572  l rotation order
-00010ff0: 2063 6f6e 7665 6e74 696f 6e3a 0a20 2020   convention:.   
-00011000: 2020 2020 2031 2e20 7961 7720 6172 6f75       1. yaw arou
-00011010: 6e64 207a 2c0a 2020 2020 2020 2020 322e  nd z,.        2.
-00011020: 2070 6974 6368 2061 726f 756e 6420 726f   pitch around ro
-00011030: 7461 7465 6420 792c 0a20 2020 2020 2020  tated y,.       
-00011040: 2033 2e20 726f 6c6c 2061 726f 756e 6420   3. roll around 
-00011050: 726f 7461 7465 6420 780a 0a20 2020 2020  rotated x..     
-00011060: 2020 2052 6f74 6174 696f 6e20 6469 7265     Rotation dire
-00011070: 6374 696f 6e73 2061 6363 6f72 6469 6e67  ctions according
-00011080: 2074 6f20 5c27 7269 6768 742d 6861 6e64   to \'right-hand
-00011090: 2072 756c 655c 272e 0a0a 2020 2020 2020   rule\'...      
-000110a0: 2020 492e 652e 2063 616d 6572 6132 4672    I.e. camera2Fr
-000110b0: 616d 6520 616e 676c 6573 203d 2030 2c30  ame angles = 0,0
-000110c0: 2c30 2063 616d 6572 6120 6973 2066 6163  ,0 camera is fac
-000110d0: 696e 6720 646f 776e 7761 7264 2077 6974  ing downward wit
-000110e0: 6820 746f 7020 7369 6465 2074 6f77 6172  h top side towar
-000110f0: 6473 2076 6568 6963 6c65 2773 2066 6f72  ds vehicle's for
-00011100: 7761 7264 2064 6972 6563 7469 6f6e 2720  ward direction' 
-00011110: 2222 220a 0a20 2020 2020 2020 2069 6e74  """..        int
-00011120: 5f61 7474 7574 7564 655f 6669 6c65 203d  _attutude_file =
-00011130: 2073 656c 662e 5f5f 6765 745f 696e 745f   self.__get_int_
-00011140: 6669 6c65 5f70 7265 6669 7828 2920 2b20  file_prefix() + 
-00011150: 275f 696d 6167 652d 6174 7469 7475 6465  '_image-attitude
-00011160: 2e74 7874 270a 2020 2020 2020 2020 6f75  .txt'.        ou
-00011170: 7470 7574 5f68 6561 6465 725f 6174 7420  tput_header_att 
-00011180: 3d20 7b20 2020 6d69 7174 762e 636f 6c5f  = {   miqtv.col_
-00011190: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-000111a0: 5b27 696d 6727 5d3a 2020 6d69 7174 762e  ['img']:  miqtv.
-000111b0: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-000111c0: 7174 275d 5b27 696d 6727 5d2c 0a20 2020  qt']['img'],.   
-000111d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000111e0: 2020 2020 2020 2020 2020 2020 206d 6971               miq
-000111f0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00011200: 6172 6971 7427 5d5b 2775 7463 275d 3a6d  ariqt']['utc']:m
-00011210: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-00011220: 276d 6172 6971 7427 5d5b 2775 7463 275d  'mariqt']['utc']
-00011230: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00011240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011250: 2020 6d69 7174 762e 636f 6c5f 6865 6164    miqtv.col_head
-00011260: 6572 5b27 6d61 7269 7174 275d 5b27 7961  er['mariqt']['ya
-00011270: 7727 5d3a 6d69 7174 762e 636f 6c5f 6865  w']:miqtv.col_he
-00011280: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00011290: 7961 7727 5d2c 0a20 2020 2020 2020 2020  yaw'],.         
-000112a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000112b0: 2020 2020 2020 206d 6971 7476 2e63 6f6c         miqtv.col
-000112c0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-000112d0: 5d5b 2770 6974 6368 275d 3a6d 6971 7476  ]['pitch']:miqtv
-000112e0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-000112f0: 6971 7427 5d5b 2770 6974 6368 275d 2c0a  iqt']['pitch'],.
-00011300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011320: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-00011330: 5b27 6d61 7269 7174 275d 5b27 726f 6c6c  ['mariqt']['roll
-00011340: 275d 3a6d 6971 7476 2e63 6f6c 5f68 6561  ']:miqtv.col_hea
-00011350: 6465 725b 276d 6172 6971 7427 5d5b 2772  der['mariqt']['r
-00011360: 6f6c 6c27 5d2c 0a20 2020 2020 2020 2020  oll'],.         
-00011370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011380: 2020 207d 0a0a 2020 2020 2020 2020 696e     }..        in
-00011390: 745f 706f 7365 5f66 696c 6520 3d20 7365  t_pose_file = se
-000113a0: 6c66 2e5f 5f67 6574 5f69 6e74 5f66 696c  lf.__get_int_fil
-000113b0: 655f 7072 6566 6978 2829 202b 2027 5f69  e_prefix() + '_i
-000113c0: 6d61 6765 2d63 616d 6572 612d 706f 7365  mage-camera-pose
-000113d0: 2e74 7874 270a 2020 2020 2020 2020 6f75  .txt'.        ou
-000113e0: 7470 7574 5f68 6561 6465 725f 706f 7365  tput_header_pose
-000113f0: 203d 207b 2020 6d69 7174 762e 636f 6c5f   = {  miqtv.col_
-00011400: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-00011410: 5b27 696d 6727 5d3a 6d69 7174 762e 636f  ['img']:miqtv.co
-00011420: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00011430: 275d 5b27 696d 6727 5d2c 0a20 2020 2020  ']['img'],.     
-00011440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011450: 2020 2020 2020 2020 2020 206d 6971 7476             miqtv
-00011460: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00011470: 6971 7427 5d5b 2775 7463 275d 3a6d 6971  iqt']['utc']:miq
-00011480: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00011490: 6172 6971 7427 5d5b 2775 7463 275d 2c0a  ariqt']['utc'],.
-000114a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000114b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000114c0: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-000114d0: 5b27 6d61 7269 7174 275d 5b27 706f 7365  ['mariqt']['pose
-000114e0: 275d 3a6d 6971 7476 2e63 6f6c 5f68 6561  ']:miqtv.col_hea
-000114f0: 6465 725b 276d 6172 6971 7427 5d5b 2770  der['mariqt']['p
-00011500: 6f73 6527 5d2c 0a20 2020 2020 2020 2020  ose'],.         
-00011510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011520: 2020 207d 0a0a 2020 2020 2020 2020 6966     }..        if
-00011530: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-00011540: 696e 745f 6174 7475 7475 6465 5f66 696c  int_attutude_fil
-00011550: 6529 2061 6e64 206e 6f74 206f 7665 7277  e) and not overw
-00011560: 7269 7465 3a0a 2020 2020 2020 2020 2020  rite:.          
-00011570: 2020 7365 6c66 2e61 6464 4974 656d 496e    self.addItemIn
-00011580: 666f 5461 6246 696c 6528 696e 745f 6174  foTabFile(int_at
-00011590: 7475 7475 6465 5f66 696c 652c 225c 7422  tutude_file,"\t"
-000115a0: 2c6f 7574 7075 745f 6865 6164 6572 5f61  ,output_header_a
-000115b0: 7474 290a 2020 2020 2020 2020 2020 2020  tt).            
-000115c0: 7265 7475 726e 2054 7275 652c 2022 4f75  return True, "Ou
-000115d0: 7470 7574 2066 696c 6520 6578 6973 7473  tput file exists
-000115e0: 3a20 222b 696e 745f 6174 7475 7475 6465  : "+int_attutude
-000115f0: 5f66 696c 650a 0a20 2020 2020 2020 2069  _file..        i
-00011600: 6620 6e6f 7420 6f73 2e70 6174 682e 6578  f not os.path.ex
-00011610: 6973 7473 2861 7474 5f70 6174 6829 3a0a  ists(att_path):.
-00011620: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00011630: 726e 2046 616c 7365 2c20 224e 6176 6967  rn False, "Navig
-00011640: 6174 696f 6e20 6669 6c65 206e 6f74 2066  ation file not f
-00011650: 6f75 6e64 3a20 222b 6174 745f 7061 7468  ound: "+att_path
-00011660: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-00011670: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-00011680: 7365 6c66 2e69 6d61 6765 7344 6972 293a  self.imagesDir):
-00011690: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000116a0: 7572 6e20 4661 6c73 652c 2022 496d 6167  urn False, "Imag
-000116b0: 6520 666f 6c64 6572 206e 6f74 2066 6f75  e folder not fou
-000116c0: 6e64 3a20 222b 2073 656c 662e 696d 6167  nd: "+ self.imag
-000116d0: 6573 4469 720a 0a20 2020 2020 2020 2073  esDir..        s
-000116e0: 203d 206d 6971 7463 2e50 7269 6e74 4c6f   = miqtc.PrintLo
-000116f0: 6164 696e 674d 7367 2822 4372 6561 7469  adingMsg("Creati
-00011700: 6e67 2069 7465 6d73 2720 6174 7469 7475  ng items' attitu
-00011710: 6465 2064 6174 6122 290a 0a20 2020 2020  de data")..     
-00011720: 2020 2023 206c 6f61 6420 6672 616d 6520     # load frame 
-00011730: 6174 7469 7475 6465 2064 6174 6120 6672  attitude data fr
-00011740: 6f6d 2066 696c 650a 2020 2020 2020 2020  om file.        
-00011750: 6174 745f 6461 7461 2c20 7061 7273 654d  att_data, parseM
-00011760: 7367 203d 206d 6971 746e 2e72 6561 6441  sg = miqtn.readA
-00011770: 6c6c 4174 7469 7475 6465 7346 726f 6d46  llAttitudesFromF
-00011780: 696c 6550 6174 6828 6174 745f 7061 7468  ilePath(att_path
-00011790: 2c20 6672 616d 655f 6174 745f 6865 6164  , frame_att_head
-000117a0: 6572 2c20 6461 7465 5f66 6f72 6d61 742c  er, date_format,
-000117b0: 636f 6c5f 7365 7061 7261 746f 723d 636f  col_separator=co
-000117c0: 6c5f 7365 7061 7261 746f 722c 636f 6e73  l_separator,cons
-000117d0: 745f 7661 6c75 6573 3d63 6f6e 7374 5f76  t_values=const_v
-000117e0: 616c 7565 732c 616e 676c 6573 496e 5261  alues,anglesInRa
-000117f0: 643d 6174 745f 7061 7468 5f61 6e67 6c65  d=att_path_angle
-00011800: 735f 696e 5f72 6164 290a 2020 2020 2020  s_in_rad).      
-00011810: 2020 6966 2070 6172 7365 4d73 6720 213d    if parseMsg !=
-00011820: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
-00011830: 2073 656c 662e 7072 6f76 2e6c 6f67 2870   self.prov.log(p
-00011840: 6172 7365 4d73 672c 646f 6e74 5368 6f77  arseMsg,dontShow
-00011850: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
-00011860: 2020 2070 6172 7365 4d73 6720 3d20 225c     parseMsg = "\
-00011870: 6e22 202b 2070 6172 7365 4d73 670a 0a20  n" + parseMsg.. 
-00011880: 2020 2020 2020 2023 2066 696e 6420 666f         # find fo
-00011890: 7220 6561 6368 2069 6d61 6765 2074 6865  r each image the
-000118a0: 2072 6573 7065 6374 6976 6520 6e61 7669   respective navi
-000118b0: 6761 7469 6f6e 2064 6174 610a 2020 2020  gation data.    
-000118c0: 2020 2020 732e 7374 6f70 2829 0a20 2020      s.stop().   
-000118d0: 2020 2020 2073 7563 6365 7373 2c20 696d       success, im
-000118e0: 6167 655f 6474 732c 206d 7367 203d 2073  age_dts, msg = s
-000118f0: 656c 662e 6669 6e64 4e61 7644 6174 6146  elf.findNavDataF
-00011900: 6f72 496d 6167 6528 6174 745f 6461 7461  orImage(att_data
-00011910: 2c76 6964 656f 5361 6d70 6c65 5365 636f  ,videoSampleSeco
-00011920: 6e64 7329 0a20 2020 2020 2020 2069 6620  nds).        if 
-00011930: 6e6f 7420 7375 6363 6573 733a 0a20 2020  not success:.   
-00011940: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00011950: 4661 6c73 652c 206d 7367 202b 2070 6172  False, msg + par
-00011960: 7365 4d73 670a 2020 2020 2020 2020 7320  seMsg.        s 
-00011970: 3d20 6d69 7174 632e 5072 696e 744c 6f61  = miqtc.PrintLoa
-00011980: 6469 6e67 4d73 6728 2243 7265 6174 696e  dingMsg("Creatin
-00011990: 6720 6974 656d 7327 2061 7474 6974 7564  g items' attitud
-000119a0: 6520 6461 7461 2229 0a0a 2020 2020 2020  e data")..      
-000119b0: 2020 2320 6164 6420 6361 6d65 7261 3246    # add camera2F
-000119c0: 7261 6d65 2061 6e67 6c65 730a 2020 2020  rame angles.    
-000119d0: 2020 2020 525f 6361 6d32 6672 616d 6520      R_cam2frame 
-000119e0: 3d20 6d69 7174 672e 525f 5961 7750 6974  = miqtg.R_YawPit
-000119f0: 6368 526f 6c6c 2863 616d 6572 6132 4672  chRoll(camera2Fr
-00011a00: 616d 655f 7961 772c 6361 6d65 7261 3246  ame_yaw,camera2F
-00011a10: 7261 6d65 5f70 6974 6368 2c63 616d 6572  rame_pitch,camer
-00011a20: 6132 4672 616d 655f 726f 6c6c 290a 2020  a2Frame_roll).  
-00011a30: 2020 2020 2020 525f 6361 6d32 7574 6d5f        R_cam2utm_
-00011a40: 6c69 7374 203d 205b 5d0a 2020 2020 2020  list = [].      
-00011a50: 2020 666f 7220 6669 6c65 2069 6e20 696d    for file in im
-00011a60: 6167 655f 6474 733a 0a20 2020 2020 2020  age_dts:.       
-00011a70: 2020 2020 2066 6f72 2074 696d 6570 6f69       for timepoi
-00011a80: 6e74 2069 6e20 696d 6167 655f 6474 735b  nt in image_dts[
-00011a90: 6669 6c65 5d3a 0a20 2020 2020 2020 2020  file]:.         
-00011aa0: 2020 2020 2020 2061 7474 6974 7564 6520         attitude 
-00011ab0: 3d20 7469 6d65 706f 696e 740a 2020 2020  = timepoint.    
-00011ac0: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-00011ad0: 7474 6974 7564 652e 7961 7720 6973 204e  ttitude.yaw is N
-00011ae0: 6f6e 6520 6f72 2061 7474 6974 7564 652e  one or attitude.
-00011af0: 7069 7463 6820 6973 204e 6f6e 6520 6f72  pitch is None or
-00011b00: 2061 7474 6974 7564 652e 726f 6c6c 2069   attitude.roll i
-00011b10: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00011b20: 2020 2020 2020 2020 2020 2020 525f 6361              R_ca
-00011b30: 6d32 7574 6d5f 6c69 7374 2e61 7070 656e  m2utm_list.appen
-00011b40: 6428 2222 290a 2020 2020 2020 2020 2020  d("").          
-00011b50: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-00011b60: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-00011b70: 2020 2052 5f66 7261 6d65 326e 6564 203d     R_frame2ned =
-00011b80: 206d 6971 7467 2e52 5f59 6177 5069 7463   miqtg.R_YawPitc
-00011b90: 6852 6f6c 6c28 6174 7469 7475 6465 2e79  hRoll(attitude.y
-00011ba0: 6177 2c61 7474 6974 7564 652e 7069 7463  aw,attitude.pitc
-00011bb0: 682c 6174 7469 7475 6465 2e72 6f6c 6c29  h,attitude.roll)
-00011bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011bd0: 2052 5f63 616d 326e 6564 203d 2052 5f66   R_cam2ned = R_f
-00011be0: 7261 6d65 326e 6564 2e64 6f74 2852 5f63  rame2ned.dot(R_c
-00011bf0: 616d 3266 7261 6d65 290a 2020 2020 2020  am2frame).      
-00011c00: 2020 2020 2020 2020 2020 7961 772c 7069            yaw,pi
-00011c10: 7463 682c 726f 6c6c 203d 206d 6971 7467  tch,roll = miqtg
-00011c20: 2e79 6177 5069 7463 6852 6f6c 6c28 525f  .yawPitchRoll(R_
-00011c30: 6361 6d32 6e65 6429 0a20 2020 2020 2020  cam2ned).       
-00011c40: 2020 2020 2020 2020 2061 7474 6974 7564           attitud
-00011c50: 652e 7961 7720 3d20 7961 770a 2020 2020  e.yaw = yaw.    
-00011c60: 2020 2020 2020 2020 2020 2020 6174 7469              atti
-00011c70: 7475 6465 2e70 6974 6368 203d 2070 6974  tude.pitch = pit
-00011c80: 6368 0a20 2020 2020 2020 2020 2020 2020  ch.             
-00011c90: 2020 2061 7474 6974 7564 652e 726f 6c6c     attitude.roll
-00011ca0: 203d 2072 6f6c 6c0a 0a20 2020 2020 2020   = roll..       
-00011cb0: 2020 2020 2020 2020 2052 5f63 616d 5374           R_camSt
-00011cc0: 6432 7574 6d20 3d20 7365 6c66 2e67 6574  d2utm = self.get
-00011cd0: 5f52 5f63 616d 5374 6432 7574 6d28 525f  _R_camStd2utm(R_
-00011ce0: 6361 6d32 6672 616d 652c 525f 6672 616d  cam2frame,R_fram
-00011cf0: 6532 6e65 6429 0a20 2020 2020 2020 2020  e2ned).         
-00011d00: 2020 2020 2020 2052 5f63 616d 3275 746d         R_cam2utm
-00011d10: 5f6c 6973 742e 6170 7065 6e64 2852 5f63  _list.append(R_c
-00011d20: 616d 5374 6432 7574 6d2e 666c 6174 7465  amStd2utm.flatte
-00011d30: 6e28 292e 746f 6c69 7374 2829 290a 0a20  n().tolist()).. 
-00011d40: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
-00011d50: 2e6c 6f67 2822 6170 706c 6965 6420 6672  .log("applied fr
-00011d60: 616d 6520 746f 2063 616d 6572 6120 726f  ame to camera ro
-00011d70: 7461 7469 6f6e 2079 6177 2c70 6974 6368  tation yaw,pitch
-00011d80: 2c72 6f6c 6c20 3d20 2220 2b20 7374 7228  ,roll = " + str(
-00011d90: 6361 6d65 7261 3246 7261 6d65 5f79 6177  camera2Frame_yaw
-00011da0: 2920 2b20 222c 2220 2b20 7374 7228 6361  ) + "," + str(ca
-00011db0: 6d65 7261 3246 7261 6d65 5f70 6974 6368  mera2Frame_pitch
-00011dc0: 2920 2b20 222c 2220 2b20 7374 7228 6361  ) + "," + str(ca
-00011dd0: 6d65 7261 3246 7261 6d65 5f72 6f6c 6c29  mera2Frame_roll)
-00011de0: 2c64 6f6e 7453 686f 773d 5472 7565 290a  ,dontShow=True).
-00011df0: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-00011e00: 696d 6167 655f 6474 7329 203e 2030 3a0a  image_dts) > 0:.
-00011e10: 0a20 2020 2020 2020 2020 2020 2023 2057  .            # W
-00011e20: 7269 7465 2074 6f20 6e61 7669 6761 7469  rite to navigati
-00011e30: 6f6e 2074 7874 2066 696c 650a 2020 2020  on txt file.    
-00011e40: 2020 2020 2020 2020 2320 6865 6164 6572          # header
-00011e50: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00011e60: 203d 206f 7065 6e28 696e 745f 6174 7475   = open(int_attu
-00011e70: 7475 6465 5f66 696c 652c 2022 7722 290a  tude_file, "w").
-00011e80: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-00011e90: 7772 6974 6528 6d69 7174 762e 636f 6c5f  write(miqtv.col_
-00011ea0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-00011eb0: 5b27 696d 6727 5d2b 225c 7422 2b6d 6971  ['img']+"\t"+miq
-00011ec0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00011ed0: 6172 6971 7427 5d5b 2775 7463 275d 290a  ariqt']['utc']).
-00011ee0: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-00011ef0: 7772 6974 6528 225c 7422 2b6d 6971 7476  write("\t"+miqtv
-00011f00: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00011f10: 6971 7427 5d5b 2779 6177 275d 290a 2020  iqt']['yaw']).  
-00011f20: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
-00011f30: 6974 6528 225c 7422 2b6d 6971 7476 2e63  ite("\t"+miqtv.c
-00011f40: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-00011f50: 7427 5d5b 2770 6974 6368 275d 290a 2020  t']['pitch']).  
-00011f60: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
-00011f70: 6974 6528 225c 7422 2b6d 6971 7476 2e63  ite("\t"+miqtv.c
-00011f80: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-00011f90: 7427 5d5b 2772 6f6c 6c27 5d29 0a0a 2020  t']['roll'])..  
-00011fa0: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
-00011fb0: 6974 6528 225c 6e22 290a 2020 2020 2020  ite("\n").      
-00011fc0: 2020 2020 2020 2320 6461 7461 206c 696e        # data lin
-00011fd0: 6573 0a20 2020 2020 2020 2020 2020 2066  es.            f
-00011fe0: 6f72 2066 696c 6520 696e 2069 6d61 6765  or file in image
-00011ff0: 5f64 7473 3a0a 2020 2020 2020 2020 2020  _dts:.          
-00012000: 2020 2020 2020 666f 7220 7469 6d65 706f        for timepo
-00012010: 696e 7420 696e 2069 6d61 6765 5f64 7473  int in image_dts
-00012020: 5b66 696c 655d 3a0a 2020 2020 2020 2020  [file]:.        
-00012030: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-00012040: 7772 6974 6528 6669 6c65 2b22 5c74 222b  write(file+"\t"+
-00012050: 7469 6d65 706f 696e 742e 6461 7465 5469  timepoint.dateTi
-00012060: 6d65 2829 2e73 7472 6674 696d 6528 6d69  me().strftime(mi
-00012070: 7174 762e 6461 7465 5f66 6f72 6d61 7473  qtv.date_formats
-00012080: 5b27 6d61 7269 7174 275d 2929 200a 2020  ['mariqt'])) .  
-00012090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000120a0: 2020 7661 6c20 3d20 7469 6d65 706f 696e    val = timepoin
-000120b0: 742e 7961 770a 2020 2020 2020 2020 2020  t.yaw.          
-000120c0: 2020 2020 2020 2020 2020 6966 2027 7961            if 'ya
-000120d0: 7727 2069 6e20 7265 636f 7264 7332 6265  w' in records2be
-000120e0: 496e 7665 7274 6564 3a0a 2020 2020 2020  Inverted:.      
-000120f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012100: 2020 7661 6c20 2a3d 202d 310a 2020 2020    val *= -1.    
-00012110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012120: 7265 732e 7772 6974 6528 225c 7422 2b73  res.write("\t"+s
-00012130: 7472 2876 616c 2929 0a20 2020 2020 2020  tr(val)).       
-00012140: 2020 2020 2020 2020 2020 2020 2076 616c               val
-00012150: 203d 2074 696d 6570 6f69 6e74 2e70 6974   = timepoint.pit
-00012160: 6368 0a20 2020 2020 2020 2020 2020 2020  ch.             
-00012170: 2020 2020 2020 2069 6620 2770 6974 6368         if 'pitch
-00012180: 2720 696e 2072 6563 6f72 6473 3262 6549  ' in records2beI
-00012190: 6e76 6572 7465 643a 0a20 2020 2020 2020  nverted:.       
-000121a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000121b0: 2076 616c 202a 3d20 2d31 0a20 2020 2020   val *= -1.     
-000121c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000121d0: 6573 2e77 7269 7465 2822 5c74 222b 7374  es.write("\t"+st
-000121e0: 7228 7661 6c29 290a 2020 2020 2020 2020  r(val)).        
-000121f0: 2020 2020 2020 2020 2020 2020 7661 6c20              val 
-00012200: 3d20 7469 6d65 706f 696e 742e 726f 6c6c  = timepoint.roll
-00012210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012220: 2020 2020 2069 6620 2772 6f6c 6c27 2069       if 'roll' i
-00012230: 6e20 7265 636f 7264 7332 6265 496e 7665  n records2beInve
-00012240: 7274 6564 3a0a 2020 2020 2020 2020 2020  rted:.          
-00012250: 2020 2020 2020 2020 2020 2020 2020 7661                va
-00012260: 6c20 2a3d 202d 310a 2020 2020 2020 2020  l *= -1.        
-00012270: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-00012280: 7772 6974 6528 225c 7422 2b73 7472 2876  write("\t"+str(v
-00012290: 616c 2929 0a20 2020 2020 2020 2020 2020  al)).           
-000122a0: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
-000122b0: 7465 2822 5c6e 2229 0a20 2020 2020 2020  te("\n").       
-000122c0: 2020 2020 2072 6573 2e63 6c6f 7365 2829       res.close()
-000122d0: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-000122e0: 6c66 2e70 726f 762e 6164 6441 7267 756d  lf.prov.addArgum
-000122f0: 656e 7428 2269 6e70 7574 4174 7469 7475  ent("inputAttitu
-00012300: 6465 4669 6c65 222c 6174 745f 7061 7468  deFile",att_path
-00012310: 2c6f 7665 7277 7269 7465 3d54 7275 6529  ,overwrite=True)
-00012320: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00012330: 662e 7072 6f76 2e6c 6f67 2822 7061 7273  f.prov.log("pars
-00012340: 6564 2066 726f 6d20 696e 7075 7441 7474  ed from inputAtt
-00012350: 6974 7564 6546 696c 653a 2022 202b 2073  itudeFile: " + s
-00012360: 7472 2866 7261 6d65 5f61 7474 5f68 6561  tr(frame_att_hea
-00012370: 6465 7229 2c64 6f6e 7453 686f 773d 5472  der),dontShow=Tr
-00012380: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-00012390: 7365 6c66 2e61 6464 4974 656d 496e 666f  self.addItemInfo
-000123a0: 5461 6246 696c 6528 696e 745f 6174 7475  TabFile(int_attu
-000123b0: 7475 6465 5f66 696c 652c 225c 7422 2c6f  tude_file,"\t",o
-000123c0: 7574 7075 745f 6865 6164 6572 5f61 7474  utput_header_att
-000123d0: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-000123e0: 2057 7269 7465 2074 6f20 706f 7365 2074   Write to pose t
-000123f0: 7874 2066 696c 650a 2020 2020 2020 2020  xt file.        
-00012400: 2020 2020 2320 6865 6164 6572 0a20 2020      # header.   
-00012410: 2020 2020 2020 2020 2072 6573 203d 206f           res = o
-00012420: 7065 6e28 696e 745f 706f 7365 5f66 696c  pen(int_pose_fil
-00012430: 652c 2022 7722 290a 2020 2020 2020 2020  e, "w").        
-00012440: 2020 2020 7265 732e 7772 6974 6528 6d69      res.write(mi
-00012450: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-00012460: 6d61 7269 7174 275d 5b27 696d 6727 5d2b  mariqt']['img']+
-00012470: 225c 7422 2b6d 6971 7476 2e63 6f6c 5f68  "\t"+miqtv.col_h
-00012480: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-00012490: 2775 7463 275d 290a 2020 2020 2020 2020  'utc']).        
-000124a0: 2020 2020 7265 732e 7772 6974 6528 225c      res.write("\
-000124b0: 7422 2b6d 6971 7476 2e63 6f6c 5f68 6561  t"+miqtv.col_hea
-000124c0: 6465 725b 276d 6172 6971 7427 5d5b 2770  der['mariqt']['p
-000124d0: 6f73 6527 5d29 0a20 2020 2020 2020 2020  ose']).         
-000124e0: 2020 2072 6573 2e77 7269 7465 2822 5c6e     res.write("\n
-000124f0: 2229 0a20 2020 2020 2020 2020 2020 2023  ").            #
-00012500: 2064 6174 6120 6c69 6e65 730a 2020 2020   data lines.    
-00012510: 2020 2020 2020 2020 6920 3d20 300a 2020          i = 0.  
-00012520: 2020 2020 2020 2020 2020 666f 7220 6669            for fi
-00012530: 6c65 2069 6e20 696d 6167 655f 6474 733a  le in image_dts:
-00012540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012550: 2066 6f72 2074 696d 6570 6f69 6e74 2069   for timepoint i
-00012560: 6e20 696d 6167 655f 6474 735b 6669 6c65  n image_dts[file
-00012570: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00012580: 2020 2020 2020 2069 6620 525f 6361 6d32         if R_cam2
-00012590: 7574 6d5f 6c69 7374 5b69 5d20 3d3d 2022  utm_list[i] == "
-000125a0: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-000125b0: 2020 2020 2020 2020 2020 2069 202b 3d20             i += 
-000125c0: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-000125d0: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-000125e0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-000125f0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-00012600: 2866 696c 652b 225c 7422 2b74 696d 6570  (file+"\t"+timep
-00012610: 6f69 6e74 2e64 6174 6554 696d 6528 292e  oint.dateTime().
-00012620: 7374 7266 7469 6d65 286d 6971 7476 2e64  strftime(miqtv.d
-00012630: 6174 655f 666f 726d 6174 735b 276d 6172  ate_formats['mar
-00012640: 6971 7427 5d29 2920 0a20 2020 2020 2020  iqt'])) .       
-00012650: 2020 2020 2020 2020 2020 2020 2065 6e74               ent
-00012660: 7279 203d 2073 7472 287b 2770 6f73 652d  ry = str({'pose-
-00012670: 6162 736f 6c75 7465 2d6f 7269 656e 7461  absolute-orienta
-00012680: 7469 6f6e 2d75 746d 2d6d 6174 7269 7827  tion-utm-matrix'
-00012690: 3a52 5f63 616d 3275 746d 5f6c 6973 745b  :R_cam2utm_list[
-000126a0: 695d 7d29 2e72 6570 6c61 6365 2827 5c6e  i]}).replace('\n
-000126b0: 272c 2727 290a 2020 2020 2020 2020 2020  ','').          
-000126c0: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
-000126d0: 6974 6528 225c 7422 2b65 6e74 7279 290a  ite("\t"+entry).
-000126e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000126f0: 2020 2020 6920 2b3d 2031 0a20 2020 2020      i += 1.     
-00012700: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00012710: 6573 2e77 7269 7465 2822 5c6e 2229 0a20  es.write("\n"). 
-00012720: 2020 2020 2020 2020 2020 2072 6573 2e63             res.c
-00012730: 6c6f 7365 2829 0a20 2020 2020 2020 2020  lose().         
-00012740: 2020 2073 656c 662e 6164 6449 7465 6d49     self.addItemI
-00012750: 6e66 6f54 6162 4669 6c65 2869 6e74 5f70  nfoTabFile(int_p
-00012760: 6f73 655f 6669 6c65 2c22 5c74 222c 6f75  ose_file,"\t",ou
-00012770: 7470 7574 5f68 6561 6465 725f 706f 7365  tput_header_pose
-00012780: 290a 2020 2020 2020 2020 2020 2020 732e  ).            s.
-00012790: 7374 6f70 2829 0a20 2020 2020 2020 2020  stop().         
-000127a0: 2020 2072 6574 7572 6e20 5472 7565 2c20     return True, 
-000127b0: 2241 7474 6974 7564 6520 6461 7461 2063  "Attitude data c
-000127c0: 7265 6174 6564 2220 2b20 7061 7273 654d  reated" + parseM
-000127d0: 7367 0a20 2020 2020 2020 2065 6c73 653a  sg.        else:
-000127e0: 0a20 2020 2020 2020 2020 2020 2073 2e73  .            s.s
-000127f0: 746f 7028 290a 2020 2020 2020 2020 2020  top().          
-00012800: 2020 7265 7475 726e 2046 616c 7365 2c20    return False, 
-00012810: 224e 6f20 696d 6167 6520 6174 7469 7475  "No image attitu
-00012820: 6465 7320 666f 756e 6422 202b 2070 6172  des found" + par
-00012830: 7365 4d73 670a 2020 2020 2020 2020 0a0a  seMsg.        ..
-00012840: 2020 2020 6465 6620 6765 745f 525f 6361      def get_R_ca
-00012850: 6d53 7464 3275 746d 2873 656c 662c 525f  mStd2utm(self,R_
-00012860: 6361 6d32 6672 616d 653a 6e70 2e61 7272  cam2frame:np.arr
-00012870: 6179 2c52 5f66 7261 6d65 326e 6564 3a6e  ay,R_frame2ned:n
-00012880: 702e 6172 7261 7929 3a0a 2020 2020 2020  p.array):.      
-00012890: 2020 2222 2220 7265 7472 756e 2072 6f74    """ retrun rot
-000128a0: 6174 696f 6e20 6d61 7472 6978 2052 2074  ation matrix R t
-000128b0: 7261 6e66 6f72 6d69 6e67 2066 726f 6d20  ranforming from 
-000128c0: 6361 6d53 7464 3a20 2878 2c79 2c7a 203d  camStd: (x,y,z =
-000128d0: 2072 6967 6874 2c62 7574 746f 6d2c 6c69   right,buttom,li
-000128e0: 6e65 206f 6620 7369 6768 7429 2074 6f20  ne of sight) to 
-000128f0: 7574 6d20 2878 2c79 2c7a 203d 2065 6173  utm (x,y,z = eas
-00012900: 7469 6e67 2c6e 6f72 7468 696e 672c 7570  ting,northing,up
-00012910: 2920 2222 220a 2020 2020 2020 2020 525f  ) """.        R_
-00012920: 6361 6d69 4644 4f32 6361 6d53 7464 203d  camiFDO2camStd =
-00012930: 206d 6971 7467 2e52 5f59 6177 5069 7463   miqtg.R_YawPitc
-00012940: 6852 6f6c 6c28 3930 2c30 2c30 2920 2320  hRoll(90,0,0) # 
-00012950: 696e 2069 4644 4f20 6361 6d3a 2028 782c  in iFDO cam: (x,
-00012960: 792c 7a20 3d20 746f 702c 7269 6768 742c  y,z = top,right,
-00012970: 6c69 6e65 206f 6620 7369 6768 7429 2062  line of sight) b
-00012980: 7574 2066 6f72 2070 6f73 6520 7468 6520  ut for pose the 
-00012990: 2773 7461 6e64 6172 6427 2063 616d 5374  'standard' camSt
-000129a0: 643a 2028 782c 792c 7a20 3d20 7269 6768  d: (x,y,z = righ
-000129b0: 742c 6275 7474 6f6d 2c6c 696e 6520 6f66  t,buttom,line of
-000129c0: 2073 6967 6874 2920 6973 2065 7870 6563   sight) is expec
-000129d0: 7465 640a 2020 2020 2020 2020 525f 6361  ted.        R_ca
-000129e0: 6d53 7464 3266 7261 6d65 203d 2052 5f63  mStd2frame = R_c
-000129f0: 616d 3266 7261 6d65 2e64 6f74 2852 5f63  am2frame.dot(R_c
-00012a00: 616d 6946 444f 3263 616d 5374 6429 0a20  amiFDO2camStd). 
-00012a10: 2020 2020 2020 2052 5f63 616d 5374 6432         R_camStd2
-00012a20: 6e65 6420 3d20 525f 6672 616d 6532 6e65  ned = R_frame2ne
-00012a30: 642e 646f 7428 525f 6361 6d53 7464 3266  d.dot(R_camStd2f
-00012a40: 7261 6d65 290a 2020 2020 2020 2020 525f  rame).        R_
-00012a50: 6e65 6432 7574 6d20 3d20 6d69 7174 672e  ned2utm = miqtg.
-00012a60: 525f 5859 5a28 3138 302c 302c 3930 2920  R_XYZ(180,0,90) 
-00012a70: 2320 7769 7468 2075 746d 2078 2c79 2c7a  # with utm x,y,z
-00012a80: 203d 2065 6173 7469 6e67 2c6e 6f72 7468   = easting,north
-00012a90: 696e 672c 7570 0a20 2020 2020 2020 2052  ing,up.        R
-00012aa0: 5f63 616d 5374 6432 7574 6d20 3d20 525f  _camStd2utm = R_
-00012ab0: 6e65 6432 7574 6d2e 646f 7428 525f 6361  ned2utm.dot(R_ca
-00012ac0: 6d53 7464 326e 6564 292e 726f 756e 6428  mStd2ned).round(
-00012ad0: 3529 0a20 2020 2020 2020 2072 6574 7572  5).        retur
-00012ae0: 6e20 525f 6361 6d53 7464 3275 746d 0a0a  n R_camStd2utm..
-00012af0: 0a20 2020 2064 6566 2066 696e 644e 6176  .    def findNav
-00012b00: 4461 7461 466f 7249 6d61 6765 2873 656c  DataForImage(sel
-00012b10: 662c 6461 7461 3a6d 6971 7467 2e4e 756d  f,data:miqtg.Num
-00012b20: 4461 7461 5469 6d65 5374 616d 7065 642c  DataTimeStamped,
-00012b30: 7669 6465 6f53 616d 706c 6553 6563 6f6e  videoSampleSecon
-00012b40: 6473 3d31 293a 0a20 2020 2020 2020 2022  ds=1):.        "
-00012b50: 2222 2063 7265 6174 6573 2061 2064 6963  "" creates a dic
-00012b60: 7420 2869 6d61 6765 5f64 7473 2920 7769  t (image_dts) wi
-00012b70: 7468 2066 696c 6520 6e61 6d65 2061 7320  th file name as 
-00012b80: 6b65 7920 616e 6420 6120 6c69 7374 206f  key and a list o
-00012b90: 6620 6461 7461 2065 6c65 6d65 6e74 7320  f data elements 
-00012ba0: 6173 2076 616c 7565 2e20 0a20 2020 2020  as value. .     
-00012bb0: 2020 2020 2020 2049 6e20 6361 7365 206f         In case o
-00012bc0: 6620 7068 6f74 6f73 2074 6865 206c 6973  f photos the lis
-00012bd0: 7420 6861 7320 6f6e 6c79 2061 2073 696e  t has only a sin
-00012be0: 676c 6520 656e 7472 792c 2066 6f72 2076  gle entry, for v
-00012bf0: 6964 656f 7320 6974 2068 6173 2076 6964  ideos it has vid
-00012c00: 656f 2064 7572 6174 696f 6e20 5b73 6563  eo duration [sec
-00012c10: 5d20 2f20 7669 6465 6f53 616d 706c 6553  ] / videoSampleS
-00012c20: 6563 6f6e 6473 2065 6e74 7269 6573 2e0a  econds entries..
-00012c30: 2020 2020 2020 2020 2020 2020 5265 7475              Retu
-00012c40: 726e 7320 7375 6363 6573 732c 2069 6d61  rns success, ima
-00012c50: 6765 5f64 7473 2c20 6d73 6720 2222 220a  ge_dts, msg """.
-00012c60: 0a20 2020 2020 2020 2069 6620 7669 6465  .        if vide
-00012c70: 6f53 616d 706c 6553 6563 6f6e 6473 203c  oSampleSeconds <
-00012c80: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-00012c90: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
-00012ca0: 2822 6669 6e64 4e61 7644 6174 6146 6f72  ("findNavDataFor
-00012cb0: 496d 6167 653a 2076 6964 656f 5361 6d70  Image: videoSamp
-00012cc0: 6c65 5365 636f 6e64 7320 6d75 7374 2062  leSeconds must b
-00012cd0: 6520 6772 6561 7465 7220 3022 290a 0a20  e greater 0").. 
-00012ce0: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
-00012cf0: 736f 7274 6564 2074 696d 6520 706f 696e  sorted time poin
-00012d00: 7473 0a20 2020 2020 2020 2074 696d 655f  ts.        time_
-00012d10: 706f 696e 7473 203d 206c 6973 7428 6461  points = list(da
-00012d20: 7461 2e6b 6579 7328 2929 0a20 2020 2020  ta.keys()).     
-00012d30: 2020 2074 696d 655f 706f 696e 7473 2e73     time_points.s
-00012d40: 6f72 7428 290a 2020 2020 2020 2020 756e  ort().        un
-00012d50: 6d61 7463 6865 6454 696d 6550 6f69 6e74  matchedTimePoint
-00012d60: 7320 3d20 5b5d 0a20 2020 2020 2020 2069  s = [].        i
-00012d70: 6d61 6765 5f64 7473 203d 207b 7d0a 2020  mage_dts = {}.  
-00012d80: 2020 2020 2020 7374 6172 7453 6561 7263        startSearc
-00012d90: 6849 6e64 6578 203d 2030 0a20 2020 2020  hIndex = 0.     
-00012da0: 2020 2069 6d61 6765 7349 6e52 6177 203d     imagesInRaw =
-00012db0: 2020 7365 6c66 2e69 6d61 6765 7349 6e49    self.imagesInI
-00012dc0: 6d61 6765 7344 6972 2829 0a20 2020 2020  magesDir().     
-00012dd0: 2020 2069 6d61 6765 7349 6e52 6177 536f     imagesInRawSo
-00012de0: 7274 6564 4c69 7374 203d 2073 656c 662e  rtedList = self.
-00012df0: 696d 6167 6573 496e 496d 6167 6573 4469  imagesInImagesDi
-00012e00: 7253 6f72 7465 644c 6973 7428 290a 2020  rSortedList().  
-00012e10: 2020 2020 2020 7072 6f67 203d 206d 6971        prog = miq
-00012e20: 7463 2e50 7269 6e74 4b6e 6f77 6e50 726f  tc.PrintKnownPro
-00012e30: 6772 6573 734d 7367 2822 496e 7465 7270  gressMsg("Interp
-00012e40: 6f6c 6174 696e 6720 6e61 7669 6761 7469  olating navigati
-00012e50: 6f6e 2066 6f72 2069 6d61 6765 222c 206c  on for image", l
-00012e60: 656e 2869 6d61 6765 7349 6e52 6177 292c  en(imagesInRaw),
-00012e70: 6d6f 6475 6c6f 3d31 290a 2020 2020 2020  modulo=1).      
-00012e80: 2020 666f 7220 6669 6c65 2069 6e20 696d    for file in im
-00012e90: 6167 6573 496e 5261 7753 6f72 7465 644c  agesInRawSortedL
-00012ea0: 6973 743a 0a20 2020 2020 2020 2020 2020  ist:.           
-00012eb0: 2070 726f 672e 7072 6f67 7265 7373 2829   prog.progress()
-00012ec0: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-00012ed0: 655f 6e61 6d65 203d 206f 732e 7061 7468  e_name = os.path
-00012ee0: 2e62 6173 656e 616d 6528 6669 6c65 290a  .basename(file).
-00012ef0: 0a20 2020 2020 2020 2020 2020 2064 745f  .            dt_
-00012f00: 696d 6167 6520 3d20 6d69 7174 632e 7061  image = miqtc.pa
-00012f10: 7273 6546 696c 6544 6174 6554 696d 6541  rseFileDateTimeA
-00012f20: 7355 5443 2866 696c 655f 6e61 6d65 290a  sUTC(file_name).
-00012f30: 2020 2020 2020 2020 2020 2020 6474 5f69              dt_i
-00012f40: 6d61 6765 5f74 7320 3d20 696e 7428 6474  mage_ts = int(dt
-00012f50: 5f69 6d61 6765 2e74 696d 6573 7461 6d70  _image.timestamp
-00012f60: 2829 202a 2031 3030 3029 0a0a 2020 2020  () * 1000)..    
-00012f70: 2020 2020 2020 2020 7275 6e54 696d 6520          runTime 
-00012f80: 3d20 696d 6167 6573 496e 5261 775b 6669  = imagesInRaw[fi
-00012f90: 6c65 5d5b 315d 2023 202d 3120 666f 7220  le][1] # -1 for 
-00012fa0: 7068 6f74 6f73 0a20 2020 2020 2020 2020  photos.         
-00012fb0: 2020 2023 2076 6964 656f 0a20 2020 2020     # video.     
-00012fc0: 2020 2020 2020 2069 6620 696d 6167 6573         if images
-00012fd0: 496e 5261 775b 6669 6c65 5d5b 325d 2069  InRaw[file][2] i
-00012fe0: 6e20 6d69 7174 762e 7669 6465 6f5f 7479  n miqtv.video_ty
-00012ff0: 7065 7320 616e 6420 7275 6e54 696d 6520  pes and runTime 
-00013000: 3c3d 2030 3a20 2320 6578 740a 2020 2020  <= 0: # ext.    
-00013010: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00013020: 7428 2243 6175 7469 6f6e 2120 436f 756c  t("Caution! Coul
-00013030: 6420 6e6f 7420 7265 6164 2076 6964 656f  d not read video
-00013040: 2072 756e 2074 696d 6520 6672 6f6d 2066   run time from f
-00013050: 696c 6522 2c66 696c 6529 2023 2054 4f44  ile",file) # TOD
-00013060: 4f20 646f 6573 2074 6869 7320 6861 7070  O does this happ
-00013070: 656e 3f20 4861 6e64 6c65 2062 6574 7465  en? Handle bette
-00013080: 723f 0a0a 2020 2020 2020 2020 2020 2020  r?..            
-00013090: 7361 6d70 6c65 5469 6d65 5365 6373 203d  sampleTimeSecs =
-000130a0: 2030 0a20 2020 2020 2020 2020 2020 2070   0.            p
-000130b0: 6f73 5f6c 6973 7420 3d20 5b5d 0a20 2020  os_list = [].   
-000130c0: 2020 2020 2020 2020 2067 6f20 3d20 5472           go = Tr
-000130d0: 7565 0a20 2020 2020 2020 2020 2020 2077  ue.            w
-000130e0: 6869 6c65 2067 6f3a 0a20 2020 2020 2020  hile go:.       
-000130f0: 2020 2020 2020 2020 2074 7279 3a20 2020           try:   
-00013100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013110: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00013120: 2020 2020 2020 706f 732c 2073 7461 7274        pos, start
-00013130: 5365 6172 6368 496e 6465 7820 3d20 6461  SearchIndex = da
-00013140: 7461 2e69 6e74 6572 706f 6c61 7465 4174  ta.interpolateAt
-00013150: 5469 6d65 2864 745f 696d 6167 655f 7473  Time(dt_image_ts
-00013160: 202b 2073 616d 706c 6554 696d 6553 6563   + sampleTimeSec
-00013170: 7320 2a20 3130 3030 2c74 696d 655f 706f  s * 1000,time_po
-00013180: 696e 7473 2c73 7461 7274 5365 6172 6368  ints,startSearch
-00013190: 496e 6465 7829 0a20 2020 2020 2020 2020  Index).         
-000131a0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-000131b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000131c0: 2320 696e 7465 7270 6f6c 6174 6541 7454  # interpolateAtT
-000131d0: 696d 6520 7265 7475 726e 7320 4e6f 6e65  ime returns None
-000131e0: 2076 616c 7565 7320 6966 2074 696d 6520   values if time 
-000131f0: 6f75 7420 6f66 2072 616e 6765 0a20 2020  out of range.   
-00013200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013210: 2069 6620 706f 732e 636f 7461 696e 734e   if pos.cotainsN
-00013220: 6f6e 6556 616c 7565 7349 6e52 6571 7569  oneValuesInRequi
-00013230: 7265 6446 6965 6c64 7328 293a 0a20 2020  redFields():.   
-00013240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013250: 2020 2020 2075 6e6d 6174 6368 6564 5469       unmatchedTi
-00013260: 6d65 506f 696e 7473 2e61 7070 656e 6428  mePoints.append(
-00013270: 2864 745f 696d 6167 655f 7473 202b 2073  (dt_image_ts + s
-00013280: 616d 706c 6554 696d 6553 6563 7320 2a20  ampleTimeSecs * 
-00013290: 3130 3030 292f 3130 3030 290a 2020 2020  1000)/1000).    
-000132a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000132b0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000132c0: 2020 2020 2020 2020 2020 2020 2020 706f                po
-000132d0: 735f 6c69 7374 2e61 7070 656e 6428 706f  s_list.append(po
-000132e0: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-000132f0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-00013300: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
-00013310: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00013320: 7475 726e 2046 616c 7365 2c20 696d 6167  turn False, imag
-00013330: 655f 6474 732c 2022 436f 756c 6420 6e6f  e_dts, "Could no
-00013340: 7420 6669 6e64 2069 6d61 6765 2074 696d  t find image tim
-00013350: 6520 222b 2064 6174 6574 696d 652e 6461  e "+ datetime.da
-00013360: 7465 7469 6d65 2e75 7463 6672 6f6d 7469  tetime.utcfromti
-00013370: 6d65 7374 616d 7028 2864 745f 696d 6167  mestamp((dt_imag
-00013380: 655f 7473 202b 2073 616d 706c 6554 696d  e_ts + sampleTim
-00013390: 6553 6563 7320 2a20 3130 3030 292f 3130  eSecs * 1000)/10
-000133a0: 3030 292e 7374 7266 7469 6d65 286d 6971  00).strftime(miq
-000133b0: 7476 2e64 6174 655f 666f 726d 6174 735b  tv.date_formats[
-000133c0: 276d 6172 6971 7427 5d29 202b 2220 696e  'mariqt']) +" in
-000133d0: 2022 2b73 7472 2864 6174 612e 6c65 6e28   "+str(data.len(
-000133e0: 2929 2b22 2064 6174 6120 706f 7369 7469  ))+" data positi
-000133f0: 6f6e 7322 202b 2073 7472 2865 2e61 7267  ons" + str(e.arg
-00013400: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-00013410: 2020 2073 616d 706c 6554 696d 6553 6563     sampleTimeSec
-00013420: 7320 2b3d 2076 6964 656f 5361 6d70 6c65  s += videoSample
-00013430: 5365 636f 6e64 730a 2020 2020 2020 2020  Seconds.        
-00013440: 2020 2020 2020 2020 6966 2073 616d 706c          if sampl
-00013450: 6554 696d 6553 6563 7320 3e20 7275 6e54  eTimeSecs > runT
-00013460: 696d 653a 0a20 2020 2020 2020 2020 2020  ime:.           
-00013470: 2020 2020 2020 2020 2067 6f20 3d20 4661           go = Fa
-00013480: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00013490: 0a20 2020 2020 2020 2020 2020 2069 6d61  .            ima
-000134a0: 6765 5f64 7473 5b66 696c 655f 6e61 6d65  ge_dts[file_name
-000134b0: 5d20 3d20 706f 735f 6c69 7374 0a20 2020  ] = pos_list.   
-000134c0: 2020 2020 2070 726f 672e 636c 6561 7228       prog.clear(
-000134d0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-000134e0: 4d73 6720 3d20 2222 0a20 2020 2020 2020  Msg = "".       
-000134f0: 2069 6620 6c65 6e28 756e 6d61 7463 6865   if len(unmatche
-00013500: 6454 696d 6550 6f69 6e74 7329 2021 3d20  dTimePoints) != 
-00013510: 303a 0a20 2020 2020 2020 2020 2020 2075  0:.            u
-00013520: 6e6d 6174 6368 6564 5469 6d65 506f 696e  nmatchedTimePoin
-00013530: 7473 2e73 6f72 7428 290a 2020 2020 2020  ts.sort().      
-00013540: 2020 2020 2020 756e 6d61 7463 6865 6454        unmatchedT
-00013550: 696d 6550 6f69 6e74 7320 3d20 5b64 6174  imePoints = [dat
-00013560: 6574 696d 652e 6461 7465 7469 6d65 2e75  etime.datetime.u
-00013570: 7463 6672 6f6d 7469 6d65 7374 616d 7028  tcfromtimestamp(
-00013580: 7473 292e 7374 7266 7469 6d65 286d 6971  ts).strftime(miq
-00013590: 7476 2e64 6174 655f 666f 726d 6174 735b  tv.date_formats[
-000135a0: 276d 6172 6971 7427 5d29 2066 6f72 2074  'mariqt']) for t
-000135b0: 7320 696e 2075 6e6d 6174 6368 6564 5469  s in unmatchedTi
-000135c0: 6d65 506f 696e 7473 5d0a 2020 2020 2020  mePoints].      
-000135d0: 2020 2020 2020 7265 7475 726e 4d73 6720        returnMsg 
-000135e0: 3d20 2243 4155 5449 4f4e 2120 4e61 7669  = "CAUTION! Navi
-000135f0: 6761 7469 6f6e 206e 6f74 2066 6f75 6e64  gation not found
-00013600: 2066 6f72 2074 6865 2066 6f6c 6c6f 7769   for the followi
-00013610: 6e67 2069 6d61 6765 2074 696d 6520 706f  ng image time po
-00013620: 696e 7473 2e20 446f 7562 6c65 2063 6865  ints. Double che
-00013630: 636b 206f 7220 7072 6f76 6964 6520 6174  ck or provide at
-00013640: 206c 6561 7374 2073 7461 7469 6320 6465   least static de
-00013650: 6661 756c 7420 6e61 7669 6761 7469 6f6e  fault navigation
-00013660: 2069 6e20 6865 6164 6572 2066 6965 6c64   in header field
-00013670: 732e 220a 2020 2020 2020 2020 2020 2020  s.".            
-00013680: 7265 7475 726e 4d73 6720 2b3d 2022 5c6e  returnMsg += "\n
-00013690: 2220 2b20 225c 6e22 2e6a 6f69 6e28 756e  " + "\n".join(un
-000136a0: 6d61 7463 6865 6454 696d 6550 6f69 6e74  matchedTimePoint
-000136b0: 7329 0a20 2020 2020 2020 2072 6574 7572  s).        retur
-000136c0: 6e20 5472 7565 2c20 696d 6167 655f 6474  n True, image_dt
-000136d0: 732c 2072 6574 7572 6e4d 7367 0a0a 0a20  s, returnMsg... 
-000136e0: 2020 2064 6566 2063 7265 6174 6549 6d61     def createIma
-000136f0: 6765 4e61 7669 6761 7469 6f6e 4669 6c65  geNavigationFile
-00013700: 2873 656c 662c 206e 6176 5f70 6174 683a  (self, nav_path:
-00013710: 2073 7472 2c20 6e61 765f 6865 6164 6572   str, nav_header
-00013720: 3d6d 6971 7476 2e70 6f73 5f68 6561 6465  =miqtv.pos_heade
-00013730: 725b 2770 616e 6761 6561 275d 2c20 6461  r['pangaea'], da
-00013740: 7465 5f66 6f72 6d61 743d 6d69 7174 762e  te_format=miqtv.
-00013750: 6461 7465 5f66 6f72 6d61 7473 5b27 7061  date_formats['pa
-00013760: 6e67 6165 6127 5d2c 206f 7665 7277 7269  ngaea'], overwri
-00013770: 7465 3d46 616c 7365 2c20 636f 6c5f 7365  te=False, col_se
-00013780: 7061 7261 746f 7220 3d20 225c 7422 2c20  parator = "\t", 
-00013790: 7669 6465 6f53 616d 706c 6553 6563 6f6e  videoSampleSecon
-000137a0: 6473 3d31 2c0a 2020 2020 2020 2020 2020  ds=1,.          
-000137b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000137c0: 2020 2020 2020 2020 2020 6f66 6673 6574            offset
-000137d0: 5f78 3d30 2c20 6f66 6673 6574 5f79 3d30  _x=0, offset_y=0
-000137e0: 2c20 6f66 6673 6574 5f7a 3d30 2c61 6e67  , offset_z=0,ang
-000137f0: 6c65 735f 696e 5f72 6164 203d 2046 616c  les_in_rad = Fal
-00013800: 7365 2c20 7265 636f 7264 7332 6265 496e  se, records2beIn
-00013810: 7665 7274 6564 3d5b 5d29 3a0a 2020 2020  verted=[]):.    
-00013820: 2020 2020 2222 2220 4372 6561 7465 7320      """ Creates 
-00013830: 696e 202f 696e 7465 726d 6564 6961 7465  in /intermediate
-00013840: 2061 2074 6578 7420 6669 6c65 2077 6974   a text file wit
-00013850: 6820 342e 3544 206e 6176 6967 6174 696f  h 4.5D navigatio
-00013860: 6e20 6461 7461 2066 6f72 2065 6163 6820  n data for each 
-00013870: 696d 6167 652c 2069 2e65 2e20 6120 7369  image, i.e. a si
-00013880: 6e67 6c65 2072 6f77 2070 6572 2070 686f  ngle row per pho
-00013890: 746f 2c20 7669 6465 6f20 6475 7261 7469  to, video durati
-000138a0: 6f6e 205b 7365 635d 202f 2076 6964 656f  on [sec] / video
-000138b0: 5361 6d70 6c65 5365 636f 6e64 7320 726f  SampleSeconds ro
-000138c0: 7773 2070 6572 2076 6964 656f 2e0a 2020  ws per video..  
-000138d0: 2020 2020 2020 2020 2020 6e61 765f 6865            nav_he
-000138e0: 6164 6572 206d 7573 7420 6265 2064 6963  ader must be dic
-000138f0: 7420 636f 6e74 6169 6e69 6e67 2074 6865  t containing the
-00013900: 206b 6579 7320 2775 7463 272c 276c 6174   keys 'utc','lat
-00013910: 272c 276c 6f6e 272c 2764 6570 2728 6f72  ','lon','dep'(or
-00013920: 2027 616c 7427 292c 206f 7074 696f 6e61   'alt'), optiona
-00013930: 6c3a 2027 6867 7427 2c27 756e 6365 7274  l: 'hgt','uncert
-00013940: 2720 7769 7468 2074 6865 2072 6573 7065  ' with the respe
-00013950: 6374 6976 6520 636f 6c75 6d6e 2068 6561  ctive column hea
-00013960: 6465 7273 2061 7320 7661 6c75 6573 200a  ders as values .
-00013970: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-00013980: 6e65 206f 6620 7468 6520 7665 6869 636c  ne of the vehicl
-00013990: 6520 782c 792c 7a20 6f66 6673 6574 7320  e x,y,z offsets 
-000139a0: 5b6d 5d20 6973 206e 6f74 2030 2061 6e64  [m] is not 0 and
-000139b0: 206e 6176 5f68 6561 6465 7220 616c 736f   nav_header also
-000139c0: 2063 6f6e 7461 696e 7320 2779 6177 272c   contains 'yaw',
-000139d0: 2770 6974 6368 272c 2772 6f6c 6c27 206c  'pitch','roll' l
-000139e0: 6576 6572 6172 6d20 6f66 6673 6574 7320  everarm offsets 
-000139f0: 6172 6520 636f 6d70 656e 7361 7465 6420  are compensated 
-00013a00: 666f 7220 2222 220a 0a20 2020 2020 2020  for """..       
-00013a10: 2069 6620 7365 6c66 2e69 6e74 6572 6d65   if self.interme
-00013a20: 6469 6174 654e 6176 4669 6c65 4578 6973  diateNavFileExis
-00013a30: 7473 2829 2061 6e64 206e 6f74 206f 7665  ts() and not ove
-00013a40: 7277 7269 7465 3a0a 2020 2020 2020 2020  rwrite:.        
-00013a50: 2020 2020 7265 7475 726e 2054 7275 652c      return True,
-00013a60: 2022 4f75 7470 7574 2066 696c 6520 6578   "Output file ex
-00013a70: 6973 7473 3a20 222b 7365 6c66 2e67 6574  ists: "+self.get
-00013a80: 5f69 6e74 5f6e 6176 5f66 696c 6528 290a  _int_nav_file().
-00013a90: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00013aa0: 6f73 2e70 6174 682e 6578 6973 7473 286e  os.path.exists(n
-00013ab0: 6176 5f70 6174 6829 3a0a 2020 2020 2020  av_path):.      
-00013ac0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00013ad0: 7365 2c20 224e 6176 6967 6174 696f 6e20  se, "Navigation 
-00013ae0: 6669 6c65 206e 6f74 2066 6f75 6e64 3a20  file not found: 
-00013af0: 222b 6e61 765f 7061 7468 0a0a 2020 2020  "+nav_path..    
-00013b00: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
-00013b10: 7468 2e65 7869 7374 7328 7365 6c66 2e69  th.exists(self.i
-00013b20: 6d61 6765 7344 6972 293a 0a20 2020 2020  magesDir):.     
-00013b30: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00013b40: 6c73 652c 2022 496d 6167 6520 666f 6c64  lse, "Image fold
-00013b50: 6572 206e 6f74 2066 6f75 6e64 3a20 222b  er not found: "+
-00013b60: 2073 656c 662e 696d 6167 6573 4469 720a   self.imagesDir.
-00013b70: 0a20 2020 2020 2020 2073 203d 206d 6971  .        s = miq
-00013b80: 7463 2e50 7269 6e74 4c6f 6164 696e 674d  tc.PrintLoadingM
-00013b90: 7367 2822 4372 6561 7469 6e67 2069 7465  sg("Creating ite
-00013ba0: 6d73 2720 6e61 7669 6761 7469 6f6e 2064  ms' navigation d
-00013bb0: 6174 6122 290a 2020 2020 2020 2020 7265  ata").        re
-00013bc0: 7475 726e 4d73 6720 3d20 2222 0a20 2020  turnMsg = "".   
-00013bd0: 2020 2020 2063 6f6d 7065 6e73 6174 4f66       compensatOf
-00013be0: 6673 6574 7320 3d20 4661 6c73 650a 2020  fsets = False.  
-00013bf0: 2020 2020 2020 6966 2028 6f66 6673 6574        if (offset
-00013c00: 5f78 213d 3020 6f72 206f 6666 7365 745f  _x!=0 or offset_
-00013c10: 7921 3d30 206f 7220 6f66 6673 6574 5f7a  y!=0 or offset_z
-00013c20: 213d 3029 2061 6e64 2027 7961 7727 2069  !=0) and 'yaw' i
-00013c30: 6e20 6e61 765f 6865 6164 6572 2061 6e64  n nav_header and
-00013c40: 2027 7069 7463 6827 2069 6e20 6e61 765f   'pitch' in nav_
-00013c50: 6865 6164 6572 2061 6e64 2027 726f 6c6c  header and 'roll
-00013c60: 2720 696e 206e 6176 5f68 6561 6465 723a  ' in nav_header:
-00013c70: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
-00013c80: 7065 6e73 6174 4f66 6673 6574 7320 3d20  pensatOffsets = 
-00013c90: 5472 7565 0a0a 2020 2020 2020 2020 2320  True..        # 
-00013ca0: 6368 6563 6b20 6966 2066 6f72 206d 6973  check if for mis
-00013cb0: 7369 6e67 2066 6965 6c64 7320 7468 6572  sing fields ther
-00013cc0: 6520 6172 6520 636f 6e73 7420 7661 6c75  e are const valu
-00013cd0: 6573 2069 6e20 6865 6164 6572 0a20 2020  es in header.   
-00013ce0: 2020 2020 2063 6f6e 7374 5f76 616c 7565       const_value
-00013cf0: 7320 3d20 7b7d 0a20 2020 2020 2020 2066  s = {}.        f
-00013d00: 6f72 206e 6176 4669 656c 6420 696e 206d  or navField in m
-00013d10: 6971 7476 2e70 6f73 5f68 6561 6465 725b  iqtv.pos_header[
-00013d20: 276d 6172 6971 7427 5d3a 0a20 2020 2020  'mariqt']:.     
-00013d30: 2020 2020 2020 2072 6573 7065 6374 6976         respectiv
-00013d40: 6548 6561 6465 7246 6965 6c64 203d 206d  eHeaderField = m
-00013d50: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-00013d60: 226d 6172 6971 7422 5d5b 6e61 7646 6965  "mariqt"][navFie
-00013d70: 6c64 5d0a 2020 2020 2020 2020 2020 2020  ld].            
-00013d80: 6966 206e 6176 4669 656c 6420 6e6f 7420  if navField not 
-00013d90: 696e 206e 6176 5f68 6561 6465 7220 616e  in nav_header an
-00013da0: 6420 2872 6573 7065 6374 6976 6548 6561  d (respectiveHea
-00013db0: 6465 7246 6965 6c64 2069 6e20 7365 6c66  derField in self
-00013dc0: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
-00013dd0: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
-00013de0: 5d20 616e 6420 7365 6c66 2e66 696e 6454  ] and self.findT
-00013df0: 6d70 4669 656c 6432 2872 6573 7065 6374  mpField2(respect
-00013e00: 6976 6548 6561 6465 7246 6965 6c64 2920  iveHeaderField) 
-00013e10: 213d 2022 2229 3a20 0a20 2020 2020 2020  != ""): .       
-00013e20: 2020 2020 2020 2020 2063 6f6e 7374 5f76           const_v
-00013e30: 616c 7565 735b 6e61 7646 6965 6c64 5d20  alues[navField] 
-00013e40: 3d20 7365 6c66 2e66 696e 6454 6d70 4669  = self.findTmpFi
-00013e50: 656c 6428 7265 7370 6563 7469 7665 4865  eld(respectiveHe
-00013e60: 6164 6572 4669 656c 6429 0a0a 2020 2020  aderField)..    
-00013e70: 2020 2020 2320 4c6f 6164 206e 6176 6967      # Load navig
-00013e80: 6174 696f 6e20 6461 7461 0a20 2020 2020  ation data.     
-00013e90: 2020 206e 6176 5f64 6174 612c 2070 6172     nav_data, par
-00013ea0: 7365 4d73 6720 3d20 6d69 7174 6e2e 7265  seMsg = miqtn.re
-00013eb0: 6164 416c 6c50 6f73 6974 696f 6e73 4672  adAllPositionsFr
-00013ec0: 6f6d 4669 6c65 5061 7468 286e 6176 5f70  omFilePath(nav_p
-00013ed0: 6174 682c 206e 6176 5f68 6561 6465 722c  ath, nav_header,
-00013ee0: 2064 6174 655f 666f 726d 6174 2c63 6f6c   date_format,col
-00013ef0: 5f73 6570 6172 6174 6f72 3d63 6f6c 5f73  _separator=col_s
-00013f00: 6570 6172 6174 6f72 2c63 6f6e 7374 5f76  eparator,const_v
-00013f10: 616c 7565 733d 636f 6e73 745f 7661 6c75  alues=const_valu
-00013f20: 6573 290a 2020 2020 2020 2020 6966 2070  es).        if p
-00013f30: 6172 7365 4d73 6720 213d 2022 223a 0a20  arseMsg != "":. 
-00013f40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00013f50: 7072 6f76 2e6c 6f67 2870 6172 7365 4d73  prov.log(parseMs
-00013f60: 672c 646f 6e74 5368 6f77 3d54 7275 6529  g,dontShow=True)
-00013f70: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00013f80: 7572 6e4d 7367 203d 2022 5c6e 2220 2b20  urnMsg = "\n" + 
-00013f90: 7061 7273 654d 7367 0a0a 2020 2020 2020  parseMsg..      
-00013fa0: 2020 2320 6669 6e64 2066 6f72 2065 6163    # find for eac
-00013fb0: 6820 696d 6167 6520 7468 6520 7265 7370  h image the resp
-00013fc0: 6563 7469 7665 206e 6176 6967 6174 696f  ective navigatio
-00013fd0: 6e20 6461 7461 0a20 2020 2020 2020 2073  n data.        s
-00013fe0: 2e73 746f 7028 290a 2020 2020 2020 2020  .stop().        
-00013ff0: 7375 6363 6573 732c 2069 6d61 6765 5f64  success, image_d
-00014000: 7473 2c20 6d73 6720 3d20 7365 6c66 2e66  ts, msg = self.f
-00014010: 696e 644e 6176 4461 7461 466f 7249 6d61  indNavDataForIma
-00014020: 6765 286e 6176 5f64 6174 612c 7669 6465  ge(nav_data,vide
-00014030: 6f53 616d 706c 6553 6563 6f6e 6473 290a  oSampleSeconds).
-00014040: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
-00014050: 762e 6c6f 6728 6d73 672c 646f 6e74 5368  v.log(msg,dontSh
-00014060: 6f77 3d54 7275 6529 0a20 2020 2020 2020  ow=True).       
-00014070: 2069 6620 6d73 6720 213d 2022 223a 0a20   if msg != "":. 
-00014080: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00014090: 6e4d 7367 202b 3d20 225c 6e22 202b 206d  nMsg += "\n" + m
-000140a0: 7367 0a20 2020 2020 2020 2069 6620 6e6f  sg.        if no
-000140b0: 7420 7375 6363 6573 733a 0a20 2020 2020  t success:.     
-000140c0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-000140d0: 6c73 652c 2072 6574 7572 6e4d 7367 0a20  lse, returnMsg. 
-000140e0: 2020 2020 2020 2073 203d 206d 6971 7463         s = miqtc
-000140f0: 2e50 7269 6e74 4c6f 6164 696e 674d 7367  .PrintLoadingMsg
-00014100: 2822 4372 6561 7469 6e67 2069 7465 6d73  ("Creating items
-00014110: 2720 6e61 7669 6761 7469 6f6e 2064 6174  ' navigation dat
-00014120: 6122 290a 0a20 2020 2020 2020 2023 2063  a")..        # c
-00014130: 6f6d 7065 6e73 6174 6520 6c65 7665 7261  ompensate levera
-00014140: 726d 206f 6666 7365 7473 0a20 2020 2020  rm offsets.     
-00014150: 2020 2069 6620 636f 6d70 656e 7361 744f     if compensatO
-00014160: 6666 7365 7473 3a0a 0a20 2020 2020 2020  ffsets:..       
-00014170: 2020 2020 2023 206c 6f61 6420 6672 616d       # load fram
-00014180: 6520 6174 7469 7475 6465 2064 6174 6120  e attitude data 
-00014190: 6672 6f6d 2066 696c 650a 2020 2020 2020  from file.      
-000141a0: 2020 2020 2020 6174 745f 6461 7461 2c20        att_data, 
-000141b0: 7061 7273 654d 7367 203d 206d 6971 746e  parseMsg = miqtn
-000141c0: 2e72 6561 6441 6c6c 4174 7469 7475 6465  .readAllAttitude
-000141d0: 7346 726f 6d46 696c 6550 6174 6828 6e61  sFromFilePath(na
-000141e0: 765f 7061 7468 2c20 6e61 765f 6865 6164  v_path, nav_head
-000141f0: 6572 2c20 6461 7465 5f66 6f72 6d61 742c  er, date_format,
-00014200: 636f 6c5f 7365 7061 7261 746f 723d 636f  col_separator=co
-00014210: 6c5f 7365 7061 7261 746f 722c 636f 6e73  l_separator,cons
-00014220: 745f 7661 6c75 6573 3d63 6f6e 7374 5f76  t_values=const_v
-00014230: 616c 7565 732c 616e 676c 6573 496e 5261  alues,anglesInRa
-00014240: 643d 616e 676c 6573 5f69 6e5f 7261 6429  d=angles_in_rad)
-00014250: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00014260: 7061 7273 654d 7367 2021 3d20 2222 3a0a  parseMsg != "":.
-00014270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014280: 7365 6c66 2e70 726f 762e 6c6f 6728 7061  self.prov.log(pa
-00014290: 7273 654d 7367 2c64 6f6e 7453 686f 773d  rseMsg,dontShow=
-000142a0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-000142b0: 2020 2020 2020 7265 7475 726e 4d73 6720        returnMsg 
-000142c0: 2b3d 2022 5c6e 2220 2b20 7061 7273 654d  += "\n" + parseM
-000142d0: 7367 0a0a 2020 2020 2020 2020 2020 2020  sg..            
-000142e0: 2320 6669 6e64 2066 6f72 2065 6163 6820  # find for each 
-000142f0: 696d 6167 6520 7468 6520 7265 7370 6563  image the respec
-00014300: 7469 7665 206e 6176 6967 6174 696f 6e20  tive navigation 
-00014310: 6461 7461 0a20 2020 2020 2020 2020 2020  data.           
-00014320: 2073 7563 6365 7373 2c20 696d 6167 655f   success, image_
-00014330: 6474 735f 6174 742c 206d 7367 203d 2073  dts_att, msg = s
-00014340: 656c 662e 6669 6e64 4e61 7644 6174 6146  elf.findNavDataF
-00014350: 6f72 496d 6167 6528 6174 745f 6461 7461  orImage(att_data
-00014360: 2c76 6964 656f 5361 6d70 6c65 5365 636f  ,videoSampleSeco
-00014370: 6e64 7329 0a20 2020 2020 2020 2020 2020  nds).           
-00014380: 2073 656c 662e 7072 6f76 2e6c 6f67 286d   self.prov.log(m
-00014390: 7367 2c64 6f6e 7453 686f 773d 5472 7565  sg,dontShow=True
-000143a0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-000143b0: 206d 7367 2021 3d20 2222 3a0a 2020 2020   msg != "":.    
-000143c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000143d0: 726e 4d73 6720 2b3d 2022 5c6e 2220 2b20  rnMsg += "\n" + 
-000143e0: 6d73 670a 2020 2020 2020 2020 2020 2020  msg.            
-000143f0: 6966 206e 6f74 2073 7563 6365 7373 3a0a  if not success:.
+0000c190: 6669 6c65 7328 290a 2020 2020 2020 2020  files().        
+0000c1a0: 7265 7475 726e 2073 656c 662e 7570 6461  return self.upda
+0000c1b0: 7465 6946 444f 2873 656c 662e 6966 646f  teiFDO(self.ifdo
+0000c1c0: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
+0000c1d0: 6574 4865 6164 6572 4b65 795d 2c20 6974  etHeaderKey], it
+0000c1e0: 656d 5f64 6174 612e 7661 6c75 6573 2829  em_data.values()
+0000c1f0: 290a 0a0a 2020 2020 6465 6620 6372 6561  )...    def crea
+0000c200: 7465 436f 7265 4669 656c 6473 2873 656c  teCoreFields(sel
+0000c210: 6629 3a0a 2020 2020 2020 2020 2222 2220  f):.        """ 
+0000c220: 4445 5052 4543 4144 4554 2c20 7573 6520  DEPRECADET, use 
+0000c230: 6372 6561 7465 5f66 6965 6c64 7328 2920  create_fields() 
+0000c240: 6f72 2075 7064 6174 655f 6669 656c 6473  or update_fields
+0000c250: 2829 2069 6e73 7465 642e 0a20 2020 2020  () insted..     
+0000c260: 2020 2046 696c 6c73 2074 6865 2069 4644     Fills the iFD
+0000c270: 4f20 636f 7265 2066 6965 6c64 7320 6672  O core fields fr
+0000c280: 6f6d 2069 6e74 6572 6d65 6469 6174 6520  om intermediate 
+0000c290: 6669 6c65 732e 2057 6974 686f 7574 2074  files. Without t
+0000c2a0: 6865 6d20 6e6f 2076 616c 6964 2069 4644  hem no valid iFD
+0000c2b0: 4f20 6361 6e20 6265 2063 7265 6174 6564  O can be created
+0000c2c0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0000c2d0: 2020 2020 2020 6974 656d 5f64 6174 6120        item_data 
+0000c2e0: 3d20 7365 6c66 2e5f 6765 745f 6974 656d  = self._get_item
+0000c2f0: 5f64 6174 615f 6672 6f6d 5f69 6e74 6572  _data_from_inter
+0000c300: 6d65 6469 6174 655f 6669 6c65 735f 636f  mediate_files_co
+0000c310: 7265 2829 0a20 2020 2020 2020 2023 2063  re().        # c
+0000c320: 6865 636b 2066 6965 6c64 7320 666f 7220  heck fields for 
+0000c330: 7661 6c69 6469 7479 0a20 2020 2020 2020  validity.       
+0000c340: 2023 2069 7465 6d5f 6461 7461 2063 6f6e   # item_data con
+0000c350: 7461 696e 7320 6669 656c 6420 696d 6167  tains field imag
+0000c360: 652d 6669 6c65 6e61 6d65 2c20 7768 6963  e-filename, whic
+0000c370: 6820 7768 6963 6820 7769 6c6c 206e 6f74  h which will not
+0000c380: 2062 6520 7374 6f72 6564 2061 7320 616e   be stored as an
+0000c390: 2069 7465 6d20 6669 656c 6420 696e 2069   item field in i
+0000c3a0: 464f 4420 6275 7420 6173 2074 6865 2069  FOD but as the i
+0000c3b0: 7465 6d20 6e61 6d65 2069 7473 656c 660a  tem name itself.
+0000c3c0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000c3d0: 656c 662e 7570 6461 7465 6946 444f 2873  elf.updateiFDO(s
+0000c3e0: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+0000c3f0: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
+0000c400: 4b65 795d 2c20 6974 656d 5f64 6174 612e  Key], item_data.
+0000c410: 7661 6c75 6573 2829 290a 0a0a 2020 2020  values())...    
+0000c420: 6465 6620 6372 6561 7465 4361 7074 7572  def createCaptur
+0000c430: 6541 6e64 436f 6e74 656e 7446 6965 6c64  eAndContentField
+0000c440: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+0000c450: 2022 2222 2044 4550 5245 4341 4445 542c   """ DEPRECADET,
+0000c460: 2075 7365 2063 7265 6174 655f 6669 656c   use create_fiel
+0000c470: 6473 2829 206f 7220 7570 6461 7465 5f66  ds() or update_f
+0000c480: 6965 6c64 7328 2920 696e 7374 6564 2e0a  ields() insted..
+0000c490: 2020 2020 2020 2020 4669 6c6c 7320 7468          Fills th
+0000c4a0: 6520 6946 444f 2063 6170 7574 7265 2061  e iFDO caputre a
+0000c4b0: 6e64 2063 6f6e 7465 6e74 2066 6965 6473  nd content fieds
+0000c4c0: 2066 726f 6d20 7072 6f76 6964 6564 2064   from provided d
+0000c4d0: 6174 6120 6669 656c 6473 200a 2020 2020  ata fields .    
+0000c4e0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000c4f0: 6974 656d 5f64 6174 6120 3d20 7365 6c66  item_data = self
+0000c500: 2e5f 6765 745f 6974 656d 5f64 6174 615f  ._get_item_data_
+0000c510: 6672 6f6d 5f69 6e74 6572 6d65 6469 6174  from_intermediat
+0000c520: 655f 6669 6c65 735f 6e6f 6e65 5f63 6f72  e_files_none_cor
+0000c530: 6528 290a 2020 2020 2020 2020 2320 6368  e().        # ch
+0000c540: 6563 6b20 6669 656c 6473 2066 6f72 2076  eck fields for v
+0000c550: 616c 6964 6974 790a 2020 2020 2020 2020  alidity.        
+0000c560: 2320 6974 656d 5f64 6174 6120 636f 6e74  # item_data cont
+0000c570: 6169 6e73 2066 6965 6c64 2069 6d61 6765  ains field image
+0000c580: 2d66 696c 656e 616d 652c 2077 6869 6368  -filename, which
+0000c590: 2077 6869 6368 2077 696c 6c20 6e6f 7420   which will not 
+0000c5a0: 6265 2073 746f 7265 6420 6173 2061 6e20  be stored as an 
+0000c5b0: 6974 656d 2066 6965 6c64 2069 6e20 6946  item field in iF
+0000c5c0: 4f44 2062 7574 2061 7320 7468 6520 6974  OD but as the it
+0000c5d0: 656d 206e 616d 6520 6974 7365 6c66 0a20  em name itself. 
+0000c5e0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000c5f0: 6c66 2e75 7064 6174 6569 4644 4f28 7365  lf.updateiFDO(se
+0000c600: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+0000c610: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
+0000c620: 6579 5d2c 2069 7465 6d5f 6461 7461 2e76  ey], item_data.v
+0000c630: 616c 7565 7328 2929 0a0a 2020 2020 0a20  alues())..    . 
+0000c640: 2020 2064 6566 205f 6765 745f 6974 656d     def _get_item
+0000c650: 5f64 6174 615f 6672 6f6d 5f69 6e74 6572  _data_from_inter
+0000c660: 6d65 6469 6174 655f 6669 6c65 7328 7365  mediate_files(se
+0000c670: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+0000c680: 2052 6561 6420 6461 7461 2066 726f 6d20   Read data from 
+0000c690: 636f 7265 2061 6e64 206e 6f6e 652d 636f  core and none-co
+0000c6a0: 7265 2069 6e74 6572 6d64 6561 7465 2066  re intermdeate f
+0000c6b0: 696c 6573 2c20 6368 6563 6b20 6669 6c65  iles, check file
+0000c6c0: 7320 6578 6973 742c 2061 6464 2027 696d  s exist, add 'im
+0000c6d0: 6167 652d 6861 6e64 6c65 272e 0a20 2020  age-handle'..   
+0000c6e0: 2020 2020 2052 6574 7572 6e73 2064 6963       Returns dic
+0000c6f0: 7420 6f66 2066 6f72 6d20 7b69 6d61 6765  t of form {image
+0000c700: 2d66 696c 652d 6e61 6d65 3a7b 6669 656c  -file-name:{fiel
+0000c710: 643a 7661 6c75 657d 2c2e 2e2e 7d20 0a20  d:value},...} . 
+0000c720: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000c730: 2020 2069 7465 6d5f 6461 7461 5f63 6f72     item_data_cor
+0000c740: 6520 3d20 7365 6c66 2e5f 6765 745f 6974  e = self._get_it
+0000c750: 656d 5f64 6174 615f 6672 6f6d 5f69 6e74  em_data_from_int
+0000c760: 6572 6d65 6469 6174 655f 6669 6c65 735f  ermediate_files_
+0000c770: 636f 7265 2829 0a20 2020 2020 2020 2069  core().        i
+0000c780: 7465 6d5f 6461 7461 5f6e 6f6e 655f 636f  tem_data_none_co
+0000c790: 7265 203d 2073 656c 662e 5f67 6574 5f69  re = self._get_i
+0000c7a0: 7465 6d5f 6461 7461 5f66 726f 6d5f 696e  tem_data_from_in
+0000c7b0: 7465 726d 6564 6961 7465 5f66 696c 6573  termediate_files
+0000c7c0: 5f6e 6f6e 655f 636f 7265 2829 0a20 2020  _none_core().   
+0000c7d0: 2020 2020 2023 7070 7269 6e74 2869 7465       #pprint(ite
+0000c7e0: 6d5f 6461 7461 5f6e 6f6e 655f 636f 7265  m_data_none_core
+0000c7f0: 290a 2020 2020 2020 2020 2370 7072 696e  ).        #pprin
+0000c800: 7428 6974 656d 5f64 6174 615f 636f 7265  t(item_data_core
+0000c810: 290a 2020 2020 2020 2020 6974 656d 5f64  ).        item_d
+0000c820: 6174 6120 3d20 6974 656d 5f64 6174 615f  ata = item_data_
+0000c830: 636f 7265 0a20 2020 2020 2020 206c 6f67  core.        log
+0000c840: 203d 206d 6971 7463 2e72 6563 7572 7369   = miqtc.recursi
+0000c850: 7665 6c79 5570 6461 7465 4469 6374 7328  velyUpdateDicts(
+0000c860: 6974 656d 5f64 6174 612c 2069 7465 6d5f  item_data, item_
+0000c870: 6461 7461 5f6e 6f6e 655f 636f 7265 290a  data_none_core).
+0000c880: 2020 2020 2020 2020 2370 7072 696e 7428          #pprint(
+0000c890: 6974 656d 5f64 6174 6129 0a20 2020 2020  item_data).     
+0000c8a0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+0000c8b0: 286c 6f67 2c64 6f6e 7453 686f 773d 5472  (log,dontShow=Tr
+0000c8c0: 7565 290a 2020 2020 2020 2020 7265 7475  ue).        retu
+0000c8d0: 726e 2069 7465 6d5f 6461 7461 0a0a 2020  rn item_data..  
+0000c8e0: 2020 6465 6620 5f67 6574 5f69 7465 6d5f    def _get_item_
+0000c8f0: 6461 7461 5f66 726f 6d5f 696e 7465 726d  data_from_interm
+0000c900: 6564 6961 7465 5f66 696c 6573 5f6e 6f6e  ediate_files_non
+0000c910: 655f 636f 7265 2873 656c 6629 3a0a 2020  e_core(self):.  
+0000c920: 2020 2020 2020 2222 2220 5265 6164 2064        """ Read d
+0000c930: 6174 6120 6672 6f6d 206e 6f6e 2d63 6f72  ata from non-cor
+0000c940: 6520 696e 7465 726d 6465 6174 6520 6669  e intermdeate fi
+0000c950: 6c65 732e 0a20 2020 2020 2020 2052 6574  les..        Ret
+0000c960: 7572 6e73 2064 6963 7420 6f66 2066 6f72  urns dict of for
+0000c970: 6d20 7b69 6d61 6765 2d66 696c 652d 6e61  m {image-file-na
+0000c980: 6d65 3a7b 6669 656c 643a 7661 6c75 657d  me:{field:value}
+0000c990: 2c2e 2e2e 7d20 0a20 2020 2020 2020 2022  ,...} .        "
+0000c9a0: 2222 0a20 2020 2020 2020 2072 6571 203d  "".        req =
+0000c9b0: 2073 656c 662e 6e6f 6e43 6f72 6546 6965   self.nonCoreFie
+0000c9c0: 6c64 496e 7465 726d 6564 6961 7465 4974  ldIntermediateIt
+0000c9d0: 656d 496e 666f 4669 6c65 730a 0a20 2020  emInfoFiles..   
+0000c9e0: 2020 2020 2069 7465 6d5f 6461 7461 203d       item_data =
+0000c9f0: 207b 7d0a 2020 2020 2020 2020 666f 7220   {}.        for 
+0000ca00: 7220 696e 2072 6571 3a0a 2020 2020 2020  r in req:.      
+0000ca10: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
+0000ca20: 2e65 7869 7374 7328 722e 6669 6c65 4e61  .exists(r.fileNa
+0000ca30: 6d65 293a 0a20 2020 2020 2020 2020 2020  me):.           
+0000ca40: 2020 2020 2073 656c 662e 7072 6173 6549       self.praseI
+0000ca50: 7465 6d44 6174 6146 726f 6d46 696c 6528  temDataFromFile(
+0000ca60: 6974 656d 5f64 6174 612c 722e 6669 6c65  item_data,r.file
+0000ca70: 4e61 6d65 2c72 2e73 6570 6172 6174 6f72  Name,r.separator
+0000ca80: 2c72 2e68 6561 6465 722c 2072 2e64 6174  ,r.header, r.dat
+0000ca90: 6574 696d 655f 666f 726d 6174 290a 2020  etime_format).  
+0000caa0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000cab0: 6c66 2e70 726f 762e 6c6f 6728 2250 6172  lf.prov.log("Par
+0000cac0: 7365 6420 6974 656d 2064 6174 6120 6672  sed item data fr
+0000cad0: 6f6d 3a20 2220 2b20 722e 6669 6c65 4e61  om: " + r.fileNa
+0000cae0: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+0000caf0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000cb00: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
+0000cb10: 6c6f 6728 2246 696c 6520 646f 6573 206e  log("File does n
+0000cb20: 6f74 2065 7869 7374 733a 2022 202b 2072  ot exists: " + r
+0000cb30: 2e66 696c 654e 616d 6529 0a0a 2020 2020  .fileName)..    
+0000cb40: 2020 2020 7265 7475 726e 2069 7465 6d5f      return item_
+0000cb50: 6461 7461 0a0a 0a20 2020 2064 6566 205f  data...    def _
+0000cb60: 6765 745f 6974 656d 5f64 6174 615f 6672  get_item_data_fr
+0000cb70: 6f6d 5f69 6e74 6572 6d65 6469 6174 655f  om_intermediate_
+0000cb80: 6669 6c65 735f 636f 7265 2873 656c 6629  files_core(self)
+0000cb90: 3a0a 2020 2020 2020 2020 2222 2220 5265  :.        """ Re
+0000cba0: 6164 2064 6174 6120 6672 6f6d 2063 6f72  ad data from cor
+0000cbb0: 6520 696e 7465 726d 6465 6174 6520 6669  e intermdeate fi
+0000cbc0: 6c65 732c 2063 6865 636b 2066 696c 6573  les, check files
+0000cbd0: 2065 7869 7374 2c20 6164 6420 2769 6d61   exist, add 'ima
+0000cbe0: 6765 2d68 616e 646c 6527 2e0a 2020 2020  ge-handle'..    
+0000cbf0: 2020 2020 5265 7475 726e 7320 6469 6374      Returns dict
+0000cc00: 206f 6620 666f 726d 207b 696d 6167 652d   of form {image-
+0000cc10: 6669 6c65 2d6e 616d 653a 7b66 6965 6c64  file-name:{field
+0000cc20: 3a76 616c 7565 7d2c 2e2e 2e7d 200a 2020  :value},...} .  
+0000cc30: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+0000cc40: 2020 2023 2057 6869 6368 2066 696c 6573     # Which files
+0000cc50: 2063 6f6e 7461 696e 2074 6865 2069 6e66   contain the inf
+0000cc60: 6f72 6d61 7469 6f6e 206e 6565 6465 6420  ormation needed 
+0000cc70: 746f 2063 7265 6174 6520 7468 6520 6946  to create the iF
+0000cc80: 444f 2069 7465 6d73 2063 6f72 6520 696e  DO items core in
+0000cc90: 666f 726d 6174 696f 6e20 616e 6420 7768  formation and wh
+0000cca0: 6963 6820 636f 6c75 6d6e 7320 7368 616c  ich columns shal
+0000ccb0: 6c20 6265 2075 7365 640a 2020 2020 2020  l be used.      
+0000ccc0: 2020 7265 7120 3d20 7365 6c66 2e69 6e74    req = self.int
+0000ccd0: 6572 6d65 6469 6174 6546 696c 6573 4465  ermediateFilesDe
+0000cce0: 665f 636f 7265 0a0a 2020 2020 2020 2020  f_core..        
+0000ccf0: 6974 656d 5f64 6174 6120 3d20 7b7d 0a20  item_data = {}. 
+0000cd00: 2020 2020 2020 2070 726f 6720 3d20 6d69         prog = mi
+0000cd10: 7174 632e 5072 696e 744b 6e6f 776e 5072  qtc.PrintKnownPr
+0000cd20: 6f67 7265 7373 4d73 6728 2250 6172 7369  ogressMsg("Parsi
+0000cd30: 6e67 2069 6e74 6572 6d65 6469 6174 6520  ng intermediate 
+0000cd40: 6461 7461 222c 206c 656e 2872 6571 2929  data", len(req))
+0000cd50: 0a20 2020 2020 2020 2066 6f72 2072 2069  .        for r i
+0000cd60: 6e20 7265 713a 0a20 2020 2020 2020 2020  n req:.         
+0000cd70: 2020 2070 726f 672e 7072 6f67 7265 7373     prog.progress
+0000cd80: 2829 0a20 2020 2020 2020 2020 2020 2066  ().            f
+0000cd90: 696c 6520 3d20 7365 6c66 2e5f 5f67 6574  ile = self.__get
+0000cda0: 5f69 6e74 5f66 696c 655f 7072 6566 6978  _int_file_prefix
+0000cdb0: 2829 202b 2072 6571 5b72 5d5b 2773 7566  () + req[r]['suf
+0000cdc0: 6669 7827 5d0a 2020 2020 2020 2020 2020  fix'].          
+0000cdd0: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
+0000cde0: 2e65 7869 7374 7328 6669 6c65 293a 0a20  .exists(file):. 
+0000cdf0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000ce00: 656c 662e 7072 6f76 2e6c 6f67 2822 5741  elf.prov.log("WA
+0000ce10: 524e 494e 4721 2046 6f72 2061 6368 6965  RNING! For achie
+0000ce20: 7669 6e67 2046 4149 526e 6573 7320 616e  ving FAIRness an
+0000ce30: 2069 6e74 6572 6d65 6469 6174 6520 696d   intermediate im
+0000ce40: 6167 6520 696e 666f 2066 696c 6520 6973  age info file is
+0000ce50: 206d 6973 7369 6e67 3a20 222b 2073 656c   missing: "+ sel
+0000ce60: 662e 5f5f 6765 745f 696e 745f 6669 6c65  f.__get_int_file
+0000ce70: 5f70 7265 6669 7828 2920 2b20 7265 715b  _prefix() + req[
+0000ce80: 725d 5b27 7375 6666 6978 275d 2b20 2220  r]['suffix']+ " 
+0000ce90: 7275 6e20 6669 7273 743a 2022 202b 2072  run first: " + r
+0000cea0: 6571 5b72 5d5b 2763 7265 6174 696f 6e46  eq[r]['creationF
+0000ceb0: 6374 275d 290a 2020 2020 2020 2020 2020  ct']).          
+0000cec0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000ced0: 2020 2020 2020 2020 7365 6c66 2e70 6172          self.par
+0000cee0: 7365 4974 656d 4461 7461 6672 6f6d 5461  seItemDatafromTa
+0000cef0: 6246 696c 6544 6174 6128 6974 656d 5f64  bFileData(item_d
+0000cf00: 6174 612c 2066 696c 652c 2072 6571 5b72  ata, file, req[r
+0000cf10: 5d5b 2763 6f6c 7327 5d2c 2072 6571 5b72  ]['cols'], req[r
+0000cf20: 5d5b 276f 7074 696f 6e61 6c27 5d29 0a20  ]['optional']). 
+0000cf30: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000cf40: 656c 662e 7072 6f76 2e6c 6f67 2822 5061  elf.prov.log("Pa
+0000cf50: 7273 6564 2069 7465 6d20 6461 7461 2066  rsed item data f
+0000cf60: 726f 6d3a 2022 202b 2066 696c 6529 0a0a  rom: " + file)..
+0000cf70: 2020 2020 2020 2020 7072 6f67 2e63 6c65          prog.cle
+0000cf80: 6172 2829 0a20 2020 2020 2020 2069 6620  ar().        if 
+0000cf90: 6c65 6e28 6974 656d 5f64 6174 6129 203d  len(item_data) =
+0000cfa0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+0000cfb0: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
+0000cfc0: 2822 4e6f 2069 4644 4f20 6974 656d 7322  ("No iFDO items"
+0000cfd0: 290a 0a20 2020 2020 2020 2023 2063 6865  )..        # che
+0000cfe0: 636b 2066 696c 6573 2065 7869 7374 0a20  ck files exist. 
+0000cff0: 2020 2020 2020 2072 656d 6f76 6520 3d20         remove = 
+0000d000: 5b5d 0a20 2020 2020 2020 2066 6f72 2069  [].        for i
+0000d010: 6d67 2069 6e20 6974 656d 5f64 6174 613a  mg in item_data:
+0000d020: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000d030: 6e6f 7420 696d 6720 696e 2073 656c 662e  not img in self.
+0000d040: 5f69 6d61 6765 4e61 6d65 7349 6d61 6765  _imageNamesImage
+0000d050: 7344 6972 3a0a 2020 2020 2020 2020 2020  sDir:.          
+0000d060: 2020 2020 2020 7265 6d6f 7665 2e61 7070        remove.app
+0000d070: 656e 6428 696d 6729 0a20 2020 2020 2020  end(img).       
+0000d080: 2066 6f72 2069 6d67 2069 6e20 7265 6d6f   for img in remo
+0000d090: 7665 3a0a 2020 2020 2020 2020 2020 2020  ve:.            
+0000d0a0: 6465 6c20 6974 656d 5f64 6174 615b 696d  del item_data[im
+0000d0b0: 675d 0a0a 2020 2020 2020 2020 2320 6164  g]..        # ad
+0000d0c0: 6420 696d 6167 652d 7572 6c0a 2020 2020  d image-url.    
+0000d0d0: 2020 2020 666f 7220 696d 6720 696e 2069      for img in i
+0000d0e0: 7465 6d5f 6461 7461 3a0a 2020 2020 2020  tem_data:.      
+0000d0f0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0000d100: 6e63 6528 6974 656d 5f64 6174 615b 696d  nce(item_data[im
+0000d110: 675d 2c6c 6973 7429 3a20 2320 6974 656d  g],list): # item
+0000d120: 2069 7320 616c 7265 6164 7920 6120 6c69   is already a li
+0000d130: 7374 2028 7669 6465 6f29 2062 7574 2070  st (video) but p
+0000d140: 6172 7365 6420 6461 7461 2069 7320 6e6f  arsed data is no
+0000d150: 742c 2069 2e65 2e20 7061 7273 6564 2064  t, i.e. parsed d
+0000d160: 6174 6120 7265 6665 7273 2074 6f20 7768  ata refers to wh
+0000d170: 6f6c 6520 7669 6465 6f20 2874 696d 6520  ole video (time 
+0000d180: 696e 6465 7065 6e64 656e 7429 2c20 692e  independent), i.
+0000d190: 652e 2077 7269 7465 2074 6f20 6669 7273  e. write to firs
+0000d1a0: 7420 656e 7472 790a 2020 2020 2020 2020  t entry.        
+0000d1b0: 2020 2020 2020 2020 7575 6964 203d 2066          uuid = f
+0000d1c0: 696e 6446 6965 6c64 2869 7465 6d5f 6461  indField(item_da
+0000d1d0: 7461 5b69 6d67 5d5b 305d 2c27 696d 6167  ta[img][0],'imag
+0000d1e0: 652d 7575 6964 2729 0a20 2020 2020 2020  e-uuid').       
+0000d1f0: 2020 2020 2020 2020 2069 6620 7575 6964           if uuid
+0000d200: 203d 3d20 2222 3a0a 2020 2020 2020 2020   == "":.        
+0000d210: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0000d220: 7428 6974 656d 5f64 6174 615b 696d 675d  t(item_data[img]
+0000d230: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000d240: 2020 2020 2020 7261 6973 6520 6d69 7174        raise miqt
+0000d250: 632e 4966 646f 4578 6365 7074 696f 6e28  c.IfdoException(
+0000d260: 2275 7569 6420 6e6f 7420 666f 756e 6420  "uuid not found 
+0000d270: 2861 2922 290a 2020 2020 2020 2020 2020  (a)").          
+0000d280: 2020 2020 2020 6974 656d 5f64 6174 615b        item_data[
+0000d290: 696d 675d 5b30 5d5b 2769 6d61 6765 2d68  img][0]['image-h
+0000d2a0: 616e 646c 6527 5d20 3d20 7365 6c66 2e69  andle'] = self.i
+0000d2b0: 6d61 6765 5f68 616e 646c 655f 7072 6566  mage_handle_pref
+0000d2c0: 6978 202b 2027 4027 202b 2075 7569 640a  ix + '@' + uuid.
+0000d2d0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0000d2e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000d2f0: 2020 7575 6964 203d 2066 696e 6446 6965    uuid = findFie
+0000d300: 6c64 2869 7465 6d5f 6461 7461 5b69 6d67  ld(item_data[img
+0000d310: 5d2c 2769 6d61 6765 2d75 7569 6427 290a  ],'image-uuid').
+0000d320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d330: 6966 2075 7569 6420 3d3d 2022 223a 0a20  if uuid == "":. 
+0000d340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d350: 2020 2072 6169 7365 206d 6971 7463 2e49     raise miqtc.I
+0000d360: 6664 6f45 7863 6570 7469 6f6e 2822 7575  fdoException("uu
+0000d370: 6964 206e 6f74 2066 6f75 6e64 2028 6229  id not found (b)
+0000d380: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0000d390: 2020 2069 7465 6d5f 6461 7461 5b69 6d67     item_data[img
+0000d3a0: 5d5b 2769 6d61 6765 2d68 616e 646c 6527  ]['image-handle'
+0000d3b0: 5d20 3d20 7365 6c66 2e69 6d61 6765 5f68  ] = self.image_h
+0000d3c0: 616e 646c 655f 7072 6566 6978 202b 2027  andle_prefix + '
+0000d3d0: 4027 202b 2075 7569 640a 0a20 2020 2020  @' + uuid..     
+0000d3e0: 2020 2072 6574 7572 6e20 6974 656d 5f64     return item_d
+0000d3f0: 6174 610a 0a0a 2020 2020 6465 6620 6164  ata...    def ad
+0000d400: 645f 6974 656d 5f69 6e66 6f5f 7461 625f  d_item_info_tab_
+0000d410: 6669 6c65 2873 656c 662c 2066 696c 654e  file(self, fileN
+0000d420: 616d 653a 2073 7472 2c20 7365 7061 7261  ame: str, separa
+0000d430: 746f 723a 7374 722c 2068 6561 6465 723a  tor:str, header:
+0000d440: 6469 6374 2c20 6461 7465 7469 6d65 5f66  dict, datetime_f
+0000d450: 6f72 6d61 7420 3d20 6d69 7174 762e 6461  ormat = miqtv.da
+0000d460: 7465 5f66 6f72 6d61 7473 5b27 6d61 7269  te_formats['mari
+0000d470: 7174 275d 293a 0a20 2020 2020 2020 2022  qt']):.        "
+0000d480: 2222 2041 6464 2061 2063 6f6c 756d 6e20  "" Add a column 
+0000d490: 7365 7065 7261 7465 6420 7465 7874 2066  seperated text f
+0000d4a0: 696c 6520 746f 2070 6172 7365 2069 7465  ile to parse ite
+0000d4b0: 6d20 6461 7461 2066 726f 6d20 6279 2063  m data from by c
+0000d4c0: 7265 6174 6543 6170 7475 7265 416e 6443  reateCaptureAndC
+0000d4d0: 6f6e 7465 6e74 4669 656c 6473 2829 2e20  ontentFields(). 
+0000d4e0: 0a20 2020 2020 2020 2043 6f6c 756d 6e73  .        Columns
+0000d4f0: 2068 6561 6465 7273 2077 696c 6c20 6265   headers will be
+0000d500: 2073 6574 2061 7320 6974 656d 2066 6965   set as item fie
+0000d510: 6c64 206e 616d 6573 2e20 4d75 7374 2063  ld names. Must c
+0000d520: 6f6e 7461 696e 2063 6f6c 756d 6e20 2769  ontain column 'i
+0000d530: 6d61 6765 2d66 696c 656e 616d 6527 2e0a  mage-filename'..
+0000d540: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000d550: 2020 2020 6966 2066 696c 654e 616d 6520      if fileName 
+0000d560: 3d3d 204e 6f6e 6520 6f72 206e 6f74 206f  == None or not o
+0000d570: 732e 7061 7468 2e65 7869 7374 7328 6669  s.path.exists(fi
+0000d580: 6c65 4e61 6d65 293a 0a20 2020 2020 2020  leName):.       
+0000d590: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
+0000d5a0: 7469 6f6e 2822 4669 6c65 222c 6669 6c65  tion("File",file
+0000d5b0: 4e61 6d65 2c22 6e6f 7420 666f 756e 6422  Name,"not found"
+0000d5c0: 290a 0a20 2020 2020 2020 2066 6f72 2066  )..        for f
+0000d5d0: 6965 6c64 2069 6e20 6865 6164 6572 3a0a  ield in header:.
+0000d5e0: 2020 2020 2020 2020 2020 2020 6966 2068              if h
+0000d5f0: 6561 6465 725b 6669 656c 645d 206e 6f74  eader[field] not
+0000d600: 2069 6e20 6d69 7174 662e 7461 6246 696c   in miqtf.tabFil
+0000d610: 6543 6f6c 756d 6e4e 616d 6573 2866 696c  eColumnNames(fil
+0000d620: 654e 616d 652c 636f 6c5f 7365 7061 7261  eName,col_separa
+0000d630: 746f 723d 7365 7061 7261 746f 7229 3a0a  tor=separator):.
+0000d640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d650: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
+0000d660: 2243 6f6c 756d 6e22 2c20 6865 6164 6572  "Column", header
+0000d670: 5b66 6965 6c64 5d2c 2022 6e6f 7420 696e  [field], "not in
+0000d680: 2066 696c 6522 2c20 6669 6c65 4e61 6d65   file", fileName
+0000d690: 290a 0a20 2020 2020 2020 2069 6620 6d69  )..        if mi
+0000d6a0: 7174 632e 6173 7365 7274 536c 6173 6828  qtc.assertSlash(
+0000d6b0: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
+0000d6c0: 6669 6c65 4e61 6d65 2929 2021 3d20 6d69  fileName)) != mi
+0000d6d0: 7174 632e 6173 7365 7274 536c 6173 6828  qtc.assertSlash(
+0000d6e0: 7365 6c66 2e64 6972 2e74 6f28 7365 6c66  self.dir.to(self
+0000d6f0: 2e64 6972 2e64 742e 696e 7465 726d 6564  .dir.dt.intermed
+0000d700: 6961 7465 2929 3a0a 2020 2020 2020 2020  iate)):.        
+0000d710: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+0000d720: 6728 2022 4361 7574 696f 6e3a 2049 7420  g( "Caution: It 
+0000d730: 6973 2072 6563 6f6d 6d65 6e64 6564 2074  is recommended t
+0000d740: 6f20 7075 7420 6669 6c65 2069 6e20 7468  o put file in th
+0000d750: 6520 6469 7265 6374 6f72 7927 7320 2769  e directory's 'i
+0000d760: 6e74 6572 6d65 6469 6174 6527 2066 6f6c  ntermediate' fol
+0000d770: 6465 723a 2022 202b 2066 696c 654e 616d  der: " + fileNam
+0000d780: 6529 0a20 2020 2020 2020 206e 6366 6969  e).        ncfii
+0000d790: 6620 3d20 6e6f 6e43 6f72 6546 6965 6c64  f = nonCoreField
+0000d7a0: 496e 7465 726d 6564 6961 7465 4974 656d  IntermediateItem
+0000d7b0: 496e 666f 4669 6c65 2866 696c 654e 616d  InfoFile(fileNam
+0000d7c0: 652c 2073 6570 6172 6174 6f72 2c20 6865  e, separator, he
+0000d7d0: 6164 6572 2c20 6461 7465 7469 6d65 5f66  ader, datetime_f
+0000d7e0: 6f72 6d61 7429 0a20 2020 2020 2020 2069  ormat).        i
+0000d7f0: 6620 6e63 6669 6966 206e 6f74 2069 6e20  f ncfiif not in 
+0000d800: 7365 6c66 2e6e 6f6e 436f 7265 4669 656c  self.nonCoreFiel
+0000d810: 6449 6e74 6572 6d65 6469 6174 6549 7465  dIntermediateIte
+0000d820: 6d49 6e66 6f46 696c 6573 3a20 0a20 2020  mInfoFiles: .   
+0000d830: 2020 2020 2020 2020 2073 656c 662e 6e6f           self.no
+0000d840: 6e43 6f72 6546 6965 6c64 496e 7465 726d  nCoreFieldInterm
+0000d850: 6564 6961 7465 4974 656d 496e 666f 4669  ediateItemInfoFi
+0000d860: 6c65 732e 6170 7065 6e64 286e 6366 6969  les.append(ncfii
+0000d870: 6629 0a0a 2020 2020 6465 6620 6164 6449  f)..    def addI
+0000d880: 7465 6d49 6e66 6f54 6162 4669 6c65 2873  temInfoTabFile(s
+0000d890: 656c 662c 2066 696c 654e 616d 653a 2073  elf, fileName: s
+0000d8a0: 7472 2c20 7365 7061 7261 746f 723a 7374  tr, separator:st
+0000d8b0: 722c 2068 6561 6465 723a 6469 6374 2c20  r, header:dict, 
+0000d8c0: 6461 7465 7469 6d65 5f66 6f72 6d61 7420  datetime_format 
+0000d8d0: 3d20 6d69 7174 762e 6461 7465 5f66 6f72  = miqtv.date_for
+0000d8e0: 6d61 7473 5b27 6d61 7269 7174 275d 293a  mats['mariqt']):
+0000d8f0: 0a20 2020 2020 2020 2022 2222 2044 6570  .        """ Dep
+0000d900: 7265 6361 7465 6420 2d20 7573 6520 6164  recated - use ad
+0000d910: 645f 6974 656d 5f69 6e66 6f5f 7461 625f  d_item_info_tab_
+0000d920: 6669 6c65 2022 2222 0a20 2020 2020 2020  file """.       
+0000d930: 2073 656c 662e 6164 645f 6974 656d 5f69   self.add_item_i
+0000d940: 6e66 6f5f 7461 625f 6669 6c65 2866 696c  nfo_tab_file(fil
+0000d950: 654e 616d 652c 7365 7061 7261 746f 722c  eName,separator,
+0000d960: 6865 6164 6572 2c64 6174 6574 696d 655f  header,datetime_
+0000d970: 666f 726d 6174 290a 0a20 2020 2020 2020  format)..       
+0000d980: 200a 2020 2020 6465 6620 7265 6d6f 7665   .    def remove
+0000d990: 4974 656d 496e 666f 5461 6246 696c 6528  ItemInfoTabFile(
+0000d9a0: 7365 6c66 2c20 6669 6c65 4e61 6d65 3a20  self, fileName: 
+0000d9b0: 7374 722c 2073 6570 6172 6174 6f72 3a73  str, separator:s
+0000d9c0: 7472 2c20 6865 6164 6572 3a64 6963 742c  tr, header:dict,
+0000d9d0: 2064 6174 6574 696d 655f 666f 726d 6174   datetime_format
+0000d9e0: 3a73 7472 293a 0a20 2020 2020 2020 2022  :str):.        "
+0000d9f0: 2222 2072 656d 6f76 6573 2066 696c 6520  "" removes file 
+0000da00: 6974 656d 2066 726f 6d20 6c69 7374 206f  item from list o
+0000da10: 6620 6669 6c65 7320 746f 2070 6172 7365  f files to parse
+0000da20: 2069 7465 6d20 6461 7461 2066 726f 6d20   item data from 
+0000da30: 6279 2063 7265 6174 6543 6170 7475 7265  by createCapture
+0000da40: 416e 6443 6f6e 7465 6e74 4669 656c 6473  AndContentFields
+0000da50: 2829 2022 2222 0a20 2020 2020 2020 206e  () """.        n
+0000da60: 6366 6969 6620 3d20 6e6f 6e43 6f72 6546  cfiif = nonCoreF
+0000da70: 6965 6c64 496e 7465 726d 6564 6961 7465  ieldIntermediate
+0000da80: 4974 656d 496e 666f 4669 6c65 2866 696c  ItemInfoFile(fil
+0000da90: 654e 616d 652c 2073 6570 6172 6174 6f72  eName, separator
+0000daa0: 2c20 6865 6164 6572 2c20 6461 7465 7469  , header, dateti
+0000dab0: 6d65 5f66 6f72 6d61 7429 0a20 2020 2020  me_format).     
+0000dac0: 2020 2069 6620 6e63 6669 6966 2069 6e20     if ncfiif in 
+0000dad0: 7365 6c66 2e6e 6f6e 436f 7265 4669 656c  self.nonCoreFiel
+0000dae0: 6449 6e74 6572 6d65 6469 6174 6549 7465  dIntermediateIte
+0000daf0: 6d49 6e66 6f46 696c 6573 3a20 0a20 2020  mInfoFiles: .   
+0000db00: 2020 2020 2020 2020 2073 656c 662e 6e6f           self.no
+0000db10: 6e43 6f72 6546 6965 6c64 496e 7465 726d  nCoreFieldInterm
+0000db20: 6564 6961 7465 4974 656d 496e 666f 4669  ediateItemInfoFi
+0000db30: 6c65 732e 7265 6d6f 7665 286e 6366 6969  les.remove(ncfii
+0000db40: 6629 0a0a 0a20 2020 2064 6566 2075 7064  f)...    def upd
+0000db50: 6174 6569 4644 4f28 7365 6c66 2c20 6865  ateiFDO(self, he
+0000db60: 6164 6572 3a20 6469 6374 2c20 6974 656d  ader: dict, item
+0000db70: 733a 206c 6973 7429 3a0a 2020 2020 2020  s: list):.      
+0000db80: 2020 2222 2220 5570 6461 7465 7320 7468    """ Updates th
+0000db90: 6520 6375 7272 656e 7420 7661 6c75 6573  e current values
+0000dba0: 2069 4644 4f20 7769 7468 2074 6865 2070   iFDO with the p
+0000dbb0: 726f 7669 6465 6420 6e65 7720 7661 6c75  rovided new valu
+0000dbc0: 6573 2022 2222 0a20 2020 2020 2020 2072  es """.        r
+0000dbd0: 6574 7572 6e20 7365 6c66 2e63 7265 6174  eturn self.creat
+0000dbe0: 6569 4644 4f28 6865 6164 6572 2c20 6974  eiFDO(header, it
+0000dbf0: 656d 732c 2075 7064 6174 6545 7869 7374  ems, updateExist
+0000dc00: 696e 673d 5472 7565 290a 0a0a 2020 2020  ing=True)...    
+0000dc10: 6465 6620 6372 6561 7465 6946 444f 2873  def createiFDO(s
+0000dc20: 656c 662c 2068 6561 6465 723a 2064 6963  elf, header: dic
+0000dc30: 742c 2069 7465 6d73 3a20 6c69 7374 2c20  t, items: list, 
+0000dc40: 7570 6461 7465 4578 6973 7469 6e67 3d46  updateExisting=F
+0000dc50: 616c 7365 2c68 6561 6465 724f 6e6c 793d  alse,headerOnly=
+0000dc60: 4661 6c73 652c 616c 6c6f 775f 6d69 7373  False,allow_miss
+0000dc70: 696e 675f 7265 7175 6972 6564 3d46 616c  ing_required=Fal
+0000dc80: 7365 293a 0a20 2020 2020 2020 2022 2222  se):.        """
+0000dc90: 2043 7265 6174 6573 2046 4149 5220 6469   Creates FAIR di
+0000dca0: 6769 7461 6c20 6f62 6a65 6374 2066 6f72  gital object for
+0000dcb0: 2074 6865 2069 6d61 6765 2064 6174 6120   the image data 
+0000dcc0: 6974 7365 6c66 2e20 5468 6973 2063 6f6e  itself. This con
+0000dcd0: 7369 7374 7320 6f66 2068 6561 6465 7220  sists of header 
+0000dce0: 696e 666f 726d 6174 696f 6e20 616e 6420  information and 
+0000dcf0: 6974 656d 2069 6e66 6f72 6d61 7469 6f6e  item information
+0000dd00: 2e0a 2020 2020 2020 2020 7570 6461 7465  ..        update
+0000dd10: 4578 6973 7469 6e67 3a20 6966 2046 616c  Existing: if Fal
+0000dd20: 7365 206f 6c64 2076 616c 7565 7320 6172  se old values ar
+0000dd30: 6520 7265 6d6f 7665 642c 206f 7468 6572  e removed, other
+0000dd40: 7769 7365 2074 6865 7920 6172 6520 7570  wise they are up
+0000dd50: 6461 7465 642e 0a20 2020 2020 2020 2068  dated..        h
+0000dd60: 6561 6465 724f 6e6c 793a 2069 6620 5472  eaderOnly: if Tr
+0000dd70: 7565 2069 7465 6d73 206d 6179 2062 6520  ue items may be 
+0000dd80: 656d 7074 7920 6c69 7374 2e0a 2020 2020  empty list..    
+0000dd90: 2020 2020 616c 6c6f 775f 6d69 7373 696e      allow_missin
+0000dda0: 675f 7265 7175 6972 6564 3a20 6966 2054  g_required: if T
+0000ddb0: 7275 652c 206e 6f20 6578 6365 7074 696f  rue, no exceptio
+0000ddc0: 6e20 7269 7365 6e20 6966 2061 2072 6571  n risen if a req
+0000ddd0: 7569 7265 6420 6669 656c 6420 6973 206d  uired field is m
+0000dde0: 6973 7369 6e67 2e20 2022 2222 0a0a 2020  issing.  """..  
+0000ddf0: 2020 2020 2020 6966 206e 6f74 2075 7064        if not upd
+0000de00: 6174 6545 7869 7374 696e 6720 616e 6420  ateExisting and 
+0000de10: 6c65 6e28 6974 656d 7329 203d 3d20 3020  len(items) == 0 
+0000de20: 616e 6420 6e6f 7420 6865 6164 6572 4f6e  and not headerOn
+0000de30: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
+0000de40: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
+0000de50: 274e 6f20 6974 656d 2069 6e66 6f72 6d61  'No item informa
+0000de60: 7469 6f6e 2067 6976 656e 2729 0a0a 2020  tion given')..  
+0000de70: 2020 2020 2020 6966 2075 7064 6174 6545        if updateE
+0000de80: 7869 7374 696e 673a 0a20 2020 2020 2020  xisting:.       
+0000de90: 2020 2020 2023 2068 6561 6465 720a 2020       # header.  
+0000dea0: 2020 2020 2020 2020 2020 7365 6c66 2e75            self.u
+0000deb0: 7064 6174 655f 6966 646f 5f68 6561 6465  pdate_ifdo_heade
+0000dec0: 725f 6669 656c 6473 2868 6561 6465 7229  r_fields(header)
+0000ded0: 0a20 2020 2020 2020 2020 2020 2023 2069  .            # i
+0000dee0: 7465 6d73 0a20 2020 2020 2020 2020 2020  tems.           
+0000def0: 2023 2075 7064 6174 6520 636f 7079 206f   # update copy o
+0000df00: 6620 6375 7272 656e 7420 6974 656d 7320  f current items 
+0000df10: 7769 7468 206e 6577 2069 7465 6d73 2066  with new items f
+0000df20: 6965 6c64 730a 2020 2020 2020 2020 2020  ields.          
+0000df30: 2020 6974 656d 7344 6963 7420 3d20 6d69    itemsDict = mi
+0000df40: 7174 692e 6372 6561 7465 496d 6167 6549  qti.createImageI
+0000df50: 7465 6d73 4469 6374 4672 6f6d 496d 6167  temsDictFromImag
+0000df60: 6549 7465 6d73 4c69 7374 2869 7465 6d73  eItemsList(items
+0000df70: 290a 2020 2020 2020 2020 2020 2020 7570  ).            up
+0000df80: 6461 7465 6449 7465 6d73 5f63 6f70 7920  datedItems_copy 
+0000df90: 3d20 636f 7079 2e64 6565 7063 6f70 7928  = copy.deepcopy(
+0000dfa0: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+0000dfb0: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
+0000dfc0: 4b65 795d 290a 2020 2020 2020 2020 2020  Key]).          
+0000dfd0: 2020 6c6f 6720 3d20 6d69 7174 632e 7265    log = miqtc.re
+0000dfe0: 6375 7273 6976 656c 7955 7064 6174 6544  cursivelyUpdateD
+0000dff0: 6963 7473 2875 7064 6174 6564 4974 656d  icts(updatedItem
+0000e000: 735f 636f 7079 2c20 6974 656d 7344 6963  s_copy, itemsDic
+0000e010: 7429 0a20 2020 2020 2020 2020 2020 2073  t).            s
+0000e020: 656c 662e 7072 6f76 2e6c 6f67 286c 6f67  elf.prov.log(log
+0000e030: 2c64 6f6e 7453 686f 773d 5472 7565 290a  ,dontShow=True).
+0000e040: 2020 2020 2020 2020 2020 2020 6974 656d              item
+0000e050: 7320 3d20 6d69 7174 692e 6372 6561 7465  s = miqti.create
+0000e060: 496d 6167 6549 7465 6d73 4c69 7374 4672  ImageItemsListFr
+0000e070: 6f6d 496d 6167 6549 7465 6d73 4469 6374  omImageItemsDict
+0000e080: 2875 7064 6174 6564 4974 656d 735f 636f  (updatedItems_co
+0000e090: 7079 290a 0a20 2020 2020 2020 2065 6c73  py)..        els
+0000e0a0: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
+0000e0b0: 206f 7665 7277 7269 7465 2068 6561 6465   overwrite heade
+0000e0c0: 720a 2020 2020 2020 2020 2020 2020 7365  r.            se
+0000e0d0: 6c66 2e73 6574 6946 444f 4865 6164 6572  lf.setiFDOHeader
+0000e0e0: 4669 656c 6473 2868 6561 6465 7229 0a20  Fields(header). 
+0000e0f0: 2020 2020 2020 2020 2020 2023 2063 6c65             # cle
+0000e100: 6172 2069 7465 6d73 2073 6563 7469 6f6e  ar items section
+0000e110: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000e120: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
+0000e130: 696d 6167 6553 6574 4974 656d 734b 6579  imageSetItemsKey
+0000e140: 5d20 3d20 7b7d 0a0a 0a20 2020 2020 2020  ] = {}...       
+0000e150: 2023 2050 6172 7365 2069 6d61 6765 2d61   # Parse image-a
+0000e160: 6273 7472 6163 7420 616e 6420 6669 6c6c  bstract and fill
+0000e170: 2069 7473 2070 6c61 6365 686f 6c64 6572   its placeholder
+0000e180: 7320 7769 7468 2069 6e66 6f72 6d61 7469  s with informati
+0000e190: 6f6e 0a20 2020 2020 2020 2074 7279 3a0a  on.        try:.
+0000e1a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000e1b0: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
+0000e1c0: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
+0000e1d0: 5d5b 2769 6d61 6765 2d61 6273 7472 6163  ]['image-abstrac
+0000e1e0: 7427 5d20 3d20 6d69 7174 732e 7061 7273  t'] = miqts.pars
+0000e1f0: 6552 6570 6c61 6365 5661 6c28 7365 6c66  eReplaceVal(self
+0000e200: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
+0000e210: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
+0000e220: 5d2c 2027 696d 6167 652d 6162 7374 7261  ], 'image-abstra
+0000e230: 6374 2729 0a20 2020 2020 2020 2065 7863  ct').        exc
+0000e240: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+0000e250: 2065 783a 0a20 2020 2020 2020 2020 2020   ex:.           
+0000e260: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
+0000e270: 436f 756c 6420 6e6f 7420 7265 706c 6163  Could not replac
+0000e280: 6520 6b65 7973 2069 6e20 5c27 696d 6167  e keys in \'imag
+0000e290: 652d 6162 7374 7261 6374 5c27 3a20 2220  e-abstract\': " 
+0000e2a0: 2b20 7374 7228 6578 2929 0a0a 0a20 2020  + str(ex))...   
+0000e2b0: 2020 2020 2023 2073 6574 2076 6572 7369       # set versi
+0000e2c0: 6f6e 2028 736f 2069 7420 6361 6e6e 6f74  on (so it cannot
+0000e2d0: 2062 6520 6368 616e 6765 6420 6279 2075   be changed by u
+0000e2e0: 7365 7229 0a20 2020 2020 2020 2073 656c  ser).        sel
+0000e2f0: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
+0000e300: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
+0000e310: 795d 5b27 696d 6167 652d 7365 742d 6966  y]['image-set-if
+0000e320: 646f 2d76 6572 7369 6f6e 275d 203d 206d  do-version'] = m
+0000e330: 6971 7476 2e69 4644 4f5f 7665 7273 696f  iqtv.iFDO_versio
+0000e340: 6e0a 0a20 2020 2020 2020 2023 2056 616c  n..        # Val
+0000e350: 6964 6174 6520 6974 656d 2069 6e66 6f72  idate item infor
+0000e360: 6d61 7469 6f6e 0a20 2020 2020 2020 2069  mation.        i
+0000e370: 6e76 616c 6964 5f69 7465 6d73 203d 2030  nvalid_items = 0
+0000e380: 0a20 2020 2020 2020 2069 6d61 6765 5f73  .        image_s
+0000e390: 6574 5f69 7465 6d73 203d 207b 7d0a 0a20  et_items = {}.. 
+0000e3a0: 2020 2020 2020 2070 726f 6720 3d20 6d69         prog = mi
+0000e3b0: 7174 632e 5072 696e 744b 6e6f 776e 5072  qtc.PrintKnownPr
+0000e3c0: 6f67 7265 7373 4d73 6728 2243 6865 636b  ogressMsg("Check
+0000e3d0: 696e 6720 6974 656d 7322 2c20 6c65 6e28  ing items", len(
+0000e3e0: 6974 656d 7329 2c6d 6f64 756c 6f3d 3529  items),modulo=5)
+0000e3f0: 0a20 2020 2020 2020 2066 6f72 2069 7465  .        for ite
+0000e400: 6d20 696e 2069 7465 6d73 3a0a 2020 2020  m in items:.    
+0000e410: 2020 2020 2020 2020 7072 6f67 2e70 726f          prog.pro
+0000e420: 6772 6573 7328 290a 2020 2020 2020 2020  gress().        
+0000e430: 2020 2020 2320 6368 6563 6b20 6966 2061      # check if a
+0000e440: 6c6c 2063 6f72 6520 6669 656c 6473 2061  ll core fields a
+0000e450: 7265 2066 696c 6c65 6420 616e 6420 6172  re filled and ar
+0000e460: 6520 6669 6c6c 6564 2076 616c 6964 6c79  e filled validly
+0000e470: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
+0000e480: 3a0a 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000e490: 2020 2023 2063 6865 636b 2069 7465 6d20     # check item 
+0000e4a0: 696d 6167 6520 6578 6973 7473 0a20 2020  image exists.   
+0000e4b0: 2020 2020 2020 2020 2020 2020 2023 2069               # i
+0000e4c0: 6620 6974 656d 2069 7320 6120 6c69 7374  f item is a list
+0000e4d0: 2028 7669 6465 6f29 2c20 6f6e 6520 776f   (video), one wo
+0000e4e0: 756c 6420 6861 7665 2074 6f20 6368 6563  uld have to chec
+0000e4f0: 6b20 6966 2065 6163 6820 656e 7472 7920  k if each entry 
+0000e500: 6973 2076 616c 6964 2067 6976 656e 2074  is valid given t
+0000e510: 6865 2064 6566 6175 6c74 2076 616c 7565  he default value
+0000e520: 7320 696e 2066 6972 7374 2065 6e74 7279  s in first entry
+0000e530: 2070 6c75 7320 6769 7665 6e20 6465 6661   plus given defa
+0000e540: 756c 7420 7661 6c75 6573 2069 6e20 6865  ult values in he
+0000e550: 6164 6572 0a20 2020 2020 2020 2020 2020  ader.           
+0000e560: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
+0000e570: 7374 616e 6365 2869 7465 6d2c 6c69 7374  stance(item,list
+0000e580: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000e590: 2020 2020 2020 2069 7465 6d20 3d20 5b69         item = [i
+0000e5a0: 7465 6d5d 0a20 2020 2020 2020 2020 2020  tem].           
+0000e5b0: 2020 2020 2073 7562 4974 656d 4465 6661       subItemDefa
+0000e5c0: 756c 7420 3d20 6974 656d 5b30 5d20 0a20  ult = item[0] . 
+0000e5d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000e5e0: 6f72 2073 7562 4974 656d 2069 6e20 6974  or subItem in it
+0000e5f0: 656d 3a0a 2020 2020 2020 2020 2020 2020  em:.            
+0000e600: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
+0000e610: 6520 3d20 7375 6249 7465 6d5b 2769 6d61  e = subItem['ima
+0000e620: 6765 2d66 696c 656e 616d 6527 5d0a 2020  ge-filename'].  
+0000e630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e640: 2020 6966 206e 6f74 2073 656c 662e 6967    if not self.ig
+0000e650: 6e6f 7265 5f69 6d61 6765 5f66 696c 6573  nore_image_files
+0000e660: 2061 6e64 2066 696c 655f 6e61 6d65 206e   and file_name n
+0000e670: 6f74 2069 6e20 7365 6c66 2e5f 696d 6167  ot in self._imag
+0000e680: 654e 616d 6573 496d 6167 6573 4469 723a  eNamesImagesDir:
+0000e690: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e6a0: 2020 2020 2020 2020 2072 6169 7365 2045           raise E
+0000e6b0: 7863 6570 7469 6f6e 2822 4974 656d 2027  xception("Item '
+0000e6c0: 2220 2b20 6669 6c65 5f6e 616d 6520 2b20  " + file_name + 
+0000e6d0: 2227 206e 6f74 2066 6f75 6e64 2069 6e20  "' not found in 
+0000e6e0: 2f72 6177 2064 6972 6563 746f 7279 2e22  /raw directory."
+0000e6f0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000e700: 2020 2020 2020 206d 6971 7474 2e61 7265         miqtt.are
+0000e710: 5f76 616c 6964 5f69 6664 6f5f 6669 656c  _valid_ifdo_fiel
+0000e720: 6473 2873 7562 4974 656d 2920 2020 2020  ds(subItem)     
+0000e730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e740: 2020 2020 0a0a 2020 2020 2020 2020 2020      ..          
+0000e750: 2020 2020 2020 696d 6167 655f 7365 745f        image_set_
+0000e760: 6974 656d 735b 7375 6249 7465 6d44 6566  items[subItemDef
+0000e770: 6175 6c74 5b27 696d 6167 652d 6669 6c65  ault['image-file
+0000e780: 6e61 6d65 275d 5d20 3d20 5b5d 2023 2063  name']] = [] # c
+0000e790: 6f75 6c64 206d 616b 6520 616e 2065 7874  ould make an ext
+0000e7a0: 7261 2063 6173 6520 666f 7220 696d 6167  ra case for imag
+0000e7b0: 6573 206f 6d69 7474 696e 6720 7468 6520  es omitting the 
+0000e7c0: 6c69 7374 0a20 2020 2020 2020 2020 2020  list.           
+0000e7d0: 2020 2020 2066 6f72 2073 7562 4974 656d       for subItem
+0000e7e0: 2069 6e20 6974 656d 3a0a 2020 2020 2020   in item:.      
+0000e7f0: 2020 2020 2020 2020 2020 2020 2020 7375                su
+0000e800: 6249 7465 6d44 6963 7420 3d20 7b7d 0a20  bItemDict = {}. 
+0000e810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e820: 2020 2066 6f72 2069 7420 696e 2073 7562     for it in sub
+0000e830: 4974 656d 3a0a 2020 2020 2020 2020 2020  Item:.          
+0000e840: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000e850: 2069 7420 213d 2027 696d 6167 652d 6669   it != 'image-fi
+0000e860: 6c65 6e61 6d65 273a 0a20 2020 2020 2020  lename':.       
+0000e870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e880: 2020 2020 2073 7562 4974 656d 4469 6374       subItemDict
+0000e890: 5b69 745d 203d 2073 7562 4974 656d 5b69  [it] = subItem[i
+0000e8a0: 745d 0a20 2020 2020 2020 2020 2020 2020  t].             
+0000e8b0: 2020 2020 2020 2069 6d61 6765 5f73 6574         image_set
+0000e8c0: 5f69 7465 6d73 5b73 7562 4974 656d 4465  _items[subItemDe
+0000e8d0: 6661 756c 745b 2769 6d61 6765 2d66 696c  fault['image-fil
+0000e8e0: 656e 616d 6527 5d5d 2e61 7070 656e 6428  ename']].append(
+0000e8f0: 7375 6249 7465 6d44 6963 7429 0a20 2020  subItemDict).   
+0000e900: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0000e910: 2020 2020 2020 6578 6365 7074 206d 6971        except miq
+0000e920: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
+0000e930: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+0000e940: 2020 2020 2020 2069 6e76 616c 6964 5f69         invalid_i
+0000e950: 7465 6d73 202b 3d20 310a 2020 2020 2020  tems += 1.      
+0000e960: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0000e970: 726f 762e 6c6f 6728 2249 6e76 616c 6964  rov.log("Invalid
+0000e980: 2069 6d61 6765 2069 7465 6d3a 2022 2b20   image item: "+ 
+0000e990: 7374 7228 6974 656d 292c 646f 6e74 5368  str(item),dontSh
+0000e9a0: 6f77 3d54 7275 6529 0a20 2020 2020 2020  ow=True).       
+0000e9b0: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+0000e9c0: 6f76 2e6c 6f67 2822 4578 6365 7074 696f  ov.log("Exceptio
+0000e9d0: 6e3a 5c6e 222b 2073 7472 2865 2e61 7267  n:\n"+ str(e.arg
+0000e9e0: 7329 2c64 6f6e 7453 686f 773d 5472 7565  s),dontShow=True
+0000e9f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000ea00: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
+0000ea10: 646f 4578 6365 7074 696f 6e28 2249 6e76  doException("Inv
+0000ea20: 616c 6964 2069 6d61 6765 2069 7465 6d20  alid image item 
+0000ea30: 222b 2066 696c 655f 6e61 6d65 202b 2022  "+ file_name + "
+0000ea40: 3a5c 6e45 7863 6570 7469 6f6e 3a5c 6e22  :\nException:\n"
+0000ea50: 2b20 7374 7228 652e 6172 6773 2929 2023  + str(e.args)) #
+0000ea60: 206f 7468 6572 7769 7365 2c20 696e 2063   otherwise, in c
+0000ea70: 6173 6520 6f66 206d 616e 7920 696d 6167  ase of many imag
+0000ea80: 6573 2c20 6974 206d 6179 206b 6565 7020  es, it may keep 
+0000ea90: 7275 6e6e 696e 6720 616e 6420 7468 726f  running and thro
+0000eaa0: 7769 6e67 2065 7272 6f72 7320 666f 7220  wing errors for 
+0000eab0: 7175 6974 2073 6f6d 6520 7469 6d65 0a20  quit some time. 
+0000eac0: 2020 2020 2020 2070 726f 672e 636c 6561         prog.clea
+0000ead0: 7228 290a 0a20 2020 2020 2020 2069 6620  r()..        if 
+0000eae0: 6c65 6e28 6974 656d 7329 2021 3d20 3020  len(items) != 0 
+0000eaf0: 616e 6420 696e 7661 6c69 645f 6974 656d  and invalid_item
+0000eb00: 7320 3d3d 206c 656e 2869 7465 6d73 293a  s == len(items):
+0000eb10: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000eb20: 7365 2045 7863 6570 7469 6f6e 2822 416c  se Exception("Al
+0000eb30: 6c20 6974 656d 7320 6172 6520 696e 7661  l items are inva
+0000eb40: 6c69 6422 290a 2020 2020 2020 2020 656c  lid").        el
+0000eb50: 6966 2069 6e76 616c 6964 5f69 7465 6d73  if invalid_items
+0000eb60: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+0000eb70: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
+0000eb80: 2241 7420 6c65 6173 7420 2220 2b20 7374  "At least " + st
+0000eb90: 7228 696e 7661 6c69 645f 6974 656d 7329  r(invalid_items)
+0000eba0: 202b 2022 2069 7465 6d73 2077 6572 6520   + " items were 
+0000ebb0: 696e 7661 6c69 6420 286f 6622 202b 2073  invalid (of" + s
+0000ebc0: 7472 286c 656e 2869 7465 6d73 2929 2b20  tr(len(items))+ 
+0000ebd0: 2229 2229 0a0a 2020 2020 2020 2020 2320  ")")..        # 
+0000ebe0: 5661 6c69 6461 7465 2068 6561 6465 7220  Validate header 
+0000ebf0: 696e 666f 726d 6174 696f 6e0a 2020 2020  information.    
+0000ec00: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000ec10: 2020 2020 206d 6971 7474 2e61 7265 5f76       miqtt.are_v
+0000ec20: 616c 6964 5f69 6664 6f5f 6669 656c 6473  alid_ifdo_fields
+0000ec30: 2873 656c 662e 6966 646f 5f74 6d70 5b73  (self.ifdo_tmp[s
+0000ec40: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+0000ec50: 6572 4b65 795d 290a 2020 2020 2020 2020  erKey]).        
+0000ec60: 6578 6365 7074 206d 6971 7463 2e49 6664  except miqtc.Ifd
+0000ec70: 6f45 7863 6570 7469 6f6e 2061 7320 6578  oException as ex
+0000ec80: 3a0a 2020 2020 2020 2020 2020 2020 6d73  :.            ms
+0000ec90: 6720 3d20 2249 6e76 616c 6964 2068 6561  g = "Invalid hea
+0000eca0: 6465 7220 6669 656c 643a 2022 202b 2073  der field: " + s
+0000ecb0: 7472 2865 7829 0a20 2020 2020 2020 2020  tr(ex).         
+0000ecc0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+0000ecd0: 2822 4578 6365 7074 696f 6e3a 2022 202b  ("Exception: " +
+0000ece0: 206d 7367 2c20 646f 6e74 5368 6f77 3d54   msg, dontShow=T
+0000ecf0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+0000ed00: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
+0000ed10: 6f45 7863 6570 7469 6f6e 286d 7367 290a  oException(msg).
+0000ed20: 0a20 2020 2020 2020 2023 2070 7574 2069  .        # put i
+0000ed30: 7465 6d20 696e 666f 2069 6e74 6f20 7365  tem info into se
+0000ed40: 6c66 2e69 6664 6f5f 746d 700a 2020 2020  lf.ifdo_tmp.    
+0000ed50: 2020 2020 7320 3d20 6d69 7174 632e 5072      s = miqtc.Pr
+0000ed60: 696e 744c 6f61 6469 6e67 4d73 6728 2255  intLoadingMsg("U
+0000ed70: 7064 6174 696e 6722 290a 2020 2020 2020  pdating").      
+0000ed80: 2020 6c6f 6720 3d20 6d69 7174 632e 7265    log = miqtc.re
+0000ed90: 6375 7273 6976 656c 7955 7064 6174 6544  cursivelyUpdateD
+0000eda0: 6963 7473 2873 656c 662e 6966 646f 5f74  icts(self.ifdo_t
+0000edb0: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
+0000edc0: 4974 656d 734b 6579 5d2c 2069 6d61 6765  ItemsKey], image
+0000edd0: 5f73 6574 5f69 7465 6d73 290a 2020 2020  _set_items).    
+0000ede0: 2020 2020 732e 7374 6f70 2829 0a20 2020      s.stop().   
+0000edf0: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+0000ee00: 6f67 286c 6f67 290a 0a20 2020 2020 2020  og(log)..       
+0000ee10: 2023 2073 6574 206c 6174 206c 6f6e 2062   # set lat lon b
+0000ee20: 6f75 6e64 696e 6720 626f 780a 2020 2020  ounding box.    
+0000ee30: 2020 2020 7365 6c66 2e5f 7365 745f 6c61      self._set_la
+0000ee40: 745f 6c6f 6e5f 626f 756e 6469 6e67 5f62  t_lon_bounding_b
+0000ee50: 6f78 2873 656c 662e 6966 646f 5f74 6d70  ox(self.ifdo_tmp
+0000ee60: 290a 0a20 2020 2020 2020 2023 2073 6574  )..        # set
+0000ee70: 2072 6570 7265 7365 6e74 6174 6976 6520   representative 
+0000ee80: 6865 6164 6572 2066 6965 6c64 7320 6461  header fields da
+0000ee90: 7465 7469 6d65 2c20 6c61 742c 206c 6f6e  tetime, lat, lon
+0000eea0: 2c20 616c 740a 2020 2020 2020 2020 7365  , alt.        se
+0000eeb0: 6c66 2e5f 7365 745f 7265 705f 6865 6164  lf._set_rep_head
+0000eec0: 6572 5f66 6965 6c64 735f 6474 5f6c 6174  er_fields_dt_lat
+0000eed0: 5f6c 6f6e 5f61 6c74 2873 656c 662e 6966  _lon_alt(self.if
+0000eee0: 646f 5f74 6d70 290a 0a20 2020 2020 2020  do_tmp)..       
+0000eef0: 2073 656c 662e 5f73 6574 5f69 6d61 6765   self._set_image
+0000ef00: 5f69 7465 6d5f 6964 656e 7469 6669 6361  _item_identifica
+0000ef10: 7469 6f6e 5f73 6368 656d 6528 7365 6c66  tion_scheme(self
+0000ef20: 2e69 6664 6f5f 746d 7029 0a0a 2020 2020  .ifdo_tmp)..    
+0000ef30: 2020 2020 2320 7265 6d6f 7665 2065 6d74      # remove emt
+0000ef40: 7079 2066 6965 6c64 730a 2020 2020 2020  py fields.      
+0000ef50: 2020 7320 3d20 6d69 7174 632e 5072 696e    s = miqtc.Prin
+0000ef60: 744c 6f61 6469 6e67 4d73 6728 2252 656d  tLoadingMsg("Rem
+0000ef70: 6f76 696e 6720 656d 7074 7920 6669 656c  oving empty fiel
+0000ef80: 6473 2229 0a20 2020 2020 2020 2073 656c  ds").        sel
+0000ef90: 662e 6966 646f 5f74 6d70 203d 206d 6971  f.ifdo_tmp = miq
+0000efa0: 7463 2e72 6563 7572 7369 7665 6c79 5265  tc.recursivelyRe
+0000efb0: 6d6f 7665 456d 7074 7946 6965 6c64 7328  moveEmptyFields(
+0000efc0: 7365 6c66 2e69 6664 6f5f 746d 7029 0a20  self.ifdo_tmp). 
+0000efd0: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
+0000efe0: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
+0000eff0: 4b65 7920 696e 2073 656c 662e 6966 646f  Key in self.ifdo
+0000f000: 5f74 6d70 3a0a 2020 2020 2020 2020 2020  _tmp:.          
+0000f010: 2020 7365 6c66 2e69 6664 6f5f 746d 705b    self.ifdo_tmp[
+0000f020: 7365 6c66 2e69 6d61 6765 5365 7449 7465  self.imageSetIte
+0000f030: 6d73 4b65 795d 203d 205b 5d0a 2020 2020  msKey] = [].    
+0000f040: 2020 2020 2320 7265 6d6f 7665 2066 6965      # remove fie
+0000f050: 6c64 7320 7468 6174 2063 6f6e 7461 696e  lds that contain
+0000f060: 2027 696d 6167 652d 6461 7465 7469 6d65   'image-datetime
+0000f070: 2720 6f6e 6c79 0a20 2020 2020 2020 2073  ' only.        s
+0000f080: 656c 662e 7265 6d6f 7665 4974 656d 4669  elf.removeItemFi
+0000f090: 656c 6473 5769 7468 4f6e 6c79 4461 7465  eldsWithOnlyDate
+0000f0a0: 5469 6d65 2829 0a20 2020 2020 2020 2073  Time().        s
+0000f0b0: 2e73 746f 7028 290a 0a20 2020 2020 2020  .stop()..       
+0000f0c0: 2069 6620 6e6f 7420 7365 6c66 2e69 676e   if not self.ign
+0000f0d0: 6f72 655f 696d 6167 655f 6669 6c65 733a  ore_image_files:
+0000f0e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000f0f0: 662e 6368 6563 6b41 6c6c 4974 656d 4861  f.checkAllItemHa
+0000f100: 7368 6573 2829 0a0a 2020 2020 2020 2020  shes()..        
+0000f110: 2320 6368 6563 6b20 6167 6169 6e73 7420  # check against 
+0000f120: 7363 6865 6d61 0a20 2020 2020 2020 2076  schema.        v
+0000f130: 616c 6964 2c20 6d73 6720 3d20 6d69 7174  alid, msg = miqt
+0000f140: 742e 7661 6c69 6461 7465 5f69 6664 6f28  t.validate_ifdo(
+0000f150: 7365 6c66 2e69 6664 6f5f 746d 7029 0a20  self.ifdo_tmp). 
+0000f160: 2020 2020 2020 2069 6620 6e6f 7420 7661         if not va
+0000f170: 6c69 6420 616e 6420 6e6f 7420 616c 6c6f  lid and not allo
+0000f180: 775f 6d69 7373 696e 675f 7265 7175 6972  w_missing_requir
+0000f190: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+0000f1a0: 7365 6c66 2e70 726f 762e 6c6f 6728 2257  self.prov.log("W
+0000f1b0: 6172 6e69 6e67 2120 6946 444f 206e 6f20  arning! iFDO no 
+0000f1c0: 7661 6c69 6420 7965 743a 2022 202b 206d  valid yet: " + m
+0000f1d0: 7367 290a 2020 2020 2020 2020 2020 2020  sg).            
+0000f1e0: 7261 6973 6520 6d69 7174 632e 4966 646f  raise miqtc.Ifdo
+0000f1f0: 4578 6365 7074 696f 6e28 6d73 6729 0a0a  Exception(msg)..
+0000f200: 2020 2020 2020 2020 2320 7365 7420 6669          # set fi
+0000f210: 6e61 6c20 6f6e 650a 2020 2020 2020 2020  nal one.        
+0000f220: 7365 6c66 2e69 6664 6f5f 6368 6563 6b65  self.ifdo_checke
+0000f230: 6420 3d20 636f 7079 2e64 6565 7063 6f70  d = copy.deepcop
+0000f240: 7928 7365 6c66 2e69 6664 6f5f 746d 7029  y(self.ifdo_tmp)
+0000f250: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000f260: 7365 6c66 2e69 6664 6f5f 6368 6563 6b65  self.ifdo_checke
+0000f270: 640a 0a0a 2020 2020 6465 6620 5f73 6574  d...    def _set
+0000f280: 5f69 6d61 6765 5f69 7465 6d5f 6964 656e  _image_item_iden
+0000f290: 7469 6669 6361 7469 6f6e 5f73 6368 656d  tification_schem
+0000f2a0: 6528 7365 6c66 2c69 6664 6f3a 6469 6374  e(self,ifdo:dict
+0000f2b0: 293a 0a20 2020 2020 2020 2022 2222 2053  ):.        """ S
+0000f2c0: 6574 2069 6d61 6765 2d69 7465 6d2d 6964  et image-item-id
+0000f2d0: 656e 7469 6669 6361 7469 6f6e 2d73 6368  entification-sch
+0000f2e0: 656d 6520 746f 2060 696d 6167 652d 7072  eme to `image-pr
+0000f2f0: 6f6a 6563 745f 696d 6167 652d 6576 656e  oject_image-even
+0000f300: 745f 696d 6167 652d 7365 6e73 6f72 5f69  t_image-sensor_i
+0000f310: 6d61 6765 2d64 6174 6574 696d 652e 6578  mage-datetime.ex
+0000f320: 7460 2069 6620 656d 7074 792e 2022 2222  t` if empty. """
+0000f330: 0a20 2020 2020 2020 2069 6620 6669 6e64  .        if find
+0000f340: 4669 656c 6428 6966 646f 5b73 656c 662e  Field(ifdo[self.
+0000f350: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
+0000f360: 795d 2c27 696d 6167 652d 6974 656d 2d69  y],'image-item-i
+0000f370: 6465 6e74 6966 6963 6174 696f 6e2d 7363  dentification-sc
+0000f380: 6865 6d65 2729 203d 3d20 2222 3a0a 2020  heme') == "":.  
+0000f390: 2020 2020 2020 2020 2020 6966 646f 5b73            ifdo[s
+0000f3a0: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+0000f3b0: 6572 4b65 795d 5b27 696d 6167 652d 6974  erKey]['image-it
+0000f3c0: 656d 2d69 6465 6e74 6966 6963 6174 696f  em-identificatio
+0000f3d0: 6e2d 7363 6865 6d65 275d 203d 2020 2769  n-scheme'] =  'i
+0000f3e0: 6d61 6765 2d70 726f 6a65 6374 5f69 6d61  mage-project_ima
+0000f3f0: 6765 2d65 7665 6e74 5f69 6d61 6765 2d73  ge-event_image-s
+0000f400: 656e 736f 725f 696d 6167 652d 6461 7465  ensor_image-date
+0000f410: 7469 6d65 2e65 7874 270a 0a0a 2020 2020  time.ext'...    
+0000f420: 6465 6620 5f73 6574 5f72 6570 5f68 6561  def _set_rep_hea
+0000f430: 6465 725f 6669 656c 6473 5f64 745f 6c61  der_fields_dt_la
+0000f440: 745f 6c6f 6e5f 616c 7428 7365 6c66 2c69  t_lon_alt(self,i
+0000f450: 6664 6f3a 6469 6374 293a 0a20 2020 2020  fdo:dict):.     
+0000f460: 2020 2022 2222 2046 696c 6c20 6865 6164     """ Fill head
+0000f470: 6572 2066 6965 6c64 7320 696d 6167 652d  er fields image-
+0000f480: 6461 7465 7469 6d65 2c20 2d6c 6174 6974  datetime, -latit
+0000f490: 7564 652c 202d 6c6f 6e67 6974 7565 6465  ude, -longituede
+0000f4a0: 2c20 2d61 6c74 6974 7564 652d 6d65 7465  , -altitude-mete
+0000f4b0: 7273 2c20 6966 2065 6d70 7479 2c0a 2020  rs, if empty,.  
+0000f4c0: 2020 2020 2020 7265 7072 6573 656e 7461        representa
+0000f4d0: 7469 7665 6c79 2077 6974 6820 7661 6c75  tively with valu
+0000f4e0: 6573 2066 726f 6d20 6669 7273 7420 6974  es from first it
+0000f4f0: 656d 2e20 2222 220a 2020 2020 2020 2020  em. """.        
+0000f500: 6669 7273 745f 696d 6167 6520 3d20 736f  first_image = so
+0000f510: 7274 6564 2869 6664 6f5b 7365 6c66 2e69  rted(ifdo[self.i
+0000f520: 6d61 6765 5365 7449 7465 6d73 4b65 795d  mageSetItemsKey]
+0000f530: 2e6b 6579 7328 2929 5b30 5d0a 2020 2020  .keys())[0].    
+0000f540: 2020 2020 7265 705f 6865 6164 6572 5f66      rep_header_f
+0000f550: 6965 6c64 7320 3d20 5b27 696d 6167 652d  ields = ['image-
+0000f560: 6461 7465 7469 6d65 272c 2769 6d61 6765  datetime','image
+0000f570: 2d6c 6174 6974 7564 6527 2c27 696d 6167  -latitude','imag
+0000f580: 652d 6c6f 6e67 6974 7564 6527 2c27 696d  e-longitude','im
+0000f590: 6167 652d 616c 7469 7475 6465 2d6d 6574  age-altitude-met
+0000f5a0: 6572 7327 5d0a 2020 2020 2020 2020 666f  ers'].        fo
+0000f5b0: 7220 6669 656c 6420 696e 2072 6570 5f68  r field in rep_h
+0000f5c0: 6561 6465 725f 6669 656c 6473 3a0a 2020  eader_fields:.  
+0000f5d0: 2020 2020 2020 2020 2020 6966 2066 696e            if fin
+0000f5e0: 6446 6965 6c64 2869 6664 6f5b 7365 6c66  dField(ifdo[self
+0000f5f0: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
+0000f600: 6579 5d2c 6669 656c 6429 203d 3d20 2222  ey],field) == ""
+0000f610: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000f620: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0000f630: 2020 2020 2020 2020 2020 2069 6664 6f5b             ifdo[
+0000f640: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+0000f650: 6465 724b 6579 5d5b 6669 656c 645d 203d  derKey][field] =
+0000f660: 2073 656c 662e 5f5f 6765 7446 6965 6c64   self.__getField
+0000f670: 5661 6c75 6528 6966 646f 2c5b 6669 7273  Value(ifdo,[firs
+0000f680: 745f 696d 6167 652c 6669 656c 645d 2c64  t_image,field],d
+0000f690: 6566 6175 6c74 5f6f 6e6c 793d 5472 7565  efault_only=True
+0000f6a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000f6b0: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
+0000f6c0: 6c6f 6728 2253 6574 2072 6570 7265 7365  log("Set represe
+0000f6d0: 6e74 6174 6976 6520 6865 6164 6572 2066  ntative header f
+0000f6e0: 6965 6c64 2027 2220 2b20 6669 656c 6420  ield '" + field 
+0000f6f0: 2b20 2227 2074 6f20 2220 2b20 7374 7228  + "' to " + str(
+0000f700: 6966 646f 5b73 656c 662e 696d 6167 6553  ifdo[self.imageS
+0000f710: 6574 4865 6164 6572 4b65 795d 5b66 6965  etHeaderKey][fie
+0000f720: 6c64 5d29 202b 2022 2066 726f 6d20 6669  ld]) + " from fi
+0000f730: 7273 7420 696d 6167 652e 2229 0a20 2020  rst image.").   
+0000f740: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+0000f750: 6570 7420 6d69 7174 632e 4966 646f 4578  ept miqtc.IfdoEx
+0000f760: 6365 7074 696f 6e20 6173 2065 783a 0a20  ception as ex:. 
+0000f770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f780: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+0000f790: 2822 436f 756c 6420 6e6f 7420 7365 7420  ("Could not set 
+0000f7a0: 7265 7072 6573 656e 7461 7469 7665 2068  representative h
+0000f7b0: 6561 6465 7220 6669 656c 643a 2022 202b  eader field: " +
+0000f7c0: 2073 7472 2865 7829 290a 2020 2020 2020   str(ex)).      
+0000f7d0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+0000f7e0: 7373 0a0a 0a20 2020 2064 6566 205f 7365  ss...    def _se
+0000f7f0: 745f 6c61 745f 6c6f 6e5f 626f 756e 6469  t_lat_lon_boundi
+0000f800: 6e67 5f62 6f78 2873 656c 662c 6966 646f  ng_box(self,ifdo
+0000f810: 3a64 6963 7429 3a0a 2020 2020 2020 2020  :dict):.        
+0000f820: 2222 2220 5365 7420 696d 6167 652d 7365  """ Set image-se
+0000f830: 742d 5b6d 696e 2c6d 6178 5d2d 5b6c 6174  t-[min,max]-[lat
+0000f840: 6974 7564 652c 6c6f 6e67 6974 7564 655d  itude,longitude]
+0000f850: 2d64 6567 7265 6573 2022 2222 0a20 2020  -degrees """.   
+0000f860: 2020 2020 206c 6174 5f6d 696e 2c20 6c61       lat_min, la
+0000f870: 745f 6d61 782c 206c 6f6e 5f6d 696e 2c20  t_max, lon_min, 
+0000f880: 6c6f 6e5f 6d61 7820 3d20 7365 6c66 2e5f  lon_max = self._
+0000f890: 6765 745f 6c61 745f 6c6f 6e5f 626f 756e  get_lat_lon_boun
+0000f8a0: 6469 6e67 5f62 6f78 2869 6664 6f5b 7365  ding_box(ifdo[se
+0000f8b0: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
+0000f8c0: 4b65 795d 290a 2020 2020 2020 2020 6966  Key]).        if
+0000f8d0: 206e 6f74 204e 6f6e 6520 696e 205b 6c61   not None in [la
+0000f8e0: 745f 6d69 6e2c 206c 6174 5f6d 6178 2c20  t_min, lat_max, 
+0000f8f0: 6c6f 6e5f 6d69 6e2c 206c 6f6e 5f6d 6178  lon_min, lon_max
+0000f900: 5d3a 0a20 2020 2020 2020 2020 2020 2069  ]:.            i
+0000f910: 6664 6f5b 7365 6c66 2e69 6d61 6765 5365  fdo[self.imageSe
+0000f920: 7448 6561 6465 724b 6579 5d5b 2769 6d61  tHeaderKey]['ima
+0000f930: 6765 2d73 6574 2d6d 696e 2d6c 6174 6974  ge-set-min-latit
+0000f940: 7564 652d 6465 6772 6565 7327 5d20 3d20  ude-degrees'] = 
+0000f950: 6c61 745f 6d69 6e0a 2020 2020 2020 2020  lat_min.        
+0000f960: 2020 2020 6966 646f 5b73 656c 662e 696d      ifdo[self.im
+0000f970: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
+0000f980: 5b27 696d 6167 652d 7365 742d 6d61 782d  ['image-set-max-
+0000f990: 6c61 7469 7475 6465 2d64 6567 7265 6573  latitude-degrees
+0000f9a0: 275d 203d 206c 6174 5f6d 6178 0a20 2020  '] = lat_max.   
+0000f9b0: 2020 2020 2020 2020 2069 6664 6f5b 7365           ifdo[se
+0000f9c0: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+0000f9d0: 724b 6579 5d5b 2769 6d61 6765 2d73 6574  rKey]['image-set
+0000f9e0: 2d6d 696e 2d6c 6f6e 6769 7475 6465 2d64  -min-longitude-d
+0000f9f0: 6567 7265 6573 275d 203d 206c 6f6e 5f6d  egrees'] = lon_m
+0000fa00: 696e 0a20 2020 2020 2020 2020 2020 2069  in.            i
+0000fa10: 6664 6f5b 7365 6c66 2e69 6d61 6765 5365  fdo[self.imageSe
+0000fa20: 7448 6561 6465 724b 6579 5d5b 2769 6d61  tHeaderKey]['ima
+0000fa30: 6765 2d73 6574 2d6d 6178 2d6c 6f6e 6769  ge-set-max-longi
+0000fa40: 7475 6465 2d64 6567 7265 6573 275d 203d  tude-degrees'] =
+0000fa50: 206c 6f6e 5f6d 6178 0a0a 0a20 2020 2040   lon_max...    @
+0000fa60: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
+0000fa70: 2064 6566 205f 6765 745f 6c61 745f 6c6f   def _get_lat_lo
+0000fa80: 6e5f 626f 756e 6469 6e67 5f62 6f78 2869  n_bounding_box(i
+0000fa90: 7465 6d73 3a64 6963 7429 3a0a 2020 2020  tems:dict):.    
+0000faa0: 2020 2020 2222 2220 5265 7475 726e 7320      """ Returns 
+0000fab0: 6c61 745f 6d69 6e2c 206c 6174 5f6d 6178  lat_min, lat_max
+0000fac0: 2c20 6c6f 6e5f 6d69 6e2c 206c 6f6e 5f6d  , lon_min, lon_m
+0000fad0: 6178 2022 2222 0a20 2020 2020 2020 206c  ax """.        l
+0000fae0: 6174 5f6d 696e 2c20 6c61 745f 6d61 782c  at_min, lat_max,
+0000faf0: 206c 6f6e 5f6d 696e 2c20 6c6f 6e5f 6d61   lon_min, lon_ma
+0000fb00: 7820 3d20 4e6f 6e65 2c20 4e6f 6e65 2c20  x = None, None, 
+0000fb10: 4e6f 6e65 2c20 4e6f 6e65 0a20 2020 2020  None, None.     
+0000fb20: 2020 2069 203d 2030 0a20 2020 2020 2020     i = 0.       
+0000fb30: 2066 6f72 2069 6d61 6765 2c20 6461 7461   for image, data
+0000fb40: 2069 6e20 6974 656d 732e 6974 656d 7328   in items.items(
+0000fb50: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
+0000fb60: 206d 616b 6520 696d 6167 6520 656e 7472   make image entr
+0000fb70: 7920 6c69 7374 2028 616c 736f 2069 6620  y list (also if 
+0000fb80: 6974 7320 6120 7069 6374 7572 6529 0a20  its a picture). 
+0000fb90: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0000fba0: 7420 6973 696e 7374 616e 6365 2864 6174  t isinstance(dat
+0000fbb0: 612c 206c 6973 7429 3a0a 2020 2020 2020  a, list):.      
+0000fbc0: 2020 2020 2020 2020 2020 6461 7461 203d            data =
+0000fbd0: 205b 6461 7461 5d0a 2020 2020 2020 2020   [data].        
+0000fbe0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+0000fbf0: 2066 6f72 2074 696d 6570 6f69 6e74 5f64   for timepoint_d
+0000fc00: 6174 6120 696e 2064 6174 613a 0a20 2020  ata in data:.   
+0000fc10: 2020 2020 2020 2020 2020 2020 2074 7279               try
+0000fc20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000fc30: 2020 2020 2020 6c61 7420 3d20 7469 6d65        lat = time
+0000fc40: 706f 696e 745f 6461 7461 5b27 696d 6167  point_data['imag
+0000fc50: 652d 6c61 7469 7475 6465 275d 0a20 2020  e-latitude'].   
+0000fc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fc70: 206c 6f6e 203d 2074 696d 6570 6f69 6e74   lon = timepoint
+0000fc80: 5f64 6174 615b 2769 6d61 6765 2d6c 6f6e  _data['image-lon
+0000fc90: 6769 7475 6465 275d 0a20 2020 2020 2020  gitude'].       
+0000fca0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+0000fcb0: 4b65 7945 7272 6f72 2061 7320 6578 3a0a  KeyError as ex:.
+0000fcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fcd0: 2020 2020 636f 6e74 696e 7565 0a0a 2020      continue..  
+0000fce0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000fcf0: 2069 203d 3d20 303a 0a20 2020 2020 2020   i == 0:.       
+0000fd00: 2020 2020 2020 2020 2020 2020 206c 6174               lat
+0000fd10: 5f6d 696e 2c20 6c61 745f 6d61 7820 3d20  _min, lat_max = 
+0000fd20: 6c61 742c 206c 6174 0a20 2020 2020 2020  lat, lat.       
+0000fd30: 2020 2020 2020 2020 2020 2020 206c 6f6e               lon
+0000fd40: 5f6d 696e 2c20 6c6f 6e5f 6d61 7820 3d20  _min, lon_max = 
+0000fd50: 6c6f 6e2c 206c 6f6e 0a20 2020 2020 2020  lon, lon.       
+0000fd60: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000fd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fd80: 2020 2069 6620 6c61 7420 3c20 6c61 745f     if lat < lat_
+0000fd90: 6d69 6e3a 0a20 2020 2020 2020 2020 2020  min:.           
+0000fda0: 2020 2020 2020 2020 2020 2020 206c 6174               lat
+0000fdb0: 5f6d 696e 203d 206c 6174 0a20 2020 2020  _min = lat.     
+0000fdc0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000fdd0: 6620 6c61 7420 3e20 6c61 745f 6d61 783a  f lat > lat_max:
+0000fde0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fdf0: 2020 2020 2020 2020 206c 6174 5f6d 6178           lat_max
+0000fe00: 203d 206c 6174 0a20 2020 2020 2020 2020   = lat.         
+0000fe10: 2020 2020 2020 2020 2020 2069 6620 6c6f             if lo
+0000fe20: 6e20 3c20 6c6f 6e5f 6d69 6e3a 0a20 2020  n < lon_min:.   
+0000fe30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fe40: 2020 2020 206c 6f6e 5f6d 696e 203d 206c       lon_min = l
+0000fe50: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
+0000fe60: 2020 2020 2020 2069 6620 6c6f 6e20 3e20         if lon > 
+0000fe70: 6c6f 6e5f 6d61 783a 0a20 2020 2020 2020  lon_max:.       
+0000fe80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fe90: 206c 6f6e 5f6d 6178 203d 206c 6f6e 0a20   lon_max = lon. 
+0000fea0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000feb0: 202b 3d20 310a 2020 2020 2020 2020 7265   += 1.        re
+0000fec0: 7475 726e 206c 6174 5f6d 696e 2c20 6c61  turn lat_min, la
+0000fed0: 745f 6d61 782c 206c 6f6e 5f6d 696e 2c20  t_max, lon_min, 
+0000fee0: 6c6f 6e5f 6d61 780a 0a0a 2020 2020 6465  lon_max...    de
+0000fef0: 6620 7265 6d6f 7665 4974 656d 4669 656c  f removeItemFiel
+0000ff00: 6473 5769 7468 4f6e 6c79 4461 7465 5469  dsWithOnlyDateTi
+0000ff10: 6d65 2873 656c 6629 3a0a 2020 2020 2020  me(self):.      
+0000ff20: 2020 2222 2220 6974 2063 616e 2068 6170    """ it can hap
+0000ff30: 7065 6e20 7468 6174 2061 6e20 696d 6167  pen that an imag
+0000ff40: 6520 7469 6d65 7374 616d 7020 646f 6573  e timestamp does
+0000ff50: 206e 6f74 2063 6f6e 7461 696e 2061 6e79   not contain any
+0000ff60: 2066 6965 6c64 7320 6275 7420 7468 6520   fields but the 
+0000ff70: 7469 6d65 7374 616d 7020 616e 7920 6d6f  timestamp any mo
+0000ff80: 7265 2e20 5468 6f73 6520 6172 6520 7265  re. Those are re
+0000ff90: 6d6f 7665 6420 6865 7265 2e20 2222 2220  moved here. """ 
+0000ffa0: 0a20 2020 2020 2020 2066 6f72 2069 7465  .        for ite
+0000ffb0: 6d20 696e 2073 656c 662e 6966 646f 5f74  m in self.ifdo_t
+0000ffc0: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
+0000ffd0: 4974 656d 734b 6579 5d3a 0a20 2020 2020  ItemsKey]:.     
+0000ffe0: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+0000fff0: 696e 7374 616e 6365 2873 656c 662e 6966  instance(self.if
+00010000: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+00010010: 6553 6574 4974 656d 734b 6579 5d5b 6974  eSetItemsKey][it
+00010020: 656d 5d2c 6c69 7374 293a 0a20 2020 2020  em],list):.     
+00010030: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00010040: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
+00010050: 6167 6553 6574 4974 656d 734b 6579 5d5b  ageSetItemsKey][
+00010060: 6974 656d 5d20 3d20 5b73 656c 662e 6966  item] = [self.if
+00010070: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+00010080: 6553 6574 4974 656d 734b 6579 5d5b 6974  eSetItemsKey][it
+00010090: 656d 5d5d 0a20 2020 2020 2020 2020 2020  em]].           
+000100a0: 2074 6f42 6552 656d 6f76 6564 203d 205b   toBeRemoved = [
+000100b0: 5d0a 2020 2020 2020 2020 2020 2020 666f  ].            fo
+000100c0: 7220 656e 7472 7920 696e 2073 656c 662e  r entry in self.
+000100d0: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
+000100e0: 6167 6553 6574 4974 656d 734b 6579 5d5b  ageSetItemsKey][
+000100f0: 6974 656d 5d3a 0a20 2020 2020 2020 2020  item]:.         
+00010100: 2020 2020 2020 2023 7072 696e 7428 656e         #print(en
+00010110: 7472 7929 0a20 2020 2020 2020 2020 2020  try).           
+00010120: 2020 2020 2069 6620 6c65 6e28 656e 7472       if len(entr
+00010130: 7929 203d 3d20 3120 616e 6420 2769 6d61  y) == 1 and 'ima
+00010140: 6765 2d64 6174 6574 696d 6527 2069 6e20  ge-datetime' in 
+00010150: 656e 7472 793a 0a20 2020 2020 2020 2020  entry:.         
+00010160: 2020 2020 2020 2020 2020 2074 6f42 6552             toBeR
+00010170: 656d 6f76 6564 2e61 7070 656e 6428 656e  emoved.append(en
+00010180: 7472 7929 0a20 2020 2020 2020 2020 2020  try).           
+00010190: 2066 6f72 2065 6e74 7279 2069 6e20 746f   for entry in to
+000101a0: 4265 5265 6d6f 7665 643a 0a20 2020 2020  BeRemoved:.     
+000101b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000101c0: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
+000101d0: 6167 6553 6574 4974 656d 734b 6579 5d5b  ageSetItemsKey][
+000101e0: 6974 656d 5d2e 7265 6d6f 7665 2865 6e74  item].remove(ent
+000101f0: 7279 2920 0a0a 0a20 2020 2064 6566 2063  ry) ...    def c
+00010200: 6865 636b 416c 6c49 7465 6d48 6173 6865  heckAllItemHashe
+00010210: 7328 7365 6c66 2c20 6861 7264 3d46 616c  s(self, hard=Fal
+00010220: 7365 2c20 7261 6973 6545 7863 6570 7469  se, raiseExcepti
+00010230: 6f6e 203d 2054 7275 6529 3a0a 2020 2020  on = True):.    
+00010240: 2020 2020 2222 2220 0a20 2020 2020 2020      """ .       
+00010250: 2043 6865 636b 7320 6966 2068 6173 6865   Checks if hashe
+00010260: 7320 696e 2069 4644 4f20 6d61 7463 6820  s in iFDO match 
+00010270: 6861 7368 6573 2069 6e20 696e 7465 726d  hashes in interm
+00010280: 6569 6461 7465 2068 6173 6820 6669 6c65  eidate hash file
+00010290: 2069 6620 7468 6520 6c61 7474 6572 2077   if the latter w
+000102a0: 6173 2063 6861 6e67 6564 206c 6173 7420  as changed last 
+000102b0: 6166 7465 7220 7468 6520 696d 6167 6573  after the images
+000102c0: 2068 6173 2063 6861 6e67 6564 2e0a 2020   has changed..  
+000102d0: 2020 2020 2020 4f74 6865 7277 6973 6520        Otherwise 
+000102e0: 6f72 2069 6620 6861 7264 3d3d 5472 7565  or if hard==True
+000102f0: 2069 7420 7265 6465 7465 726d 696e 6573   it redetermines
+00010300: 2074 6865 2061 6374 7561 6c6c 2066 696c   the actuall fil
+00010310: 6527 7320 6861 7368 2061 6e64 2063 6f6d  e's hash and com
+00010320: 7061 7265 7320 7468 6520 6946 444f 2069  pares the iFDO i
+00010330: 7465 6d27 7320 6861 7368 2077 6974 6820  tem's hash with 
+00010340: 7468 6174 2e0a 2020 2020 2020 2020 4966  that..        If
+00010350: 2068 6173 6865 7320 646f 206e 6f74 206d   hashes do not m
+00010360: 6174 6368 2061 206d 6172 6971 742e 636f  atch a mariqt.co
+00010370: 7265 2e49 6664 6f45 7863 6570 7469 6f6e  re.IfdoException
+00010380: 2069 7320 7269 7365 6e20 756e 736c 6573   is risen unsles
+00010390: 7320 7261 6973 6545 7863 6570 7469 6f6e  s raiseException
+000103a0: 203d 3d20 4661 6c73 652c 2074 6865 6e20   == False, then 
+000103b0: 6120 6c69 7374 206f 6620 6c69 7374 7320  a list of lists 
+000103c0: 5b3c 6669 6c65 3e2c 3c65 7863 6570 7469  [<file>,<excepti
+000103d0: 6f6e 3e5d 2069 7320 7265 7475 726e 6564  on>] is returned
+000103e0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+000103f0: 2020 2020 2020 6861 7368 6573 203d 207b        hashes = {
+00010400: 7d0a 2020 2020 2020 2020 6861 7368 4669  }.        hashFi
+00010410: 6c65 4d6f 6454 696d 6520 3d20 3130 652b  leModTime = 10e+
+00010420: 3130 300a 2020 2020 2020 2020 6966 206f  100.        if o
+00010430: 732e 7061 7468 2e65 7869 7374 7328 7365  s.path.exists(se
+00010440: 6c66 2e67 6574 5f69 6e74 5f68 6173 685f  lf.get_int_hash_
+00010450: 6669 6c65 2829 293a 0a20 2020 2020 2020  file()):.       
+00010460: 2020 2020 2068 6173 6865 7320 3d20 6d69       hashes = mi
+00010470: 7174 662e 7461 6246 696c 6544 6174 6128  qtf.tabFileData(
+00010480: 7365 6c66 2e67 6574 5f69 6e74 5f68 6173  self.get_int_has
+00010490: 685f 6669 6c65 2829 2c20 5b6d 6971 7476  h_file(), [miqtv
+000104a0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+000104b0: 6971 7427 5d5b 2769 6d67 275d 2c20 6d69  iqt']['img'], mi
+000104c0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+000104d0: 6d61 7269 7174 275d 5b27 6861 7368 275d  mariqt']['hash']
+000104e0: 5d2c 206b 6579 5f63 6f6c 3d6d 6971 7476  ], key_col=miqtv
+000104f0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+00010500: 6971 7427 5d5b 2769 6d67 275d 290a 2020  iqt']['img']).  
+00010510: 2020 2020 2020 2020 2020 6861 7368 4669            hashFi
+00010520: 6c65 4d6f 6454 696d 6520 3d20 6f73 2e70  leModTime = os.p
+00010530: 6174 682e 6765 746d 7469 6d65 2873 656c  ath.getmtime(sel
+00010540: 662e 6765 745f 696e 745f 6861 7368 5f66  f.get_int_hash_f
+00010550: 696c 6528 2929 0a0a 2020 2020 2020 2020  ile())..        
+00010560: 6578 6365 7074 696f 6e4c 6973 7420 3d20  exceptionList = 
+00010570: 5b5d 0a0a 2020 2020 2020 2020 6861 7368  []..        hash
+00010580: 556e 6368 6563 6b49 6d61 6765 7349 6e52  UncheckImagesInR
+00010590: 6177 203d 2073 656c 662e 696d 6167 6573  aw = self.images
+000105a0: 496e 496d 6167 6573 4469 7228 290a 2020  InImagesDir().  
+000105b0: 2020 2020 2020 7072 6f67 203d 206d 6971        prog = miq
+000105c0: 7463 2e50 7269 6e74 4b6e 6f77 6e50 726f  tc.PrintKnownPro
+000105d0: 6772 6573 734d 7367 2822 4368 6563 6b69  gressMsg("Checki
+000105e0: 6e67 2069 7465 6d20 6861 7368 6573 222c  ng item hashes",
+000105f0: 206c 656e 2873 656c 662e 6966 646f 5f74   len(self.ifdo_t
+00010600: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
+00010610: 4974 656d 734b 6579 5d29 290a 2020 2020  ItemsKey])).    
+00010620: 2020 2020 666f 7220 6974 656d 2069 6e20      for item in 
+00010630: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+00010640: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
+00010650: 4b65 795d 3a0a 2020 2020 2020 2020 2020  Key]:.          
+00010660: 2020 7072 6f67 2e70 726f 6772 6573 7328    prog.progress(
+00010670: 290a 0a20 2020 2020 2020 2020 2020 2066  )..            f
+00010680: 6f75 6e64 203d 2046 616c 7365 0a20 2020  ound = False.   
+00010690: 2020 2020 2020 2020 2066 6f72 2069 6d61           for ima
+000106a0: 6765 2069 6e20 6861 7368 556e 6368 6563  ge in hashUnchec
+000106b0: 6b49 6d61 6765 7349 6e52 6177 3a0a 2020  kImagesInRaw:.  
+000106c0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+000106d0: 6c65 4e61 6d65 203d 206f 732e 7061 7468  leName = os.path
+000106e0: 2e62 6173 656e 616d 6528 696d 6167 6529  .basename(image)
+000106f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010700: 2069 6620 6669 6c65 4e61 6d65 203d 3d20   if fileName == 
+00010710: 6974 656d 3a0a 2020 2020 2020 2020 2020  item:.          
+00010720: 2020 2020 2020 2020 2020 666f 756e 6420            found 
+00010730: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+00010740: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+00010750: 696e 7374 616e 6365 2873 656c 662e 6966  instance(self.if
+00010760: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+00010770: 6553 6574 4974 656d 734b 6579 5d5b 6974  eSetItemsKey][it
+00010780: 656d 5d2c 6c69 7374 293a 2023 2069 6e20  em],list): # in 
+00010790: 6361 7365 206f 6620 7669 6465 6f20 7769  case of video wi
+000107a0: 7468 2069 7465 6d20 6173 206c 6973 7420  th item as list 
+000107b0: 7468 6520 6669 7273 7420 656e 7472 7920  the first entry 
+000107c0: 686f 6c64 7320 7468 6520 6465 6661 756c  holds the defaul
+000107d0: 7420 616e 6420 7468 6520 6861 7368 2063  t and the hash c
+000107e0: 616e 6e6f 7420 7661 7279 2066 6f72 2074  annot vary for t
+000107f0: 6865 2073 616d 6520 696d 6167 650a 2020  he same image.  
+00010800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010810: 2020 2020 2020 6974 656d 456e 7472 7920        itemEntry 
+00010820: 3d20 7365 6c66 2e69 6664 6f5f 746d 705b  = self.ifdo_tmp[
+00010830: 7365 6c66 2e69 6d61 6765 5365 7449 7465  self.imageSetIte
+00010840: 6d73 4b65 795d 5b69 7465 6d5d 5b30 5d20  msKey][item][0] 
+00010850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010860: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00010870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010880: 2020 2069 7465 6d45 6e74 7279 203d 2073     itemEntry = s
+00010890: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+000108a0: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
+000108b0: 6579 5d5b 6974 656d 5d0a 0a20 2020 2020  ey][item]..     
+000108c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000108d0: 6d61 6765 4d6f 6454 696d 6520 3d20 6f73  mageModTime = os
+000108e0: 2e70 6174 682e 6765 746d 7469 6d65 2869  .path.getmtime(i
+000108f0: 6d61 6765 290a 2020 2020 2020 2020 2020  mage).          
+00010900: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00010910: 2068 6172 6420 616e 6420 696d 6167 654d   hard and imageM
+00010920: 6f64 5469 6d65 203c 2068 6173 6846 696c  odTime < hashFil
+00010930: 654d 6f64 5469 6d65 3a0a 2020 2020 2020  eModTime:.      
+00010940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010950: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
+00010960: 2e62 6173 656e 616d 6528 696d 6167 6529  .basename(image)
+00010970: 2069 6e20 6861 7368 6573 3a0a 2020 2020   in hashes:.    
+00010980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010990: 2020 2020 2020 2020 6966 2072 6169 7365          if raise
+000109a0: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
+000109b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000109c0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+000109d0: 206d 6971 7463 2e49 6664 6f45 7863 6570   miqtc.IfdoExcep
+000109e0: 7469 6f6e 2869 7465 6d2c 2022 6e6f 7420  tion(item, "not 
+000109f0: 666f 756e 6420 696e 2069 6e74 6572 6d65  found in interme
+00010a00: 6964 6174 6520 6861 7368 2066 696c 6522  idate hash file"
+00010a10: 2c73 656c 662e 6765 745f 696e 745f 6861  ,self.get_int_ha
+00010a20: 7368 5f66 696c 6528 292c 2220 7275 6e20  sh_file()," run 
+00010a30: 6372 6561 7465 5f69 6d61 6765 5f73 6861  create_image_sha
+00010a40: 3235 365f 6669 6c65 2829 2066 6972 7374  256_file() first
+00010a50: 2229 200a 2020 2020 2020 2020 2020 2020  ") .            
+00010a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010a70: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00010a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010a90: 2020 2020 2020 6578 6365 7074 696f 6e4c        exceptionL
+00010aa0: 6973 742e 6170 7065 6e64 285b 6669 6c65  ist.append([file
+00010ab0: 4e61 6d65 2c22 6e6f 7420 666f 756e 6420  Name,"not found 
+00010ac0: 696e 2069 6e74 6572 6d65 6964 6174 6520  in intermeidate 
+00010ad0: 6861 7368 2066 696c 6520 2220 2b20 7374  hash file " + st
+00010ae0: 7228 7365 6c66 2e67 6574 5f69 6e74 5f68  r(self.get_int_h
+00010af0: 6173 685f 6669 6c65 2829 295d 290a 2020  ash_file())]).  
+00010b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010b10: 2020 2020 2020 6966 206e 6f74 2069 7465        if not ite
+00010b20: 6d45 6e74 7279 5b27 696d 6167 652d 6861  mEntry['image-ha
+00010b30: 7368 2d73 6861 3235 3627 5d20 3d3d 2068  sh-sha256'] == h
+00010b40: 6173 6865 735b 6f73 2e70 6174 682e 6261  ashes[os.path.ba
+00010b50: 7365 6e61 6d65 2869 6d61 6765 295d 5b27  sename(image)]['
+00010b60: 696d 6167 652d 6861 7368 2d73 6861 3235  image-hash-sha25
+00010b70: 3627 5d3a 0a20 2020 2020 2020 2020 2020  6']:.           
+00010b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010b90: 2069 6620 7261 6973 6545 7863 6570 7469   if raiseExcepti
+00010ba0: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
+00010bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010bc0: 2020 2020 7261 6973 6520 6d69 7174 632e      raise miqtc.
+00010bd0: 4966 646f 4578 6365 7074 696f 6e28 6974  IfdoException(it
+00010be0: 656d 2c20 2269 6e63 6f72 7265 6374 2073  em, "incorrect s
+00010bf0: 6861 3235 3620 6861 7368 222c 2069 7465  ha256 hash", ite
+00010c00: 6d45 6e74 7279 5b27 696d 6167 652d 6861  mEntry['image-ha
+00010c10: 7368 2d73 6861 3235 3627 5d2c 2266 6f72  sh-sha256'],"for
+00010c20: 2066 696c 6522 2c66 696c 654e 616d 652c   file",fileName,
+00010c30: 2220 7275 6e20 6372 6561 7465 5f69 6d61  " run create_ima
+00010c40: 6765 5f73 6861 3235 365f 6669 6c65 2829  ge_sha256_file()
+00010c50: 2066 6972 7374 2229 0a20 2020 2020 2020   first").       
+00010c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010c70: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00010c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010c90: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00010ca0: 7469 6f6e 4c69 7374 2e61 7070 656e 6428  tionList.append(
+00010cb0: 5b66 696c 654e 616d 652c 2269 6e63 6f72  [fileName,"incor
+00010cc0: 7265 6374 2073 6861 3235 3620 6861 7368  rect sha256 hash
+00010cd0: 225d 290a 2020 2020 2020 2020 2020 2020  "]).            
+00010ce0: 2020 2020 2020 2020 656c 6966 206e 6f74          elif not
+00010cf0: 2069 7465 6d45 6e74 7279 5b27 696d 6167   itemEntry['imag
+00010d00: 652d 6861 7368 2d73 6861 3235 3627 5d20  e-hash-sha256'] 
+00010d10: 3d3d 206d 6971 7463 2e73 6861 3235 3648  == miqtc.sha256H
+00010d20: 6173 6846 696c 6528 696d 6167 6529 3a0a  ashFile(image):.
+00010d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d40: 2020 2020 2020 2020 6966 2072 6169 7365          if raise
+00010d50: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
+00010d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d70: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
+00010d80: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
+00010d90: 2869 7465 6d2c 2022 696e 636f 7272 6563  (item, "incorrec
+00010da0: 7420 7368 6132 3536 2068 6173 6822 2c20  t sha256 hash", 
+00010db0: 6974 656d 456e 7472 795b 2769 6d61 6765  itemEntry['image
+00010dc0: 2d68 6173 682d 7368 6132 3536 275d 2c22  -hash-sha256'],"
+00010dd0: 666f 7220 6669 6c65 222c 6669 6c65 4e61  for file",fileNa
+00010de0: 6d65 2c22 2072 756e 2063 7265 6174 655f  me," run create_
+00010df0: 696d 6167 655f 7368 6132 3536 5f66 696c  image_sha256_fil
+00010e00: 6528 2920 6669 7273 7422 290a 2020 2020  e() first").    
+00010e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e20: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00010e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e40: 2020 2020 2020 6578 6365 7074 696f 6e4c        exceptionL
+00010e50: 6973 742e 6170 7065 6e64 285b 6669 6c65  ist.append([file
+00010e60: 4e61 6d65 2c22 696e 636f 7272 6563 7420  Name,"incorrect 
+00010e70: 7368 6132 3536 2068 6173 6822 5d29 0a20  sha256 hash"]). 
+00010e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e90: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
+00010ea0: 2020 2020 2069 6620 666f 756e 643a 0a20       if found:. 
+00010eb0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00010ec0: 656c 2068 6173 6855 6e63 6865 636b 496d  el hashUncheckIm
+00010ed0: 6167 6573 496e 5261 775b 696d 6167 655d  agesInRaw[image]
+00010ee0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00010ef0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00010f00: 2020 2069 6620 7261 6973 6545 7863 6570     if raiseExcep
+00010f10: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
+00010f20: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00010f30: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
+00010f40: 696f 6e28 2022 696d 6167 6522 2c20 6974  ion( "image", it
+00010f50: 656d 2c20 226e 6f74 2066 6f75 6e64 2069  em, "not found i
+00010f60: 6e20 6469 7265 6374 6f72 7927 7320 7261  n directory's ra
+00010f70: 7720 666f 6c64 6572 2122 290a 2020 2020  w folder!").    
+00010f80: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00010f90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010fa0: 2020 2020 2020 6578 6365 7074 696f 6e4c        exceptionL
+00010fb0: 6973 742e 6170 7065 6e64 285b 6669 6c65  ist.append([file
+00010fc0: 4e61 6d65 2c22 6669 6c65 206e 6f74 2066  Name,"file not f
+00010fd0: 6f75 6e64 225d 290a 2020 2020 2020 2020  ound"]).        
+00010fe0: 7072 6f67 2e63 6c65 6172 2829 0a20 2020  prog.clear().   
+00010ff0: 2020 2020 2069 6620 6e6f 7420 7261 6973       if not rais
+00011000: 6545 7863 6570 7469 6f6e 3a0a 2020 2020  eException:.    
+00011010: 2020 2020 2020 2020 7265 7475 726e 2065          return e
+00011020: 7863 6570 7469 6f6e 4c69 7374 0a0a 0a20  xceptionList... 
+00011030: 2020 2064 6566 2063 7265 6174 655f 7575     def create_uu
+00011040: 6964 5f66 696c 6528 7365 6c66 2c63 6c65  id_file(self,cle
+00011050: 616e 3d54 7275 6529 3a0a 2020 2020 2020  an=True):.      
+00011060: 2020 2222 2220 4372 6561 7465 7320 696e    """ Creates in
+00011070: 202f 696e 7465 726d 6564 6961 7465 2061   /intermediate a
+00011080: 2074 6578 7420 6669 6c65 2063 6f6e 7461   text file conta
+00011090: 696e 696e 6720 7065 7220 696d 6167 6520  ining per image 
+000110a0: 6120 6372 6561 7465 6420 7575 6964 2028  a created uuid (
+000110b0: 7665 7273 696f 6e20 3429 2e0a 0a20 2020  version 4)...   
+000110c0: 2020 2020 2054 6865 2055 5549 4420 6973       The UUID is
+000110d0: 206f 6e6c 7920 2a74 616b 656e 2a20 6672   only *taken* fr
+000110e0: 6f6d 2074 6865 206d 6574 6164 6174 6120  om the metadata 
+000110f0: 6f66 2074 6865 2069 6d61 6765 732e 2049  of the images. I
+00011100: 7420 646f 6573 206e 6f74 2077 7269 7465  t does not write
+00011110: 2055 5549 4473 2074 6f20 7468 6520 6d65   UUIDs to the me
+00011120: 7461 6461 7461 2069 6e20 6361 7365 2073  tadata in case s
+00011130: 6f6d 6520 6669 6c65 7320 6172 6520 6d69  ome files are mi
+00011140: 7373 696e 6720 6974 2e0a 2020 2020 2020  ssing it..      
+00011150: 2020 4275 742c 2069 7420 6372 6561 7465    But, it create
+00011160: 7320 6120 4353 5620 6669 6c65 2069 6e20  s a CSV file in 
+00011170: 7468 6174 2063 6173 6520 7468 6174 2079  that case that y
+00011180: 6f75 2063 616e 2075 7365 2074 6f67 6574  ou can use toget
+00011190: 6865 7220 7769 7468 2065 7869 6674 6f6f  her with exiftoo
+000111a0: 6c20 746f 2061 6464 2074 6865 2055 5549  l to add the UUI
+000111b0: 4420 746f 2079 6f75 7220 6461 7461 2e20  D to your data. 
+000111c0: 4265 7761 7265 2120 7468 6973 2063 616e  Beware! this can
+000111d0: 2064 6573 7472 6f79 2079 6f75 7220 696d   destroy your im
+000111e0: 6167 6573 0a20 2020 2020 2020 2069 6620  ages.        if 
+000111f0: 6e6f 7420 646f 6e65 2070 726f 7065 726c  not done properl
+00011200: 7921 204e 6f20 6775 6172 616e 7465 6520  y! No guarantee 
+00011210: 6973 2067 6976 656e 2069 7420 7769 6c6c  is given it will
+00011220: 2077 6f72 6b2e 2042 6520 6361 7265 6675   work. Be carefu
+00011230: 6c21 0a0a 2020 2020 2020 2020 5573 6520  l!..        Use 
+00011240: 636c 6561 6e3d 4661 6c73 6520 746f 206e  clean=False to n
+00011250: 6f74 2063 6865 636b 2074 686f 7365 2066  ot check those f
+00011260: 696c 6573 2061 6761 696e 2077 6869 6368  iles again which
+00011270: 2061 7265 2061 6c72 6561 6479 2066 6f75   are already fou
+00011280: 6e64 2069 6e20 696e 7465 726d 6564 6961  nd in intermedia
+00011290: 7465 2075 7569 6420 6669 6c65 0a20 2020  te uuid file.   
+000112a0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+000112b0: 2020 7575 6964 7320 3d20 7b7d 0a20 2020    uuids = {}.   
+000112c0: 2020 2020 2023 2043 6865 636b 2077 6865       # Check whe
+000112d0: 7468 6572 2061 2066 696c 6520 7769 7468  ther a file with
+000112e0: 2055 5549 4473 2065 7869 7374 732c 2074   UUIDs exists, t
+000112f0: 6865 6e20 7265 6164 2069 740a 2020 2020  hen read it.    
+00011300: 2020 2020 6966 206e 6f74 2063 6c65 616e      if not clean
+00011310: 2061 6e64 206f 732e 7061 7468 2e65 7869   and os.path.exi
+00011320: 7374 7328 7365 6c66 2e67 6574 5f69 6e74  sts(self.get_int
+00011330: 5f75 7569 645f 6669 6c65 2829 293a 0a20  _uuid_file()):. 
+00011340: 2020 2020 2020 2020 2020 2075 7569 6473             uuids
+00011350: 203d 206d 6971 7466 2e74 6162 4669 6c65   = miqtf.tabFile
+00011360: 4461 7461 2873 656c 662e 6765 745f 696e  Data(self.get_in
+00011370: 745f 7575 6964 5f66 696c 6528 292c 205b  t_uuid_file(), [
+00011380: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00011390: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
+000113a0: 5d2c 206d 6971 7476 2e63 6f6c 5f68 6561  ], miqtv.col_hea
+000113b0: 6465 725b 276d 6172 6971 7427 5d5b 2775  der['mariqt']['u
+000113c0: 7569 6427 5d5d 2c20 6b65 795f 636f 6c3d  uid']], key_col=
+000113d0: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+000113e0: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
+000113f0: 5d29 0a20 2020 2020 2020 2020 2020 200a  ]).            .
+00011400: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+00011410: 7468 2e65 7869 7374 7328 7365 6c66 2e69  th.exists(self.i
+00011420: 6d61 6765 7344 6972 293a 0a0a 2020 2020  magesDir):..    
+00011430: 2020 2020 2020 2020 6d69 7373 696e 675f          missing_
+00011440: 7575 6964 7320 3d20 7b7d 0a20 2020 2020  uuids = {}.     
+00011450: 2020 2020 2020 2061 6464 6564 5f75 7569         added_uui
+00011460: 6473 203d 2030 0a0a 2020 2020 2020 2020  ds = 0..        
+00011470: 2020 2020 756e 6b6e 6f77 6e46 696c 6573      unknownFiles
+00011480: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
+00011490: 2020 666f 7220 6669 6c65 2069 6e20 7365    for file in se
+000114a0: 6c66 2e69 6d61 6765 7349 6e49 6d61 6765  lf.imagesInImage
+000114b0: 7344 6972 2829 3a0a 2020 2020 2020 2020  sDir():.        
+000114c0: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
+000114d0: 6520 3d20 6f73 2e70 6174 682e 6261 7365  e = os.path.base
+000114e0: 6e61 6d65 2866 696c 6529 0a20 2020 2020  name(file).     
+000114f0: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
+00011500: 6c65 5f6e 616d 6520 6e6f 7420 696e 2075  le_name not in u
+00011510: 7569 6473 3a0a 2020 2020 2020 2020 2020  uids:.          
+00011520: 2020 2020 2020 2020 2020 756e 6b6e 6f77            unknow
+00011530: 6e46 696c 6573 2e61 7070 656e 6428 6669  nFiles.append(fi
+00011540: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
+00011550: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00011560: 2020 2020 2020 2020 2020 2020 2020 7575                uu
+00011570: 6964 735b 6669 6c65 5f6e 616d 655d 203d  ids[file_name] =
+00011580: 2075 7569 6473 5b66 696c 655f 6e61 6d65   uuids[file_name
+00011590: 5d5b 6d69 7174 762e 636f 6c5f 6865 6164  ][miqtv.col_head
+000115a0: 6572 5b27 6d61 7269 7174 275d 5b27 7575  er['mariqt']['uu
+000115b0: 6964 275d 5d0a 0a20 2020 2020 2020 2020  id']]..         
+000115c0: 2020 2075 6e6b 6e6f 776e 4669 6c65 7355     unknownFilesU
+000115d0: 5549 4473 203d 206d 6971 7469 2e69 6d61  UIDs = miqti.ima
+000115e0: 6765 7343 6f6e 7461 696e 5661 6c69 6455  gesContainValidU
+000115f0: 5549 4428 756e 6b6e 6f77 6e46 696c 6573  UID(unknownFiles
+00011600: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
+00011610: 7220 6669 6c65 2069 6e20 756e 6b6e 6f77  r file in unknow
+00011620: 6e46 696c 6573 5555 4944 733a 0a20 2020  nFilesUUIDs:.   
+00011630: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+00011640: 655f 6e61 6d65 203d 206f 732e 7061 7468  e_name = os.path
+00011650: 2e62 6173 656e 616d 6528 6669 6c65 290a  .basename(file).
+00011660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011670: 6966 206e 6f74 2075 6e6b 6e6f 776e 4669  if not unknownFi
+00011680: 6c65 7355 5549 4473 5b66 696c 655d 5b27  lesUUIDs[file]['
+00011690: 7661 6c69 6427 5d3a 0a20 2020 2020 2020  valid']:.       
+000116a0: 2020 2020 2020 2020 2020 2020 2075 7569               uui
+000116b0: 6420 3d20 6d69 7174 632e 7575 6964 3428  d = miqtc.uuid4(
+000116c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000116d0: 2020 2020 2020 6d69 7373 696e 675f 7575        missing_uu
+000116e0: 6964 735b 6669 6c65 5d20 3d20 7575 6964  ids[file] = uuid
+000116f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011700: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00011710: 2020 2020 2020 2020 2020 2075 7569 6473             uuids
+00011720: 5b66 696c 655f 6e61 6d65 5d20 3d20 756e  [file_name] = un
+00011730: 6b6e 6f77 6e46 696c 6573 5555 4944 735b  knownFilesUUIDs[
+00011740: 6669 6c65 5d5b 2775 7569 6427 5d0a 2020  file]['uuid'].  
+00011750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011760: 2020 6164 6465 645f 7575 6964 7320 2b3d    added_uuids +=
+00011770: 2031 0a0a 2020 2020 2020 2020 2020 2020   1..            
+00011780: 2320 4966 2070 7265 7669 6f75 736c 7920  # If previously 
+00011790: 756e 6b6e 6f77 6e20 5555 4944 7320 7765  unknown UUIDs we
+000117a0: 7265 2066 6f75 6e64 2069 6e20 7468 6520  re found in the 
+000117b0: 6669 6c65 2068 6561 6465 7273 2c20 6164  file headers, ad
+000117c0: 6420 7468 656d 2074 6f20 7468 6520 5555  d them to the UU
+000117d0: 4944 2066 696c 650a 2020 2020 2020 2020  ID file.        
+000117e0: 2020 2020 6966 2061 6464 6564 5f75 7569      if added_uui
+000117f0: 6473 203e 2030 3a0a 2020 2020 2020 2020  ds > 0:.        
+00011800: 2020 2020 2020 2020 7265 7320 3d20 6f70          res = op
+00011810: 656e 2873 656c 662e 6765 745f 696e 745f  en(self.get_int_
+00011820: 7575 6964 5f66 696c 6528 292c 2022 7722  uuid_file(), "w"
+00011830: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00011840: 2020 7265 732e 7772 6974 6528 6d69 7174    res.write(miqt
+00011850: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+00011860: 7269 7174 275d 5b27 696d 6727 5d20 2b22  riqt']['img'] +"
+00011870: 5c74 222b 6d69 7174 762e 636f 6c5f 6865  \t"+miqtv.col_he
+00011880: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00011890: 7575 6964 275d 2b22 5c6e 2229 0a20 2020  uuid']+"\n").   
+000118a0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+000118b0: 2066 696c 6520 696e 2075 7569 6473 3a0a   file in uuids:.
+000118c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000118d0: 2020 2020 7265 732e 7772 6974 6528 6669      res.write(fi
+000118e0: 6c65 2b22 5c74 222b 7374 7228 7575 6964  le+"\t"+str(uuid
+000118f0: 735b 6669 6c65 5d29 2b22 5c6e 2229 0a20  s[file])+"\n"). 
+00011900: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00011910: 6573 2e63 6c6f 7365 2829 0a0a 2020 2020  es.close()..    
+00011920: 2020 2020 2020 2020 6966 206c 656e 286d          if len(m
+00011930: 6973 7369 6e67 5f75 7569 6473 2920 3e20  issing_uuids) > 
+00011940: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+00011950: 2020 2065 6373 765f 7061 7468 203d 2073     ecsv_path = s
+00011960: 656c 662e 5f5f 6765 745f 696e 745f 6669  elf.__get_int_fi
+00011970: 6c65 5f70 7265 6669 7828 2920 2b20 225f  le_prefix() + "_
+00011980: 6578 6966 2d61 6464 2d75 7569 642e 6373  exif-add-uuid.cs
+00011990: 7622 0a20 2020 2020 2020 2020 2020 2020  v".             
+000119a0: 2020 2063 7376 203d 206f 7065 6e28 6563     csv = open(ec
+000119b0: 7376 5f70 6174 682c 2022 7722 290a 2020  sv_path, "w").  
+000119c0: 2020 2020 2020 2020 2020 2020 2020 6373                cs
+000119d0: 762e 7772 6974 6528 6d69 7174 762e 636f  v.write(miqtv.co
+000119e0: 6c5f 6865 6164 6572 5b27 6578 6966 275d  l_header['exif']
+000119f0: 5b27 696d 6727 5d20 2b0a 2020 2020 2020  ['img'] +.      
+00011a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a10: 2020 2020 222c 222b 6d69 7174 762e 636f      ","+miqtv.co
+00011a20: 6c5f 6865 6164 6572 5b27 6578 6966 275d  l_header['exif']
+00011a30: 5b27 7575 6964 275d 2b22 5c6e 2229 0a20  ['uuid']+"\n"). 
+00011a40: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00011a50: 6966 6665 7265 6e74 5f70 6174 6873 203d  ifferent_paths =
+00011a60: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+00011a70: 2020 2020 666f 7220 696d 6720 696e 206d      for img in m
+00011a80: 6973 7369 6e67 5f75 7569 6473 3a0a 2020  issing_uuids:.  
+00011a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011aa0: 2020 6966 206f 732e 7061 7468 2e62 6173    if os.path.bas
+00011ab0: 656e 616d 6528 696d 6729 206e 6f74 2069  ename(img) not i
+00011ac0: 6e20 6469 6666 6572 656e 745f 7061 7468  n different_path
+00011ad0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00011ae0: 2020 2020 2020 2020 2020 2064 6966 6665             diffe
+00011af0: 7265 6e74 5f70 6174 6873 2e61 7070 656e  rent_paths.appen
+00011b00: 6428 6f73 2e70 6174 682e 6261 7365 6e61  d(os.path.basena
+00011b10: 6d65 2869 6d67 2929 0a20 2020 2020 2020  me(img)).       
+00011b20: 2020 2020 2020 2020 2020 2020 2063 7376               csv
+00011b30: 2e77 7269 7465 2869 6d67 2b22 2c22 2b73  .write(img+","+s
+00011b40: 7472 286d 6973 7369 6e67 5f75 7569 6473  tr(missing_uuids
+00011b50: 5b69 6d67 5d29 2b22 5c6e 2229 0a20 2020  [img])+"\n").   
+00011b60: 2020 2020 2020 2020 2020 2020 2023 7265               #re
+00011b70: 7475 726e 2046 616c 7365 2c20 2265 7869  turn False, "exi
+00011b80: 6674 6f6f 6c20 2d63 7376 3d22 2b65 6373  ftool -csv="+ecs
+00011b90: 765f 7061 7468 2b22 2022 2b22 2022 2e6a  v_path+" "+" ".j
+00011ba0: 6f69 6e28 6469 6666 6572 656e 745f 7061  oin(different_pa
+00011bb0: 7468 7329 0a20 2020 2020 2020 2020 2020  ths).           
+00011bc0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00011bd0: 652c 2022 4e6f 7420 616c 6c20 696d 6167  e, "Not all imag
+00011be0: 6573 2068 6176 6520 7661 6c69 6420 5555  es have valid UU
+00011bf0: 4944 732e 204d 6973 7369 6e67 2066 6f72  IDs. Missing for
+00011c00: 2066 6f6c 6c6f 7769 6e67 2066 696c 6573   following files
+00011c10: 3a5c 6e22 2b22 5cc5 8622 2e6a 6f69 6e28  :\n"+"\..".join(
+00011c20: 6469 6666 6572 656e 745f 7061 7468 7329  different_paths)
+00011c30: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+00011c40: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00011c50: 5f61 6c6c 5555 4944 7343 6865 636b 6564  _allUUIDsChecked
+00011c60: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+00011c70: 2020 2020 7265 7475 726e 2054 7275 652c      return True,
+00011c80: 2022 416c 6c20 696d 6167 6573 2068 6176   "All images hav
+00011c90: 6520 6120 5555 4944 220a 2020 2020 2020  e a UUID".      
+00011ca0: 2020 7265 7475 726e 2046 616c 7365 2c20    return False, 
+00011cb0: 2250 6174 6820 222b 7365 6c66 2e69 6d61  "Path "+self.ima
+00011cc0: 6765 7344 6972 202b 2022 206e 6f74 2066  gesDir + " not f
+00011cd0: 6f75 6e64 2e22 0a0a 2020 2020 6465 6620  ound."..    def 
+00011ce0: 6372 6561 7465 5555 4944 4669 6c65 2873  createUUIDFile(s
+00011cf0: 656c 662c 636c 6561 6e3d 5472 7565 293a  elf,clean=True):
+00011d00: 0a20 2020 2020 2020 2022 2222 2044 6570  .        """ Dep
+00011d10: 7265 6361 7465 6420 2d20 7573 6520 6372  recated - use cr
+00011d20: 6561 7465 5f75 7569 645f 6669 6c65 2022  eate_uuid_file "
+00011d30: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+00011d40: 6e20 7365 6c66 2e63 7265 6174 655f 7575  n self.create_uu
+00011d50: 6964 5f66 696c 6528 636c 6561 6e29 0a0a  id_file(clean)..
+00011d60: 0a20 2020 2064 6566 2073 6574 5f69 6d61  .    def set_ima
+00011d70: 6765 5f73 6574 5f61 7474 6974 7564 6528  ge_set_attitude(
+00011d80: 7365 6c66 2c79 6177 5f66 7261 6d65 3a66  self,yaw_frame:f
+00011d90: 6c6f 6174 2c70 6974 6368 5f66 7261 6d65  loat,pitch_frame
+00011da0: 3a66 6c6f 6174 2c72 6f6c 6c5f 6672 616d  :float,roll_fram
+00011db0: 653a 666c 6f61 742c 7961 775f 6361 6d32  e:float,yaw_cam2
+00011dc0: 6672 616d 653a 666c 6f61 742c 7069 7463  frame:float,pitc
+00011dd0: 685f 6361 6d32 6672 616d 653a 666c 6f61  h_cam2frame:floa
+00011de0: 742c 726f 6c6c 5f63 616d 3266 7261 6d65  t,roll_cam2frame
+00011df0: 3a66 6c6f 6174 293a 0a20 2020 2020 2020  :float):.       
+00011e00: 2022 2222 2063 616c 6375 6c61 7465 7320   """ calculates 
+00011e10: 7468 6520 7468 6520 6361 6d65 7261 7320  the the cameras 
+00011e20: 6162 736f 6c75 7465 2061 7474 6974 7564  absolute attitud
+00011e30: 6520 616e 6420 7365 7473 2069 7420 746f  e and sets it to
+00011e40: 2069 6d61 6765 2073 6574 2068 6561 6465   image set heade
+00011e50: 722e 2041 6c6c 2061 6e67 6c65 7320 6172  r. All angles ar
+00011e60: 6520 6578 7065 6374 6564 2069 6e20 6465  e expected in de
+00011e70: 6772 6565 732e 200a 2020 2020 2020 2020  grees. .        
+00011e80: 6361 6d65 7261 3266 7261 6d65 2061 6e67  camera2frame ang
+00011e90: 6c65 733a 2072 6f74 6174 696f 6e20 6f66  les: rotation of
+00011ea0: 2063 616d 6572 6120 636f 6f72 6469 6e61   camera coordina
+00011eb0: 7465 7320 2878 2c79 2c7a 203d 2074 6f70  tes (x,y,z = top
+00011ec0: 2c20 7269 6768 742c 206c 696e 6520 6f66  , right, line of
+00011ed0: 2073 6967 6874 2920 7769 7468 2072 6573   sight) with res
+00011ee0: 7065 6374 2074 6f20 7665 6869 636c 6520  pect to vehicle 
+00011ef0: 636f 6f72 6469 6e61 7465 7320 2878 2c79  coordinates (x,y
+00011f00: 2c7a 203d 2066 6f72 7761 7264 2c72 6967  ,z = forward,rig
+00011f10: 6874 2c64 6f77 6e29 200a 2020 2020 2020  ht,down) .      
+00011f20: 2020 696e 2061 6363 6f72 6461 6e63 6520    in accordance 
+00011f30: 7769 7468 2074 6865 2079 6177 2c70 6974  with the yaw,pit
+00011f40: 6368 2c72 6f6c 6c20 726f 7461 7469 6f6e  ch,roll rotation
+00011f50: 206f 7264 6572 2063 6f6e 7665 6e74 696f   order conventio
+00011f60: 6e3a 0a0a 2020 2020 2020 2020 312e 2079  n:..        1. y
+00011f70: 6177 2061 726f 756e 6420 7a2c 0a20 2020  aw around z,.   
+00011f80: 2020 2020 2032 2e20 7069 7463 6820 6172       2. pitch ar
+00011f90: 6f75 6e64 2072 6f74 6174 6564 2079 2c0a  ound rotated y,.
+00011fa0: 2020 2020 2020 2020 332e 2072 6f6c 6c20          3. roll 
+00011fb0: 6172 6f75 6e64 2072 6f74 6174 6564 2078  around rotated x
+00011fc0: 0a0a 2020 2020 2020 2020 526f 7461 7469  ..        Rotati
+00011fd0: 6f6e 2064 6972 6563 7469 6f6e 7320 6163  on directions ac
+00011fe0: 636f 7264 696e 6720 746f 205c 2772 6967  cording to \'rig
+00011ff0: 6874 2d68 616e 6420 7275 6c65 5c27 2e0a  ht-hand rule\'..
+00012000: 0a20 2020 2020 2020 2049 2e65 2e20 6361  .        I.e. ca
+00012010: 6d65 7261 3246 7261 6d65 2061 6e67 6c65  mera2Frame angle
+00012020: 7320 3d20 302c 302c 3020 6361 6d65 7261  s = 0,0,0 camera
+00012030: 2069 7320 6661 6369 6e67 2064 6f77 6e77   is facing downw
+00012040: 6172 6420 7769 7468 2074 6f70 2073 6964  ard with top sid
+00012050: 6520 746f 7761 7264 7320 7665 6869 636c  e towards vehicl
+00012060: 6527 7320 666f 7277 6172 6420 6469 7265  e's forward dire
+00012070: 6374 696f 6e27 2022 2222 0a0a 2020 2020  ction' """..    
+00012080: 2020 2020 525f 6672 616d 6532 6e65 6420      R_frame2ned 
+00012090: 3d20 6d69 7174 672e 525f 5961 7750 6974  = miqtg.R_YawPit
+000120a0: 6368 526f 6c6c 2879 6177 5f66 7261 6d65  chRoll(yaw_frame
+000120b0: 2c70 6974 6368 5f66 7261 6d65 2c72 6f6c  ,pitch_frame,rol
+000120c0: 6c5f 6672 616d 6529 0a20 2020 2020 2020  l_frame).       
+000120d0: 2052 5f63 616d 3266 7261 6d65 203d 206d   R_cam2frame = m
+000120e0: 6971 7467 2e52 5f59 6177 5069 7463 6852  iqtg.R_YawPitchR
+000120f0: 6f6c 6c28 7961 775f 6361 6d32 6672 616d  oll(yaw_cam2fram
+00012100: 652c 7069 7463 685f 6361 6d32 6672 616d  e,pitch_cam2fram
+00012110: 652c 726f 6c6c 5f63 616d 3266 7261 6d65  e,roll_cam2frame
+00012120: 290a 2020 2020 2020 2020 525f 6361 6d32  ).        R_cam2
+00012130: 6e65 6420 3d20 525f 6672 616d 6532 6e65  ned = R_frame2ne
+00012140: 642e 646f 7428 525f 6361 6d32 6672 616d  d.dot(R_cam2fram
+00012150: 6529 0a20 2020 2020 2020 2079 6177 2c70  e).        yaw,p
+00012160: 6974 6368 2c72 6f6c 6c20 3d20 6d69 7174  itch,roll = miqt
+00012170: 672e 7961 7750 6974 6368 526f 6c6c 2852  g.yawPitchRoll(R
+00012180: 5f63 616d 326e 6564 290a 0a20 2020 2020  _cam2ned)..     
+00012190: 2020 2023 2070 6f73 6520 6d61 7472 6978     # pose matrix
+000121a0: 2063 616d 3275 746d 0a20 2020 2020 2020   cam2utm.       
+000121b0: 2052 5f63 616d 5374 6432 7574 6d20 3d20   R_camStd2utm = 
+000121c0: 7365 6c66 2e67 6574 5f52 5f63 616d 5374  self.get_R_camSt
+000121d0: 6432 7574 6d28 525f 6361 6d32 6672 616d  d2utm(R_cam2fram
+000121e0: 652c 525f 6672 616d 6532 6e65 6429 0a0a  e,R_frame2ned)..
+000121f0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00012200: 2020 2020 7820 3d20 6e70 2e61 7272 6179      x = np.array
+00012210: 285b 312c 302c 305d 290a 2020 2020 2020  ([1,0,0]).      
+00012220: 2020 7920 3d20 6e70 2e61 7272 6179 285b    y = np.array([
+00012230: 302c 312c 305d 290a 2020 2020 2020 2020  0,1,0]).        
+00012240: 7a20 3d20 6e70 2e61 7272 6179 285b 302c  z = np.array([0,
+00012250: 302c 315d 290a 2020 2020 2020 2020 7072  0,1]).        pr
+00012260: 696e 7428 2778 272c 525f 6361 6d53 7464  int('x',R_camStd
+00012270: 3275 746d 2e64 6f74 2878 292e 726f 756e  2utm.dot(x).roun
+00012280: 6428 3529 290a 2020 2020 2020 2020 7072  d(5)).        pr
+00012290: 696e 7428 2779 272c 525f 6361 6d53 7464  int('y',R_camStd
+000122a0: 3275 746d 2e64 6f74 2879 292e 726f 756e  2utm.dot(y).roun
+000122b0: 6428 3529 290a 2020 2020 2020 2020 7072  d(5)).        pr
+000122c0: 696e 7428 277a 272c 525f 6361 6d53 7464  int('z',R_camStd
+000122d0: 3275 746d 2e64 6f74 287a 292e 726f 756e  2utm.dot(z).roun
+000122e0: 6428 3529 290a 2020 2020 2020 2020 2222  d(5)).        ""
+000122f0: 220a 0a20 2020 2020 2020 2068 6561 6465  "..        heade
+00012300: 7255 7064 6174 6520 3d20 7b0a 2020 2020  rUpdate = {.    
+00012310: 2020 2020 2020 2020 6d69 7174 762e 636f          miqtv.co
+00012320: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+00012330: 275d 5b27 7961 7727 5d3a 7961 772c 0a20  ']['yaw']:yaw,. 
+00012340: 2020 2020 2020 2020 2020 206d 6971 7476             miqtv
+00012350: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+00012360: 6971 7427 5d5b 2770 6974 6368 275d 3a70  iqt']['pitch']:p
+00012370: 6974 6368 2c0a 2020 2020 2020 2020 2020  itch,.          
+00012380: 2020 6d69 7174 762e 636f 6c5f 6865 6164    miqtv.col_head
+00012390: 6572 5b27 6d61 7269 7174 275d 5b27 726f  er['mariqt']['ro
+000123a0: 6c6c 275d 3a72 6f6c 6c2c 0a20 2020 2020  ll']:roll,.     
+000123b0: 2020 2020 2020 206d 6971 7476 2e63 6f6c         miqtv.col
+000123c0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+000123d0: 5d5b 2770 6f73 6527 5d3a 7b27 706f 7365  ]['pose']:{'pose
+000123e0: 2d61 6273 6f6c 7574 652d 6f72 6965 6e74  -absolute-orient
+000123f0: 6174 696f 6e2d 7574 6d2d 6d61 7472 6978  ation-utm-matrix
+00012400: 273a 525f 6361 6d53 7464 3275 746d 2e66  ':R_camStd2utm.f
+00012410: 6c61 7474 656e 2829 2e74 6f6c 6973 7428  latten().tolist(
+00012420: 297d 0a20 2020 2020 2020 207d 0a20 2020  )}.        }.   
+00012430: 2020 2020 2073 656c 662e 7570 6461 7465       self.update
+00012440: 5f69 6664 6f5f 6865 6164 6572 5f66 6965  _ifdo_header_fie
+00012450: 6c64 7328 6865 6164 6572 5570 6461 7465  lds(headerUpdate
+00012460: 290a 0a20 2020 2064 6566 2073 6574 496d  )..    def setIm
+00012470: 6167 6553 6574 4174 7469 7475 6465 2873  ageSetAttitude(s
+00012480: 656c 662c 7961 775f 6672 616d 653a 666c  elf,yaw_frame:fl
+00012490: 6f61 742c 7069 7463 685f 6672 616d 653a  oat,pitch_frame:
+000124a0: 666c 6f61 742c 726f 6c6c 5f66 7261 6d65  float,roll_frame
+000124b0: 3a66 6c6f 6174 2c79 6177 5f63 616d 3266  :float,yaw_cam2f
+000124c0: 7261 6d65 3a66 6c6f 6174 2c70 6974 6368  rame:float,pitch
+000124d0: 5f63 616d 3266 7261 6d65 3a66 6c6f 6174  _cam2frame:float
+000124e0: 2c72 6f6c 6c5f 6361 6d32 6672 616d 653a  ,roll_cam2frame:
+000124f0: 666c 6f61 7429 3a0a 2020 2020 2020 2020  float):.        
+00012500: 2222 2220 4465 7072 6563 6174 6564 202d  """ Deprecated -
+00012510: 2075 7365 2073 6574 5f69 6d61 6765 5f73   use set_image_s
+00012520: 6574 5f61 7474 6974 7564 6520 2222 220a  et_attitude """.
+00012530: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
+00012540: 5f69 6d61 6765 5f73 6574 5f61 7474 6974  _image_set_attit
+00012550: 7564 6528 7961 775f 6672 616d 652c 2070  ude(yaw_frame, p
+00012560: 6974 6368 5f66 7261 6d65 2c20 726f 6c6c  itch_frame, roll
+00012570: 5f66 7261 6d65 2c20 7961 775f 6361 6d32  _frame, yaw_cam2
+00012580: 6672 616d 652c 2070 6974 6368 5f63 616d  frame, pitch_cam
+00012590: 3266 7261 6d65 2c20 726f 6c6c 5f63 616d  2frame, roll_cam
+000125a0: 3266 7261 6d65 290a 0a0a 2020 2020 6465  2frame)...    de
+000125b0: 6620 6372 6561 7465 5f69 6d61 6765 5f61  f create_image_a
+000125c0: 7474 6974 7564 655f 6669 6c65 2873 656c  ttitude_file(sel
+000125d0: 662c 2061 7474 5f70 6174 683a 7374 722c  f, att_path:str,
+000125e0: 2066 7261 6d65 5f61 7474 5f68 6561 6465   frame_att_heade
+000125f0: 723a 6469 6374 2c20 6361 6d65 7261 3246  r:dict, camera2F
+00012600: 7261 6d65 5f79 6177 3a66 6c6f 6174 2c63  rame_yaw:float,c
+00012610: 616d 6572 6132 4672 616d 655f 7069 7463  amera2Frame_pitc
+00012620: 683a 666c 6f61 742c 6361 6d65 7261 3246  h:float,camera2F
+00012630: 7261 6d65 5f72 6f6c 6c3a 666c 6f61 742c  rame_roll:float,
+00012640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012660: 2064 6174 655f 666f 726d 6174 3d6d 6971   date_format=miq
+00012670: 7476 2e64 6174 655f 666f 726d 6174 735b  tv.date_formats[
+00012680: 2770 616e 6761 6561 275d 2c20 636f 6e73  'pangaea'], cons
+00012690: 745f 7661 6c75 6573 203d 207b 7d2c 206f  t_values = {}, o
+000126a0: 7665 7277 7269 7465 3d46 616c 7365 2c20  verwrite=False, 
+000126b0: 636f 6c5f 7365 7061 7261 746f 7220 3d20  col_separator = 
+000126c0: 225c 7422 2c0a 2020 2020 2020 2020 2020  "\t",.          
+000126d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000126e0: 2020 2020 2020 6174 745f 7061 7468 5f61        att_path_a
+000126f0: 6e67 6c65 735f 696e 5f72 6164 203d 2046  ngles_in_rad = F
+00012700: 616c 7365 2c20 7669 6465 6f53 616d 706c  alse, videoSampl
+00012710: 6553 6563 6f6e 6473 3d31 2c72 6563 6f72  eSeconds=1,recor
+00012720: 6473 3262 6549 6e76 6572 7465 643d 5b5d  ds2beInverted=[]
+00012730: 293a 0a20 2020 2020 2020 2022 2222 2043  ):.        """ C
+00012740: 7265 6174 6573 2069 6e20 2f69 6e74 6572  reates in /inter
+00012750: 6d65 6469 6174 6520 6120 7465 7874 2066  mediate a text f
+00012760: 696c 6520 7769 7468 2063 616d 6572 6120  ile with camera 
+00012770: 6174 7469 7475 6465 2064 6174 6120 666f  attitude data fo
+00012780: 7220 6561 6368 2069 6d61 6765 2e20 416c  r each image. Al
+00012790: 6c20 616e 676c 6573 2061 7265 2065 7870  l angles are exp
+000127a0: 6563 7465 6420 696e 2064 6567 7265 6573  ected in degrees
+000127b0: 2e20 5573 6520 6174 745f 7061 7468 5f61  . Use att_path_a
+000127c0: 6e67 6c65 735f 696e 5f72 6164 2069 6620  ngles_in_rad if 
+000127d0: 6e65 6365 7373 6172 792e 200a 2020 2020  necessary. .    
+000127e0: 2020 2020 6361 6d65 7261 3246 7261 6d65      camera2Frame
+000127f0: 2061 6e67 6c65 733a 2072 6f74 6174 696f   angles: rotatio
+00012800: 6e20 6f66 2063 616d 6572 6120 636f 6f72  n of camera coor
+00012810: 6469 6e61 7465 7320 2878 2c79 2c7a 203d  dinates (x,y,z =
+00012820: 2074 6f70 2c20 7269 6768 742c 206c 696e   top, right, lin
+00012830: 6520 6f66 2073 6967 6874 2920 7769 7468  e of sight) with
+00012840: 2072 6573 7065 6374 2074 6f20 7665 6869   respect to vehi
+00012850: 636c 6520 636f 6f72 6469 6e61 7465 7320  cle coordinates 
+00012860: 2878 2c79 2c7a 203d 2066 6f72 7761 7264  (x,y,z = forward
+00012870: 2c72 6967 6874 2c64 6f77 6e29 200a 2020  ,right,down) .  
+00012880: 2020 2020 2020 696e 2061 6363 6f72 6461        in accorda
+00012890: 6e63 6520 7769 7468 2074 6865 2079 6177  nce with the yaw
+000128a0: 2c70 6974 6368 2c72 6f6c 6c20 726f 7461  ,pitch,roll rota
+000128b0: 7469 6f6e 206f 7264 6572 2063 6f6e 7665  tion order conve
+000128c0: 6e74 696f 6e3a 0a20 2020 2020 2020 2031  ntion:.        1
+000128d0: 2e20 7961 7720 6172 6f75 6e64 207a 2c0a  . yaw around z,.
+000128e0: 2020 2020 2020 2020 322e 2070 6974 6368          2. pitch
+000128f0: 2061 726f 756e 6420 726f 7461 7465 6420   around rotated 
+00012900: 792c 0a20 2020 2020 2020 2033 2e20 726f  y,.        3. ro
+00012910: 6c6c 2061 726f 756e 6420 726f 7461 7465  ll around rotate
+00012920: 6420 780a 0a20 2020 2020 2020 2052 6f74  d x..        Rot
+00012930: 6174 696f 6e20 6469 7265 6374 696f 6e73  ation directions
+00012940: 2061 6363 6f72 6469 6e67 2074 6f20 5c27   according to \'
+00012950: 7269 6768 742d 6861 6e64 2072 756c 655c  right-hand rule\
+00012960: 272e 0a0a 2020 2020 2020 2020 492e 652e  '...        I.e.
+00012970: 2063 616d 6572 6132 4672 616d 6520 616e   camera2Frame an
+00012980: 676c 6573 203d 2030 2c30 2c30 2063 616d  gles = 0,0,0 cam
+00012990: 6572 6120 6973 2066 6163 696e 6720 646f  era is facing do
+000129a0: 776e 7761 7264 2077 6974 6820 746f 7020  wnward with top 
+000129b0: 7369 6465 2074 6f77 6172 6473 2076 6568  side towards veh
+000129c0: 6963 6c65 2773 2066 6f72 7761 7264 2064  icle's forward d
+000129d0: 6972 6563 7469 6f6e 2720 2222 220a 0a20  irection' """.. 
+000129e0: 2020 2020 2020 2069 6e74 5f61 7474 7574         int_attut
+000129f0: 7564 655f 6669 6c65 203d 2073 656c 662e  ude_file = self.
+00012a00: 5f5f 6765 745f 696e 745f 6669 6c65 5f70  __get_int_file_p
+00012a10: 7265 6669 7828 2920 2b20 275f 696d 6167  refix() + '_imag
+00012a20: 652d 6174 7469 7475 6465 2e74 7874 270a  e-attitude.txt'.
+00012a30: 2020 2020 2020 2020 6f75 7470 7574 5f68          output_h
+00012a40: 6561 6465 725f 6174 7420 3d20 7b20 2020  eader_att = {   
+00012a50: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00012a60: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
+00012a70: 5d3a 2020 6d69 7174 762e 636f 6c5f 6865  ]:  miqtv.col_he
+00012a80: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00012a90: 696d 6727 5d2c 0a20 2020 2020 2020 2020  img'],.         
+00012aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ab0: 2020 2020 2020 206d 6971 7476 2e63 6f6c         miqtv.col
+00012ac0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00012ad0: 5d5b 2775 7463 275d 3a6d 6971 7476 2e63  ]['utc']:miqtv.c
+00012ae0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+00012af0: 7427 5d5b 2775 7463 275d 2c0a 2020 2020  t']['utc'],.    
+00012b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012b10: 2020 2020 2020 2020 2020 2020 6d69 7174              miqt
+00012b20: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+00012b30: 7269 7174 275d 5b27 7961 7727 5d3a 6d69  riqt']['yaw']:mi
+00012b40: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+00012b50: 6d61 7269 7174 275d 5b27 7961 7727 5d2c  mariqt']['yaw'],
+00012b60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012b80: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
+00012b90: 725b 276d 6172 6971 7427 5d5b 2770 6974  r['mariqt']['pit
+00012ba0: 6368 275d 3a6d 6971 7476 2e63 6f6c 5f68  ch']:miqtv.col_h
+00012bb0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00012bc0: 2770 6974 6368 275d 2c0a 2020 2020 2020  'pitch'],.      
+00012bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012be0: 2020 2020 2020 2020 2020 6d69 7174 762e            miqtv.
+00012bf0: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+00012c00: 7174 275d 5b27 726f 6c6c 275d 3a6d 6971  qt']['roll']:miq
+00012c10: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+00012c20: 6172 6971 7427 5d5b 2772 6f6c 6c27 5d2c  ariqt']['roll'],
+00012c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012c40: 2020 2020 2020 2020 2020 2020 207d 0a0a               }..
+00012c50: 2020 2020 2020 2020 696e 745f 706f 7365          int_pose
+00012c60: 5f66 696c 6520 3d20 7365 6c66 2e5f 5f67  _file = self.__g
+00012c70: 6574 5f69 6e74 5f66 696c 655f 7072 6566  et_int_file_pref
+00012c80: 6978 2829 202b 2027 5f69 6d61 6765 2d63  ix() + '_image-c
+00012c90: 616d 6572 612d 706f 7365 2e74 7874 270a  amera-pose.txt'.
+00012ca0: 2020 2020 2020 2020 6f75 7470 7574 5f68          output_h
+00012cb0: 6561 6465 725f 706f 7365 203d 207b 2020  eader_pose = {  
+00012cc0: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00012cd0: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
+00012ce0: 5d3a 6d69 7174 762e 636f 6c5f 6865 6164  ]:miqtv.col_head
+00012cf0: 6572 5b27 6d61 7269 7174 275d 5b27 696d  er['mariqt']['im
+00012d00: 6727 5d2c 0a20 2020 2020 2020 2020 2020  g'],.           
+00012d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012d20: 2020 2020 206d 6971 7476 2e63 6f6c 5f68       miqtv.col_h
+00012d30: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00012d40: 2775 7463 275d 3a6d 6971 7476 2e63 6f6c  'utc']:miqtv.col
+00012d50: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00012d60: 5d5b 2775 7463 275d 2c0a 2020 2020 2020  ]['utc'],.      
+00012d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012d80: 2020 2020 2020 2020 2020 6d69 7174 762e            miqtv.
+00012d90: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+00012da0: 7174 275d 5b27 706f 7365 275d 3a6d 6971  qt']['pose']:miq
+00012db0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+00012dc0: 6172 6971 7427 5d5b 2770 6f73 6527 5d2c  ariqt']['pose'],
+00012dd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012de0: 2020 2020 2020 2020 2020 2020 207d 0a0a               }..
+00012df0: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+00012e00: 7468 2e65 7869 7374 7328 696e 745f 6174  th.exists(int_at
+00012e10: 7475 7475 6465 5f66 696c 6529 2061 6e64  tutude_file) and
+00012e20: 206e 6f74 206f 7665 7277 7269 7465 3a0a   not overwrite:.
+00012e30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00012e40: 2e61 6464 5f69 7465 6d5f 696e 666f 5f74  .add_item_info_t
+00012e50: 6162 5f66 696c 6528 696e 745f 6174 7475  ab_file(int_attu
+00012e60: 7475 6465 5f66 696c 652c 225c 7422 2c6f  tude_file,"\t",o
+00012e70: 7574 7075 745f 6865 6164 6572 5f61 7474  utput_header_att
+00012e80: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00012e90: 7475 726e 2054 7275 652c 2022 4f75 7470  turn True, "Outp
+00012ea0: 7574 2066 696c 6520 6578 6973 7473 3a20  ut file exists: 
+00012eb0: 222b 696e 745f 6174 7475 7475 6465 5f66  "+int_attutude_f
+00012ec0: 696c 650a 0a20 2020 2020 2020 2069 6620  ile..        if 
+00012ed0: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
+00012ee0: 7473 2861 7474 5f70 6174 6829 3a0a 2020  ts(att_path):.  
+00012ef0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00012f00: 2046 616c 7365 2c20 224e 6176 6967 6174   False, "Navigat
+00012f10: 696f 6e20 6669 6c65 206e 6f74 2066 6f75  ion file not fou
+00012f20: 6e64 3a20 222b 6174 745f 7061 7468 0a0a  nd: "+att_path..
+00012f30: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
+00012f40: 732e 7061 7468 2e65 7869 7374 7328 7365  s.path.exists(se
+00012f50: 6c66 2e69 6d61 6765 7344 6972 293a 0a20  lf.imagesDir):. 
+00012f60: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00012f70: 6e20 4661 6c73 652c 2022 496d 6167 6520  n False, "Image 
+00012f80: 666f 6c64 6572 206e 6f74 2066 6f75 6e64  folder not found
+00012f90: 3a20 222b 2073 656c 662e 696d 6167 6573  : "+ self.images
+00012fa0: 4469 720a 0a20 2020 2020 2020 2073 203d  Dir..        s =
+00012fb0: 206d 6971 7463 2e50 7269 6e74 4c6f 6164   miqtc.PrintLoad
+00012fc0: 696e 674d 7367 2822 4372 6561 7469 6e67  ingMsg("Creating
+00012fd0: 2069 7465 6d73 2720 6174 7469 7475 6465   items' attitude
+00012fe0: 2064 6174 6122 290a 0a20 2020 2020 2020   data")..       
+00012ff0: 2023 206c 6f61 6420 6672 616d 6520 6174   # load frame at
+00013000: 7469 7475 6465 2064 6174 6120 6672 6f6d  titude data from
+00013010: 2066 696c 650a 2020 2020 2020 2020 6174   file.        at
+00013020: 745f 6461 7461 2c20 7061 7273 654d 7367  t_data, parseMsg
+00013030: 203d 206d 6971 746e 2e72 6561 6441 6c6c   = miqtn.readAll
+00013040: 4174 7469 7475 6465 7346 726f 6d46 696c  AttitudesFromFil
+00013050: 6550 6174 6828 6174 745f 7061 7468 2c20  ePath(att_path, 
+00013060: 6672 616d 655f 6174 745f 6865 6164 6572  frame_att_header
+00013070: 2c20 6461 7465 5f66 6f72 6d61 742c 636f  , date_format,co
+00013080: 6c5f 7365 7061 7261 746f 723d 636f 6c5f  l_separator=col_
+00013090: 7365 7061 7261 746f 722c 636f 6e73 745f  separator,const_
+000130a0: 7661 6c75 6573 3d63 6f6e 7374 5f76 616c  values=const_val
+000130b0: 7565 732c 616e 676c 6573 496e 5261 643d  ues,anglesInRad=
+000130c0: 6174 745f 7061 7468 5f61 6e67 6c65 735f  att_path_angles_
+000130d0: 696e 5f72 6164 290a 2020 2020 2020 2020  in_rad).        
+000130e0: 6966 2070 6172 7365 4d73 6720 213d 2022  if parseMsg != "
+000130f0: 223a 0a20 2020 2020 2020 2020 2020 2073  ":.            s
+00013100: 656c 662e 7072 6f76 2e6c 6f67 2870 6172  elf.prov.log(par
+00013110: 7365 4d73 672c 646f 6e74 5368 6f77 3d54  seMsg,dontShow=T
+00013120: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+00013130: 2070 6172 7365 4d73 6720 3d20 225c 6e22   parseMsg = "\n"
+00013140: 202b 2070 6172 7365 4d73 670a 0a20 2020   + parseMsg..   
+00013150: 2020 2020 2023 2066 696e 6420 666f 7220       # find for 
+00013160: 6561 6368 2069 6d61 6765 2074 6865 2072  each image the r
+00013170: 6573 7065 6374 6976 6520 6e61 7669 6761  espective naviga
+00013180: 7469 6f6e 2064 6174 610a 2020 2020 2020  tion data.      
+00013190: 2020 732e 7374 6f70 2829 0a20 2020 2020    s.stop().     
+000131a0: 2020 2073 7563 6365 7373 2c20 696d 6167     success, imag
+000131b0: 655f 6474 732c 206d 7367 203d 2073 656c  e_dts, msg = sel
+000131c0: 662e 6669 6e64 4e61 7644 6174 6146 6f72  f.findNavDataFor
+000131d0: 496d 6167 6528 6174 745f 6461 7461 2c76  Image(att_data,v
+000131e0: 6964 656f 5361 6d70 6c65 5365 636f 6e64  ideoSampleSecond
+000131f0: 7329 0a20 2020 2020 2020 2069 6620 6e6f  s).        if no
+00013200: 7420 7375 6363 6573 733a 0a20 2020 2020  t success:.     
+00013210: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+00013220: 6c73 652c 206d 7367 202b 2070 6172 7365  lse, msg + parse
+00013230: 4d73 670a 2020 2020 2020 2020 7320 3d20  Msg.        s = 
+00013240: 6d69 7174 632e 5072 696e 744c 6f61 6469  miqtc.PrintLoadi
+00013250: 6e67 4d73 6728 2243 7265 6174 696e 6720  ngMsg("Creating 
+00013260: 6974 656d 7327 2061 7474 6974 7564 6520  items' attitude 
+00013270: 6461 7461 2229 0a0a 2020 2020 2020 2020  data")..        
+00013280: 2320 6164 6420 6361 6d65 7261 3246 7261  # add camera2Fra
+00013290: 6d65 2061 6e67 6c65 730a 2020 2020 2020  me angles.      
+000132a0: 2020 525f 6361 6d32 6672 616d 6520 3d20    R_cam2frame = 
+000132b0: 6d69 7174 672e 525f 5961 7750 6974 6368  miqtg.R_YawPitch
+000132c0: 526f 6c6c 2863 616d 6572 6132 4672 616d  Roll(camera2Fram
+000132d0: 655f 7961 772c 6361 6d65 7261 3246 7261  e_yaw,camera2Fra
+000132e0: 6d65 5f70 6974 6368 2c63 616d 6572 6132  me_pitch,camera2
+000132f0: 4672 616d 655f 726f 6c6c 290a 2020 2020  Frame_roll).    
+00013300: 2020 2020 525f 6361 6d32 7574 6d5f 6c69      R_cam2utm_li
+00013310: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
+00013320: 666f 7220 6669 6c65 2069 6e20 696d 6167  for file in imag
+00013330: 655f 6474 733a 0a20 2020 2020 2020 2020  e_dts:.         
+00013340: 2020 2066 6f72 2074 696d 6570 6f69 6e74     for timepoint
+00013350: 2069 6e20 696d 6167 655f 6474 735b 6669   in image_dts[fi
+00013360: 6c65 5d3a 0a20 2020 2020 2020 2020 2020  le]:.           
+00013370: 2020 2020 2061 7474 6974 7564 6520 3d20       attitude = 
+00013380: 7469 6d65 706f 696e 740a 2020 2020 2020  timepoint.      
+00013390: 2020 2020 2020 2020 2020 6966 2061 7474            if att
+000133a0: 6974 7564 652e 7961 7720 6973 204e 6f6e  itude.yaw is Non
+000133b0: 6520 6f72 2061 7474 6974 7564 652e 7069  e or attitude.pi
+000133c0: 7463 6820 6973 204e 6f6e 6520 6f72 2061  tch is None or a
+000133d0: 7474 6974 7564 652e 726f 6c6c 2069 7320  ttitude.roll is 
+000133e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000133f0: 2020 2020 2020 2020 2020 525f 6361 6d32            R_cam2
+00013400: 7574 6d5f 6c69 7374 2e61 7070 656e 6428  utm_list.append(
+00013410: 2222 290a 2020 2020 2020 2020 2020 2020  "").            
+00013420: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+00013430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013440: 2052 5f66 7261 6d65 326e 6564 203d 206d   R_frame2ned = m
+00013450: 6971 7467 2e52 5f59 6177 5069 7463 6852  iqtg.R_YawPitchR
+00013460: 6f6c 6c28 6174 7469 7475 6465 2e79 6177  oll(attitude.yaw
+00013470: 2c61 7474 6974 7564 652e 7069 7463 682c  ,attitude.pitch,
+00013480: 6174 7469 7475 6465 2e72 6f6c 6c29 0a20  attitude.roll). 
+00013490: 2020 2020 2020 2020 2020 2020 2020 2052                 R
+000134a0: 5f63 616d 326e 6564 203d 2052 5f66 7261  _cam2ned = R_fra
+000134b0: 6d65 326e 6564 2e64 6f74 2852 5f63 616d  me2ned.dot(R_cam
+000134c0: 3266 7261 6d65 290a 2020 2020 2020 2020  2frame).        
+000134d0: 2020 2020 2020 2020 7961 772c 7069 7463          yaw,pitc
+000134e0: 682c 726f 6c6c 203d 206d 6971 7467 2e79  h,roll = miqtg.y
+000134f0: 6177 5069 7463 6852 6f6c 6c28 525f 6361  awPitchRoll(R_ca
+00013500: 6d32 6e65 6429 0a20 2020 2020 2020 2020  m2ned).         
+00013510: 2020 2020 2020 2061 7474 6974 7564 652e         attitude.
+00013520: 7961 7720 3d20 7961 770a 2020 2020 2020  yaw = yaw.      
+00013530: 2020 2020 2020 2020 2020 6174 7469 7475            attitu
+00013540: 6465 2e70 6974 6368 203d 2070 6974 6368  de.pitch = pitch
+00013550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013560: 2061 7474 6974 7564 652e 726f 6c6c 203d   attitude.roll =
+00013570: 2072 6f6c 6c0a 0a20 2020 2020 2020 2020   roll..         
+00013580: 2020 2020 2020 2052 5f63 616d 5374 6432         R_camStd2
+00013590: 7574 6d20 3d20 7365 6c66 2e67 6574 5f52  utm = self.get_R
+000135a0: 5f63 616d 5374 6432 7574 6d28 525f 6361  _camStd2utm(R_ca
+000135b0: 6d32 6672 616d 652c 525f 6672 616d 6532  m2frame,R_frame2
+000135c0: 6e65 6429 0a20 2020 2020 2020 2020 2020  ned).           
+000135d0: 2020 2020 2052 5f63 616d 3275 746d 5f6c       R_cam2utm_l
+000135e0: 6973 742e 6170 7065 6e64 2852 5f63 616d  ist.append(R_cam
+000135f0: 5374 6432 7574 6d2e 666c 6174 7465 6e28  Std2utm.flatten(
+00013600: 292e 746f 6c69 7374 2829 290a 0a20 2020  ).tolist())..   
+00013610: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+00013620: 6f67 2822 6170 706c 6965 6420 6672 616d  og("applied fram
+00013630: 6520 746f 2063 616d 6572 6120 726f 7461  e to camera rota
+00013640: 7469 6f6e 2079 6177 2c70 6974 6368 2c72  tion yaw,pitch,r
+00013650: 6f6c 6c20 3d20 2220 2b20 7374 7228 6361  oll = " + str(ca
+00013660: 6d65 7261 3246 7261 6d65 5f79 6177 2920  mera2Frame_yaw) 
+00013670: 2b20 222c 2220 2b20 7374 7228 6361 6d65  + "," + str(came
+00013680: 7261 3246 7261 6d65 5f70 6974 6368 2920  ra2Frame_pitch) 
+00013690: 2b20 222c 2220 2b20 7374 7228 6361 6d65  + "," + str(came
+000136a0: 7261 3246 7261 6d65 5f72 6f6c 6c29 2c64  ra2Frame_roll),d
+000136b0: 6f6e 7453 686f 773d 5472 7565 290a 0a20  ontShow=True).. 
+000136c0: 2020 2020 2020 2069 6620 6c65 6e28 696d         if len(im
+000136d0: 6167 655f 6474 7329 203e 2030 3a0a 0a20  age_dts) > 0:.. 
+000136e0: 2020 2020 2020 2020 2020 2023 2057 7269             # Wri
+000136f0: 7465 2074 6f20 6e61 7669 6761 7469 6f6e  te to navigation
+00013700: 2074 7874 2066 696c 650a 2020 2020 2020   txt file.      
+00013710: 2020 2020 2020 2320 6865 6164 6572 0a20        # header. 
+00013720: 2020 2020 2020 2020 2020 2072 6573 203d             res =
+00013730: 206f 7065 6e28 696e 745f 6174 7475 7475   open(int_attutu
+00013740: 6465 5f66 696c 652c 2022 7722 290a 2020  de_file, "w").  
+00013750: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
+00013760: 6974 6528 6d69 7174 762e 636f 6c5f 6865  ite(miqtv.col_he
+00013770: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00013780: 696d 6727 5d2b 225c 7422 2b6d 6971 7476  img']+"\t"+miqtv
+00013790: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+000137a0: 6971 7427 5d5b 2775 7463 275d 290a 2020  iqt']['utc']).  
+000137b0: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
+000137c0: 6974 6528 225c 7422 2b6d 6971 7476 2e63  ite("\t"+miqtv.c
+000137d0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+000137e0: 7427 5d5b 2779 6177 275d 290a 2020 2020  t']['yaw']).    
+000137f0: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
+00013800: 6528 225c 7422 2b6d 6971 7476 2e63 6f6c  e("\t"+miqtv.col
+00013810: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00013820: 5d5b 2770 6974 6368 275d 290a 2020 2020  ]['pitch']).    
+00013830: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
+00013840: 6528 225c 7422 2b6d 6971 7476 2e63 6f6c  e("\t"+miqtv.col
+00013850: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00013860: 5d5b 2772 6f6c 6c27 5d29 0a0a 2020 2020  ]['roll'])..    
+00013870: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
+00013880: 6528 225c 6e22 290a 2020 2020 2020 2020  e("\n").        
+00013890: 2020 2020 2320 6461 7461 206c 696e 6573      # data lines
+000138a0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+000138b0: 2066 696c 6520 696e 2069 6d61 6765 5f64   file in image_d
+000138c0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+000138d0: 2020 2020 666f 7220 7469 6d65 706f 696e      for timepoin
+000138e0: 7420 696e 2069 6d61 6765 5f64 7473 5b66  t in image_dts[f
+000138f0: 696c 655d 3a0a 2020 2020 2020 2020 2020  ile]:.          
+00013900: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
+00013910: 6974 6528 6669 6c65 2b22 5c74 222b 7469  ite(file+"\t"+ti
+00013920: 6d65 706f 696e 742e 6461 7465 5469 6d65  mepoint.dateTime
+00013930: 2829 2e73 7472 6674 696d 6528 6d69 7174  ().strftime(miqt
+00013940: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
+00013950: 6d61 7269 7174 275d 2929 200a 2020 2020  mariqt'])) .    
+00013960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013970: 7661 6c20 3d20 7469 6d65 706f 696e 742e  val = timepoint.
+00013980: 7961 770a 2020 2020 2020 2020 2020 2020  yaw.            
+00013990: 2020 2020 2020 2020 6966 2027 7961 7727          if 'yaw'
+000139a0: 2069 6e20 7265 636f 7264 7332 6265 496e   in records2beIn
+000139b0: 7665 7274 6564 3a0a 2020 2020 2020 2020  verted:.        
+000139c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000139d0: 7661 6c20 2a3d 202d 310a 2020 2020 2020  val *= -1.      
+000139e0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000139f0: 732e 7772 6974 6528 225c 7422 2b73 7472  s.write("\t"+str
+00013a00: 2876 616c 2929 0a20 2020 2020 2020 2020  (val)).         
+00013a10: 2020 2020 2020 2020 2020 2076 616c 203d             val =
+00013a20: 2074 696d 6570 6f69 6e74 2e70 6974 6368   timepoint.pitch
+00013a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013a40: 2020 2020 2069 6620 2770 6974 6368 2720       if 'pitch' 
+00013a50: 696e 2072 6563 6f72 6473 3262 6549 6e76  in records2beInv
+00013a60: 6572 7465 643a 0a20 2020 2020 2020 2020  erted:.         
+00013a70: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00013a80: 616c 202a 3d20 2d31 0a20 2020 2020 2020  al *= -1.       
+00013a90: 2020 2020 2020 2020 2020 2020 2072 6573               res
+00013aa0: 2e77 7269 7465 2822 5c74 222b 7374 7228  .write("\t"+str(
+00013ab0: 7661 6c29 290a 2020 2020 2020 2020 2020  val)).          
+00013ac0: 2020 2020 2020 2020 2020 7661 6c20 3d20            val = 
+00013ad0: 7469 6d65 706f 696e 742e 726f 6c6c 0a20  timepoint.roll. 
+00013ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013af0: 2020 2069 6620 2772 6f6c 6c27 2069 6e20     if 'roll' in 
+00013b00: 7265 636f 7264 7332 6265 496e 7665 7274  records2beInvert
+00013b10: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+00013b20: 2020 2020 2020 2020 2020 2020 7661 6c20              val 
+00013b30: 2a3d 202d 310a 2020 2020 2020 2020 2020  *= -1.          
+00013b40: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
+00013b50: 6974 6528 225c 7422 2b73 7472 2876 616c  ite("\t"+str(val
+00013b60: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00013b70: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+00013b80: 2822 5c6e 2229 0a20 2020 2020 2020 2020  ("\n").         
+00013b90: 2020 2072 6573 2e63 6c6f 7365 2829 0a0a     res.close()..
+00013ba0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00013bb0: 2e70 726f 762e 6164 6441 7267 756d 656e  .prov.addArgumen
+00013bc0: 7428 2269 6e70 7574 4174 7469 7475 6465  t("inputAttitude
+00013bd0: 4669 6c65 222c 6174 745f 7061 7468 2c6f  File",att_path,o
+00013be0: 7665 7277 7269 7465 3d54 7275 6529 0a20  verwrite=True). 
+00013bf0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00013c00: 7072 6f76 2e6c 6f67 2822 7061 7273 6564  prov.log("parsed
+00013c10: 2066 726f 6d20 696e 7075 7441 7474 6974   from inputAttit
+00013c20: 7564 6546 696c 653a 2022 202b 2073 7472  udeFile: " + str
+00013c30: 2866 7261 6d65 5f61 7474 5f68 6561 6465  (frame_att_heade
+00013c40: 7229 2c64 6f6e 7453 686f 773d 5472 7565  r),dontShow=True
+00013c50: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00013c60: 6c66 2e61 6464 5f69 7465 6d5f 696e 666f  lf.add_item_info
+00013c70: 5f74 6162 5f66 696c 6528 696e 745f 6174  _tab_file(int_at
+00013c80: 7475 7475 6465 5f66 696c 652c 225c 7422  tutude_file,"\t"
+00013c90: 2c6f 7574 7075 745f 6865 6164 6572 5f61  ,output_header_a
+00013ca0: 7474 290a 0a20 2020 2020 2020 2020 2020  tt)..           
+00013cb0: 2023 2057 7269 7465 2074 6f20 706f 7365   # Write to pose
+00013cc0: 2074 7874 2066 696c 650a 2020 2020 2020   txt file.      
+00013cd0: 2020 2020 2020 2320 6865 6164 6572 0a20        # header. 
+00013ce0: 2020 2020 2020 2020 2020 2072 6573 203d             res =
+00013cf0: 206f 7065 6e28 696e 745f 706f 7365 5f66   open(int_pose_f
+00013d00: 696c 652c 2022 7722 290a 2020 2020 2020  ile, "w").      
+00013d10: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
+00013d20: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00013d30: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
+00013d40: 5d2b 225c 7422 2b6d 6971 7476 2e63 6f6c  ]+"\t"+miqtv.col
+00013d50: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00013d60: 5d5b 2775 7463 275d 290a 2020 2020 2020  ]['utc']).      
+00013d70: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
+00013d80: 225c 7422 2b6d 6971 7476 2e63 6f6c 5f68  "\t"+miqtv.col_h
+00013d90: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00013da0: 2770 6f73 6527 5d29 0a20 2020 2020 2020  'pose']).       
+00013db0: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
+00013dc0: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
+00013dd0: 2023 2064 6174 6120 6c69 6e65 730a 2020   # data lines.  
+00013de0: 2020 2020 2020 2020 2020 6920 3d20 300a            i = 0.
+00013df0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00013e00: 6669 6c65 2069 6e20 696d 6167 655f 6474  file in image_dt
+00013e10: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00013e20: 2020 2066 6f72 2074 696d 6570 6f69 6e74     for timepoint
+00013e30: 2069 6e20 696d 6167 655f 6474 735b 6669   in image_dts[fi
+00013e40: 6c65 5d3a 0a20 2020 2020 2020 2020 2020  le]:.           
+00013e50: 2020 2020 2020 2020 2069 6620 525f 6361           if R_ca
+00013e60: 6d32 7574 6d5f 6c69 7374 5b69 5d20 3d3d  m2utm_list[i] ==
+00013e70: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
+00013e80: 2020 2020 2020 2020 2020 2020 2069 202b               i +
+00013e90: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+00013ea0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00013eb0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+00013ec0: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
+00013ed0: 7465 2866 696c 652b 225c 7422 2b74 696d  te(file+"\t"+tim
+00013ee0: 6570 6f69 6e74 2e64 6174 6554 696d 6528  epoint.dateTime(
+00013ef0: 292e 7374 7266 7469 6d65 286d 6971 7476  ).strftime(miqtv
+00013f00: 2e64 6174 655f 666f 726d 6174 735b 276d  .date_formats['m
+00013f10: 6172 6971 7427 5d29 2920 0a20 2020 2020  ariqt'])) .     
+00013f20: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00013f30: 6e74 7279 203d 2073 7472 287b 2770 6f73  ntry = str({'pos
+00013f40: 652d 6162 736f 6c75 7465 2d6f 7269 656e  e-absolute-orien
+00013f50: 7461 7469 6f6e 2d75 746d 2d6d 6174 7269  tation-utm-matri
+00013f60: 7827 3a52 5f63 616d 3275 746d 5f6c 6973  x':R_cam2utm_lis
+00013f70: 745b 695d 7d29 2e72 6570 6c61 6365 2827  t[i]}).replace('
+00013f80: 5c6e 272c 2727 290a 2020 2020 2020 2020  \n','').        
+00013f90: 2020 2020 2020 2020 2020 2020 7265 732e              res.
+00013fa0: 7772 6974 6528 225c 7422 2b65 6e74 7279  write("\t"+entry
+00013fb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00013fc0: 2020 2020 2020 6920 2b3d 2031 0a20 2020        i += 1.   
+00013fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013fe0: 2072 6573 2e77 7269 7465 2822 5c6e 2229   res.write("\n")
+00013ff0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00014000: 2e63 6c6f 7365 2829 0a20 2020 2020 2020  .close().       
+00014010: 2020 2020 2073 656c 662e 6164 645f 6974       self.add_it
+00014020: 656d 5f69 6e66 6f5f 7461 625f 6669 6c65  em_info_tab_file
+00014030: 2869 6e74 5f70 6f73 655f 6669 6c65 2c22  (int_pose_file,"
+00014040: 5c74 222c 6f75 7470 7574 5f68 6561 6465  \t",output_heade
+00014050: 725f 706f 7365 290a 2020 2020 2020 2020  r_pose).        
+00014060: 2020 2020 732e 7374 6f70 2829 0a20 2020      s.stop().   
+00014070: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00014080: 5472 7565 2c20 2241 7474 6974 7564 6520  True, "Attitude 
+00014090: 6461 7461 2063 7265 6174 6564 2220 2b20  data created" + 
+000140a0: 7061 7273 654d 7367 0a20 2020 2020 2020  parseMsg.       
+000140b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000140c0: 2020 2073 2e73 746f 7028 290a 2020 2020     s.stop().    
+000140d0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+000140e0: 616c 7365 2c20 224e 6f20 696d 6167 6520  alse, "No image 
+000140f0: 6174 7469 7475 6465 7320 666f 756e 6422  attitudes found"
+00014100: 202b 2070 6172 7365 4d73 670a 2020 2020   + parseMsg.    
+00014110: 2020 2020 0a20 2020 2020 2020 200a 2020      .        .  
+00014120: 2020 6465 6620 6372 6561 7465 496d 6167    def createImag
+00014130: 6541 7474 6974 7564 6546 696c 6528 7365  eAttitudeFile(se
+00014140: 6c66 2c20 6174 745f 7061 7468 3a73 7472  lf, att_path:str
+00014150: 2c20 6672 616d 655f 6174 745f 6865 6164  , frame_att_head
+00014160: 6572 3a64 6963 742c 2063 616d 6572 6132  er:dict, camera2
+00014170: 4672 616d 655f 7961 773a 666c 6f61 742c  Frame_yaw:float,
+00014180: 6361 6d65 7261 3246 7261 6d65 5f70 6974  camera2Frame_pit
+00014190: 6368 3a66 6c6f 6174 2c63 616d 6572 6132  ch:float,camera2
+000141a0: 4672 616d 655f 726f 6c6c 3a66 6c6f 6174  Frame_roll:float
+000141b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000141c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000141d0: 2020 6461 7465 5f66 6f72 6d61 743d 6d69    date_format=mi
+000141e0: 7174 762e 6461 7465 5f66 6f72 6d61 7473  qtv.date_formats
+000141f0: 5b27 7061 6e67 6165 6127 5d2c 2063 6f6e  ['pangaea'], con
+00014200: 7374 5f76 616c 7565 7320 3d20 7b7d 2c20  st_values = {}, 
+00014210: 6f76 6572 7772 6974 653d 4661 6c73 652c  overwrite=False,
+00014220: 2063 6f6c 5f73 6570 6172 6174 6f72 203d   col_separator =
+00014230: 2022 5c74 222c 0a20 2020 2020 2020 2020   "\t",.         
+00014240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014250: 2020 2020 2020 2061 7474 5f70 6174 685f         att_path_
+00014260: 616e 676c 6573 5f69 6e5f 7261 6420 3d20  angles_in_rad = 
+00014270: 4661 6c73 652c 2076 6964 656f 5361 6d70  False, videoSamp
+00014280: 6c65 5365 636f 6e64 733d 312c 7265 636f  leSeconds=1,reco
+00014290: 7264 7332 6265 496e 7665 7274 6564 3d5b  rds2beInverted=[
+000142a0: 5d29 3a0a 2020 2020 2020 2020 2222 2220  ]):.        """ 
+000142b0: 4465 7072 6563 6174 6465 202d 2075 7365  Deprecatde - use
+000142c0: 2063 7265 6174 655f 696d 6167 655f 6174   create_image_at
+000142d0: 7469 7475 6465 5f66 696c 6520 2222 220a  titude_file """.
+000142e0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+000142f0: 656c 662e 6372 6561 7465 5f69 6d61 6765  elf.create_image
+00014300: 5f61 7474 6974 7564 655f 6669 6c65 2861  _attitude_file(a
+00014310: 7474 5f70 6174 682c 2066 7261 6d65 5f61  tt_path, frame_a
+00014320: 7474 5f68 6561 6465 722c 2063 616d 6572  tt_header, camer
+00014330: 6132 4672 616d 655f 7961 772c 2063 616d  a2Frame_yaw, cam
+00014340: 6572 6132 4672 616d 655f 7069 7463 682c  era2Frame_pitch,
+00014350: 2063 616d 6572 6132 4672 616d 655f 726f   camera2Frame_ro
+00014360: 6c6c 2c20 0a20 2020 2020 2020 2020 2020  ll, .           
+00014370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014390: 2020 2020 6461 7465 5f66 6f72 6d61 742c      date_format,
+000143a0: 2063 6f6e 7374 5f76 616c 7565 732c 206f   const_values, o
+000143b0: 7665 7277 7269 7465 2c20 636f 6c5f 7365  verwrite, col_se
+000143c0: 7061 7261 746f 722c 2061 7474 5f70 6174  parator, att_pat
+000143d0: 685f 616e 676c 6573 5f69 6e5f 7261 642c  h_angles_in_rad,
+000143e0: 2076 6964 656f 5361 6d70 6c65 5365 636f   videoSampleSeco
+000143f0: 6e64 732c 0a20 2020 2020 2020 2020 2020  nds,.           
 00014400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014410: 7265 7475 726e 2046 616c 7365 2c20 7265  return False, re
-00014420: 7475 726e 4d73 670a 0a20 2020 2020 2020  turnMsg..       
-00014430: 2020 2020 2023 2063 6f6d 7065 6e73 6174       # compensat
-00014440: 650a 2020 2020 2020 2020 2020 2020 666f  e.            fo
-00014450: 7220 6669 6c65 2069 6e20 696d 6167 655f  r file in image_
-00014460: 6474 733a 0a20 2020 2020 2020 2020 2020  dts:.           
-00014470: 2020 2020 2070 6f73 6974 696f 6e73 203d       positions =
-00014480: 2069 6d61 6765 5f64 7473 5b66 696c 655d   image_dts[file]
-00014490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000144a0: 2061 7474 6974 7564 6573 203d 2069 6d61   attitudes = ima
-000144b0: 6765 5f64 7473 5f61 7474 5b66 696c 655d  ge_dts_att[file]
-000144c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000144d0: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-000144e0: 6c65 6e28 706f 7369 7469 6f6e 7329 293a  len(positions)):
-000144f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014500: 2020 2020 206c 6174 203d 2070 6f73 6974       lat = posit
-00014510: 696f 6e73 5b69 5d2e 6c61 740a 2020 2020  ions[i].lat.    
-00014520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014530: 6c6f 6e20 3d20 706f 7369 7469 6f6e 735b  lon = positions[
-00014540: 695d 2e6c 6f6e 0a20 2020 2020 2020 2020  i].lon.         
-00014550: 2020 2020 2020 2020 2020 2064 6570 203d             dep =
-00014560: 2070 6f73 6974 696f 6e73 5b69 5d2e 6465   positions[i].de
-00014570: 700a 2020 2020 2020 2020 2020 2020 2020  p.              
-00014580: 2020 2020 2020 6966 2027 616c 7427 2069        if 'alt' i
-00014590: 6e20 6e61 765f 6865 6164 6572 2061 6e64  n nav_header and
-000145a0: 206e 6f74 2027 6465 7027 2069 6e20 6e61   not 'dep' in na
-000145b0: 765f 6865 6164 6572 3a0a 2020 2020 2020  v_header:.      
-000145c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000145d0: 2020 6465 7020 2a3d 202d 310a 2020 2020    dep *= -1.    
-000145e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000145f0: 7961 7720 3d20 6174 7469 7475 6465 735b  yaw = attitudes[
-00014600: 695d 2e79 6177 0a20 2020 2020 2020 2020  i].yaw.         
-00014610: 2020 2020 2020 2020 2020 2070 6974 6368             pitch
-00014620: 203d 2061 7474 6974 7564 6573 5b69 5d2e   = attitudes[i].
-00014630: 7069 7463 680a 2020 2020 2020 2020 2020  pitch.          
-00014640: 2020 2020 2020 2020 2020 726f 6c6c 203d            roll =
-00014650: 2061 7474 6974 7564 6573 5b69 5d2e 726f   attitudes[i].ro
-00014660: 6c6c 0a20 2020 2020 2020 2020 2020 2020  ll.             
-00014670: 2020 2020 2020 2069 6620 7961 7720 6973         if yaw is
-00014680: 204e 6f6e 6520 6f72 2070 6974 6368 2069   None or pitch i
-00014690: 7320 4e6f 6e65 206f 7220 726f 6c6c 2069  s None or roll i
-000146a0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-000146b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000146c0: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
-000146d0: 2020 2020 2020 2020 2020 2020 206e 6577               new
-000146e0: 5f6c 6174 2c6e 6577 5f6c 6f6e 2c6e 6577  _lat,new_lon,new
-000146f0: 5f64 6570 203d 206d 6971 7467 2e61 6464  _dep = miqtg.add
-00014700: 4c65 7665 7261 726d 7332 4c61 746c 6f6e  Leverarms2Latlon
-00014710: 286c 6174 2c6c 6f6e 2c64 6570 2c6f 6666  (lat,lon,dep,off
-00014720: 7365 745f 782c 6f66 6673 6574 5f79 2c6f  set_x,offset_y,o
-00014730: 6666 7365 745f 7a2c 7961 772c 7069 7463  ffset_z,yaw,pitc
-00014740: 682c 726f 6c6c 290a 2020 2020 2020 2020  h,roll).        
-00014750: 2020 2020 2020 2020 2020 2020 706f 7369              posi
-00014760: 7469 6f6e 735b 695d 2e6c 6174 203d 206e  tions[i].lat = n
-00014770: 6577 5f6c 6174 0a20 2020 2020 2020 2020  ew_lat.         
-00014780: 2020 2020 2020 2020 2020 2070 6f73 6974             posit
-00014790: 696f 6e73 5b69 5d2e 6c6f 6e20 3d20 6e65  ions[i].lon = ne
-000147a0: 775f 6c6f 6e0a 2020 2020 2020 2020 2020  w_lon.          
-000147b0: 2020 2020 2020 2020 2020 706f 7369 7469            positi
-000147c0: 6f6e 735b 695d 2e64 6570 203d 206e 6577  ons[i].dep = new
-000147d0: 5f64 6570 0a0a 2020 2020 2020 2020 2020  _dep..          
-000147e0: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
-000147f0: 2261 7070 6c69 6564 206c 6576 6572 2061  "applied lever a
-00014800: 726d 2063 6f6d 7065 6e73 6174 696f 6e20  rm compensation 
-00014810: 782c 792c 7a20 3d20 2220 2b20 7374 7228  x,y,z = " + str(
-00014820: 6f66 6673 6574 5f78 2920 2b20 222c 2220  offset_x) + "," 
-00014830: 2b20 7374 7228 6f66 6673 6574 5f79 2920  + str(offset_y) 
-00014840: 2b20 222c 2220 2b20 7374 7228 6f66 6673  + "," + str(offs
-00014850: 6574 5f7a 292c 646f 6e74 5368 6f77 3d54  et_z),dontShow=T
-00014860: 7275 6529 0a0a 2020 2020 2020 2020 6966  rue)..        if
-00014870: 206c 656e 2869 6d61 6765 5f64 7473 2920   len(image_dts) 
-00014880: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
-00014890: 2023 2043 6865 636b 2077 6865 7468 6572   # Check whether
-000148a0: 2064 6570 7468 2061 6e64 2068 6569 6768   depth and heigh
-000148b0: 7420 6172 6520 7365 740a 2020 2020 2020  t are set.      
-000148c0: 2020 2020 2020 6c61 745f 6964 656e 7469        lat_identi
-000148d0: 6361 6c2c 206c 6f6e 5f69 6465 6e74 6963  cal, lon_identic
-000148e0: 616c 2c20 6465 705f 6964 656e 7469 6361  al, dep_identica
-000148f0: 6c2c 2068 6774 5f69 6465 6e74 6963 616c  l, hgt_identical
-00014900: 2c20 6465 705f 6e6f 745f 7a65 726f 2c20  , dep_not_zero, 
-00014910: 6867 745f 6e6f 745f 7a65 726f 2c75 6e63  hgt_not_zero,unc
-00014920: 6572 745f 6e6f 745f 7a65 726f 203d 206e  ert_not_zero = n
-00014930: 6176 5f64 6174 612e 6368 6563 6b50 6f73  av_data.checkPos
-00014940: 6974 696f 6e73 436f 6e74 656e 7428 290a  itionsContent().
-00014950: 0a20 2020 2020 2020 2020 2020 2023 2057  .            # W
-00014960: 7269 7465 2074 6f20 6e61 7669 6761 7469  rite to navigati
-00014970: 6f6e 2074 7874 2066 696c 650a 2020 2020  on txt file.    
-00014980: 2020 2020 2020 2020 2320 6865 6164 6572          # header
-00014990: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-000149a0: 203d 206f 7065 6e28 7365 6c66 2e67 6574   = open(self.get
-000149b0: 5f69 6e74 5f6e 6176 5f66 696c 6528 292c  _int_nav_file(),
-000149c0: 2022 7722 290a 2020 2020 2020 2020 2020   "w").          
-000149d0: 2020 7265 732e 7772 6974 6528 6d69 7174    res.write(miqt
-000149e0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-000149f0: 7269 7174 275d 5b27 696d 6727 5d2b 225c  riqt']['img']+"\
-00014a00: 7422 2b6d 6971 7476 2e63 6f6c 5f68 6561  t"+miqtv.col_hea
-00014a10: 6465 725b 276d 6172 6971 7427 5d5b 2775  der['mariqt']['u
-00014a20: 7463 275d 290a 2020 2020 2020 2020 2020  tc']).          
-00014a30: 2020 6966 2027 6c61 7427 2069 6e20 6e61    if 'lat' in na
-00014a40: 765f 6865 6164 6572 3a0a 2020 2020 2020  v_header:.      
-00014a50: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
-00014a60: 6974 6528 225c 7422 2b6d 6971 7476 2e63  ite("\t"+miqtv.c
-00014a70: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-00014a80: 7427 5d5b 276c 6174 275d 290a 2020 2020  t']['lat']).    
-00014a90: 2020 2020 2020 2020 6966 2027 6c6f 6e27          if 'lon'
-00014aa0: 2069 6e20 6e61 765f 6865 6164 6572 3a0a   in nav_header:.
-00014ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ac0: 7265 732e 7772 6974 6528 225c 7422 2b6d  res.write("\t"+m
-00014ad0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-00014ae0: 276d 6172 6971 7427 5d5b 276c 6f6e 275d  'mariqt']['lon']
-00014af0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00014b00: 2064 6570 5f6e 6f74 5f7a 6572 6f20 616e   dep_not_zero an
-00014b10: 6420 2764 6570 2720 696e 206e 6176 5f68  d 'dep' in nav_h
-00014b20: 6561 6465 723a 0a20 2020 2020 2020 2020  eader:.         
-00014b30: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-00014b40: 2822 5c74 222b 6d69 7174 762e 636f 6c5f  ("\t"+miqtv.col_
-00014b50: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-00014b60: 5b27 6465 7027 5d29 0a20 2020 2020 2020  ['dep']).       
-00014b70: 2020 2020 2065 6c69 6620 6465 705f 6e6f       elif dep_no
-00014b80: 745f 7a65 726f 2061 6e64 2027 616c 7427  t_zero and 'alt'
-00014b90: 2069 6e20 6e61 765f 6865 6164 6572 3a0a   in nav_header:.
-00014ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014bb0: 7265 732e 7772 6974 6528 225c 7422 2b6d  res.write("\t"+m
-00014bc0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-00014bd0: 276d 6172 6971 7427 5d5b 2761 6c74 275d  'mariqt']['alt']
-00014be0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00014bf0: 2068 6774 5f6e 6f74 5f7a 6572 6f20 616e   hgt_not_zero an
-00014c00: 6420 2768 6774 2720 696e 206e 6176 5f68  d 'hgt' in nav_h
-00014c10: 6561 6465 723a 0a20 2020 2020 2020 2020  eader:.         
-00014c20: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-00014c30: 2822 5c74 222b 6d69 7174 762e 636f 6c5f  ("\t"+miqtv.col_
-00014c40: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-00014c50: 5b27 6867 7427 5d29 0a20 2020 2020 2020  ['hgt']).       
-00014c60: 2020 2020 2069 6620 756e 6365 7274 5f6e       if uncert_n
-00014c70: 6f74 5f7a 6572 6f20 616e 6420 2775 6e63  ot_zero and 'unc
-00014c80: 6572 7427 2069 6e20 6e61 765f 6865 6164  ert' in nav_head
-00014c90: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
-00014ca0: 2020 2020 7265 732e 7772 6974 6528 225c      res.write("\
-00014cb0: 7422 2b6d 6971 7476 2e63 6f6c 5f68 6561  t"+miqtv.col_hea
-00014cc0: 6465 725b 276d 6172 6971 7427 5d5b 2775  der['mariqt']['u
-00014cd0: 6e63 6572 7427 5d29 0a20 2020 2020 2020  ncert']).       
-00014ce0: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
-00014cf0: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
-00014d00: 2023 2064 6174 6120 6c69 6e65 730a 2020   # data lines.  
-00014d10: 2020 2020 2020 2020 2020 666f 7220 6669            for fi
-00014d20: 6c65 2069 6e20 696d 6167 655f 6474 733a  le in image_dts:
-00014d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014d40: 2066 6f72 2074 696d 6570 6f69 6e74 2069   for timepoint i
-00014d50: 6e20 696d 6167 655f 6474 735b 6669 6c65  n image_dts[file
-00014d60: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00014d70: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-00014d80: 2866 696c 652b 225c 7422 2b74 696d 6570  (file+"\t"+timep
-00014d90: 6f69 6e74 2e64 6174 6554 696d 6528 292e  oint.dateTime().
-00014da0: 7374 7266 7469 6d65 286d 6971 7476 2e64  strftime(miqtv.d
-00014db0: 6174 655f 666f 726d 6174 735b 276d 6172  ate_formats['mar
-00014dc0: 6971 7427 5d29 2920 0a20 2020 2020 2020  iqt'])) .       
-00014dd0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00014de0: 276c 6174 2720 696e 206e 6176 5f68 6561  'lat' in nav_hea
-00014df0: 6465 723a 0a20 2020 2020 2020 2020 2020  der:.           
-00014e00: 2020 2020 2020 2020 2020 2020 2076 616c               val
-00014e10: 203d 2074 696d 6570 6f69 6e74 2e6c 6174   = timepoint.lat
-00014e20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014e30: 2020 2020 2020 2020 2069 6620 276c 6174           if 'lat
-00014e40: 2720 696e 2072 6563 6f72 6473 3262 6549  ' in records2beI
-00014e50: 6e76 6572 7465 643a 0a20 2020 2020 2020  nverted:.       
-00014e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014e70: 2020 2020 2076 616c 202a 3d20 2d31 0a20       val *= -1. 
-00014e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014e90: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-00014ea0: 2822 5c74 222b 7374 7228 7661 6c29 290a  ("\t"+str(val)).
-00014eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ec0: 2020 2020 6966 2027 6c6f 6e27 2069 6e20      if 'lon' in 
-00014ed0: 6e61 765f 6865 6164 6572 3a0a 2020 2020  nav_header:.    
-00014ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ef0: 2020 2020 7661 6c20 3d20 7469 6d65 706f      val = timepo
-00014f00: 696e 742e 6c6f 6e0a 2020 2020 2020 2020  int.lon.        
+00014410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014420: 2020 2020 7265 636f 7264 7332 6265 496e      records2beIn
+00014430: 7665 7274 6564 290a 2020 2020 2020 2020  verted).        
+00014440: 0a0a 2020 2020 6465 6620 6765 745f 525f  ..    def get_R_
+00014450: 6361 6d53 7464 3275 746d 2873 656c 662c  camStd2utm(self,
+00014460: 525f 6361 6d32 6672 616d 653a 6e70 2e61  R_cam2frame:np.a
+00014470: 7272 6179 2c52 5f66 7261 6d65 326e 6564  rray,R_frame2ned
+00014480: 3a6e 702e 6172 7261 7929 3a0a 2020 2020  :np.array):.    
+00014490: 2020 2020 2222 2220 7265 7472 756e 2072      """ retrun r
+000144a0: 6f74 6174 696f 6e20 6d61 7472 6978 2052  otation matrix R
+000144b0: 2074 7261 6e66 6f72 6d69 6e67 2066 726f   tranforming fro
+000144c0: 6d20 6361 6d53 7464 3a20 2878 2c79 2c7a  m camStd: (x,y,z
+000144d0: 203d 2072 6967 6874 2c62 7574 746f 6d2c   = right,buttom,
+000144e0: 6c69 6e65 206f 6620 7369 6768 7429 2074  line of sight) t
+000144f0: 6f20 7574 6d20 2878 2c79 2c7a 203d 2065  o utm (x,y,z = e
+00014500: 6173 7469 6e67 2c6e 6f72 7468 696e 672c  asting,northing,
+00014510: 7570 2920 2222 220a 2020 2020 2020 2020  up) """.        
+00014520: 525f 6361 6d69 4644 4f32 6361 6d53 7464  R_camiFDO2camStd
+00014530: 203d 206d 6971 7467 2e52 5f59 6177 5069   = miqtg.R_YawPi
+00014540: 7463 6852 6f6c 6c28 3930 2c30 2c30 2920  tchRoll(90,0,0) 
+00014550: 2320 696e 2069 4644 4f20 6361 6d3a 2028  # in iFDO cam: (
+00014560: 782c 792c 7a20 3d20 746f 702c 7269 6768  x,y,z = top,righ
+00014570: 742c 6c69 6e65 206f 6620 7369 6768 7429  t,line of sight)
+00014580: 2062 7574 2066 6f72 2070 6f73 6520 7468   but for pose th
+00014590: 6520 2773 7461 6e64 6172 6427 2063 616d  e 'standard' cam
+000145a0: 5374 643a 2028 782c 792c 7a20 3d20 7269  Std: (x,y,z = ri
+000145b0: 6768 742c 6275 7474 6f6d 2c6c 696e 6520  ght,buttom,line 
+000145c0: 6f66 2073 6967 6874 2920 6973 2065 7870  of sight) is exp
+000145d0: 6563 7465 640a 2020 2020 2020 2020 525f  ected.        R_
+000145e0: 6361 6d53 7464 3266 7261 6d65 203d 2052  camStd2frame = R
+000145f0: 5f63 616d 3266 7261 6d65 2e64 6f74 2852  _cam2frame.dot(R
+00014600: 5f63 616d 6946 444f 3263 616d 5374 6429  _camiFDO2camStd)
+00014610: 0a20 2020 2020 2020 2052 5f63 616d 5374  .        R_camSt
+00014620: 6432 6e65 6420 3d20 525f 6672 616d 6532  d2ned = R_frame2
+00014630: 6e65 642e 646f 7428 525f 6361 6d53 7464  ned.dot(R_camStd
+00014640: 3266 7261 6d65 290a 2020 2020 2020 2020  2frame).        
+00014650: 525f 6e65 6432 7574 6d20 3d20 6d69 7174  R_ned2utm = miqt
+00014660: 672e 525f 5859 5a28 3138 302c 302c 3930  g.R_XYZ(180,0,90
+00014670: 2920 2320 7769 7468 2075 746d 2078 2c79  ) # with utm x,y
+00014680: 2c7a 203d 2065 6173 7469 6e67 2c6e 6f72  ,z = easting,nor
+00014690: 7468 696e 672c 7570 0a20 2020 2020 2020  thing,up.       
+000146a0: 2052 5f63 616d 5374 6432 7574 6d20 3d20   R_camStd2utm = 
+000146b0: 525f 6e65 6432 7574 6d2e 646f 7428 525f  R_ned2utm.dot(R_
+000146c0: 6361 6d53 7464 326e 6564 292e 726f 756e  camStd2ned).roun
+000146d0: 6428 3529 0a20 2020 2020 2020 2072 6574  d(5).        ret
+000146e0: 7572 6e20 525f 6361 6d53 7464 3275 746d  urn R_camStd2utm
+000146f0: 0a0a 0a20 2020 2064 6566 2066 696e 644e  ...    def findN
+00014700: 6176 4461 7461 466f 7249 6d61 6765 2873  avDataForImage(s
+00014710: 656c 662c 6461 7461 3a6d 6971 7467 2e4e  elf,data:miqtg.N
+00014720: 756d 4461 7461 5469 6d65 5374 616d 7065  umDataTimeStampe
+00014730: 642c 7669 6465 6f53 616d 706c 6553 6563  d,videoSampleSec
+00014740: 6f6e 6473 3d31 293a 0a20 2020 2020 2020  onds=1):.       
+00014750: 2022 2222 2063 7265 6174 6573 2061 2064   """ creates a d
+00014760: 6963 7420 2869 6d61 6765 5f64 7473 2920  ict (image_dts) 
+00014770: 7769 7468 2066 696c 6520 6e61 6d65 2061  with file name a
+00014780: 7320 6b65 7920 616e 6420 6120 6c69 7374  s key and a list
+00014790: 206f 6620 6461 7461 2065 6c65 6d65 6e74   of data element
+000147a0: 7320 6173 2076 616c 7565 2e20 0a20 2020  s as value. .   
+000147b0: 2020 2020 2020 2020 2049 6e20 6361 7365           In case
+000147c0: 206f 6620 7068 6f74 6f73 2074 6865 206c   of photos the l
+000147d0: 6973 7420 6861 7320 6f6e 6c79 2061 2073  ist has only a s
+000147e0: 696e 676c 6520 656e 7472 792c 2066 6f72  ingle entry, for
+000147f0: 2076 6964 656f 7320 6974 2068 6173 2076   videos it has v
+00014800: 6964 656f 2064 7572 6174 696f 6e20 5b73  ideo duration [s
+00014810: 6563 5d20 2f20 7669 6465 6f53 616d 706c  ec] / videoSampl
+00014820: 6553 6563 6f6e 6473 2065 6e74 7269 6573  eSeconds entries
+00014830: 2e0a 2020 2020 2020 2020 2020 2020 5265  ..            Re
+00014840: 7475 726e 7320 7375 6363 6573 732c 2069  turns success, i
+00014850: 6d61 6765 5f64 7473 2c20 6d73 6720 2222  mage_dts, msg ""
+00014860: 220a 0a20 2020 2020 2020 2069 6620 7669  "..        if vi
+00014870: 6465 6f53 616d 706c 6553 6563 6f6e 6473  deoSampleSeconds
+00014880: 203c 3d20 303a 0a20 2020 2020 2020 2020   <= 0:.         
+00014890: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
+000148a0: 6f6e 2822 6669 6e64 4e61 7644 6174 6146  on("findNavDataF
+000148b0: 6f72 496d 6167 653a 2076 6964 656f 5361  orImage: videoSa
+000148c0: 6d70 6c65 5365 636f 6e64 7320 6d75 7374  mpleSeconds must
+000148d0: 2062 6520 6772 6561 7465 7220 3022 290a   be greater 0").
+000148e0: 0a20 2020 2020 2020 2023 2063 7265 6174  .        # creat
+000148f0: 6520 736f 7274 6564 2074 696d 6520 706f  e sorted time po
+00014900: 696e 7473 0a20 2020 2020 2020 2074 696d  ints.        tim
+00014910: 655f 706f 696e 7473 203d 206c 6973 7428  e_points = list(
+00014920: 6461 7461 2e6b 6579 7328 2929 0a20 2020  data.keys()).   
+00014930: 2020 2020 2074 696d 655f 706f 696e 7473       time_points
+00014940: 2e73 6f72 7428 290a 2020 2020 2020 2020  .sort().        
+00014950: 756e 6d61 7463 6865 6454 696d 6550 6f69  unmatchedTimePoi
+00014960: 6e74 7320 3d20 5b5d 0a20 2020 2020 2020  nts = [].       
+00014970: 2069 6d61 6765 5f64 7473 203d 207b 7d0a   image_dts = {}.
+00014980: 2020 2020 2020 2020 7374 6172 7453 6561          startSea
+00014990: 7263 6849 6e64 6578 203d 2030 0a20 2020  rchIndex = 0.   
+000149a0: 2020 2020 2069 6d61 6765 7349 6e52 6177       imagesInRaw
+000149b0: 203d 2020 7365 6c66 2e69 6d61 6765 7349   =  self.imagesI
+000149c0: 6e49 6d61 6765 7344 6972 2829 0a20 2020  nImagesDir().   
+000149d0: 2020 2020 2069 6d61 6765 7349 6e52 6177       imagesInRaw
+000149e0: 536f 7274 6564 4c69 7374 203d 2073 656c  SortedList = sel
+000149f0: 662e 696d 6167 6573 496e 496d 6167 6573  f.imagesInImages
+00014a00: 4469 7253 6f72 7465 644c 6973 7428 290a  DirSortedList().
+00014a10: 2020 2020 2020 2020 7072 6f67 203d 206d          prog = m
+00014a20: 6971 7463 2e50 7269 6e74 4b6e 6f77 6e50  iqtc.PrintKnownP
+00014a30: 726f 6772 6573 734d 7367 2822 496e 7465  rogressMsg("Inte
+00014a40: 7270 6f6c 6174 696e 6720 6e61 7669 6761  rpolating naviga
+00014a50: 7469 6f6e 2066 6f72 2069 6d61 6765 222c  tion for image",
+00014a60: 206c 656e 2869 6d61 6765 7349 6e52 6177   len(imagesInRaw
+00014a70: 292c 6d6f 6475 6c6f 3d31 290a 2020 2020  ),modulo=1).    
+00014a80: 2020 2020 666f 7220 6669 6c65 2069 6e20      for file in 
+00014a90: 696d 6167 6573 496e 5261 7753 6f72 7465  imagesInRawSorte
+00014aa0: 644c 6973 743a 0a20 2020 2020 2020 2020  dList:.         
+00014ab0: 2020 2070 726f 672e 7072 6f67 7265 7373     prog.progress
+00014ac0: 2829 0a20 2020 2020 2020 2020 2020 2066  ().            f
+00014ad0: 696c 655f 6e61 6d65 203d 206f 732e 7061  ile_name = os.pa
+00014ae0: 7468 2e62 6173 656e 616d 6528 6669 6c65  th.basename(file
+00014af0: 290a 0a20 2020 2020 2020 2020 2020 2064  )..            d
+00014b00: 745f 696d 6167 6520 3d20 6d69 7174 632e  t_image = miqtc.
+00014b10: 7061 7273 6546 696c 6544 6174 6554 696d  parseFileDateTim
+00014b20: 6541 7355 5443 2866 696c 655f 6e61 6d65  eAsUTC(file_name
+00014b30: 290a 2020 2020 2020 2020 2020 2020 6474  ).            dt
+00014b40: 5f69 6d61 6765 5f74 7320 3d20 696e 7428  _image_ts = int(
+00014b50: 6474 5f69 6d61 6765 2e74 696d 6573 7461  dt_image.timesta
+00014b60: 6d70 2829 202a 2031 3030 3029 0a0a 2020  mp() * 1000)..  
+00014b70: 2020 2020 2020 2020 2020 7275 6e54 696d            runTim
+00014b80: 6520 3d20 696d 6167 6573 496e 5261 775b  e = imagesInRaw[
+00014b90: 6669 6c65 5d5b 315d 2023 202d 3120 666f  file][1] # -1 fo
+00014ba0: 7220 7068 6f74 6f73 0a20 2020 2020 2020  r photos.       
+00014bb0: 2020 2020 2023 2076 6964 656f 0a20 2020       # video.   
+00014bc0: 2020 2020 2020 2020 2069 6620 696d 6167           if imag
+00014bd0: 6573 496e 5261 775b 6669 6c65 5d5b 325d  esInRaw[file][2]
+00014be0: 2069 6e20 6d69 7174 762e 7669 6465 6f5f   in miqtv.video_
+00014bf0: 7479 7065 7320 616e 6420 7275 6e54 696d  types and runTim
+00014c00: 6520 3c3d 2030 3a20 2320 6578 740a 2020  e <= 0: # ext.  
+00014c10: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00014c20: 696e 7428 2243 6175 7469 6f6e 2120 436f  int("Caution! Co
+00014c30: 756c 6420 6e6f 7420 7265 6164 2076 6964  uld not read vid
+00014c40: 656f 2072 756e 2074 696d 6520 6672 6f6d  eo run time from
+00014c50: 2066 696c 6522 2c66 696c 6529 2023 2054   file",file) # T
+00014c60: 4f44 4f20 646f 6573 2074 6869 7320 6861  ODO does this ha
+00014c70: 7070 656e 3f20 4861 6e64 6c65 2062 6574  ppen? Handle bet
+00014c80: 7465 723f 0a0a 2020 2020 2020 2020 2020  ter?..          
+00014c90: 2020 7361 6d70 6c65 5469 6d65 5365 6373    sampleTimeSecs
+00014ca0: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
+00014cb0: 2070 6f73 5f6c 6973 7420 3d20 5b5d 0a20   pos_list = []. 
+00014cc0: 2020 2020 2020 2020 2020 2067 6f20 3d20             go = 
+00014cd0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+00014ce0: 2077 6869 6c65 2067 6f3a 0a20 2020 2020   while go:.     
+00014cf0: 2020 2020 2020 2020 2020 2074 7279 3a20             try: 
+00014d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014d10: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+00014d20: 2020 2020 2020 2020 706f 732c 2073 7461          pos, sta
+00014d30: 7274 5365 6172 6368 496e 6465 7820 3d20  rtSearchIndex = 
+00014d40: 6461 7461 2e69 6e74 6572 706f 6c61 7465  data.interpolate
+00014d50: 4174 5469 6d65 2864 745f 696d 6167 655f  AtTime(dt_image_
+00014d60: 7473 202b 2073 616d 706c 6554 696d 6553  ts + sampleTimeS
+00014d70: 6563 7320 2a20 3130 3030 2c74 696d 655f  ecs * 1000,time_
+00014d80: 706f 696e 7473 2c73 7461 7274 5365 6172  points,startSear
+00014d90: 6368 496e 6465 7829 0a20 2020 2020 2020  chIndex).       
+00014da0: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+00014db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014dc0: 2020 2320 696e 7465 7270 6f6c 6174 6541    # interpolateA
+00014dd0: 7454 696d 6520 7265 7475 726e 7320 4e6f  tTime returns No
+00014de0: 6e65 2076 616c 7565 7320 6966 2074 696d  ne values if tim
+00014df0: 6520 6f75 7420 6f66 2072 616e 6765 0a20  e out of range. 
+00014e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e10: 2020 2069 6620 706f 732e 636f 7461 696e     if pos.cotain
+00014e20: 734e 6f6e 6556 616c 7565 7349 6e52 6571  sNoneValuesInReq
+00014e30: 7569 7265 6446 6965 6c64 7328 293a 0a20  uiredFields():. 
+00014e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e50: 2020 2020 2020 2075 6e6d 6174 6368 6564         unmatched
+00014e60: 5469 6d65 506f 696e 7473 2e61 7070 656e  TimePoints.appen
+00014e70: 6428 2864 745f 696d 6167 655f 7473 202b  d((dt_image_ts +
+00014e80: 2073 616d 706c 6554 696d 6553 6563 7320   sampleTimeSecs 
+00014e90: 2a20 3130 3030 292f 3130 3030 290a 2020  * 1000)/1000).  
+00014ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014eb0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00014ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ed0: 706f 735f 6c69 7374 2e61 7070 656e 6428  pos_list.append(
+00014ee0: 706f 7329 0a20 2020 2020 2020 2020 2020  pos).           
+00014ef0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+00014f00: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
 00014f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f20: 6966 2027 6c6f 6e27 2069 6e20 7265 636f  if 'lon' in reco
-00014f30: 7264 7332 6265 496e 7665 7274 6564 3a0a  rds2beInverted:.
-00014f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f50: 2020 2020 2020 2020 2020 2020 7661 6c20              val 
-00014f60: 2a3d 202d 310a 2020 2020 2020 2020 2020  *= -1.          
-00014f70: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00014f80: 732e 7772 6974 6528 225c 7422 2b73 7472  s.write("\t"+str
-00014f90: 2876 616c 2929 0a20 2020 2020 2020 2020  (val)).         
-00014fa0: 2020 2020 2020 2020 2020 2069 6620 6465             if de
-00014fb0: 705f 6e6f 745f 7a65 726f 2061 6e64 2027  p_not_zero and '
-00014fc0: 6465 7027 2069 6e20 6e61 765f 6865 6164  dep' in nav_head
-00014fd0: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
-00014fe0: 2020 2020 2020 2020 2020 2020 7661 6c20              val 
-00014ff0: 3d20 7469 6d65 706f 696e 742e 6465 700a  = timepoint.dep.
-00015000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015010: 2020 2020 2020 2020 6966 2027 6465 7027          if 'dep'
-00015020: 2069 6e20 7265 636f 7264 7332 6265 496e   in records2beIn
-00015030: 7665 7274 6564 3a0a 2020 2020 2020 2020  verted:.        
-00015040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015050: 2020 2020 7661 6c20 2a3d 202d 310a 2020      val *= -1.  
-00015060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015070: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
-00015080: 225c 7422 2b73 7472 2876 616c 2929 0a20  "\t"+str(val)). 
-00015090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000150a0: 2020 2065 6c69 6620 6465 705f 6e6f 745f     elif dep_not_
-000150b0: 7a65 726f 2061 6e64 2027 616c 7427 2069  zero and 'alt' i
-000150c0: 6e20 6e61 765f 6865 6164 6572 3a0a 2020  n nav_header:.  
-000150d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000150e0: 2020 2020 2020 7661 6c20 3d20 7469 6d65        val = time
-000150f0: 706f 696e 742e 6465 7020 2a20 2d31 0a20  point.dep * -1. 
-00015100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015110: 2020 2020 2020 2069 6620 2761 6c74 2720         if 'alt' 
-00015120: 696e 2072 6563 6f72 6473 3262 6549 6e76  in records2beInv
-00015130: 6572 7465 643a 0a20 2020 2020 2020 2020  erted:.         
-00015140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015150: 2020 2076 616c 202a 3d20 2d31 0a20 2020     val *= -1.   
-00015160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015170: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
-00015180: 5c74 222b 7374 7228 7661 6c29 290a 2020  \t"+str(val)).  
-00015190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000151a0: 2020 6966 2068 6774 5f6e 6f74 5f7a 6572    if hgt_not_zer
-000151b0: 6f20 616e 6420 2768 6774 2720 696e 206e  o and 'hgt' in n
-000151c0: 6176 5f68 6561 6465 723a 0a20 2020 2020  av_header:.     
-000151d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000151e0: 2020 2076 616c 203d 2074 696d 6570 6f69     val = timepoi
-000151f0: 6e74 2e68 6774 0a20 2020 2020 2020 2020  nt.hgt.         
-00015200: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00015210: 6620 2768 6774 2720 696e 2072 6563 6f72  f 'hgt' in recor
-00015220: 6473 3262 6549 6e76 6572 7465 643a 0a20  ds2beInverted:. 
-00015230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015240: 2020 2020 2020 2020 2020 2076 616c 202a             val *
-00015250: 3d20 2d31 0a20 2020 2020 2020 2020 2020  = -1.           
-00015260: 2020 2020 2020 2020 2020 2020 2072 6573               res
-00015270: 2e77 7269 7465 2822 5c74 222b 7374 7228  .write("\t"+str(
-00015280: 7661 6c29 290a 2020 2020 2020 2020 2020  val)).          
-00015290: 2020 2020 2020 2020 2020 6966 2075 6e63            if unc
-000152a0: 6572 745f 6e6f 745f 7a65 726f 2061 6e64  ert_not_zero and
-000152b0: 2027 756e 6365 7274 2720 696e 206e 6176   'uncert' in nav
-000152c0: 5f68 6561 6465 723a 0a20 2020 2020 2020  _header:.       
-000152d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000152e0: 2076 616c 203d 2074 696d 6570 6f69 6e74   val = timepoint
-000152f0: 2e75 6e63 6572 740a 2020 2020 2020 2020  .uncert.        
-00015300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015310: 6966 2027 756e 6365 7274 2720 696e 2072  if 'uncert' in r
-00015320: 6563 6f72 6473 3262 6549 6e76 6572 7465  ecords2beInverte
-00015330: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
-00015340: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00015350: 616c 202a 3d20 2d31 0a20 2020 2020 2020  al *= -1.       
-00015360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015370: 2072 6573 2e77 7269 7465 2822 5c74 222b   res.write("\t"+
-00015380: 7374 7228 7661 6c29 290a 2020 2020 2020  str(val)).      
-00015390: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000153a0: 732e 7772 6974 6528 225c 6e22 290a 2020  s.write("\n").  
-000153b0: 2020 2020 2020 2020 2020 7265 732e 636c            res.cl
-000153c0: 6f73 6528 290a 0a20 2020 2020 2020 2020  ose()..         
-000153d0: 2020 2023 2057 7269 7465 2074 6f20 6765     # Write to ge
-000153e0: 6f6a 736f 6e20 6669 6c65 0a20 2020 2020  ojson file.     
-000153f0: 2020 2020 2020 2067 656f 6a73 6f6e 203d         geojson =
-00015400: 207b 2774 7970 6527 3a20 2746 6561 7475   {'type': 'Featu
-00015410: 7265 436f 6c6c 6563 7469 6f6e 272c 2027  reCollection', '
-00015420: 6e61 6d65 273a 2073 656c 662e 6469 722e  name': self.dir.
-00015430: 6576 656e 7428 292b 225f 222b 7365 6c66  event()+"_"+self
-00015440: 2e64 6972 2e73 656e 736f 7228 292b 225f  .dir.sensor()+"_
-00015450: 696d 6167 652d 6e61 7669 6761 7469 6f6e  image-navigation
-00015460: 222c 2027 6665 6174 7572 6573 273a 205b  ", 'features': [
-00015470: 5d7d 0a20 2020 2020 2020 2020 2020 2066  ]}.            f
-00015480: 6f72 2066 696c 6520 696e 2069 6d61 6765  or file in image
-00015490: 5f64 7473 3a0a 2020 2020 2020 2020 2020  _dts:.          
-000154a0: 2020 2020 2020 2320 7068 6f74 6f0a 2020        # photo.  
-000154b0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000154c0: 206c 656e 2869 6d61 6765 5f64 7473 5b66   len(image_dts[f
-000154d0: 696c 655d 2920 3d3d 2031 3a0a 2020 2020  ile]) == 1:.    
-000154e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000154f0: 6966 2064 6570 5f6e 6f74 5f7a 6572 6f3a  if dep_not_zero:
-00015500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015510: 2020 2020 2020 2020 2067 656f 6d65 7472           geometr
-00015520: 7920 3d20 207b 2774 7970 6527 3a20 2250  y =  {'type': "P
-00015530: 6f69 6e74 222c 2027 636f 6f72 6469 6e61  oint", 'coordina
-00015540: 7465 7327 3a20 0a20 2020 2020 2020 2020  tes': .         
-00015550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015560: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-00015570: 666c 6f61 7428 696d 6167 655f 6474 735b  float(image_dts[
-00015580: 6669 6c65 5d5b 305d 2e6c 6f6e 292c 2066  file][0].lon), f
-00015590: 6c6f 6174 2869 6d61 6765 5f64 7473 5b66  loat(image_dts[f
-000155a0: 696c 655d 5b30 5d2e 6c61 7429 2c20 666c  ile][0].lat), fl
-000155b0: 6f61 7428 696d 6167 655f 6474 735b 6669  oat(image_dts[fi
-000155c0: 6c65 5d5b 305d 2e64 6570 295d 0a20 2020  le][0].dep)].   
-000155d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000155e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000155f0: 207d 0a20 2020 2020 2020 2020 2020 2020   }.             
-00015600: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00015610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015620: 2020 2020 2067 656f 6d65 7472 7920 3d20       geometry = 
-00015630: 207b 2774 7970 6527 3a20 2250 6f69 6e74   {'type': "Point
-00015640: 222c 2027 636f 6f72 6469 6e61 7465 7327  ", 'coordinates'
-00015650: 3a20 0a20 2020 2020 2020 2020 2020 2020  : .             
-00015660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015670: 2020 2020 2020 2020 2020 205b 666c 6f61             [floa
-00015680: 7428 696d 6167 655f 6474 735b 6669 6c65  t(image_dts[file
-00015690: 5d5b 305d 2e6c 6f6e 292c 2066 6c6f 6174  ][0].lon), float
-000156a0: 2869 6d61 6765 5f64 7473 5b66 696c 655d  (image_dts[file]
-000156b0: 5b30 5d2e 6c61 7429 5d0a 2020 2020 2020  [0].lat)].      
-000156c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000156d0: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
-000156e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000156f0: 2020 2020 6966 2054 7275 6520 696e 205b      if True in [
-00015700: 6d61 7468 2e69 736e 616e 2878 2920 666f  math.isnan(x) fo
-00015710: 7220 7820 696e 2067 656f 6d65 7472 795b  r x in geometry[
-00015720: 2763 6f6f 7264 696e 6174 6573 275d 5d3a  'coordinates']]:
-00015730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015740: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-00015750: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
-00015760: 2020 2023 2076 6964 656f 0a20 2020 2020     # video.     
-00015770: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00015780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015790: 2020 2020 2069 6620 6465 705f 6e6f 745f       if dep_not_
-000157a0: 7a65 726f 3a0a 2020 2020 2020 2020 2020  zero:.          
-000157b0: 2020 2020 2020 2020 2020 2020 2020 6765                ge
-000157c0: 6f6d 6574 7279 203d 2020 7b27 7479 7065  ometry =  {'type
-000157d0: 273a 2022 4d75 6c74 6950 6f69 6e74 222c  ': "MultiPoint",
-000157e0: 2027 636f 6f72 6469 6e61 7465 7327 3a0a   'coordinates':.
-000157f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015810: 2020 2020 2020 2020 5b5b 666c 6f61 7428          [[float(
-00015820: 642e 6c6f 6e29 2c20 666c 6f61 7428 642e  d.lon), float(d.
-00015830: 6c61 7429 2c20 666c 6f61 7428 642e 6465  lat), float(d.de
-00015840: 7029 5d20 666f 7220 6420 696e 2069 6d61  p)] for d in ima
-00015850: 6765 5f64 7473 5b66 696c 655d 5d0a 2020  ge_dts[file]].  
-00015860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015880: 2020 7d0a 2020 2020 2020 2020 2020 2020    }.            
-00015890: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000158a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000158b0: 2020 2020 2020 6765 6f6d 6574 7279 203d        geometry =
-000158c0: 2020 7b27 7479 7065 273a 2022 4d75 6c74    {'type': "Mult
-000158d0: 6950 6f69 6e74 222c 2027 636f 6f72 6469  iPoint", 'coordi
-000158e0: 6e61 7465 7327 3a0a 2020 2020 2020 2020  nates':.        
-000158f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015910: 5b5b 666c 6f61 7428 642e 6c6f 6e29 2c20  [[float(d.lon), 
-00015920: 666c 6f61 7428 642e 6c61 7429 5d20 666f  float(d.lat)] fo
-00015930: 7220 6420 696e 2069 6d61 6765 5f64 7473  r d in image_dts
-00015940: 5b66 696c 655d 5d0a 2020 2020 2020 2020  [file]].        
-00015950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015960: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
-00015970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015980: 2020 6966 2054 7275 6520 696e 205b 6d61    if True in [ma
-00015990: 7468 2e69 736e 616e 2878 2920 666f 7220  th.isnan(x) for 
-000159a0: 7820 696e 205b 6974 656d 2066 6f72 2073  x in [item for s
-000159b0: 7562 6c69 7374 2069 6e20 6765 6f6d 6574  ublist in geomet
-000159c0: 7279 5b27 636f 6f72 6469 6e61 7465 7327  ry['coordinates'
-000159d0: 5d20 666f 7220 6974 656d 2069 6e20 7375  ] for item in su
-000159e0: 626c 6973 745d 5d3a 0a20 2020 2020 2020  blist]]:.       
-000159f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015a00: 2063 6f6e 7469 6e75 650a 0a20 2020 2020   continue..     
-00015a10: 2020 2020 2020 2020 2020 2067 656f 6a73             geojs
-00015a20: 6f6e 5b27 6665 6174 7572 6573 275d 2e61  on['features'].a
-00015a30: 7070 656e 6428 7b27 7479 7065 273a 2027  ppend({'type': '
-00015a40: 4665 6174 7572 6527 2c20 2770 726f 7065  Feature', 'prope
-00015a50: 7274 6965 7327 3a20 7b27 6964 273a 2066  rties': {'id': f
-00015a60: 696c 657d 2c20 2767 656f 6d65 7472 7927  ile}, 'geometry'
-00015a70: 3a20 6765 6f6d 6574 7279 207d 290a 2020  : geometry }).  
-00015a80: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-00015a90: 2020 2020 2020 2020 2020 206f 203d 206f             o = o
-00015aa0: 7065 6e28 7365 6c66 2e67 6574 5f69 6e74  pen(self.get_int
-00015ab0: 5f6e 6176 5f66 696c 6528 292e 7265 706c  _nav_file().repl
-00015ac0: 6163 6528 222e 7478 7422 2c20 222e 6765  ace(".txt", ".ge
-00015ad0: 6f6a 736f 6e22 292c 0a20 2020 2020 2020  ojson"),.       
-00015ae0: 2020 2020 2020 2020 2020 2020 2020 2277                "w
-00015af0: 222c 2065 7272 6f72 733d 2269 676e 6f72  ", errors="ignor
-00015b00: 6522 2c20 656e 636f 6469 6e67 3d27 7574  e", encoding='ut
-00015b10: 662d 3827 290a 2020 2020 2020 2020 2020  f-8').          
-00015b20: 2020 6a73 6f6e 2e64 756d 7028 6765 6f6a    json.dump(geoj
-00015b30: 736f 6e2c 206f 2c20 656e 7375 7265 5f61  son, o, ensure_a
-00015b40: 7363 6969 3d46 616c 7365 2c20 696e 6465  scii=False, inde
-00015b50: 6e74 3d34 290a 2020 2020 2020 2020 2020  nt=4).          
-00015b60: 2020 6f2e 636c 6f73 6528 290a 0a20 2020    o.close()..   
-00015b70: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-00015b80: 6f76 2e61 6464 4172 6775 6d65 6e74 2822  ov.addArgument("
-00015b90: 696e 7075 744e 6176 6967 6174 696f 6e46  inputNavigationF
-00015ba0: 696c 6522 2c6e 6176 5f70 6174 682c 6f76  ile",nav_path,ov
-00015bb0: 6572 7772 6974 653d 5472 7565 290a 2020  erwrite=True).  
-00015bc0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-00015bd0: 726f 762e 6c6f 6728 2270 6172 7365 6420  rov.log("parsed 
-00015be0: 6672 6f6d 2069 6e70 7574 4e61 7669 6761  from inputNaviga
-00015bf0: 7469 6f6e 4669 6c65 3a20 2220 2b20 7374  tionFile: " + st
-00015c00: 7228 6e61 765f 6865 6164 6572 292c 646f  r(nav_header),do
-00015c10: 6e74 5368 6f77 3d54 7275 6529 0a20 2020  ntShow=True).   
-00015c20: 2020 2020 2020 2020 2073 2e73 746f 7028           s.stop(
-00015c30: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00015c40: 7475 726e 2054 7275 652c 2022 4e61 7669  turn True, "Navi
-00015c50: 6761 7469 6f6e 2064 6174 6120 6372 6561  gation data crea
-00015c60: 7465 6422 202b 2072 6574 7572 6e4d 7367  ted" + returnMsg
-00015c70: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00015c80: 2020 2020 2020 2020 2020 2073 2e73 746f             s.sto
-00015c90: 7028 290a 2020 2020 2020 2020 2020 2020  p().            
-00015ca0: 7265 7475 726e 2046 616c 7365 2c20 224e  return False, "N
-00015cb0: 6f20 696d 6167 6520 636f 6f72 6469 6e61  o image coordina
-00015cc0: 7465 7320 666f 756e 6422 202b 2072 6574  tes found" + ret
-00015cd0: 7572 6e4d 7367 0a0a 0a20 2020 2064 6566  urnMsg...    def
-00015ce0: 2063 7265 6174 6549 6d61 6765 5348 4132   createImageSHA2
-00015cf0: 3536 4669 6c65 2873 656c 662c 7265 5265  56File(self,reRe
-00015d00: 6164 416c 6c3d 5472 7565 293a 0a20 2020  adAll=True):.   
-00015d10: 2020 2020 2022 2222 2043 7265 6174 6573       """ Creates
-00015d20: 2069 6e20 2f69 6e74 6572 6d65 6469 6174   in /intermediat
-00015d30: 6520 6120 7465 7874 2066 696c 6520 636f  e a text file co
-00015d40: 6e74 6169 6e69 6e67 2070 6572 2069 6d61  ntaining per ima
-00015d50: 6765 2069 7473 2053 4841 3235 3620 6861  ge its SHA256 ha
-00015d60: 7368 2e0a 2020 2020 2020 2020 2020 2020  sh..            
-00015d70: 4966 2072 6552 6561 6441 6c6c 2069 7320  If reReadAll is 
-00015d80: 5472 7565 2061 6c6c 2069 6d61 6765 7327  True all images'
-00015d90: 2068 6173 6865 7320 6172 6520 6465 7465   hashes are dete
-00015da0: 726d 696e 6564 2e20 4f74 6865 7277 6973  rmined. Otherwis
-00015db0: 6520 6f6e 6c79 2066 6f72 2074 686f 7365  e only for those
-00015dc0: 2066 696c 6573 0a20 2020 2020 2020 2020   files.         
-00015dd0: 2020 2077 6869 6368 2061 7265 206e 6f74     which are not
-00015de0: 2079 6574 2069 6e20 7468 6520 696e 7465   yet in the inte
-00015df0: 726d 6564 6961 7465 2066 696c 6520 636f  rmediate file co
-00015e00: 6e74 6169 6e69 6e67 2074 6865 2069 6d61  ntaining the ima
-00015e10: 6765 2068 6173 6865 7320 2022 2222 0a20  ge hashes  """. 
-00015e20: 2020 2020 2020 2068 6173 6865 7320 3d20         hashes = 
-00015e30: 7b7d 0a20 2020 2020 2020 2069 6620 6f73  {}.        if os
-00015e40: 2e70 6174 682e 6578 6973 7473 2873 656c  .path.exists(sel
-00015e50: 662e 6765 745f 696e 745f 6861 7368 5f66  f.get_int_hash_f
-00015e60: 696c 6528 2929 3a0a 2020 2020 2020 2020  ile()):.        
-00015e70: 2020 2020 6861 7368 6573 203d 206d 6971      hashes = miq
-00015e80: 7466 2e74 6162 4669 6c65 4461 7461 2873  tf.tabFileData(s
-00015e90: 656c 662e 6765 745f 696e 745f 6861 7368  elf.get_int_hash
-00015ea0: 5f66 696c 6528 292c 205b 6d69 7174 762e  _file(), [miqtv.
-00015eb0: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00015ec0: 7174 275d 5b27 696d 6727 5d2c 206d 6971  qt']['img'], miq
-00015ed0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00015ee0: 6172 6971 7427 5d5b 2768 6173 6827 5d5d  ariqt']['hash']]
-00015ef0: 2c20 6b65 795f 636f 6c3d 6d69 7174 762e  , key_col=miqtv.
-00015f00: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00015f10: 7174 275d 5b27 696d 6727 5d29 0a0a 2020  qt']['img'])..  
-00015f20: 2020 2020 2020 696d 6167 6573 496e 5261        imagesInRa
-00015f30: 7720 3d20 7365 6c66 2e69 6d61 6765 7349  w = self.imagesI
-00015f40: 6e49 6d61 6765 7344 6972 2829 0a20 2020  nImagesDir().   
-00015f50: 2020 2020 2069 6620 6c65 6e28 696d 6167       if len(imag
-00015f60: 6573 496e 5261 7729 203e 2030 3a0a 0a20  esInRaw) > 0:.. 
-00015f70: 2020 2020 2020 2020 2020 2061 6464 6564             added
-00015f80: 5f68 6173 6865 7320 3d20 300a 2020 2020  _hashes = 0.    
-00015f90: 2020 2020 2020 2020 7072 6f67 203d 206d          prog = m
-00015fa0: 6971 7463 2e50 7269 6e74 4b6e 6f77 6e50  iqtc.PrintKnownP
-00015fb0: 726f 6772 6573 734d 7367 2822 4368 6563  rogressMsg("Chec
-00015fc0: 6b69 6e67 2068 6173 6865 7322 2c20 6c65  king hashes", le
-00015fd0: 6e28 696d 6167 6573 496e 5261 7729 2c6d  n(imagesInRaw),m
-00015fe0: 6f64 756c 6f3d 3529 0a20 2020 2020 2020  odulo=5).       
-00015ff0: 2020 2020 2066 6f72 2066 696c 6520 696e       for file in
-00016000: 2069 6d61 6765 7349 6e52 6177 3a0a 2020   imagesInRaw:.  
-00016010: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00016020: 6f67 2e70 726f 6772 6573 7328 290a 0a20  og.progress().. 
-00016030: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00016040: 6620 6e6f 7420 7365 6c66 2e5f 5f61 6c6c  f not self.__all
-00016050: 5555 4944 7343 6865 636b 6564 2061 6e64  UUIDsChecked and
-00016060: 206e 6f74 206d 6971 7469 2e69 6d61 6765   not miqti.image
-00016070: 436f 6e74 6169 6e73 5661 6c69 6455 5549  ContainsValidUUI
-00016080: 4428 6669 6c65 295b 305d 3a0a 2020 2020  D(file)[0]:.    
-00016090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000160a0: 2320 7265 6d6f 7665 2066 726f 6d20 7575  # remove from uu
-000160b0: 6964 2066 696c 650a 2020 2020 2020 2020  id file.        
-000160c0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-000160d0: 732e 7061 7468 2e65 7869 7374 7328 7365  s.path.exists(se
-000160e0: 6c66 2e67 6574 5f69 6e74 5f75 7569 645f  lf.get_int_uuid_
-000160f0: 6669 6c65 2829 293a 0a20 2020 2020 2020  file()):.       
-00016100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016110: 2072 6573 203d 206f 7065 6e28 7365 6c66   res = open(self
-00016120: 2e67 6574 5f69 6e74 5f75 7569 645f 6669  .get_int_uuid_fi
-00016130: 6c65 2829 2c20 2272 2229 0a20 2020 2020  le(), "r").     
-00016140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016150: 2020 206c 696e 6573 203d 2072 6573 2e72     lines = res.r
-00016160: 6561 646c 696e 6573 2829 0a20 2020 2020  eadlines().     
-00016170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016180: 2020 2072 6573 2e63 6c6f 7365 2829 0a20     res.close(). 
-00016190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000161a0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000161b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000161c0: 206c 696e 6573 203d 205b 5d0a 2020 2020   lines = [].    
-000161d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000161e0: 6920 3d20 300a 2020 2020 2020 2020 2020  i = 0.          
-000161f0: 2020 2020 2020 2020 2020 6c69 6e65 4e72            lineNr
-00016200: 203d 2069 0a20 2020 2020 2020 2020 2020   = i.           
-00016210: 2020 2020 2020 2020 2066 6f72 206c 696e           for lin
-00016220: 6520 696e 206c 696e 6573 3a0a 2020 2020  e in lines:.    
-00016230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016240: 2020 2020 6966 206f 732e 7061 7468 2e62      if os.path.b
-00016250: 6173 656e 616d 6528 6669 6c65 2920 696e  asename(file) in
-00016260: 206c 696e 653a 0a20 2020 2020 2020 2020   line:.         
-00016270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016280: 2020 206c 696e 654e 7220 3d20 690a 2020     lineNr = i.  
-00016290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000162a0: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+00014f20: 7265 7475 726e 2046 616c 7365 2c20 696d  return False, im
+00014f30: 6167 655f 6474 732c 2022 436f 756c 6420  age_dts, "Could 
+00014f40: 6e6f 7420 6669 6e64 2069 6d61 6765 2074  not find image t
+00014f50: 696d 6520 222b 2064 6174 6574 696d 652e  ime "+ datetime.
+00014f60: 6461 7465 7469 6d65 2e75 7463 6672 6f6d  datetime.utcfrom
+00014f70: 7469 6d65 7374 616d 7028 2864 745f 696d  timestamp((dt_im
+00014f80: 6167 655f 7473 202b 2073 616d 706c 6554  age_ts + sampleT
+00014f90: 696d 6553 6563 7320 2a20 3130 3030 292f  imeSecs * 1000)/
+00014fa0: 3130 3030 292e 7374 7266 7469 6d65 286d  1000).strftime(m
+00014fb0: 6971 7476 2e64 6174 655f 666f 726d 6174  iqtv.date_format
+00014fc0: 735b 276d 6172 6971 7427 5d29 202b 2220  s['mariqt']) +" 
+00014fd0: 696e 2022 2b73 7472 2864 6174 612e 6c65  in "+str(data.le
+00014fe0: 6e28 2929 2b22 2064 6174 6120 706f 7369  n())+" data posi
+00014ff0: 7469 6f6e 7322 202b 2073 7472 2865 2e61  tions" + str(e.a
+00015000: 7267 7329 0a20 2020 2020 2020 2020 2020  rgs).           
+00015010: 2020 2020 2073 616d 706c 6554 696d 6553       sampleTimeS
+00015020: 6563 7320 2b3d 2076 6964 656f 5361 6d70  ecs += videoSamp
+00015030: 6c65 5365 636f 6e64 730a 2020 2020 2020  leSeconds.      
+00015040: 2020 2020 2020 2020 2020 6966 2073 616d            if sam
+00015050: 706c 6554 696d 6553 6563 7320 3e20 7275  pleTimeSecs > ru
+00015060: 6e54 696d 653a 0a20 2020 2020 2020 2020  nTime:.         
+00015070: 2020 2020 2020 2020 2020 2067 6f20 3d20             go = 
+00015080: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+00015090: 2020 0a20 2020 2020 2020 2020 2020 2069    .            i
+000150a0: 6d61 6765 5f64 7473 5b66 696c 655f 6e61  mage_dts[file_na
+000150b0: 6d65 5d20 3d20 706f 735f 6c69 7374 0a20  me] = pos_list. 
+000150c0: 2020 2020 2020 2070 726f 672e 636c 6561         prog.clea
+000150d0: 7228 290a 2020 2020 2020 2020 7265 7475  r().        retu
+000150e0: 726e 4d73 6720 3d20 2222 0a20 2020 2020  rnMsg = "".     
+000150f0: 2020 2069 6620 6c65 6e28 756e 6d61 7463     if len(unmatc
+00015100: 6865 6454 696d 6550 6f69 6e74 7329 2021  hedTimePoints) !
+00015110: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+00015120: 2075 6e6d 6174 6368 6564 5469 6d65 506f   unmatchedTimePo
+00015130: 696e 7473 2e73 6f72 7428 290a 2020 2020  ints.sort().    
+00015140: 2020 2020 2020 2020 756e 6d61 7463 6865          unmatche
+00015150: 6454 696d 6550 6f69 6e74 7320 3d20 5b64  dTimePoints = [d
+00015160: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
+00015170: 2e75 7463 6672 6f6d 7469 6d65 7374 616d  .utcfromtimestam
+00015180: 7028 7473 292e 7374 7266 7469 6d65 286d  p(ts).strftime(m
+00015190: 6971 7476 2e64 6174 655f 666f 726d 6174  iqtv.date_format
+000151a0: 735b 276d 6172 6971 7427 5d29 2066 6f72  s['mariqt']) for
+000151b0: 2074 7320 696e 2075 6e6d 6174 6368 6564   ts in unmatched
+000151c0: 5469 6d65 506f 696e 7473 5d0a 2020 2020  TimePoints].    
+000151d0: 2020 2020 2020 2020 7265 7475 726e 4d73          returnMs
+000151e0: 6720 3d20 2243 4155 5449 4f4e 2120 4e61  g = "CAUTION! Na
+000151f0: 7669 6761 7469 6f6e 206e 6f74 2066 6f75  vigation not fou
+00015200: 6e64 2066 6f72 2074 6865 2066 6f6c 6c6f  nd for the follo
+00015210: 7769 6e67 2069 6d61 6765 2074 696d 6520  wing image time 
+00015220: 706f 696e 7473 2e20 446f 7562 6c65 2063  points. Double c
+00015230: 6865 636b 206f 7220 7072 6f76 6964 6520  heck or provide 
+00015240: 6174 206c 6561 7374 2073 7461 7469 6320  at least static 
+00015250: 6465 6661 756c 7420 6e61 7669 6761 7469  default navigati
+00015260: 6f6e 2069 6e20 6865 6164 6572 2066 6965  on in header fie
+00015270: 6c64 732e 220a 2020 2020 2020 2020 2020  lds.".          
+00015280: 2020 7265 7475 726e 4d73 6720 2b3d 2022    returnMsg += "
+00015290: 5c6e 2220 2b20 225c 6e22 2e6a 6f69 6e28  \n" + "\n".join(
+000152a0: 756e 6d61 7463 6865 6454 696d 6550 6f69  unmatchedTimePoi
+000152b0: 6e74 7329 0a20 2020 2020 2020 2072 6574  nts).        ret
+000152c0: 7572 6e20 5472 7565 2c20 696d 6167 655f  urn True, image_
+000152d0: 6474 732c 2072 6574 7572 6e4d 7367 0a0a  dts, returnMsg..
+000152e0: 0a20 2020 2064 6566 2063 7265 6174 655f  .    def create_
+000152f0: 696d 6167 655f 6e61 7669 6761 7469 6f6e  image_navigation
+00015300: 5f66 696c 6528 7365 6c66 2c20 6e61 765f  _file(self, nav_
+00015310: 7061 7468 3a20 7374 722c 206e 6176 5f68  path: str, nav_h
+00015320: 6561 6465 723d 6d69 7174 762e 706f 735f  eader=miqtv.pos_
+00015330: 6865 6164 6572 5b27 7061 6e67 6165 6127  header['pangaea'
+00015340: 5d2c 2064 6174 655f 666f 726d 6174 3d6d  ], date_format=m
+00015350: 6971 7476 2e64 6174 655f 666f 726d 6174  iqtv.date_format
+00015360: 735b 2770 616e 6761 6561 275d 2c20 6f76  s['pangaea'], ov
+00015370: 6572 7772 6974 653d 4661 6c73 652c 2063  erwrite=False, c
+00015380: 6f6c 5f73 6570 6172 6174 6f72 203d 2022  ol_separator = "
+00015390: 5c74 222c 2076 6964 656f 5361 6d70 6c65  \t", videoSample
+000153a0: 5365 636f 6e64 733d 312c 0a20 2020 2020  Seconds=1,.     
+000153b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000153c0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+000153d0: 6666 7365 745f 783d 302c 206f 6666 7365  ffset_x=0, offse
+000153e0: 745f 793d 302c 206f 6666 7365 745f 7a3d  t_y=0, offset_z=
+000153f0: 302c 616e 676c 6573 5f69 6e5f 7261 6420  0,angles_in_rad 
+00015400: 3d20 4661 6c73 652c 2072 6563 6f72 6473  = False, records
+00015410: 3262 6549 6e76 6572 7465 643d 5b5d 293a  2beInverted=[]):
+00015420: 0a20 2020 2020 2020 2022 2222 2043 7265  .        """ Cre
+00015430: 6174 6573 2069 6e20 2f69 6e74 6572 6d65  ates in /interme
+00015440: 6469 6174 6520 6120 7465 7874 2066 696c  diate a text fil
+00015450: 6520 7769 7468 2034 2e35 4420 6e61 7669  e with 4.5D navi
+00015460: 6761 7469 6f6e 2064 6174 6120 666f 7220  gation data for 
+00015470: 6561 6368 2069 6d61 6765 2c20 692e 652e  each image, i.e.
+00015480: 2061 2073 696e 676c 6520 726f 7720 7065   a single row pe
+00015490: 7220 7068 6f74 6f2c 2076 6964 656f 2064  r photo, video d
+000154a0: 7572 6174 696f 6e20 5b73 6563 5d20 2f20  uration [sec] / 
+000154b0: 7669 6465 6f53 616d 706c 6553 6563 6f6e  videoSampleSecon
+000154c0: 6473 2072 6f77 7320 7065 7220 7669 6465  ds rows per vide
+000154d0: 6f2e 0a20 2020 2020 2020 2020 2020 206e  o..            n
+000154e0: 6176 5f68 6561 6465 7220 6d75 7374 2062  av_header must b
+000154f0: 6520 6469 6374 2063 6f6e 7461 696e 696e  e dict containin
+00015500: 6720 7468 6520 6b65 7973 2027 7574 6327  g the keys 'utc'
+00015510: 2c27 6c61 7427 2c27 6c6f 6e27 2c27 6465  ,'lat','lon','de
+00015520: 7027 286f 7220 2761 6c74 2729 2c20 6f70  p'(or 'alt'), op
+00015530: 7469 6f6e 616c 3a20 2768 6774 272c 2775  tional: 'hgt','u
+00015540: 6e63 6572 7427 2077 6974 6820 7468 6520  ncert' with the 
+00015550: 7265 7370 6563 7469 7665 2063 6f6c 756d  respective colum
+00015560: 6e20 6865 6164 6572 7320 6173 2076 616c  n headers as val
+00015570: 7565 7320 0a20 2020 2020 2020 2020 2020  ues .           
+00015580: 2069 6620 6f6e 6520 6f66 2074 6865 2076   if one of the v
+00015590: 6568 6963 6c65 2078 2c79 2c7a 206f 6666  ehicle x,y,z off
+000155a0: 7365 7473 205b 6d5d 2069 7320 6e6f 7420  sets [m] is not 
+000155b0: 3020 616e 6420 6e61 765f 6865 6164 6572  0 and nav_header
+000155c0: 2061 6c73 6f20 636f 6e74 6169 6e73 2027   also contains '
+000155d0: 7961 7727 2c27 7069 7463 6827 2c27 726f  yaw','pitch','ro
+000155e0: 6c6c 2720 6c65 7665 7261 726d 206f 6666  ll' leverarm off
+000155f0: 7365 7473 2061 7265 2063 6f6d 7065 6e73  sets are compens
+00015600: 6174 6564 2066 6f72 2022 2222 0a0a 2020  ated for """..  
+00015610: 2020 2020 2020 6966 2073 656c 662e 696e        if self.in
+00015620: 7465 726d 6564 6961 7465 4e61 7646 696c  termediateNavFil
+00015630: 6545 7869 7374 7328 2920 616e 6420 6e6f  eExists() and no
+00015640: 7420 6f76 6572 7772 6974 653a 0a20 2020  t overwrite:.   
+00015650: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00015660: 5472 7565 2c20 224f 7574 7075 7420 6669  True, "Output fi
+00015670: 6c65 2065 7869 7374 733a 2022 2b73 656c  le exists: "+sel
+00015680: 662e 6765 745f 696e 745f 6e61 765f 6669  f.get_int_nav_fi
+00015690: 6c65 2829 0a0a 2020 2020 2020 2020 6966  le()..        if
+000156a0: 206e 6f74 206f 732e 7061 7468 2e65 7869   not os.path.exi
+000156b0: 7374 7328 6e61 765f 7061 7468 293a 0a20  sts(nav_path):. 
+000156c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000156d0: 6e20 4661 6c73 652c 2022 4e61 7669 6761  n False, "Naviga
+000156e0: 7469 6f6e 2066 696c 6520 6e6f 7420 666f  tion file not fo
+000156f0: 756e 643a 2022 2b6e 6176 5f70 6174 680a  und: "+nav_path.
+00015700: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00015710: 6f73 2e70 6174 682e 6578 6973 7473 2873  os.path.exists(s
+00015720: 656c 662e 696d 6167 6573 4469 7229 3a0a  elf.imagesDir):.
+00015730: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00015740: 726e 2046 616c 7365 2c20 2249 6d61 6765  rn False, "Image
+00015750: 2066 6f6c 6465 7220 6e6f 7420 666f 756e   folder not foun
+00015760: 643a 2022 2b20 7365 6c66 2e69 6d61 6765  d: "+ self.image
+00015770: 7344 6972 0a0a 2020 2020 2020 2020 7320  sDir..        s 
+00015780: 3d20 6d69 7174 632e 5072 696e 744c 6f61  = miqtc.PrintLoa
+00015790: 6469 6e67 4d73 6728 2243 7265 6174 696e  dingMsg("Creatin
+000157a0: 6720 6974 656d 7327 206e 6176 6967 6174  g items' navigat
+000157b0: 696f 6e20 6461 7461 2229 0a20 2020 2020  ion data").     
+000157c0: 2020 2072 6574 7572 6e4d 7367 203d 2022     returnMsg = "
+000157d0: 220a 2020 2020 2020 2020 636f 6d70 656e  ".        compen
+000157e0: 7361 744f 6666 7365 7473 203d 2046 616c  satOffsets = Fal
+000157f0: 7365 0a20 2020 2020 2020 2069 6620 286f  se.        if (o
+00015800: 6666 7365 745f 7821 3d30 206f 7220 6f66  ffset_x!=0 or of
+00015810: 6673 6574 5f79 213d 3020 6f72 206f 6666  fset_y!=0 or off
+00015820: 7365 745f 7a21 3d30 2920 616e 6420 2779  set_z!=0) and 'y
+00015830: 6177 2720 696e 206e 6176 5f68 6561 6465  aw' in nav_heade
+00015840: 7220 616e 6420 2770 6974 6368 2720 696e  r and 'pitch' in
+00015850: 206e 6176 5f68 6561 6465 7220 616e 6420   nav_header and 
+00015860: 2772 6f6c 6c27 2069 6e20 6e61 765f 6865  'roll' in nav_he
+00015870: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
+00015880: 2020 636f 6d70 656e 7361 744f 6666 7365    compensatOffse
+00015890: 7473 203d 2054 7275 650a 0a20 2020 2020  ts = True..     
+000158a0: 2020 2023 2063 6865 636b 2069 6620 666f     # check if fo
+000158b0: 7220 6d69 7373 696e 6720 6669 656c 6473  r missing fields
+000158c0: 2074 6865 7265 2061 7265 2063 6f6e 7374   there are const
+000158d0: 2076 616c 7565 7320 696e 2068 6561 6465   values in heade
+000158e0: 720a 2020 2020 2020 2020 636f 6e73 745f  r.        const_
+000158f0: 7661 6c75 6573 203d 207b 7d0a 2020 2020  values = {}.    
+00015900: 2020 2020 666f 7220 6e61 7646 6965 6c64      for navField
+00015910: 2069 6e20 6d69 7174 762e 706f 735f 6865   in miqtv.pos_he
+00015920: 6164 6572 5b27 6d61 7269 7174 275d 3a0a  ader['mariqt']:.
+00015930: 2020 2020 2020 2020 2020 2020 7265 7370              resp
+00015940: 6563 7469 7665 4865 6164 6572 4669 656c  ectiveHeaderFiel
+00015950: 6420 3d20 6d69 7174 762e 636f 6c5f 6865  d = miqtv.col_he
+00015960: 6164 6572 5b22 6d61 7269 7174 225d 5b6e  ader["mariqt"][n
+00015970: 6176 4669 656c 645d 0a20 2020 2020 2020  avField].       
+00015980: 2020 2020 2069 6620 6e61 7646 6965 6c64       if navField
+00015990: 206e 6f74 2069 6e20 6e61 765f 6865 6164   not in nav_head
+000159a0: 6572 2061 6e64 2028 7265 7370 6563 7469  er and (respecti
+000159b0: 7665 4865 6164 6572 4669 656c 6420 696e  veHeaderField in
+000159c0: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
+000159d0: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+000159e0: 6572 4b65 795d 2061 6e64 2073 656c 662e  erKey] and self.
+000159f0: 6669 6e64 546d 7046 6965 6c64 3228 7265  findTmpField2(re
+00015a00: 7370 6563 7469 7665 4865 6164 6572 4669  spectiveHeaderFi
+00015a10: 656c 6429 2021 3d20 2222 293a 200a 2020  eld) != ""): .  
+00015a20: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00015a30: 6e73 745f 7661 6c75 6573 5b6e 6176 4669  nst_values[navFi
+00015a40: 656c 645d 203d 2073 656c 662e 6669 6e64  eld] = self.find
+00015a50: 546d 7046 6965 6c64 2872 6573 7065 6374  TmpField(respect
+00015a60: 6976 6548 6561 6465 7246 6965 6c64 290a  iveHeaderField).
+00015a70: 0a20 2020 2020 2020 2023 204c 6f61 6420  .        # Load 
+00015a80: 6e61 7669 6761 7469 6f6e 2064 6174 610a  navigation data.
+00015a90: 2020 2020 2020 2020 6e61 765f 6461 7461          nav_data
+00015aa0: 2c20 7061 7273 654d 7367 203d 206d 6971  , parseMsg = miq
+00015ab0: 746e 2e72 6561 6441 6c6c 506f 7369 7469  tn.readAllPositi
+00015ac0: 6f6e 7346 726f 6d46 696c 6550 6174 6828  onsFromFilePath(
+00015ad0: 6e61 765f 7061 7468 2c20 6e61 765f 6865  nav_path, nav_he
+00015ae0: 6164 6572 2c20 6461 7465 5f66 6f72 6d61  ader, date_forma
+00015af0: 742c 636f 6c5f 7365 7061 7261 746f 723d  t,col_separator=
+00015b00: 636f 6c5f 7365 7061 7261 746f 722c 636f  col_separator,co
+00015b10: 6e73 745f 7661 6c75 6573 3d63 6f6e 7374  nst_values=const
+00015b20: 5f76 616c 7565 7329 0a20 2020 2020 2020  _values).       
+00015b30: 2069 6620 7061 7273 654d 7367 2021 3d20   if parseMsg != 
+00015b40: 2222 3a0a 2020 2020 2020 2020 2020 2020  "":.            
+00015b50: 7365 6c66 2e70 726f 762e 6c6f 6728 7061  self.prov.log(pa
+00015b60: 7273 654d 7367 2c64 6f6e 7453 686f 773d  rseMsg,dontShow=
+00015b70: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+00015b80: 2020 7265 7475 726e 4d73 6720 3d20 225c    returnMsg = "\
+00015b90: 6e22 202b 2070 6172 7365 4d73 670a 0a20  n" + parseMsg.. 
+00015ba0: 2020 2020 2020 2023 2066 696e 6420 666f         # find fo
+00015bb0: 7220 6561 6368 2069 6d61 6765 2074 6865  r each image the
+00015bc0: 2072 6573 7065 6374 6976 6520 6e61 7669   respective navi
+00015bd0: 6761 7469 6f6e 2064 6174 610a 2020 2020  gation data.    
+00015be0: 2020 2020 732e 7374 6f70 2829 0a20 2020      s.stop().   
+00015bf0: 2020 2020 2073 7563 6365 7373 2c20 696d       success, im
+00015c00: 6167 655f 6474 732c 206d 7367 203d 2073  age_dts, msg = s
+00015c10: 656c 662e 6669 6e64 4e61 7644 6174 6146  elf.findNavDataF
+00015c20: 6f72 496d 6167 6528 6e61 765f 6461 7461  orImage(nav_data
+00015c30: 2c76 6964 656f 5361 6d70 6c65 5365 636f  ,videoSampleSeco
+00015c40: 6e64 7329 0a20 2020 2020 2020 2073 656c  nds).        sel
+00015c50: 662e 7072 6f76 2e6c 6f67 286d 7367 2c64  f.prov.log(msg,d
+00015c60: 6f6e 7453 686f 773d 5472 7565 290a 2020  ontShow=True).  
+00015c70: 2020 2020 2020 6966 206d 7367 2021 3d20        if msg != 
+00015c80: 2222 3a0a 2020 2020 2020 2020 2020 2020  "":.            
+00015c90: 7265 7475 726e 4d73 6720 2b3d 2022 5c6e  returnMsg += "\n
+00015ca0: 2220 2b20 6d73 670a 2020 2020 2020 2020  " + msg.        
+00015cb0: 6966 206e 6f74 2073 7563 6365 7373 3a0a  if not success:.
+00015cc0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00015cd0: 726e 2046 616c 7365 2c20 7265 7475 726e  rn False, return
+00015ce0: 4d73 670a 2020 2020 2020 2020 7320 3d20  Msg.        s = 
+00015cf0: 6d69 7174 632e 5072 696e 744c 6f61 6469  miqtc.PrintLoadi
+00015d00: 6e67 4d73 6728 2243 7265 6174 696e 6720  ngMsg("Creating 
+00015d10: 6974 656d 7327 206e 6176 6967 6174 696f  items' navigatio
+00015d20: 6e20 6461 7461 2229 0a0a 2020 2020 2020  n data")..      
+00015d30: 2020 2320 636f 6d70 656e 7361 7465 206c    # compensate l
+00015d40: 6576 6572 6172 6d20 6f66 6673 6574 730a  everarm offsets.
+00015d50: 2020 2020 2020 2020 6966 2063 6f6d 7065          if compe
+00015d60: 6e73 6174 4f66 6673 6574 733a 0a0a 2020  nsatOffsets:..  
+00015d70: 2020 2020 2020 2020 2020 2320 6c6f 6164            # load
+00015d80: 2066 7261 6d65 2061 7474 6974 7564 6520   frame attitude 
+00015d90: 6461 7461 2066 726f 6d20 6669 6c65 0a20  data from file. 
+00015da0: 2020 2020 2020 2020 2020 2061 7474 5f64             att_d
+00015db0: 6174 612c 2070 6172 7365 4d73 6720 3d20  ata, parseMsg = 
+00015dc0: 6d69 7174 6e2e 7265 6164 416c 6c41 7474  miqtn.readAllAtt
+00015dd0: 6974 7564 6573 4672 6f6d 4669 6c65 5061  itudesFromFilePa
+00015de0: 7468 286e 6176 5f70 6174 682c 206e 6176  th(nav_path, nav
+00015df0: 5f68 6561 6465 722c 2064 6174 655f 666f  _header, date_fo
+00015e00: 726d 6174 2c63 6f6c 5f73 6570 6172 6174  rmat,col_separat
+00015e10: 6f72 3d63 6f6c 5f73 6570 6172 6174 6f72  or=col_separator
+00015e20: 2c63 6f6e 7374 5f76 616c 7565 733d 636f  ,const_values=co
+00015e30: 6e73 745f 7661 6c75 6573 2c61 6e67 6c65  nst_values,angle
+00015e40: 7349 6e52 6164 3d61 6e67 6c65 735f 696e  sInRad=angles_in
+00015e50: 5f72 6164 290a 2020 2020 2020 2020 2020  _rad).          
+00015e60: 2020 6966 2070 6172 7365 4d73 6720 213d    if parseMsg !=
+00015e70: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
+00015e80: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+00015e90: 6f67 2870 6172 7365 4d73 672c 646f 6e74  og(parseMsg,dont
+00015ea0: 5368 6f77 3d54 7275 6529 0a20 2020 2020  Show=True).     
+00015eb0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00015ec0: 6e4d 7367 202b 3d20 225c 6e22 202b 2070  nMsg += "\n" + p
+00015ed0: 6172 7365 4d73 670a 0a20 2020 2020 2020  arseMsg..       
+00015ee0: 2020 2020 2023 2066 696e 6420 666f 7220       # find for 
+00015ef0: 6561 6368 2069 6d61 6765 2074 6865 2072  each image the r
+00015f00: 6573 7065 6374 6976 6520 6e61 7669 6761  espective naviga
+00015f10: 7469 6f6e 2064 6174 610a 2020 2020 2020  tion data.      
+00015f20: 2020 2020 2020 7375 6363 6573 732c 2069        success, i
+00015f30: 6d61 6765 5f64 7473 5f61 7474 2c20 6d73  mage_dts_att, ms
+00015f40: 6720 3d20 7365 6c66 2e66 696e 644e 6176  g = self.findNav
+00015f50: 4461 7461 466f 7249 6d61 6765 2861 7474  DataForImage(att
+00015f60: 5f64 6174 612c 7669 6465 6f53 616d 706c  _data,videoSampl
+00015f70: 6553 6563 6f6e 6473 290a 2020 2020 2020  eSeconds).      
+00015f80: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
+00015f90: 6c6f 6728 6d73 672c 646f 6e74 5368 6f77  log(msg,dontShow
+00015fa0: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+00015fb0: 2020 2069 6620 6d73 6720 213d 2022 223a     if msg != "":
+00015fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015fd0: 2072 6574 7572 6e4d 7367 202b 3d20 225c   returnMsg += "\
+00015fe0: 6e22 202b 206d 7367 0a20 2020 2020 2020  n" + msg.       
+00015ff0: 2020 2020 2069 6620 6e6f 7420 7375 6363       if not succ
+00016000: 6573 733a 0a20 2020 2020 2020 2020 2020  ess:.           
+00016010: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00016020: 652c 2072 6574 7572 6e4d 7367 0a0a 2020  e, returnMsg..  
+00016030: 2020 2020 2020 2020 2020 2320 636f 6d70            # comp
+00016040: 656e 7361 7465 0a20 2020 2020 2020 2020  ensate.         
+00016050: 2020 2066 6f72 2066 696c 6520 696e 2069     for file in i
+00016060: 6d61 6765 5f64 7473 3a0a 2020 2020 2020  mage_dts:.      
+00016070: 2020 2020 2020 2020 2020 706f 7369 7469            positi
+00016080: 6f6e 7320 3d20 696d 6167 655f 6474 735b  ons = image_dts[
+00016090: 6669 6c65 5d0a 2020 2020 2020 2020 2020  file].          
+000160a0: 2020 2020 2020 6174 7469 7475 6465 7320        attitudes 
+000160b0: 3d20 696d 6167 655f 6474 735f 6174 745b  = image_dts_att[
+000160c0: 6669 6c65 5d0a 2020 2020 2020 2020 2020  file].          
+000160d0: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+000160e0: 616e 6765 286c 656e 2870 6f73 6974 696f  ange(len(positio
+000160f0: 6e73 2929 3a0a 2020 2020 2020 2020 2020  ns)):.          
+00016100: 2020 2020 2020 2020 2020 6c61 7420 3d20            lat = 
+00016110: 706f 7369 7469 6f6e 735b 695d 2e6c 6174  positions[i].lat
+00016120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016130: 2020 2020 206c 6f6e 203d 2070 6f73 6974       lon = posit
+00016140: 696f 6e73 5b69 5d2e 6c6f 6e0a 2020 2020  ions[i].lon.    
+00016150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016160: 6465 7020 3d20 706f 7369 7469 6f6e 735b  dep = positions[
+00016170: 695d 2e64 6570 0a20 2020 2020 2020 2020  i].dep.         
+00016180: 2020 2020 2020 2020 2020 2069 6620 2761             if 'a
+00016190: 6c74 2720 696e 206e 6176 5f68 6561 6465  lt' in nav_heade
+000161a0: 7220 616e 6420 6e6f 7420 2764 6570 2720  r and not 'dep' 
+000161b0: 696e 206e 6176 5f68 6561 6465 723a 0a20  in nav_header:. 
+000161c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000161d0: 2020 2020 2020 2064 6570 202a 3d20 2d31         dep *= -1
+000161e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000161f0: 2020 2020 2079 6177 203d 2061 7474 6974       yaw = attit
+00016200: 7564 6573 5b69 5d2e 7961 770a 2020 2020  udes[i].yaw.    
+00016210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016220: 7069 7463 6820 3d20 6174 7469 7475 6465  pitch = attitude
+00016230: 735b 695d 2e70 6974 6368 0a20 2020 2020  s[i].pitch.     
+00016240: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00016250: 6f6c 6c20 3d20 6174 7469 7475 6465 735b  oll = attitudes[
+00016260: 695d 2e72 6f6c 6c0a 2020 2020 2020 2020  i].roll.        
+00016270: 2020 2020 2020 2020 2020 2020 6966 2079              if y
+00016280: 6177 2069 7320 4e6f 6e65 206f 7220 7069  aw is None or pi
+00016290: 7463 6820 6973 204e 6f6e 6520 6f72 2072  tch is None or r
+000162a0: 6f6c 6c20 6973 204e 6f6e 653a 0a20 2020  oll is None:.   
 000162b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000162c0: 2020 2020 2020 2020 6920 2b3d 2031 0a20          i += 1. 
+000162c0: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
 000162d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000162e0: 2020 2069 6620 6c69 6e65 4e72 2021 3d20     if lineNr != 
-000162f0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-00016300: 2020 2020 2020 2020 2020 2064 656c 206c             del l
-00016310: 696e 6573 5b6c 696e 654e 725d 0a20 2020  ines[lineNr].   
-00016320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016330: 2020 2020 2072 6573 203d 206f 7065 6e28       res = open(
-00016340: 7365 6c66 2e67 6574 5f69 6e74 5f75 7569  self.get_int_uui
-00016350: 645f 6669 6c65 2829 2c20 2277 2229 0a20  d_file(), "w"). 
-00016360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016370: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-00016380: 6c69 6e65 7328 6c69 6e65 7329 0a20 2020  lines(lines).   
-00016390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000163a0: 2020 2020 2072 6573 2e63 6c6f 7365 2829       res.close()
-000163b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000163c0: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
-000163d0: 7469 6f6e 2820 2246 696c 6520 2220 2b20  tion( "File " + 
-000163e0: 6669 6c65 202b 2022 2064 6f65 7320 6e6f  file + " does no
-000163f0: 7420 636f 7461 696e 2061 2076 616c 6964  t cotain a valid
-00016400: 2055 5549 442e 2052 756e 2063 7265 6174   UUID. Run creat
-00016410: 6555 5549 4446 696c 6528 2920 6669 7273  eUUIDFile() firs
-00016420: 7421 2229 0a0a 2020 2020 2020 2020 2020  t!")..          
-00016430: 2020 2020 2020 6669 6c65 5f6e 616d 6520        file_name 
-00016440: 3d20 6f73 2e70 6174 682e 6261 7365 6e61  = os.path.basena
-00016450: 6d65 2866 696c 6529 0a20 2020 2020 2020  me(file).       
-00016460: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00016470: 7265 5265 6164 416c 6c20 616e 6420 6669  reReadAll and fi
-00016480: 6c65 5f6e 616d 6520 696e 2068 6173 6865  le_name in hashe
-00016490: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-000164a0: 2020 2020 2020 2068 6173 6865 735b 6669         hashes[fi
-000164b0: 6c65 5f6e 616d 655d 203d 2068 6173 6865  le_name] = hashe
-000164c0: 735b 6669 6c65 5f6e 616d 655d 5b6d 6971  s[file_name][miq
-000164d0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-000164e0: 6172 6971 7427 5d5b 2768 6173 6827 5d5d  ariqt']['hash']]
-000164f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016500: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00016510: 2020 2020 2020 2020 2020 2068 6173 6865             hashe
-00016520: 735b 6669 6c65 5f6e 616d 655d 203d 206d  s[file_name] = m
-00016530: 6971 7463 2e73 6861 3235 3648 6173 6846  iqtc.sha256HashF
-00016540: 696c 6528 6669 6c65 290a 2020 2020 2020  ile(file).      
-00016550: 2020 2020 2020 2020 2020 2020 2020 6164                ad
-00016560: 6465 645f 6861 7368 6573 202b 3d20 310a  ded_hashes += 1.
-00016570: 2020 2020 2020 2020 2020 2020 7072 6f67              prog
-00016580: 2e63 6c65 6172 2829 0a0a 2020 2020 2020  .clear()..      
-00016590: 2020 2020 2020 6966 2072 6552 6561 6441        if reReadA
-000165a0: 6c6c 206f 7220 6164 6465 645f 6861 7368  ll or added_hash
-000165b0: 6573 203e 2030 3a0a 2020 2020 2020 2020  es > 0:.        
-000165c0: 2020 2020 2020 2020 6861 7368 5f66 696c          hash_fil
-000165d0: 6520 3d20 6f70 656e 2873 656c 662e 6765  e = open(self.ge
-000165e0: 745f 696e 745f 6861 7368 5f66 696c 6528  t_int_hash_file(
-000165f0: 292c 2022 7722 290a 2020 2020 2020 2020  ), "w").        
-00016600: 2020 2020 2020 2020 6861 7368 5f66 696c          hash_fil
-00016610: 652e 7772 6974 6528 206d 6971 7476 2e63  e.write( miqtv.c
-00016620: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-00016630: 7427 5d5b 2769 6d67 275d 2b22 5c74 222b  t']['img']+"\t"+
-00016640: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-00016650: 5b27 6d61 7269 7174 275d 5b27 6861 7368  ['mariqt']['hash
-00016660: 275d 2b22 5c6e 2229 0a20 2020 2020 2020  ']+"\n").       
-00016670: 2020 2020 2020 2020 2066 6f72 2066 696c           for fil
-00016680: 655f 6e61 6d65 2069 6e20 6861 7368 6573  e_name in hashes
-00016690: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000166a0: 2020 2020 2020 6861 7368 5f66 696c 652e        hash_file.
-000166b0: 7772 6974 6528 6669 6c65 5f6e 616d 652b  write(file_name+
-000166c0: 225c 7422 2b68 6173 6865 735b 6669 6c65  "\t"+hashes[file
-000166d0: 5f6e 616d 655d 2b22 5c6e 2229 0a0a 2020  _name]+"\n")..  
-000166e0: 2020 2020 2020 2020 2020 2020 2020 6861                ha
-000166f0: 7368 5f66 696c 652e 636c 6f73 6528 290a  sh_file.close().
-00016700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016710: 7265 7475 726e 2054 7275 652c 2022 4164  return True, "Ad
-00016720: 6465 6420 222b 7374 7228 6164 6465 645f  ded "+str(added_
-00016730: 6861 7368 6573 292b 2220 6861 7368 6573  hashes)+" hashes
-00016740: 2074 6f20 6861 7368 2066 696c 6522 0a20   to hash file". 
-00016750: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00016760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016770: 2072 6574 7572 6e20 5472 7565 2c20 2241   return True, "A
-00016780: 6c6c 2068 6173 6865 7320 6578 6973 7422  ll hashes exist"
-00016790: 0a0a 2020 2020 2020 2020 656c 7365 3a0a  ..        else:.
-000167a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000167b0: 726e 2046 616c 7365 2c20 224e 6f20 696d  rn False, "No im
-000167c0: 6167 6573 2066 6f75 6e64 2074 6f20 6861  ages found to ha
-000167d0: 7368 220a 0a0a 2020 2020 6465 6620 6372  sh"...    def cr
-000167e0: 6561 7465 5374 6172 7454 696d 6546 696c  eateStartTimeFil
-000167f0: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
-00016800: 2022 2222 2043 7265 6174 6573 2069 6e20   """ Creates in 
-00016810: 2f69 6e74 6572 6d65 6469 6174 6520 6120  /intermediate a 
-00016820: 7465 7874 2066 696c 6520 636f 6e74 6169  text file contai
-00016830: 6e69 6e67 2070 6572 2069 6d61 6765 2069  ning per image i
-00016840: 7473 2073 7461 7274 2074 696d 6520 7061  ts start time pa
-00016850: 7273 6564 2066 726f 6d20 7468 6520 6669  rsed from the fi
-00016860: 6c65 206e 616d 6520 2222 220a 0a20 2020  le name """..   
-00016870: 2020 2020 2073 203d 206d 6971 7463 2e50       s = miqtc.P
-00016880: 7269 6e74 4c6f 6164 696e 674d 7367 2822  rintLoadingMsg("
-00016890: 4372 6561 7469 6e67 2069 6e74 6572 6d65  Creating interme
-000168a0: 6469 6174 6520 7374 6172 7474 696d 6520  diate starttime 
-000168b0: 6669 6c65 2022 290a 2020 2020 2020 2020  file ").        
-000168c0: 696d 6167 6573 496e 5261 7720 3d20 7365  imagesInRaw = se
-000168d0: 6c66 2e69 6d61 6765 7349 6e49 6d61 6765  lf.imagesInImage
-000168e0: 7344 6972 536f 7274 6564 4c69 7374 2829  sDirSortedList()
-000168f0: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-00016900: 696d 6167 6573 496e 5261 7729 203e 2030  imagesInRaw) > 0
-00016910: 3a0a 0a20 2020 2020 2020 2020 2020 206f  :..            o
-00016920: 203d 206f 7065 6e28 7365 6c66 2e67 6574   = open(self.get
-00016930: 5f69 6e74 5f73 7461 7274 5469 6d65 735f  _int_startTimes_
-00016940: 6669 6c65 2829 2c20 2277 2229 0a20 2020  file(), "w").   
-00016950: 2020 2020 2020 2020 206f 2e77 7269 7465           o.write
-00016960: 286d 6971 7476 2e63 6f6c 5f68 6561 6465  (miqtv.col_heade
-00016970: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
-00016980: 275d 202b 0a20 2020 2020 2020 2020 2020  '] +.           
-00016990: 2020 2020 2020 2020 2022 5c74 222b 6d69           "\t"+mi
-000169a0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-000169b0: 6d61 7269 7174 275d 5b27 7574 6327 5d2b  mariqt']['utc']+
-000169c0: 225c 6e22 290a 0a20 2020 2020 2020 2020  "\n")..         
-000169d0: 2020 2066 6f72 2066 696c 6520 696e 2069     for file in i
-000169e0: 6d61 6765 7349 6e52 6177 3a0a 2020 2020  magesInRaw:.    
-000169f0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-00016a00: 5f6e 616d 6520 3d20 6f73 2e70 6174 682e  _name = os.path.
-00016a10: 6261 7365 6e61 6d65 2866 696c 6529 0a0a  basename(file)..
-00016a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a30: 6474 203d 206d 6971 7463 2e70 6172 7365  dt = miqtc.parse
-00016a40: 4669 6c65 4461 7465 5469 6d65 4173 5554  FileDateTimeAsUT
-00016a50: 4328 6669 6c65 5f6e 616d 6529 0a20 2020  C(file_name).   
-00016a60: 2020 2020 2020 2020 2020 2020 206f 2e77               o.w
-00016a70: 7269 7465 2866 696c 655f 6e61 6d65 2b22  rite(file_name+"
-00016a80: 5c74 2220 2b20 6474 2e73 7472 6674 696d  \t" + dt.strftim
-00016a90: 6528 6d69 7174 762e 6461 7465 5f66 6f72  e(miqtv.date_for
-00016aa0: 6d61 7473 5b27 6d61 7269 7174 275d 292b  mats['mariqt'])+
-00016ab0: 225c 6e22 290a 0a20 2020 2020 2020 2020  "\n")..         
-00016ac0: 2020 206f 2e63 6c6f 7365 2829 0a20 2020     o.close().   
-00016ad0: 2020 2020 2020 2020 2073 2e73 746f 7028           s.stop(
-00016ae0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00016af0: 7475 726e 2054 7275 652c 2022 4372 6561  turn True, "Crea
-00016b00: 7465 6420 7374 6172 7420 7469 6d65 2066  ted start time f
-00016b10: 696c 6522 0a20 2020 2020 2020 2065 6c73  ile".        els
-00016b20: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-00016b30: 2e73 746f 7028 290a 2020 2020 2020 2020  .stop().        
-00016b40: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00016b50: 2c20 224e 6f20 696d 6167 6573 2066 6f75  , "No images fou
-00016b60: 6e64 2074 6f20 7265 6164 2073 7461 7274  nd to read start
-00016b70: 2074 696d 6573 220a 0a0a 2020 2020 6465   times"...    de
-00016b80: 6620 6372 6561 7465 4163 7175 6973 6974  f createAcquisit
-00016b90: 696f 6e53 6574 7469 6e67 7345 5849 4646  ionSettingsEXIFF
-00016ba0: 696c 6528 7365 6c66 2c6f 7665 7272 6964  ile(self,overrid
-00016bb0: 653d 4661 6c73 6529 3a0a 2020 2020 2020  e=False):.      
-00016bc0: 2020 2222 2220 4372 6561 7465 7320 696e    """ Creates in
-00016bd0: 202f 696e 7465 726d 6564 6961 7465 2061   /intermediate a
-00016be0: 2074 6578 7420 6669 6c65 2063 6f6e 7461   text file conta
-00016bf0: 696e 696e 6720 7065 7220 696d 6167 6520  ining per image 
-00016c00: 6120 6469 6374 206f 6620 6578 6966 2074  a dict of exif t
-00016c10: 6167 7320 616e 6420 7468 6569 7220 7661  ags and their va
-00016c20: 6c75 6573 2070 6172 7365 6420 6672 6f6d  lues parsed from
-00016c30: 2074 6865 2069 6d61 6765 2022 2222 0a0a   the image """..
-00016c40: 2020 2020 2020 2020 696e 745f 6163 7175          int_acqu
-00016c50: 6973 6974 696f 6e53 6574 7469 6e67 5f66  isitionSetting_f
-00016c60: 696c 6520 3d20 7365 6c66 2e5f 5f67 6574  ile = self.__get
-00016c70: 5f69 6e74 5f66 696c 655f 7072 6566 6978  _int_file_prefix
-00016c80: 2829 202b 2027 5f69 6d61 6765 2d61 6371  () + '_image-acq
-00016c90: 7569 7369 7469 6f6e 2d73 6574 7469 6e67  uisition-setting
-00016ca0: 732e 7478 7427 0a20 2020 2020 2020 2068  s.txt'.        h
-00016cb0: 6561 6465 7220 3d20 7b20 206d 6971 7476  eader = {  miqtv
-00016cc0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00016cd0: 6971 7427 5d5b 2769 6d67 275d 3a20 206d  iqt']['img']:  m
-00016ce0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-00016cf0: 276d 6172 6971 7427 5d5b 2769 6d67 275d  'mariqt']['img']
-00016d00: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00016d10: 2020 2020 2020 6d69 7174 762e 636f 6c5f        miqtv.col_
-00016d20: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-00016d30: 5b27 6163 7175 6927 5d3a 6d69 7174 762e  ['acqui']:miqtv.
-00016d40: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00016d50: 7174 275d 5b27 6163 7175 6927 5d7d 0a20  qt']['acqui']}. 
-00016d60: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
-00016d70: 682e 6578 6973 7473 2869 6e74 5f61 6371  h.exists(int_acq
-00016d80: 7569 7369 7469 6f6e 5365 7474 696e 675f  uisitionSetting_
-00016d90: 6669 6c65 2920 616e 6420 6e6f 7420 6f76  file) and not ov
-00016da0: 6572 7269 6465 3a0a 2020 2020 2020 2020  erride:.        
-00016db0: 2020 2020 7365 6c66 2e61 6464 4974 656d      self.addItem
-00016dc0: 496e 666f 5461 6246 696c 6528 696e 745f  InfoTabFile(int_
-00016dd0: 6163 7175 6973 6974 696f 6e53 6574 7469  acquisitionSetti
-00016de0: 6e67 5f66 696c 652c 225c 7422 2c68 6561  ng_file,"\t",hea
-00016df0: 6465 7229 0a20 2020 2020 2020 2020 2020  der).           
-00016e00: 2072 6574 7572 6e20 5472 7565 2c20 2252   return True, "R
-00016e10: 6573 756c 7420 6669 6c65 2065 7869 7374  esult file exist
-00016e20: 7322 0a0a 2020 2020 2020 2020 696d 6167  s"..        imag
-00016e30: 6573 496e 5261 7720 3d20 7365 6c66 2e69  esInRaw = self.i
-00016e40: 6d61 6765 7349 6e49 6d61 6765 7344 6972  magesInImagesDir
-00016e50: 536f 7274 6564 4c69 7374 2829 0a20 2020  SortedList().   
-00016e60: 2020 2020 2069 6620 6c65 6e28 696d 6167       if len(imag
-00016e70: 6573 496e 5261 7729 203e 2030 3a0a 0a20  esInRaw) > 0:.. 
-00016e80: 2020 2020 2020 2020 2020 206f 203d 206f             o = o
-00016e90: 7065 6e28 696e 745f 6163 7175 6973 6974  pen(int_acquisit
-00016ea0: 696f 6e53 6574 7469 6e67 5f66 696c 652c  ionSetting_file,
-00016eb0: 2022 7722 290a 2020 2020 2020 2020 2020   "w").          
-00016ec0: 2020 6f2e 7772 6974 6528 6d69 7174 762e    o.write(miqtv.
-00016ed0: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00016ee0: 7174 275d 5b27 696d 6727 5d20 2b20 225c  qt']['img'] + "\
-00016ef0: 7422 2b6d 6971 7476 2e63 6f6c 5f68 6561  t"+miqtv.col_hea
-00016f00: 6465 725b 276d 6172 6971 7427 5d5b 2761  der['mariqt']['a
-00016f10: 6371 7569 275d 2b22 5c6e 2229 0a20 0a20  cqui']+"\n"). . 
-00016f20: 2020 2020 2020 2020 2020 2069 6d61 6765             image
-00016f30: 7345 7869 6673 203d 206d 6971 7469 2e67  sExifs = miqti.g
-00016f40: 6574 496d 6167 6573 416c 6c45 7869 6656  etImagesAllExifV
-00016f50: 616c 7565 7328 696d 6167 6573 496e 5261  alues(imagesInRa
-00016f60: 772c 7365 6c66 2e70 726f 7629 0a20 2020  w,self.prov).   
-00016f70: 2020 2020 2020 2020 2066 6f72 2066 696c           for fil
-00016f80: 6520 696e 2069 6d61 6765 7345 7869 6673  e in imagesExifs
-00016f90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016fa0: 2020 6669 6c65 5f6e 616d 6520 3d20 6f73    file_name = os
-00016fb0: 2e70 6174 682e 6261 7365 6e61 6d65 2866  .path.basename(f
-00016fc0: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
-00016fd0: 2020 2020 206f 2e77 7269 7465 2866 696c       o.write(fil
-00016fe0: 655f 6e61 6d65 2b22 5c74 222b 7374 7228  e_name+"\t"+str(
-00016ff0: 696d 6167 6573 4578 6966 735b 6669 6c65  imagesExifs[file
-00017000: 5d29 2b22 5c6e 2229 0a0a 2020 2020 2020  ])+"\n")..      
-00017010: 2020 2020 2020 6f2e 636c 6f73 6528 290a        o.close().
-00017020: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00017030: 662e 6164 6449 7465 6d49 6e66 6f54 6162  f.addItemInfoTab
-00017040: 4669 6c65 2869 6e74 5f61 6371 7569 7369  File(int_acquisi
-00017050: 7469 6f6e 5365 7474 696e 675f 6669 6c65  tionSetting_file
-00017060: 2c22 5c74 222c 6865 6164 6572 290a 2020  ,"\t",header).  
-00017070: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00017080: 2054 7275 652c 2022 4372 6561 7465 6420   True, "Created 
-00017090: 6163 7175 6973 6974 696f 6e20 7365 7474  acquisition sett
-000170a0: 696e 6773 2066 696c 6522 0a20 2020 2020  ings file".     
-000170b0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000170c0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-000170d0: 652c 2022 4e6f 2069 6d61 6765 7320 666f  e, "No images fo
-000170e0: 756e 6422 0a0a 0a20 2020 2064 6566 2069  und"...    def i
-000170f0: 6d61 6765 7349 6e49 6d61 6765 7344 6972  magesInImagesDir
-00017100: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00017110: 7265 7475 726e 2063 6f70 792e 6465 6570  return copy.deep
-00017120: 636f 7079 2873 656c 662e 5f69 6d61 6765  copy(self._image
-00017130: 7349 6e49 6d61 6765 7344 6972 290a 0a20  sInImagesDir).. 
-00017140: 2020 2064 6566 2069 6d61 6765 7349 6e49     def imagesInI
-00017150: 6d61 6765 7344 6972 536f 7274 6564 4c69  magesDirSortedLi
-00017160: 7374 2873 656c 6629 3a0a 2020 2020 2020  st(self):.      
-00017170: 2020 7265 7475 726e 2063 6f70 792e 6465    return copy.de
-00017180: 6570 636f 7079 2873 656c 662e 5f69 6d61  epcopy(self._ima
-00017190: 6765 7349 6e49 6d61 6765 7344 6972 536f  gesInImagesDirSo
-000171a0: 7274 6564 4c69 7374 290a 0a0a 2020 2020  rtedList)...    
-000171b0: 6465 6620 7061 7273 6549 7465 6d44 6174  def parseItemDat
-000171c0: 6166 726f 6d54 6162 4669 6c65 4461 7461  afromTabFileData
-000171d0: 2873 656c 662c 2069 7465 6d73 3a20 6469  (self, items: di
-000171e0: 6374 2c20 6669 6c65 3a20 7374 722c 2063  ct, file: str, c
-000171f0: 6f6c 733a 206c 6973 742c 206f 7074 696f  ols: list, optio
-00017200: 6e61 6c3a 206c 6973 7420 3d20 5b5d 2c20  nal: list = [], 
-00017210: 6461 7465 7469 6d65 5f66 6f72 6d61 743a  datetime_format:
-00017220: 7374 723d 6d69 7174 762e 6461 7465 5f66  str=miqtv.date_f
-00017230: 6f72 6d61 7473 5b27 6d61 7269 7174 275d  ormats['mariqt']
-00017240: 293a 0a20 2020 2020 2020 2022 2222 2070  ):.        """ p
-00017250: 6172 7365 7320 6461 7461 2066 726f 6d20  arses data from 
-00017260: 636f 6c75 6d6e 7320 696e 2063 6f6c 7320  columns in cols 
-00017270: 616e 6420 7772 6974 6573 2069 6e66 6f20  and writes info 
-00017280: 746f 2069 7465 6d73 2e20 436f 6c75 6d6e  to items. Column
-00017290: 2027 696d 6167 652d 6669 6c65 6e61 6d65   'image-filename
-000172a0: 2720 6d75 7374 2062 6520 696e 2066 696c  ' must be in fil
-000172b0: 6520 616e 6420 646f 6573 206e 6f74 206e  e and does not n
-000172c0: 6565 6420 746f 2062 6520 7061 7373 6564  eed to be passed
-000172d0: 2069 6e20 636f 6c73 2e20 0a20 2020 2020   in cols. .     
-000172e0: 2020 2020 2020 2046 696c 6520 6d75 7374         File must
-000172f0: 2062 6520 7461 6220 7365 7061 7261 7465   be tab separate
-00017300: 6420 616e 6420 636f 6c75 6d6e 7320 6e61  d and columns na
-00017310: 6d65 7320 6d75 7374 2065 7175 616c 2069  mes must equal i
-00017320: 7465 6d20 6669 656c 6420 6e61 6d65 7322  tem field names"
-00017330: 2222 0a20 2020 2020 2020 2074 6d70 5f64  "".        tmp_d
-00017340: 6174 6120 3d20 6d69 7174 662e 7461 6246  ata = miqtf.tabF
-00017350: 696c 6544 6174 6128 6669 6c65 2c20 636f  ileData(file, co
-00017360: 6c73 2b5b 2769 6d61 6765 2d66 696c 656e  ls+['image-filen
-00017370: 616d 6527 5d2b 6f70 7469 6f6e 616c 2c20  ame']+optional, 
-00017380: 6b65 795f 636f 6c3d 2769 6d61 6765 2d66  key_col='image-f
-00017390: 696c 656e 616d 6527 2c20 6f70 7469 6f6e  ilename', option
-000173a0: 616c 3d6f 7074 696f 6e61 6c2c 636f 6e76  al=optional,conv
-000173b0: 6572 743d 5472 7565 290a 2020 2020 2020  ert=True).      
-000173c0: 2020 7365 6c66 2e77 7269 7465 5061 7273    self.writePars
-000173d0: 6564 4461 7461 546f 4974 656d 7328 746d  edDataToItems(tm
-000173e0: 705f 6461 7461 2c69 7465 6d73 2c73 656c  p_data,items,sel
-000173f0: 662e 6966 646f 5f74 6d70 5b6d 6971 7476  f.ifdo_tmp[miqtv
-00017400: 2e69 6d61 6765 5f73 6574 5f68 6561 6465  .image_set_heade
-00017410: 725f 6b65 795d 2c20 6461 7465 7469 6d65  r_key], datetime
-00017420: 5f66 6f72 6d61 743d 6461 7465 7469 6d65  _format=datetime
-00017430: 5f66 6f72 6d61 7429 0a0a 0a20 2020 2064  _format)...    d
-00017440: 6566 2070 7261 7365 4974 656d 4461 7461  ef praseItemData
-00017450: 4672 6f6d 4669 6c65 2873 656c 662c 6974  FromFile(self,it
-00017460: 656d 733a 6469 6374 2c66 696c 653a 7374  ems:dict,file:st
-00017470: 722c 7365 7061 7261 746f 723a 7374 722c  r,separator:str,
-00017480: 6865 6164 6572 3a64 6963 742c 2064 6174  header:dict, dat
-00017490: 6574 696d 655f 666f 726d 6174 3a73 7472  etime_format:str
-000174a0: 3d6d 6971 7476 2e64 6174 655f 666f 726d  =miqtv.date_form
-000174b0: 6174 735b 276d 6172 6971 7427 5d29 3a0a  ats['mariqt']):.
-000174c0: 2020 2020 2020 2020 2222 2220 7061 7273          """ pars
-000174d0: 6573 2064 6174 6120 6672 6f6d 2066 726f  es data from fro
-000174e0: 6d20 6669 6c65 2074 6f20 6974 656d 732e  m file to items.
-000174f0: 2068 6561 6465 7220 6469 6374 206d 7573   header dict mus
-00017500: 7420 6265 206f 6620 7374 7275 6374 7572  t be of structur
-00017510: 653a 207b 3c69 7465 6d2d 6669 656c 642d  e: {<item-field-
-00017520: 6e61 6d65 3e3a 3c63 6f6c 756d 6e2d 6e61  name>:<column-na
-00017530: 6d65 3e7d 0a20 2020 2020 2020 2020 2020  me>}.           
-00017540: 2061 6e64 206d 7573 7420 636f 6e74 6169   and must contai
-00017550: 6e20 656e 7472 7920 2769 6d61 6765 2d66  n entry 'image-f
-00017560: 696c 656e 616d 6527 2022 2222 0a20 2020  ilename' """.   
-00017570: 2020 2020 2069 6620 6e6f 7420 2769 6d61       if not 'ima
-00017580: 6765 2d66 696c 656e 616d 6527 2069 6e20  ge-filename' in 
-00017590: 6865 6164 6572 3a0a 2020 2020 2020 2020  header:.        
-000175a0: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
-000175b0: 696f 6e28 2268 6561 6465 7220 646f 6573  ion("header does
-000175c0: 206e 6f74 2063 6f6e 7461 696e 2027 696d   not contain 'im
-000175d0: 6167 652d 6669 6c65 6e61 6d65 2722 290a  age-filename'").
-000175e0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-000175f0: 2074 6d70 5f64 6174 6120 3d20 6d69 7174   tmp_data = miqt
-00017600: 662e 7461 6246 696c 6544 6174 6128 6669  f.tabFileData(fi
-00017610: 6c65 2c20 6865 6164 6572 2c63 6f6c 5f73  le, header,col_s
-00017620: 6570 6172 6174 6f72 3d73 6570 6172 6174  eparator=separat
-00017630: 6f72 2c20 6b65 795f 636f 6c3d 2769 6d61  or, key_col='ima
-00017640: 6765 2d66 696c 656e 616d 6527 2c63 6f6e  ge-filename',con
-00017650: 7665 7274 3d54 7275 6529 0a20 2020 2020  vert=True).     
-00017660: 2020 2073 656c 662e 7772 6974 6550 6172     self.writePar
-00017670: 7365 6444 6174 6154 6f49 7465 6d73 2874  sedDataToItems(t
-00017680: 6d70 5f64 6174 612c 6974 656d 732c 7365  mp_data,items,se
-00017690: 6c66 2e69 6664 6f5f 746d 705b 6d69 7174  lf.ifdo_tmp[miqt
-000176a0: 762e 696d 6167 655f 7365 745f 6865 6164  v.image_set_head
-000176b0: 6572 5f6b 6579 5d2c 2064 6174 6574 696d  er_key], datetim
-000176c0: 655f 666f 726d 6174 3d64 6174 6574 696d  e_format=datetim
-000176d0: 655f 666f 726d 6174 290a 0a0a 2020 2020  e_format)...    
-000176e0: 6465 6620 7772 6974 6550 6172 7365 6444  def writeParsedD
-000176f0: 6174 6154 6f49 7465 6d73 2873 656c 662c  ataToItems(self,
-00017700: 6461 7461 3a64 6963 742c 6974 656d 733a  data:dict,items:
-00017710: 6469 6374 2c68 6561 6465 723a 6469 6374  dict,header:dict
-00017720: 2c20 6461 7465 7469 6d65 5f66 6f72 6d61  , datetime_forma
-00017730: 743a 7374 723d 6d69 7174 762e 6461 7465  t:str=miqtv.date
-00017740: 5f66 6f72 6d61 7473 5b27 6d61 7269 7174  _formats['mariqt
-00017750: 275d 293a 0a0a 2020 2020 2020 2020 2320  ']):..        # 
-00017760: 6576 616c 2073 7472 696e 6773 2061 7320  eval strings as 
-00017770: 6469 6374 206f 7220 6c69 7374 0a20 2020  dict or list.   
-00017780: 2020 2020 206d 6971 7463 2e72 6563 7572       miqtc.recur
-00017790: 7369 7665 4576 616c 2864 6174 6129 0a0a  siveEval(data)..
-000177a0: 2020 2020 2020 2020 2320 706f 7465 6e74          # potent
-000177b0: 6169 6c6c 7920 7265 6d6f 7665 2063 6f6e  ailly remove con
-000177c0: 7374 2064 6174 6120 6672 6f6d 2069 7465  st data from ite
-000177d0: 6d73 2061 6e64 2070 7574 2069 6e20 6865  ms and put in he
-000177e0: 6164 6572 0a20 2020 2020 2020 2073 656c  ader.        sel
-000177f0: 662e 6578 7472 6163 7443 6f6e 7374 4461  f.extractConstDa
-00017800: 7461 5661 6c75 6573 2864 6174 612c 6865  taValues(data,he
-00017810: 6164 6572 290a 0a20 2020 2020 2020 2064  ader)..        d
-00017820: 6174 6120 3d20 6d69 7174 632e 7265 6375  ata = miqtc.recu
-00017830: 7273 6976 656c 7952 656d 6f76 6545 6d70  rsivelyRemoveEmp
-00017840: 7479 4669 656c 6473 2864 6174 612c 636f  tyFields(data,co
-00017850: 6e74 656e 7432 6265 5265 6d6f 7665 643d  ntent2beRemoved=
-00017860: 4e6f 6e65 290a 0a20 2020 2020 2020 2023  None)..        #
-00017870: 2061 6464 2027 696d 6167 652d 6669 6c65   add 'image-file
-00017880: 6e61 6d65 2720 6669 656c 640a 2020 2020  name' field.    
-00017890: 2020 2020 666f 7220 696d 672c 2065 6e74      for img, ent
-000178a0: 7279 2069 6e20 6461 7461 2e69 7465 6d73  ry in data.items
-000178b0: 2829 3a0a 0a20 2020 2020 2020 2020 2020  ():..           
-000178c0: 2023 206c 6973 740a 2020 2020 2020 2020   # list.        
-000178d0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-000178e0: 6528 656e 7472 792c 6c69 7374 293a 0a20  e(entry,list):. 
-000178f0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00017900: 6f72 206c 6973 7449 7465 6d20 696e 2065  or listItem in e
-00017910: 6e74 7279 3a0a 2020 2020 2020 2020 2020  ntry:.          
-00017920: 2020 2020 2020 2020 2020 6c69 7374 4974            listIt
-00017930: 656d 5b27 696d 6167 652d 6669 6c65 6e61  em['image-filena
-00017940: 6d65 275d 203d 2069 6d67 0a20 2020 2020  me'] = img.     
-00017950: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00017960: 2063 6f76 6572 7420 6461 7465 7469 6d65   covert datetime
-00017970: 2073 7472 696e 670a 2020 2020 2020 2020   string.        
-00017980: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-00017990: 696d 6167 652d 6461 7465 7469 6d65 2720  image-datetime' 
-000179a0: 696e 206c 6973 7449 7465 6d3a 0a20 2020  in listItem:.   
-000179b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000179c0: 2020 2020 2064 7420 3d20 6461 7465 7469       dt = dateti
-000179d0: 6d65 2e64 6174 6574 696d 652e 7374 7270  me.datetime.strp
-000179e0: 7469 6d65 286c 6973 7449 7465 6d5b 2769  time(listItem['i
-000179f0: 6d61 6765 2d64 6174 6574 696d 6527 5d2c  mage-datetime'],
-00017a00: 2064 6174 6574 696d 655f 666f 726d 6174   datetime_format
-00017a10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00017a20: 2020 2020 2020 2020 2020 6c69 7374 4974            listIt
-00017a30: 656d 5b27 696d 6167 652d 6461 7465 7469  em['image-dateti
-00017a40: 6d65 275d 203d 2064 742e 7374 7266 7469  me'] = dt.strfti
-00017a50: 6d65 286d 6971 7476 2e64 6174 655f 666f  me(miqtv.date_fo
-00017a60: 726d 6174 735b 276d 6172 6971 7427 5d29  rmats['mariqt'])
-00017a70: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00017a80: 6620 6973 696e 7374 616e 6365 2865 6e74  f isinstance(ent
-00017a90: 7279 2c64 6963 7429 3a0a 2020 2020 2020  ry,dict):.      
-00017aa0: 2020 2020 2020 2020 2020 656e 7472 795b            entry[
-00017ab0: 2769 6d61 6765 2d66 696c 656e 616d 6527  'image-filename'
-00017ac0: 5d20 3d20 696d 670a 2020 2020 2020 2020  ] = img.        
-00017ad0: 2020 2020 2020 2020 2320 636f 7665 7274          # covert
-00017ae0: 2064 6174 6574 696d 6520 7374 7269 6e67   datetime string
-00017af0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017b00: 2069 6620 2769 6d61 6765 2d64 6174 6574   if 'image-datet
-00017b10: 696d 6527 2069 6e20 656e 7472 793a 0a20  ime' in entry:. 
-00017b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017b30: 2020 2064 7420 3d20 6461 7465 7469 6d65     dt = datetime
-00017b40: 2e64 6174 6574 696d 652e 7374 7270 7469  .datetime.strpti
-00017b50: 6d65 2865 6e74 7279 5b27 696d 6167 652d  me(entry['image-
-00017b60: 6461 7465 7469 6d65 275d 2c20 6461 7465  datetime'], date
-00017b70: 7469 6d65 5f66 6f72 6d61 7429 0a20 2020  time_format).   
-00017b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017b90: 2065 6e74 7279 5b27 696d 6167 652d 6461   entry['image-da
-00017ba0: 7465 7469 6d65 275d 203d 2064 742e 7374  tetime'] = dt.st
-00017bb0: 7266 7469 6d65 286d 6971 7476 2e64 6174  rftime(miqtv.dat
-00017bc0: 655f 666f 726d 6174 735b 276d 6172 6971  e_formats['mariq
-00017bd0: 7427 5d29 0a20 2020 2020 2020 2020 2020  t']).           
-00017be0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00017bf0: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
-00017c00: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
-00017c10: 2822 6461 7461 2065 6e74 7269 6573 206d  ("data entries m
-00017c20: 7573 7420 6265 2064 6963 7420 6f72 206c  ust be dict or l
-00017c30: 6973 7420 6966 2064 6963 7473 2229 0a0a  ist if dicts")..
-00017c40: 2020 2020 2020 2020 6d69 7174 632e 7265          miqtc.re
-00017c50: 6375 7273 6976 656c 7955 7064 6174 6544  cursivelyUpdateD
-00017c60: 6963 7473 2869 7465 6d73 2c64 6174 6129  icts(items,data)
-00017c70: 0a0a 0a20 2020 2040 7374 6174 6963 6d65  ...    @staticme
-00017c80: 7468 6f64 0a20 2020 2064 6566 2065 7874  thod.    def ext
-00017c90: 7261 6374 436f 6e73 7444 6174 6156 616c  ractConstDataVal
-00017ca0: 7565 7328 6461 7461 3a64 6963 742c 6865  ues(data:dict,he
-00017cb0: 6164 6572 3a64 6963 7429 3a0a 2020 2020  ader:dict):.    
-00017cc0: 2020 2020 2222 2220 5265 6d6f 7665 7320      """ Removes 
-00017cd0: 6669 656c 6473 2074 6861 7420 6172 6520  fields that are 
-00017ce0: 636f 6e73 7461 6e74 2066 6f72 2061 6c6c  constant for all
-00017cf0: 2065 6e74 7269 6573 2066 726f 6d20 6461   entries from da
-00017d00: 7461 2064 6963 7420 616e 6420 7075 7420  ta dict and put 
-00017d10: 7468 656d 2069 6e20 6865 6164 6572 2064  them in header d
-00017d20: 6963 742e 200a 2020 2020 2020 2020 2020  ict. .          
-00017d30: 2020 4561 6368 2065 6e74 7279 206f 6620    Each entry of 
-00017d40: 6461 7461 206d 7573 7420 6265 2061 2064  data must be a d
-00017d50: 6963 7420 7769 7468 2074 6865 2073 616d  ict with the sam
-00017d60: 6520 7365 7420 6f66 206b 6579 732e 2022  e set of keys. "
-00017d70: 2222 0a20 2020 200a 2020 2020 2020 2020  "".    .        
-00017d80: 6669 656c 6473 546f 4967 6e6f 7265 203d  fieldsToIgnore =
-00017d90: 205b 2769 6d61 6765 2d64 6174 6574 696d   ['image-datetim
-00017da0: 6527 5d0a 2020 2020 2020 2020 636f 6e73  e'].        cons
-00017db0: 7444 6174 6120 3d20 7b7d 0a20 2020 2020  tData = {}.     
-00017dc0: 2020 2066 6972 7374 496d 6167 6520 3d20     firstImage = 
-00017dd0: 5472 7565 0a20 2020 2020 2020 2066 6f72  True.        for
-00017de0: 2069 6d61 6765 2c69 6d61 6765 5f64 6174   image,image_dat
-00017df0: 6120 696e 2064 6174 612e 6974 656d 7328  a in data.items(
-00017e00: 293a 0a20 2020 2020 2020 2020 2020 200a  ):.            .
-00017e10: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00017e20: 6f74 2069 7369 6e73 7461 6e63 6528 696d  ot isinstance(im
-00017e30: 6167 655f 6461 7461 2c6c 6973 7429 3a0a  age_data,list):.
-00017e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017e50: 696d 6167 655f 6461 7461 203d 205b 696d  image_data = [im
-00017e60: 6167 655f 6461 7461 5d0a 0a20 2020 2020  age_data]..     
-00017e70: 2020 2020 2020 2069 6620 6e6f 7420 6669         if not fi
-00017e80: 7273 7449 6d61 6765 2061 6e64 2063 6f6e  rstImage and con
-00017e90: 7374 4461 7461 203d 3d20 7b7d 3a0a 2020  stData == {}:.  
-00017ea0: 2020 2020 2020 2020 2020 2020 2020 6272                br
-00017eb0: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
-00017ec0: 0a20 2020 2020 2020 2020 2020 2066 6972  .            fir
-00017ed0: 7374 5469 6d65 506f 696e 7420 3d20 5472  stTimePoint = Tr
-00017ee0: 7565 0a20 2020 2020 2020 2020 2020 2066  ue.            f
-00017ef0: 6f72 2069 6d61 6765 5f74 705f 6461 7461  or image_tp_data
-00017f00: 2069 6e20 696d 6167 655f 6461 7461 3a0a   in image_data:.
+000162e0: 2020 6e65 775f 6c61 742c 6e65 775f 6c6f    new_lat,new_lo
+000162f0: 6e2c 6e65 775f 6465 7020 3d20 6d69 7174  n,new_dep = miqt
+00016300: 672e 6164 644c 6576 6572 6172 6d73 324c  g.addLeverarms2L
+00016310: 6174 6c6f 6e28 6c61 742c 6c6f 6e2c 6465  atlon(lat,lon,de
+00016320: 702c 6f66 6673 6574 5f78 2c6f 6666 7365  p,offset_x,offse
+00016330: 745f 792c 6f66 6673 6574 5f7a 2c79 6177  t_y,offset_z,yaw
+00016340: 2c70 6974 6368 2c72 6f6c 6c29 0a20 2020  ,pitch,roll).   
+00016350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016360: 2070 6f73 6974 696f 6e73 5b69 5d2e 6c61   positions[i].la
+00016370: 7420 3d20 6e65 775f 6c61 740a 2020 2020  t = new_lat.    
+00016380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016390: 706f 7369 7469 6f6e 735b 695d 2e6c 6f6e  positions[i].lon
+000163a0: 203d 206e 6577 5f6c 6f6e 0a20 2020 2020   = new_lon.     
+000163b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000163c0: 6f73 6974 696f 6e73 5b69 5d2e 6465 7020  ositions[i].dep 
+000163d0: 3d20 6e65 775f 6465 700a 0a20 2020 2020  = new_dep..     
+000163e0: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+000163f0: 2e6c 6f67 2822 6170 706c 6965 6420 6c65  .log("applied le
+00016400: 7665 7220 6172 6d20 636f 6d70 656e 7361  ver arm compensa
+00016410: 7469 6f6e 2078 2c79 2c7a 203d 2022 202b  tion x,y,z = " +
+00016420: 2073 7472 286f 6666 7365 745f 7829 202b   str(offset_x) +
+00016430: 2022 2c22 202b 2073 7472 286f 6666 7365   "," + str(offse
+00016440: 745f 7929 202b 2022 2c22 202b 2073 7472  t_y) + "," + str
+00016450: 286f 6666 7365 745f 7a29 2c64 6f6e 7453  (offset_z),dontS
+00016460: 686f 773d 5472 7565 290a 0a20 2020 2020  how=True)..     
+00016470: 2020 2069 6620 6c65 6e28 696d 6167 655f     if len(image_
+00016480: 6474 7329 203e 2030 3a0a 2020 2020 2020  dts) > 0:.      
+00016490: 2020 2020 2020 2320 4368 6563 6b20 7768        # Check wh
+000164a0: 6574 6865 7220 6465 7074 6820 616e 6420  ether depth and 
+000164b0: 6865 6967 6874 2061 7265 2073 6574 0a20  height are set. 
+000164c0: 2020 2020 2020 2020 2020 206c 6174 5f69             lat_i
+000164d0: 6465 6e74 6963 616c 2c20 6c6f 6e5f 6964  dentical, lon_id
+000164e0: 656e 7469 6361 6c2c 2064 6570 5f69 6465  entical, dep_ide
+000164f0: 6e74 6963 616c 2c20 6867 745f 6964 656e  ntical, hgt_iden
+00016500: 7469 6361 6c2c 2064 6570 5f6e 6f74 5f7a  tical, dep_not_z
+00016510: 6572 6f2c 2068 6774 5f6e 6f74 5f7a 6572  ero, hgt_not_zer
+00016520: 6f2c 756e 6365 7274 5f6e 6f74 5f7a 6572  o,uncert_not_zer
+00016530: 6f20 3d20 6e61 765f 6461 7461 2e63 6865  o = nav_data.che
+00016540: 636b 506f 7369 7469 6f6e 7343 6f6e 7465  ckPositionsConte
+00016550: 6e74 2829 0a0a 2020 2020 2020 2020 2020  nt()..          
+00016560: 2020 2320 5772 6974 6520 746f 206e 6176    # Write to nav
+00016570: 6967 6174 696f 6e20 7478 7420 6669 6c65  igation txt file
+00016580: 0a20 2020 2020 2020 2020 2020 2023 2068  .            # h
+00016590: 6561 6465 720a 2020 2020 2020 2020 2020  eader.          
+000165a0: 2020 7265 7320 3d20 6f70 656e 2873 656c    res = open(sel
+000165b0: 662e 6765 745f 696e 745f 6e61 765f 6669  f.get_int_nav_fi
+000165c0: 6c65 2829 2c20 2277 2229 0a20 2020 2020  le(), "w").     
+000165d0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+000165e0: 286d 6971 7476 2e63 6f6c 5f68 6561 6465  (miqtv.col_heade
+000165f0: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
+00016600: 275d 2b22 5c74 222b 6d69 7174 762e 636f  ']+"\t"+miqtv.co
+00016610: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+00016620: 275d 5b27 7574 6327 5d29 0a0a 2020 2020  ']['utc'])..    
+00016630: 2020 2020 2020 2020 6861 735f 616c 7420          has_alt 
+00016640: 3d20 5472 7565 2069 6620 6465 705f 6e6f  = True if dep_no
+00016650: 745f 7a65 726f 2061 6e64 2028 2027 6465  t_zero and ( 'de
+00016660: 7027 2069 6e20 6e61 765f 6865 6164 6572  p' in nav_header
+00016670: 206f 7220 2761 6c74 2720 696e 206e 6176   or 'alt' in nav
+00016680: 5f68 6561 6465 7220 2920 656c 7365 2046  _header ) else F
+00016690: 616c 7365 0a0a 2020 2020 2020 2020 2020  alse..          
+000166a0: 2020 6966 2027 6c61 7427 2069 6e20 6e61    if 'lat' in na
+000166b0: 765f 6865 6164 6572 3a0a 2020 2020 2020  v_header:.      
+000166c0: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
+000166d0: 6974 6528 225c 7422 2b6d 6971 7476 2e63  ite("\t"+miqtv.c
+000166e0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+000166f0: 7427 5d5b 276c 6174 275d 290a 2020 2020  t']['lat']).    
+00016700: 2020 2020 2020 2020 6966 2027 6c6f 6e27          if 'lon'
+00016710: 2069 6e20 6e61 765f 6865 6164 6572 3a0a   in nav_header:.
+00016720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016730: 7265 732e 7772 6974 6528 225c 7422 2b6d  res.write("\t"+m
+00016740: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+00016750: 276d 6172 6971 7427 5d5b 276c 6f6e 275d  'mariqt']['lon']
+00016760: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00016770: 2068 6173 5f61 6c74 3a0a 2020 2020 2020   has_alt:.      
+00016780: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
+00016790: 6974 6528 225c 7422 2b6d 6971 7476 2e63  ite("\t"+miqtv.c
+000167a0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+000167b0: 7427 5d5b 2761 6c74 275d 290a 2020 2020  t']['alt']).    
+000167c0: 2020 2020 2020 2020 6966 2068 6774 5f6e          if hgt_n
+000167d0: 6f74 5f7a 6572 6f20 616e 6420 2768 6774  ot_zero and 'hgt
+000167e0: 2720 696e 206e 6176 5f68 6561 6465 723a  ' in nav_header:
+000167f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016800: 2072 6573 2e77 7269 7465 2822 5c74 222b   res.write("\t"+
+00016810: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00016820: 5b27 6d61 7269 7174 275d 5b27 6867 7427  ['mariqt']['hgt'
+00016830: 5d29 0a20 2020 2020 2020 2020 2020 2069  ]).            i
+00016840: 6620 756e 6365 7274 5f6e 6f74 5f7a 6572  f uncert_not_zer
+00016850: 6f20 616e 6420 2775 6e63 6572 7427 2069  o and 'uncert' i
+00016860: 6e20 6e61 765f 6865 6164 6572 3a0a 2020  n nav_header:.  
+00016870: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00016880: 732e 7772 6974 6528 225c 7422 2b6d 6971  s.write("\t"+miq
+00016890: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+000168a0: 6172 6971 7427 5d5b 2775 6e63 6572 7427  ariqt']['uncert'
+000168b0: 5d29 0a20 2020 2020 2020 2020 2020 2072  ]).            r
+000168c0: 6573 2e77 7269 7465 2822 5c6e 2229 0a20  es.write("\n"). 
+000168d0: 2020 2020 2020 2020 2020 2023 2064 6174             # dat
+000168e0: 6120 6c69 6e65 730a 2020 2020 2020 2020  a lines.        
+000168f0: 2020 2020 666f 7220 6669 6c65 2069 6e20      for file in 
+00016900: 696d 6167 655f 6474 733a 0a20 2020 2020  image_dts:.     
+00016910: 2020 2020 2020 2020 2020 2066 6f72 2074             for t
+00016920: 696d 6570 6f69 6e74 2069 6e20 696d 6167  imepoint in imag
+00016930: 655f 6474 735b 6669 6c65 5d3a 0a20 2020  e_dts[file]:.   
+00016940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016950: 2072 6573 2e77 7269 7465 2866 696c 652b   res.write(file+
+00016960: 225c 7422 2b74 696d 6570 6f69 6e74 2e64  "\t"+timepoint.d
+00016970: 6174 6554 696d 6528 292e 7374 7266 7469  ateTime().strfti
+00016980: 6d65 286d 6971 7476 2e64 6174 655f 666f  me(miqtv.date_fo
+00016990: 726d 6174 735b 276d 6172 6971 7427 5d29  rmats['mariqt'])
+000169a0: 2920 0a20 2020 2020 2020 2020 2020 2020  ) .             
+000169b0: 2020 2020 2020 2069 6620 276c 6174 2720         if 'lat' 
+000169c0: 696e 206e 6176 5f68 6561 6465 723a 0a20  in nav_header:. 
+000169d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000169e0: 2020 2020 2020 2076 616c 203d 2074 696d         val = tim
+000169f0: 6570 6f69 6e74 2e6c 6174 0a20 2020 2020  epoint.lat.     
+00016a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a10: 2020 2069 6620 276c 6174 2720 696e 2072     if 'lat' in r
+00016a20: 6563 6f72 6473 3262 6549 6e76 6572 7465  ecords2beInverte
+00016a30: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
+00016a40: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00016a50: 616c 202a 3d20 2d31 0a20 2020 2020 2020  al *= -1.       
+00016a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a70: 2072 6573 2e77 7269 7465 2822 5c74 222b   res.write("\t"+
+00016a80: 7374 7228 7661 6c29 290a 2020 2020 2020  str(val)).      
+00016a90: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00016aa0: 2027 6c6f 6e27 2069 6e20 6e61 765f 6865   'lon' in nav_he
+00016ab0: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
+00016ac0: 2020 2020 2020 2020 2020 2020 2020 7661                va
+00016ad0: 6c20 3d20 7469 6d65 706f 696e 742e 6c6f  l = timepoint.lo
+00016ae0: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+00016af0: 2020 2020 2020 2020 2020 6966 2027 6c6f            if 'lo
+00016b00: 6e27 2069 6e20 7265 636f 7264 7332 6265  n' in records2be
+00016b10: 496e 7665 7274 6564 3a0a 2020 2020 2020  Inverted:.      
+00016b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b30: 2020 2020 2020 7661 6c20 2a3d 202d 310a        val *= -1.
+00016b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b50: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
+00016b60: 6528 225c 7422 2b73 7472 2876 616c 2929  e("\t"+str(val))
+00016b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016b80: 2020 2020 2069 6620 6861 735f 616c 743a       if has_alt:
+00016b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016ba0: 2020 2020 2020 2020 2076 616c 203d 2074           val = t
+00016bb0: 696d 6570 6f69 6e74 2e64 6570 0a20 2020  imepoint.dep.   
+00016bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016bd0: 2020 2020 2069 6620 2764 6570 2720 696e       if 'dep' in
+00016be0: 206e 6176 5f68 6561 6465 723a 0a20 2020   nav_header:.   
+00016bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c00: 2020 2020 2020 2020 2076 616c 202a 3d20           val *= 
+00016c10: 2d31 0a20 2020 2020 2020 2020 2020 2020  -1.             
+00016c20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00016c30: 6620 2764 6570 2720 696e 2072 6563 6f72  f 'dep' in recor
+00016c40: 6473 3262 6549 6e76 6572 7465 643a 0a20  ds2beInverted:. 
+00016c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c60: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00016c70: 616c 202a 3d20 2d31 0a20 2020 2020 2020  al *= -1.       
+00016c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c90: 2065 6c69 6620 2027 616c 7427 2069 6e20   elif  'alt' in 
+00016ca0: 6e61 765f 6865 6164 6572 2061 6e64 2027  nav_header and '
+00016cb0: 616c 7427 2069 6e20 7265 636f 7264 7332  alt' in records2
+00016cc0: 6265 496e 7665 7274 6564 3a0a 2020 2020  beInverted:.    
+00016cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ce0: 2020 2020 2020 2020 7661 6c20 2a3d 202d          val *= -
+00016cf0: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+00016d00: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
+00016d10: 6974 6528 225c 7422 2b73 7472 2876 616c  ite("\t"+str(val
+00016d20: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00016d30: 2020 2020 2020 2069 6620 6867 745f 6e6f         if hgt_no
+00016d40: 745f 7a65 726f 2061 6e64 2027 6867 7427  t_zero and 'hgt'
+00016d50: 2069 6e20 6e61 765f 6865 6164 6572 3a0a   in nav_header:.
+00016d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016d70: 2020 2020 2020 2020 7661 6c20 3d20 7469          val = ti
+00016d80: 6d65 706f 696e 742e 6867 740a 2020 2020  mepoint.hgt.    
+00016d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016da0: 2020 2020 6966 2027 6867 7427 2069 6e20      if 'hgt' in 
+00016db0: 7265 636f 7264 7332 6265 496e 7665 7274  records2beInvert
+00016dc0: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+00016dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016de0: 7661 6c20 2a3d 202d 310a 2020 2020 2020  val *= -1.      
+00016df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e00: 2020 7265 732e 7772 6974 6528 225c 7422    res.write("\t"
+00016e10: 2b73 7472 2876 616c 2929 0a20 2020 2020  +str(val)).     
+00016e20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00016e30: 6620 756e 6365 7274 5f6e 6f74 5f7a 6572  f uncert_not_zer
+00016e40: 6f20 616e 6420 2775 6e63 6572 7427 2069  o and 'uncert' i
+00016e50: 6e20 6e61 765f 6865 6164 6572 3a0a 2020  n nav_header:.  
+00016e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e70: 2020 2020 2020 7661 6c20 3d20 7469 6d65        val = time
+00016e80: 706f 696e 742e 756e 6365 7274 0a20 2020  point.uncert.   
+00016e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ea0: 2020 2020 2069 6620 2775 6e63 6572 7427       if 'uncert'
+00016eb0: 2069 6e20 7265 636f 7264 7332 6265 496e   in records2beIn
+00016ec0: 7665 7274 6564 3a0a 2020 2020 2020 2020  verted:.        
+00016ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ee0: 2020 2020 7661 6c20 2a3d 202d 310a 2020      val *= -1.  
+00016ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f00: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
+00016f10: 225c 7422 2b73 7472 2876 616c 2929 0a20  "\t"+str(val)). 
+00016f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f30: 2020 2072 6573 2e77 7269 7465 2822 5c6e     res.write("\n
+00016f40: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
+00016f50: 6573 2e63 6c6f 7365 2829 0a0a 2020 2020  es.close()..    
+00016f60: 2020 2020 2020 2020 2320 5772 6974 6520          # Write 
+00016f70: 746f 2067 656f 6a73 6f6e 2066 696c 650a  to geojson file.
+00016f80: 2020 2020 2020 2020 2020 2020 6765 6f6a              geoj
+00016f90: 736f 6e20 3d20 7b27 7479 7065 273a 2027  son = {'type': '
+00016fa0: 4665 6174 7572 6543 6f6c 6c65 6374 696f  FeatureCollectio
+00016fb0: 6e27 2c20 276e 616d 6527 3a20 7365 6c66  n', 'name': self
+00016fc0: 2e64 6972 2e65 7665 6e74 2829 2b22 5f22  .dir.event()+"_"
+00016fd0: 2b73 656c 662e 6469 722e 7365 6e73 6f72  +self.dir.sensor
+00016fe0: 2829 2b22 5f69 6d61 6765 2d6e 6176 6967  ()+"_image-navig
+00016ff0: 6174 696f 6e22 2c20 2766 6561 7475 7265  ation", 'feature
+00017000: 7327 3a20 5b5d 7d0a 2020 2020 2020 2020  s': []}.        
+00017010: 2020 2020 666f 7220 6669 6c65 2069 6e20      for file in 
+00017020: 696d 6167 655f 6474 733a 0a20 2020 2020  image_dts:.     
+00017030: 2020 2020 2020 2020 2020 2023 2070 686f             # pho
+00017040: 746f 0a20 2020 2020 2020 2020 2020 2020  to.             
+00017050: 2020 2069 6620 6c65 6e28 696d 6167 655f     if len(image_
+00017060: 6474 735b 6669 6c65 5d29 203d 3d20 313a  dts[file]) == 1:
+00017070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017080: 2020 2020 2069 6620 6465 705f 6e6f 745f       if dep_not_
+00017090: 7a65 726f 3a0a 2020 2020 2020 2020 2020  zero:.          
+000170a0: 2020 2020 2020 2020 2020 2020 2020 6765                ge
+000170b0: 6f6d 6574 7279 203d 2020 7b27 7479 7065  ometry =  {'type
+000170c0: 273a 2022 506f 696e 7422 2c20 2763 6f6f  ': "Point", 'coo
+000170d0: 7264 696e 6174 6573 273a 200a 2020 2020  rdinates': .    
+000170e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000170f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017100: 2020 2020 5b66 6c6f 6174 2869 6d61 6765      [float(image
+00017110: 5f64 7473 5b66 696c 655d 5b30 5d2e 6c6f  _dts[file][0].lo
+00017120: 6e29 2c20 666c 6f61 7428 696d 6167 655f  n), float(image_
+00017130: 6474 735b 6669 6c65 5d5b 305d 2e6c 6174  dts[file][0].lat
+00017140: 292c 2066 6c6f 6174 2869 6d61 6765 5f64  ), float(image_d
+00017150: 7473 5b66 696c 655d 5b30 5d2e 6465 7029  ts[file][0].dep)
+00017160: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00017170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017180: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00017190: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000171a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000171b0: 2020 2020 2020 2020 2020 6765 6f6d 6574            geomet
+000171c0: 7279 203d 2020 7b27 7479 7065 273a 2022  ry =  {'type': "
+000171d0: 506f 696e 7422 2c20 2763 6f6f 7264 696e  Point", 'coordin
+000171e0: 6174 6573 273a 200a 2020 2020 2020 2020  ates': .        
+000171f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017210: 5b66 6c6f 6174 2869 6d61 6765 5f64 7473  [float(image_dts
+00017220: 5b66 696c 655d 5b30 5d2e 6c6f 6e29 2c20  [file][0].lon), 
+00017230: 666c 6f61 7428 696d 6167 655f 6474 735b  float(image_dts[
+00017240: 6669 6c65 5d5b 305d 2e6c 6174 295d 0a20  file][0].lat)]. 
+00017250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017270: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
+00017280: 2020 2020 2020 2020 2069 6620 5472 7565           if True
+00017290: 2069 6e20 5b6d 6174 682e 6973 6e61 6e28   in [math.isnan(
+000172a0: 7829 2066 6f72 2078 2069 6e20 6765 6f6d  x) for x in geom
+000172b0: 6574 7279 5b27 636f 6f72 6469 6e61 7465  etry['coordinate
+000172c0: 7327 5d5d 3a0a 2020 2020 2020 2020 2020  s']]:.          
+000172d0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+000172e0: 6e74 696e 7565 0a0a 2020 2020 2020 2020  ntinue..        
+000172f0: 2020 2020 2020 2020 2320 7669 6465 6f0a          # video.
+00017300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017310: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00017320: 2020 2020 2020 2020 2020 6966 2064 6570            if dep
+00017330: 5f6e 6f74 5f7a 6572 6f3a 0a20 2020 2020  _not_zero:.     
+00017340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017350: 2020 2067 656f 6d65 7472 7920 3d20 207b     geometry =  {
+00017360: 2774 7970 6527 3a20 224d 756c 7469 506f  'type': "MultiPo
+00017370: 696e 7422 2c20 2763 6f6f 7264 696e 6174  int", 'coordinat
+00017380: 6573 273a 0a20 2020 2020 2020 2020 2020  es':.           
+00017390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000173a0: 2020 2020 2020 2020 2020 2020 205b 5b66               [[f
+000173b0: 6c6f 6174 2864 2e6c 6f6e 292c 2066 6c6f  loat(d.lon), flo
+000173c0: 6174 2864 2e6c 6174 292c 2066 6c6f 6174  at(d.lat), float
+000173d0: 2864 2e64 6570 295d 2066 6f72 2064 2069  (d.dep)] for d i
+000173e0: 6e20 696d 6167 655f 6474 735b 6669 6c65  n image_dts[file
+000173f0: 5d5d 0a20 2020 2020 2020 2020 2020 2020  ]].             
+00017400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017410: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+00017420: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00017430: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00017440: 2020 2020 2020 2020 2020 2067 656f 6d65             geome
+00017450: 7472 7920 3d20 207b 2774 7970 6527 3a20  try =  {'type': 
+00017460: 224d 756c 7469 506f 696e 7422 2c20 2763  "MultiPoint", 'c
+00017470: 6f6f 7264 696e 6174 6573 273a 0a20 2020  oordinates':.   
+00017480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000174a0: 2020 2020 205b 5b66 6c6f 6174 2864 2e6c       [[float(d.l
+000174b0: 6f6e 292c 2066 6c6f 6174 2864 2e6c 6174  on), float(d.lat
+000174c0: 295d 2066 6f72 2064 2069 6e20 696d 6167  )] for d in imag
+000174d0: 655f 6474 735b 6669 6c65 5d5d 0a20 2020  e_dts[file]].   
+000174e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000174f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017500: 207d 0a20 2020 2020 2020 2020 2020 2020   }.             
+00017510: 2020 2020 2020 2069 6620 5472 7565 2069         if True i
+00017520: 6e20 5b6d 6174 682e 6973 6e61 6e28 7829  n [math.isnan(x)
+00017530: 2066 6f72 2078 2069 6e20 5b69 7465 6d20   for x in [item 
+00017540: 666f 7220 7375 626c 6973 7420 696e 2067  for sublist in g
+00017550: 656f 6d65 7472 795b 2763 6f6f 7264 696e  eometry['coordin
+00017560: 6174 6573 275d 2066 6f72 2069 7465 6d20  ates'] for item 
+00017570: 696e 2073 7562 6c69 7374 5d5d 3a0a 2020  in sublist]]:.  
+00017580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017590: 2020 2020 2020 636f 6e74 696e 7565 0a0a        continue..
+000175a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000175b0: 6765 6f6a 736f 6e5b 2766 6561 7475 7265  geojson['feature
+000175c0: 7327 5d2e 6170 7065 6e64 287b 2774 7970  s'].append({'typ
+000175d0: 6527 3a20 2746 6561 7475 7265 272c 2027  e': 'Feature', '
+000175e0: 7072 6f70 6572 7469 6573 273a 207b 2769  properties': {'i
+000175f0: 6427 3a20 6669 6c65 7d2c 2027 6765 6f6d  d': file}, 'geom
+00017600: 6574 7279 273a 2067 656f 6d65 7472 7920  etry': geometry 
+00017610: 7d29 0a20 2020 2020 2020 2020 2020 2020  }).             
+00017620: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+00017630: 6f20 3d20 6f70 656e 2873 656c 662e 6765  o = open(self.ge
+00017640: 745f 696e 745f 6e61 765f 6669 6c65 2829  t_int_nav_file()
+00017650: 2e72 6570 6c61 6365 2822 2e74 7874 222c  .replace(".txt",
+00017660: 2022 2e67 656f 6a73 6f6e 2229 2c0a 2020   ".geojson"),.  
+00017670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017680: 2020 2022 7722 2c20 6572 726f 7273 3d22     "w", errors="
+00017690: 6967 6e6f 7265 222c 2065 6e63 6f64 696e  ignore", encodin
+000176a0: 673d 2775 7466 2d38 2729 0a20 2020 2020  g='utf-8').     
+000176b0: 2020 2020 2020 206a 736f 6e2e 6475 6d70         json.dump
+000176c0: 2867 656f 6a73 6f6e 2c20 6f2c 2065 6e73  (geojson, o, ens
+000176d0: 7572 655f 6173 6369 693d 4661 6c73 652c  ure_ascii=False,
+000176e0: 2069 6e64 656e 743d 3429 0a20 2020 2020   indent=4).     
+000176f0: 2020 2020 2020 206f 2e63 6c6f 7365 2829         o.close()
+00017700: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00017710: 6c66 2e70 726f 762e 6164 6441 7267 756d  lf.prov.addArgum
+00017720: 656e 7428 2269 6e70 7574 4e61 7669 6761  ent("inputNaviga
+00017730: 7469 6f6e 4669 6c65 222c 6e61 765f 7061  tionFile",nav_pa
+00017740: 7468 2c6f 7665 7277 7269 7465 3d54 7275  th,overwrite=Tru
+00017750: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
+00017760: 656c 662e 7072 6f76 2e6c 6f67 2822 7061  elf.prov.log("pa
+00017770: 7273 6564 2066 726f 6d20 696e 7075 744e  rsed from inputN
+00017780: 6176 6967 6174 696f 6e46 696c 653a 2022  avigationFile: "
+00017790: 202b 2073 7472 286e 6176 5f68 6561 6465   + str(nav_heade
+000177a0: 7229 2c64 6f6e 7453 686f 773d 5472 7565  r),dontShow=True
+000177b0: 290a 2020 2020 2020 2020 2020 2020 732e  ).            s.
+000177c0: 7374 6f70 2829 0a20 2020 2020 2020 2020  stop().         
+000177d0: 2020 2072 6574 7572 6e20 5472 7565 2c20     return True, 
+000177e0: 224e 6176 6967 6174 696f 6e20 6461 7461  "Navigation data
+000177f0: 2063 7265 6174 6564 2220 2b20 7265 7475   created" + retu
+00017800: 726e 4d73 670a 2020 2020 2020 2020 656c  rnMsg.        el
+00017810: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00017820: 732e 7374 6f70 2829 0a20 2020 2020 2020  s.stop().       
+00017830: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00017840: 652c 2022 4e6f 2069 6d61 6765 2063 6f6f  e, "No image coo
+00017850: 7264 696e 6174 6573 2066 6f75 6e64 2220  rdinates found" 
+00017860: 2b20 7265 7475 726e 4d73 670a 0a20 2020  + returnMsg..   
+00017870: 2064 6566 2063 7265 6174 6549 6d61 6765   def createImage
+00017880: 4e61 7669 6761 7469 6f6e 4669 6c65 2873  NavigationFile(s
+00017890: 656c 662c 206e 6176 5f70 6174 683a 2073  elf, nav_path: s
+000178a0: 7472 2c20 6e61 765f 6865 6164 6572 3d6d  tr, nav_header=m
+000178b0: 6971 7476 2e70 6f73 5f68 6561 6465 725b  iqtv.pos_header[
+000178c0: 2770 616e 6761 6561 275d 2c20 6461 7465  'pangaea'], date
+000178d0: 5f66 6f72 6d61 743d 6d69 7174 762e 6461  _format=miqtv.da
+000178e0: 7465 5f66 6f72 6d61 7473 5b27 7061 6e67  te_formats['pang
+000178f0: 6165 6127 5d2c 206f 7665 7277 7269 7465  aea'], overwrite
+00017900: 3d46 616c 7365 2c20 636f 6c5f 7365 7061  =False, col_sepa
+00017910: 7261 746f 7220 3d20 225c 7422 2c20 7669  rator = "\t", vi
+00017920: 6465 6f53 616d 706c 6553 6563 6f6e 6473  deoSampleSeconds
+00017930: 3d31 2c0a 2020 2020 2020 2020 2020 2020  =1,.            
+00017940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017950: 2020 2020 2020 2020 6f66 6673 6574 5f78          offset_x
+00017960: 3d30 2c20 6f66 6673 6574 5f79 3d30 2c20  =0, offset_y=0, 
+00017970: 6f66 6673 6574 5f7a 3d30 2c61 6e67 6c65  offset_z=0,angle
+00017980: 735f 696e 5f72 6164 203d 2046 616c 7365  s_in_rad = False
+00017990: 2c20 7265 636f 7264 7332 6265 496e 7665  , records2beInve
+000179a0: 7274 6564 3d5b 5d29 3a0a 2020 2020 2020  rted=[]):.      
+000179b0: 2020 2222 2220 4465 7072 6563 6174 6564    """ Deprecated
+000179c0: 202d 2075 7365 2063 7265 6174 655f 696d   - use create_im
+000179d0: 6167 655f 6e61 7669 6761 7469 6f6e 5f66  age_navigation_f
+000179e0: 696c 6520 2222 220a 2020 2020 2020 2020  ile """.        
+000179f0: 7365 6c66 2e63 7265 6174 655f 696d 6167  self.create_imag
+00017a00: 655f 6e61 7669 6761 7469 6f6e 5f66 696c  e_navigation_fil
+00017a10: 6528 6e61 765f 7061 7468 2c20 6e61 765f  e(nav_path, nav_
+00017a20: 6865 6164 6572 2c20 6461 7465 5f66 6f72  header, date_for
+00017a30: 6d61 742c 206f 7665 7277 7269 7465 2c20  mat, overwrite, 
+00017a40: 636f 6c5f 7365 7061 7261 746f 722c 2076  col_separator, v
+00017a50: 6964 656f 5361 6d70 6c65 5365 636f 6e64  ideoSampleSecond
+00017a60: 732c 206f 6666 7365 745f 782c 206f 6666  s, offset_x, off
+00017a70: 7365 745f 792c 206f 6666 7365 745f 7a2c  set_y, offset_z,
+00017a80: 2061 6e67 6c65 735f 696e 5f72 6164 2c20   angles_in_rad, 
+00017a90: 7265 636f 7264 7332 6265 496e 7665 7274  records2beInvert
+00017aa0: 6564 290a 0a0a 2020 2020 6465 6620 6372  ed)...    def cr
+00017ab0: 6561 7465 5f69 6d61 6765 5f73 6861 3235  eate_image_sha25
+00017ac0: 365f 6669 6c65 2873 656c 662c 7265 5265  6_file(self,reRe
+00017ad0: 6164 416c 6c3d 5472 7565 293a 0a20 2020  adAll=True):.   
+00017ae0: 2020 2020 2022 2222 2043 7265 6174 6573       """ Creates
+00017af0: 2069 6e20 2f69 6e74 6572 6d65 6469 6174   in /intermediat
+00017b00: 6520 6120 7465 7874 2066 696c 6520 636f  e a text file co
+00017b10: 6e74 6169 6e69 6e67 2070 6572 2069 6d61  ntaining per ima
+00017b20: 6765 2069 7473 2053 4841 3235 3620 6861  ge its SHA256 ha
+00017b30: 7368 2e0a 2020 2020 2020 2020 2020 2020  sh..            
+00017b40: 4966 2072 6552 6561 6441 6c6c 2069 7320  If reReadAll is 
+00017b50: 5472 7565 2061 6c6c 2069 6d61 6765 7327  True all images'
+00017b60: 2068 6173 6865 7320 6172 6520 6465 7465   hashes are dete
+00017b70: 726d 696e 6564 2e20 4f74 6865 7277 6973  rmined. Otherwis
+00017b80: 6520 6f6e 6c79 2066 6f72 2074 686f 7365  e only for those
+00017b90: 2066 696c 6573 0a20 2020 2020 2020 2020   files.         
+00017ba0: 2020 2077 6869 6368 2061 7265 206e 6f74     which are not
+00017bb0: 2079 6574 2069 6e20 7468 6520 696e 7465   yet in the inte
+00017bc0: 726d 6564 6961 7465 2066 696c 6520 636f  rmediate file co
+00017bd0: 6e74 6169 6e69 6e67 2074 6865 2069 6d61  ntaining the ima
+00017be0: 6765 2068 6173 6865 7320 2022 2222 0a20  ge hashes  """. 
+00017bf0: 2020 2020 2020 2068 6173 6865 7320 3d20         hashes = 
+00017c00: 7b7d 0a20 2020 2020 2020 2069 6620 6f73  {}.        if os
+00017c10: 2e70 6174 682e 6578 6973 7473 2873 656c  .path.exists(sel
+00017c20: 662e 6765 745f 696e 745f 6861 7368 5f66  f.get_int_hash_f
+00017c30: 696c 6528 2929 3a0a 2020 2020 2020 2020  ile()):.        
+00017c40: 2020 2020 6861 7368 6573 203d 206d 6971      hashes = miq
+00017c50: 7466 2e74 6162 4669 6c65 4461 7461 2873  tf.tabFileData(s
+00017c60: 656c 662e 6765 745f 696e 745f 6861 7368  elf.get_int_hash
+00017c70: 5f66 696c 6528 292c 205b 6d69 7174 762e  _file(), [miqtv.
+00017c80: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+00017c90: 7174 275d 5b27 696d 6727 5d2c 206d 6971  qt']['img'], miq
+00017ca0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+00017cb0: 6172 6971 7427 5d5b 2768 6173 6827 5d5d  ariqt']['hash']]
+00017cc0: 2c20 6b65 795f 636f 6c3d 6d69 7174 762e  , key_col=miqtv.
+00017cd0: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+00017ce0: 7174 275d 5b27 696d 6727 5d29 0a0a 2020  qt']['img'])..  
+00017cf0: 2020 2020 2020 696d 6167 6573 496e 5261        imagesInRa
+00017d00: 7720 3d20 7365 6c66 2e69 6d61 6765 7349  w = self.imagesI
+00017d10: 6e49 6d61 6765 7344 6972 2829 0a20 2020  nImagesDir().   
+00017d20: 2020 2020 2069 6620 6c65 6e28 696d 6167       if len(imag
+00017d30: 6573 496e 5261 7729 203e 2030 3a0a 0a20  esInRaw) > 0:.. 
+00017d40: 2020 2020 2020 2020 2020 2061 6464 6564             added
+00017d50: 5f68 6173 6865 7320 3d20 300a 2020 2020  _hashes = 0.    
+00017d60: 2020 2020 2020 2020 7072 6f67 203d 206d          prog = m
+00017d70: 6971 7463 2e50 7269 6e74 4b6e 6f77 6e50  iqtc.PrintKnownP
+00017d80: 726f 6772 6573 734d 7367 2822 4368 6563  rogressMsg("Chec
+00017d90: 6b69 6e67 2068 6173 6865 7322 2c20 6c65  king hashes", le
+00017da0: 6e28 696d 6167 6573 496e 5261 7729 2c6d  n(imagesInRaw),m
+00017db0: 6f64 756c 6f3d 3529 0a20 2020 2020 2020  odulo=5).       
+00017dc0: 2020 2020 2066 6f72 2066 696c 6520 696e       for file in
+00017dd0: 2069 6d61 6765 7349 6e52 6177 3a0a 2020   imagesInRaw:.  
+00017de0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00017df0: 6f67 2e70 726f 6772 6573 7328 290a 0a20  og.progress().. 
+00017e00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00017e10: 6620 6e6f 7420 7365 6c66 2e5f 5f61 6c6c  f not self.__all
+00017e20: 5555 4944 7343 6865 636b 6564 2061 6e64  UUIDsChecked and
+00017e30: 206e 6f74 206d 6971 7469 2e69 6d61 6765   not miqti.image
+00017e40: 436f 6e74 6169 6e73 5661 6c69 6455 5549  ContainsValidUUI
+00017e50: 4428 6669 6c65 295b 305d 3a0a 2020 2020  D(file)[0]:.    
+00017e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017e70: 2320 7265 6d6f 7665 2066 726f 6d20 7575  # remove from uu
+00017e80: 6964 2066 696c 650a 2020 2020 2020 2020  id file.        
+00017e90: 2020 2020 2020 2020 2020 2020 6966 206f              if o
+00017ea0: 732e 7061 7468 2e65 7869 7374 7328 7365  s.path.exists(se
+00017eb0: 6c66 2e67 6574 5f69 6e74 5f75 7569 645f  lf.get_int_uuid_
+00017ec0: 6669 6c65 2829 293a 0a20 2020 2020 2020  file()):.       
+00017ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ee0: 2072 6573 203d 206f 7065 6e28 7365 6c66   res = open(self
+00017ef0: 2e67 6574 5f69 6e74 5f75 7569 645f 6669  .get_int_uuid_fi
+00017f00: 6c65 2829 2c20 2272 2229 0a20 2020 2020  le(), "r").     
 00017f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f20: 2320 7665 7279 2066 6972 7374 2064 6174  # very first dat
-00017f30: 6120 666f 7220 636f 6d70 6172 6973 6f6e  a for comparison
-00017f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017f50: 2069 6620 6669 7273 7449 6d61 6765 2061   if firstImage a
-00017f60: 6e64 2066 6972 7374 5469 6d65 506f 696e  nd firstTimePoin
-00017f70: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-00017f80: 2020 2020 2020 2063 6f6e 7374 4461 7461         constData
-00017f90: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
-00017fa0: 2869 6d61 6765 5f74 705f 6461 7461 290a  (image_tp_data).
-00017fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017fc0: 2020 2020 666f 7220 6669 656c 6420 696e      for field in
-00017fd0: 2066 6965 6c64 7354 6f49 676e 6f72 653a   fieldsToIgnore:
-00017fe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017ff0: 2020 2020 2020 2020 2069 6620 6669 656c           if fiel
-00018000: 6420 696e 2063 6f6e 7374 4461 7461 3a0a  d in constData:.
-00018010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018020: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
-00018030: 636f 6e73 7444 6174 615b 6669 656c 645d  constData[field]
-00018040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018050: 2020 2020 2066 6972 7374 5469 6d65 506f       firstTimePo
-00018060: 696e 7420 3d20 4661 6c73 650a 2020 2020  int = False.    
-00018070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018080: 636f 6e74 696e 7565 0a0a 2020 2020 2020  continue..      
-00018090: 2020 2020 2020 2020 2020 636f 6e73 7444            constD
-000180a0: 6174 6120 3d20 6d69 7174 632e 6669 6e64  ata = miqtc.find
-000180b0: 436f 6d6d 6f6e 4469 6374 456c 656d 656e  CommonDictElemen
-000180c0: 7473 2869 6d61 6765 5f74 705f 6461 7461  ts(image_tp_data
-000180d0: 2c63 6f6e 7374 4461 7461 290a 0a20 2020  ,constData)..   
-000180e0: 2020 2020 2020 2020 2066 6972 7374 496d           firstIm
-000180f0: 6167 6520 3d20 4661 6c73 650a 0a20 2020  age = False..   
-00018100: 2020 2020 2023 2054 4f44 4f20 6368 6563       # TODO chec
-00018110: 6b20 7769 7468 696e 2069 6d61 6765 2074  k within image t
-00018120: 696d 6573 202d 3e20 746f 2069 6d61 6765  imes -> to image
-00018130: 2064 6566 6175 6c74 2e20 2874 7269 636b   default. (trick
-00018140: 7920 7369 6e63 6520 7765 2064 6f6e 2774  y since we don't
-00018150: 2068 6176 6520 7468 6520 6461 6661 756c   have the dafaul
-00018160: 7420 696e 6465 7820 6865 7265 2e20 4f6e  t index here. On
-00018170: 6c79 2061 2073 7562 7365 7420 6d69 6768  ly a subset migh
-00018180: 7420 6265 2075 7064 6174 6520 6865 7265  t be update here
-00018190: 290a 2020 2020 2020 2020 2320 6368 6563  ).        # chec
-000181a0: 6b20 7769 7468 696e 2069 6d61 6765 2069  k within image i
-000181b0: 7465 6d73 202d 3e20 6865 6164 6572 0a20  tems -> header. 
-000181c0: 2020 2020 2020 2068 6561 6465 7255 7064         headerUpd
-000181d0: 6174 6520 3d20 636f 7079 2e64 6565 7063  ate = copy.deepc
-000181e0: 6f70 7928 636f 6e73 7444 6174 6129 0a20  opy(constData). 
-000181f0: 2020 2020 2020 2068 6561 6465 7255 7064         headerUpd
-00018200: 6174 6564 5465 7374 203d 2063 6f70 792e  atedTest = copy.
-00018210: 6465 6570 636f 7079 2868 6561 6465 7229  deepcopy(header)
-00018220: 0a20 2020 2020 2020 206d 6971 7463 2e72  .        miqtc.r
-00018230: 6563 7572 7369 7665 6c79 5570 6461 7465  ecursivelyUpdate
-00018240: 4469 6374 7328 6865 6164 6572 5570 6461  Dicts(headerUpda
-00018250: 7465 6454 6573 742c 6865 6164 6572 5570  tedTest,headerUp
-00018260: 6461 7465 290a 2020 2020 2020 2020 7570  date).        up
-00018270: 6461 7465 4469 6666 203d 2044 6565 7044  dateDiff = DeepD
-00018280: 6966 6628 6865 6164 6572 2c68 6561 6465  iff(header,heade
-00018290: 7255 7064 6174 6564 5465 7374 290a 2020  rUpdatedTest).  
-000182a0: 2020 2020 2020 2320 6368 6563 6b20 6966        # check if
-000182b0: 2068 6561 6465 7255 7064 6174 6520 776f   headerUpdate wo
-000182c0: 756c 6420 6f76 6572 7772 6974 6520 616e  uld overwrite an
-000182d0: 7974 6869 6e67 2066 726f 6d20 6375 7272  ything from curr
-000182e0: 656e 7420 6865 6164 6572 2028 7368 6f75  ent header (shou
-000182f0: 6c64 206e 6f74 2068 6170 7065 6e29 2c20  ld not happen), 
-00018300: 6966 2073 6f20 646f 6e74 2072 656d 6f76  if so dont remov
-00018310: 6520 6672 6f6d 2069 7465 6d73 0a20 2020  e from items.   
-00018320: 2020 2020 2069 6620 6e6f 7420 2776 616c       if not 'val
-00018330: 7565 735f 6368 616e 6765 6427 2069 6e20  ues_changed' in 
-00018340: 7570 6461 7465 4469 6666 2061 6e64 206e  updateDiff and n
-00018350: 6f74 2027 7479 7065 5f63 6861 6e67 6573  ot 'type_changes
-00018360: 2720 696e 2075 7064 6174 6544 6966 6620  ' in updateDiff 
-00018370: 616e 6420 6e6f 7420 2764 6963 7469 6f6e  and not 'diction
-00018380: 6172 795f 6974 656d 5f72 656d 6f76 6564  ary_item_removed
-00018390: 2720 696e 2075 7064 6174 6544 6966 663a  ' in updateDiff:
-000183a0: 0a20 2020 2020 2020 2020 2020 2068 6561  .            hea
-000183b0: 6465 722e 636c 6561 7228 290a 2020 2020  der.clear().    
-000183c0: 2020 2020 2020 2020 6865 6164 6572 2e75          header.u
-000183d0: 7064 6174 6528 6865 6164 6572 5570 6461  pdate(headerUpda
-000183e0: 7465 6454 6573 7429 0a0a 2020 2020 2020  tedTest)..      
-000183f0: 2020 2020 2020 2320 7265 6d6f 7665 2063        # remove c
-00018400: 6f6e 7374 2076 616c 7565 7320 6672 6f6d  onst values from
-00018410: 2064 6174 610a 2020 2020 2020 2020 2020   data.          
-00018420: 2020 6d69 7174 632e 7265 6375 7273 6976    miqtc.recursiv
-00018430: 654d 616b 654e 6f6e 6544 6963 7446 6965  eMakeNoneDictFie
-00018440: 6c64 7345 6d70 7479 5374 7228 636f 6e73  ldsEmptyStr(cons
-00018450: 7444 6174 6129 0a20 2020 2020 2020 2020  tData).         
-00018460: 2020 2066 6f72 2069 6d61 6765 2c69 6d61     for image,ima
-00018470: 6765 5f64 6174 6120 696e 2064 6174 612e  ge_data in data.
-00018480: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
-00018490: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-000184a0: 6973 696e 7374 616e 6365 2869 6d61 6765  isinstance(image
-000184b0: 5f64 6174 612c 6c69 7374 293a 0a20 2020  _data,list):.   
-000184c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000184d0: 2069 6d61 6765 5f64 6174 6120 3d20 5b69   image_data = [i
-000184e0: 6d61 6765 5f64 6174 615d 0a20 2020 2020  mage_data].     
-000184f0: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-00018500: 6d61 6765 5f74 705f 6461 7461 2069 6e20  mage_tp_data in 
-00018510: 696d 6167 655f 6461 7461 3a0a 2020 2020  image_data:.    
-00018520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018530: 6d69 7174 632e 7265 6375 7273 6976 656c  miqtc.recursivel
-00018540: 7955 7064 6174 6544 6963 7473 2869 6d61  yUpdateDicts(ima
-00018550: 6765 5f74 705f 6461 7461 2c63 6f6e 7374  ge_tp_data,const
-00018560: 4461 7461 2920 2020 2020 2020 2020 200a  Data)          .
-00018570: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00018580: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
-00018590: 2020 2020 2020 2020 2020 2020 2320 544f              # TO
-000185a0: 444f 206c 6f67 3f0a 2020 2020 200a 0a20  DO log?.     .. 
-000185b0: 2020 2064 6566 2069 6e74 6572 6d65 6469     def intermedi
-000185c0: 6174 654e 6176 4669 6c65 4578 6973 7473  ateNavFileExists
-000185d0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-000185e0: 6966 206f 732e 7061 7468 2e65 7869 7374  if os.path.exist
-000185f0: 7328 7365 6c66 2e67 6574 5f69 6e74 5f6e  s(self.get_int_n
-00018600: 6176 5f66 696c 6528 2929 3a0a 2020 2020  av_file()):.    
-00018610: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-00018620: 7275 650a 2020 2020 2020 2020 656c 7365  rue.        else
-00018630: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00018640: 7475 726e 2046 616c 7365 0a0a 0a20 2020  turn False...   
-00018650: 2064 6566 2061 6c6c 4e61 7646 6965 6c64   def allNavField
-00018660: 7349 6e48 6561 6465 7228 7365 6c66 293a  sInHeader(self):
-00018670: 0a20 2020 2020 2020 2066 6f72 2066 6965  .        for fie
-00018680: 6c64 2069 6e20 7365 6c66 2e72 6571 4e61  ld in self.reqNa
-00018690: 7646 6965 6c64 733a 0a20 2020 2020 2020  vFields:.       
-000186a0: 2020 2020 2023 206d 756c 7469 706c 6520       # multiple 
-000186b0: 6f70 7469 6f6e 730a 2020 2020 2020 2020  options.        
-000186c0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-000186d0: 6528 6669 656c 642c 6c69 7374 293a 0a20  e(field,list):. 
-000186e0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-000186f0: 616c 6964 203d 2046 616c 7365 0a20 2020  alid = False.   
-00018700: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00018710: 2073 7562 6669 656c 6420 696e 2066 6965   subfield in fie
-00018720: 6c64 3a0a 2020 2020 2020 2020 2020 2020  ld:.            
-00018730: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00018740: 6865 6164 6572 4669 656c 6446 696c 6c65  headerFieldFille
-00018750: 6428 7375 6266 6965 6c64 293a 0a20 2020  d(subfield):.   
-00018760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018770: 2020 2020 2076 616c 6964 203d 2054 7275       valid = Tru
-00018780: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00018790: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-000187a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000187b0: 6966 206e 6f74 2076 616c 6964 3a0a 2020  if not valid:.  
-000187c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000187d0: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
-000187e0: 2020 2020 2020 2020 2020 2023 2073 696e             # sin
-000187f0: 676c 6520 6f70 7469 6f6e 0a20 2020 2020  gle option.     
-00018800: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00018810: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00018820: 6e6f 7420 7365 6c66 2e68 6561 6465 7246  not self.headerF
-00018830: 6965 6c64 4669 6c6c 6564 2866 6965 6c64  ieldFilled(field
-00018840: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00018850: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00018860: 6c73 650a 2020 2020 2020 2020 7265 7475  lse.        retu
-00018870: 726e 2054 7275 650a 0a20 2020 2064 6566  rn True..    def
-00018880: 2068 6561 6465 7246 6965 6c64 4669 6c6c   headerFieldFill
-00018890: 6564 2873 656c 662c 6669 656c 643a 7374  ed(self,field:st
-000188a0: 7229 3a0a 2020 2020 2020 2020 6966 2073  r):.        if s
-000188b0: 656c 662e 6669 6e64 546d 7046 6965 6c64  elf.findTmpField
-000188c0: 3228 6669 656c 6429 203d 3d20 2222 3a0a  2(field) == "":.
-000188d0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000188e0: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
-000188f0: 2072 6574 7572 6e20 5472 7565 0a0a 2020   return True..  
-00018900: 2020 6465 6620 636f 6e76 6572 7454 6f44    def convertToD
-00018910: 6566 6175 6c74 4461 7465 5469 6d65 466f  efaultDateTimeFo
-00018920: 726d 6174 2873 656c 662c 6966 646f 293a  rmat(self,ifdo):
-00018930: 0a20 2020 2020 2020 2022 2222 2043 6865  .        """ Che
-00018940: 636b 7320 6966 2061 6c6c 2069 7465 6d73  cks if all items
-00018950: 2720 2769 6d61 6765 2d64 6174 6574 696d  ' 'image-datetim
-00018960: 6527 2066 6965 6c64 7320 6d61 7463 6820  e' fields match 
-00018970: 6465 6661 756c 7420 6461 7465 7469 6d65  default datetime
-00018980: 2066 6f72 6d61 7420 6f72 2061 2063 7573   format or a cus
-00018990: 746f 6d20 6f6e 6520 6465 6669 6e65 6420  tom one defined 
-000189a0: 696e 2027 696d 6167 652d 6461 7465 7469  in 'image-dateti
-000189b0: 6d65 2d66 6f72 6d61 7427 0a20 2020 2020  me-format'.     
-000189c0: 2020 2020 2020 2061 6e64 2063 6f6e 7665         and conve
-000189d0: 7274 7320 746f 2064 6566 6175 6c74 2066  rts to default f
-000189e0: 6f72 6d61 742e 2054 6872 6f77 7320 6578  ormat. Throws ex
-000189f0: 6365 7074 696f 6e20 6966 2064 6174 6574  ception if datet
-00018a00: 696d 6520 6361 6e6e 6f74 2062 6520 7061  ime cannot be pa
-00018a10: 7273 6564 2022 2222 0a20 2020 2020 2020  rsed """.       
-00018a20: 2063 7573 746f 6d44 6174 6554 696d 6546   customDateTimeF
-00018a30: 6f72 6d61 7446 6f75 6e64 203d 2046 616c  ormatFound = Fal
-00018a40: 7365 0a20 2020 2020 2020 2068 6561 6465  se.        heade
-00018a50: 7243 7573 746f 6d44 6174 6554 696d 6546  rCustomDateTimeF
-00018a60: 6f72 6d61 7420 3d20 6669 6e64 4669 656c  ormat = findFiel
-00018a70: 6428 6966 646f 5b73 656c 662e 696d 6167  d(ifdo[self.imag
-00018a80: 6553 6574 4865 6164 6572 4b65 795d 2c27  eSetHeaderKey],'
-00018a90: 696d 6167 652d 6461 7465 7469 6d65 2d66  image-datetime-f
-00018aa0: 6f72 6d61 7427 290a 2020 2020 2020 2020  ormat').        
-00018ab0: 6966 2068 6561 6465 7243 7573 746f 6d44  if headerCustomD
-00018ac0: 6174 6554 696d 6546 6f72 6d61 7420 213d  ateTimeFormat !=
-00018ad0: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
-00018ae0: 2069 6664 6f5b 7365 6c66 2e69 6d61 6765   ifdo[self.image
-00018af0: 5365 7448 6561 6465 724b 6579 5d5b 2769  SetHeaderKey]['i
-00018b00: 6d61 6765 2d64 6174 6574 696d 652d 666f  mage-datetime-fo
-00018b10: 726d 6174 275d 203d 2022 2220 2320 7265  rmat'] = "" # re
-00018b20: 6d6f 7665 2063 7573 746f 6d20 666f 726d  move custom form
-00018b30: 6174 0a20 2020 2020 2020 2020 2020 2063  at.            c
-00018b40: 7573 746f 6d44 6174 6554 696d 6546 6f72  ustomDateTimeFor
-00018b50: 6d61 7446 6f75 6e64 203d 2054 7275 650a  matFound = True.
-00018b60: 2020 2020 2020 2020 7072 6f67 203d 206d          prog = m
-00018b70: 6971 7463 2e50 7269 6e74 4b6e 6f77 6e50  iqtc.PrintKnownP
-00018b80: 726f 6772 6573 734d 7367 2822 4368 6563  rogressMsg("Chec
-00018b90: 6b69 6e67 2064 6174 6574 696d 6520 666f  king datetime fo
-00018ba0: 726d 6174 222c 206c 656e 2869 6664 6f5b  rmat", len(ifdo[
-00018bb0: 7365 6c66 2e69 6d61 6765 5365 7449 7465  self.imageSetIte
-00018bc0: 6d73 4b65 795d 292c 6d6f 6475 6c6f 3d31  msKey]),modulo=1
-00018bd0: 290a 2020 2020 2020 2020 666f 7220 6669  ).        for fi
-00018be0: 6c65 2c69 7465 6d20 696e 2069 6664 6f5b  le,item in ifdo[
-00018bf0: 7365 6c66 2e69 6d61 6765 5365 7449 7465  self.imageSetIte
-00018c00: 6d73 4b65 795d 2e69 7465 6d73 2829 3a0a  msKey].items():.
-00018c10: 2020 2020 2020 2020 2020 2020 7072 6f67              prog
-00018c20: 2e70 726f 6772 6573 7328 290a 2020 2020  .progress().    
-00018c30: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-00018c40: 7369 6e73 7461 6e63 6528 6974 656d 2c6c  sinstance(item,l
-00018c50: 6973 7429 3a0a 2020 2020 2020 2020 2020  ist):.          
-00018c60: 2020 2020 2020 2020 2020 6974 656d 203d            item =
-00018c70: 205b 6974 656d 5d0a 2020 2020 2020 2020   [item].        
-00018c80: 2020 2020 7375 6249 7465 6d44 6566 6175      subItemDefau
-00018c90: 6c74 203d 2069 7465 6d5b 305d 0a20 2020  lt = item[0].   
-00018ca0: 2020 2020 2020 2020 2069 7465 6d43 7573           itemCus
-00018cb0: 746f 6d44 6174 6554 696d 6546 6f72 6d61  tomDateTimeForma
-00018cc0: 7420 3d20 2222 0a20 2020 2020 2020 2020  t = "".         
-00018cd0: 2020 2069 6620 2769 6d61 6765 2d64 6174     if 'image-dat
-00018ce0: 6574 696d 652d 666f 726d 6174 2720 696e  etime-format' in
-00018cf0: 2073 7562 4974 656d 4465 6661 756c 743a   subItemDefault:
-00018d00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018d10: 2069 7465 6d43 7573 746f 6d44 6174 6554   itemCustomDateT
-00018d20: 696d 6546 6f72 6d61 7420 3d20 7375 6249  imeFormat = subI
-00018d30: 7465 6d44 6566 6175 6c74 5b27 696d 6167  temDefault['imag
-00018d40: 652d 6461 7465 7469 6d65 2d66 6f72 6d61  e-datetime-forma
-00018d50: 7427 5d0a 2020 2020 2020 2020 2020 2020  t'].            
-00018d60: 2020 2020 7375 6249 7465 6d44 6566 6175      subItemDefau
-00018d70: 6c74 5b27 696d 6167 652d 6461 7465 7469  lt['image-dateti
-00018d80: 6d65 2d66 6f72 6d61 7427 5d20 3d20 2222  me-format'] = ""
-00018d90: 2023 2072 656d 6f76 6520 6375 7374 6f6d   # remove custom
-00018da0: 2066 6f72 6d61 740a 2020 2020 2020 2020   format.        
-00018db0: 2020 2020 2020 2020 6375 7374 6f6d 4461          customDa
-00018dc0: 7465 5469 6d65 466f 726d 6174 466f 756e  teTimeFormatFoun
-00018dd0: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
-00018de0: 2020 2020 2066 6f72 2073 7562 4974 656d       for subItem
-00018df0: 2069 6e20 6974 656d 3a0a 2020 2020 2020   in item:.      
-00018e00: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-00018e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018e20: 2020 2066 6f72 6d61 7420 3d20 6d69 7174     format = miqt
-00018e30: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
-00018e40: 6d61 7269 7174 275d 0a20 2020 2020 2020  mariqt'].       
-00018e50: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-00018e60: 6574 696d 652e 6461 7465 7469 6d65 2e73  etime.datetime.s
-00018e70: 7472 7074 696d 6528 7375 6249 7465 6d5b  trptime(subItem[
-00018e80: 2769 6d61 6765 2d64 6174 6574 696d 6527  'image-datetime'
-00018e90: 5d2c 666f 726d 6174 290a 2020 2020 2020  ],format).      
-00018ea0: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00018eb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00018ec0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00018ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ee0: 2020 2066 6f72 6d61 7420 3d20 6865 6164     format = head
-00018ef0: 6572 4375 7374 6f6d 4461 7465 5469 6d65  erCustomDateTime
-00018f00: 466f 726d 6174 0a20 2020 2020 2020 2020  Format.         
-00018f10: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00018f20: 7420 3d20 6461 7465 7469 6d65 2e64 6174  t = datetime.dat
-00018f30: 6574 696d 652e 7374 7270 7469 6d65 2873  etime.strptime(s
-00018f40: 7562 4974 656d 5b27 696d 6167 652d 6461  ubItem['image-da
-00018f50: 7465 7469 6d65 275d 2c66 6f72 6d61 7429  tetime'],format)
-00018f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018f70: 2020 2020 2020 2020 2073 7562 4974 656d           subItem
-00018f80: 5b27 696d 6167 652d 6461 7465 7469 6d65  ['image-datetime
-00018f90: 275d 203d 2064 6174 6574 696d 652e 6461  '] = datetime.da
-00018fa0: 7465 7469 6d65 2e73 7472 6674 696d 6528  tetime.strftime(
-00018fb0: 6474 2c6d 6971 7476 2e64 6174 655f 666f  dt,miqtv.date_fo
-00018fc0: 726d 6174 735b 276d 6172 6971 7427 5d29  rmats['mariqt'])
-00018fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018fe0: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
-00018ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019000: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00019010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019020: 2020 2020 2020 666f 726d 6174 203d 2069        format = i
-00019030: 7465 6d43 7573 746f 6d44 6174 6554 696d  temCustomDateTim
-00019040: 6546 6f72 6d61 740a 2020 2020 2020 2020  eFormat.        
-00019050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019060: 2020 2020 6474 203d 2064 6174 6574 696d      dt = datetim
-00019070: 652e 6461 7465 7469 6d65 2e73 7472 7074  e.datetime.strpt
-00019080: 696d 6528 7375 6249 7465 6d5b 2769 6d61  ime(subItem['ima
-00019090: 6765 2d64 6174 6574 696d 6527 5d2c 666f  ge-datetime'],fo
-000190a0: 726d 6174 290a 2020 2020 2020 2020 2020  rmat).          
-000190b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000190c0: 2020 7375 6249 7465 6d5b 2769 6d61 6765    subItem['image
-000190d0: 2d64 6174 6574 696d 6527 5d20 3d20 6461  -datetime'] = da
-000190e0: 7465 7469 6d65 2e64 6174 6574 696d 652e  tetime.datetime.
-000190f0: 7374 7266 7469 6d65 2864 742c 6d69 7174  strftime(dt,miqt
-00019100: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
-00019110: 6d61 7269 7174 275d 290a 2020 2020 2020  mariqt']).      
-00019120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019130: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
-00019140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019150: 2020 2020 2020 7072 6f67 2e63 6c65 6172        prog.clear
-00019160: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-00019170: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00019180: 6169 7365 206d 6971 7463 2e49 6664 6f45  aise miqtc.IfdoE
-00019190: 7863 6570 7469 6f6e 2827 496e 7661 6c69  xception('Invali
-000191a0: 6420 6461 7465 7469 6d65 2076 616c 7565  d datetime value
-000191b0: 272c 7375 6249 7465 6d5b 2769 6d61 6765  ',subItem['image
-000191c0: 2d64 6174 6574 696d 6527 5d2c 2022 646f  -datetime'], "do
-000191d0: 6573 206e 6f74 206d 6174 6368 2066 6f72  es not match for
-000191e0: 6d61 7420 6465 6661 756c 7420 6f72 2063  mat default or c
-000191f0: 7573 746f 6d20 666f 726d 6174 2229 0a20  ustom format"). 
-00019200: 2020 2020 2020 2069 6620 6375 7374 6f6d         if custom
-00019210: 4461 7465 5469 6d65 466f 726d 6174 466f  DateTimeFormatFo
-00019220: 756e 643a 0a20 2020 2020 2020 2020 2020  und:.           
-00019230: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
-00019240: 4375 7374 6f6d 2064 6174 6574 696d 6520  Custom datetime 
-00019250: 666f 726d 6174 7320 666f 756e 642e 2054  formats found. T
-00019260: 6865 7920 7769 6c6c 2062 6520 7265 706c  hey will be repl
-00019270: 6163 6564 2062 7920 7468 6520 6465 6661  aced by the defa
-00019280: 756c 7420 666f 726d 6174 2e22 2920 2020  ult format.")   
-00019290: 0a20 2020 2020 2020 2070 726f 672e 636c  .        prog.cl
-000192a0: 6561 7228 2920 2020 200a 0a0a 2020 2020  ear()    ...    
-000192b0: 6465 6620 5f5f 696e 6974 496e 7465 726d  def __initInterm
-000192c0: 6564 6961 7465 4669 6c65 7328 7365 6c66  ediateFiles(self
-000192d0: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
-000192e0: 696e 7465 726d 6564 6961 7465 4669 6c65  intermediateFile
-000192f0: 7344 6566 5f63 6f72 6520 3d20 7b0a 2020  sDef_core = {.  
-00019300: 2020 2020 2020 2020 2020 2768 6173 6865            'hashe
-00019310: 7327 3a20 7b0a 2020 2020 2020 2020 2020  s': {.          
-00019320: 2020 2020 2020 2763 7265 6174 696f 6e46        'creationF
-00019330: 6374 273a 2027 6372 6561 7465 496d 6167  ct': 'createImag
-00019340: 6553 4841 3235 3646 696c 6528 2927 2c0a  eSHA256File()',.
-00019350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019360: 2773 7566 6669 7827 3a20 275f 696d 6167  'suffix': '_imag
-00019370: 652d 6861 7368 6573 2e74 7874 272c 0a20  e-hashes.txt',. 
-00019380: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00019390: 636f 6c73 273a 205b 6d69 7174 762e 636f  cols': [miqtv.co
-000193a0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-000193b0: 275d 5b27 6861 7368 275d 5d2c 0a20 2020  ']['hash']],.   
-000193c0: 2020 2020 2020 2020 2020 2020 2027 6f70               'op
-000193d0: 7469 6f6e 616c 273a 205b 5d7d 2c0a 2020  tional': []},.  
-000193e0: 2020 2020 2020 2020 2020 2775 7569 6473            'uuids
-000193f0: 273a 207b 0a20 2020 2020 2020 2020 2020  ': {.           
-00019400: 2020 2020 2027 6372 6561 7469 6f6e 4663       'creationFc
-00019410: 7427 3a20 2763 7265 6174 6555 5549 4446  t': 'createUUIDF
-00019420: 696c 6528 2927 2c0a 2020 2020 2020 2020  ile()',.        
-00019430: 2020 2020 2020 2020 2773 7566 6669 7827          'suffix'
-00019440: 3a20 275f 696d 6167 652d 7575 6964 732e  : '_image-uuids.
-00019450: 7478 7427 2c0a 2020 2020 2020 2020 2020  txt',.          
-00019460: 2020 2020 2020 2763 6f6c 7327 3a20 5b6d        'cols': [m
-00019470: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-00019480: 276d 6172 6971 7427 5d5b 2775 7569 6427  'mariqt']['uuid'
-00019490: 5d5d 2c0a 2020 2020 2020 2020 2020 2020  ]],.            
-000194a0: 2020 2020 276f 7074 696f 6e61 6c27 3a20      'optional': 
-000194b0: 5b5d 7d2c 0a20 2020 2020 2020 2020 2020  []},.           
-000194c0: 2027 6461 7465 7469 6d65 273a 207b 0a20   'datetime': {. 
-000194d0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-000194e0: 6372 6561 7469 6f6e 4663 7427 3a20 2763  creationFct': 'c
-000194f0: 7265 6174 6553 7461 7274 5469 6d65 4669  reateStartTimeFi
-00019500: 6c65 2829 272c 0a20 2020 2020 2020 2020  le()',.         
-00019510: 2020 2020 2020 2027 7375 6666 6978 273a         'suffix':
-00019520: 2027 5f69 6d61 6765 2d73 7461 7274 2d74   '_image-start-t
-00019530: 696d 6573 2e74 7874 272c 0a20 2020 2020  imes.txt',.     
-00019540: 2020 2020 2020 2020 2020 2027 636f 6c73             'cols
-00019550: 273a 205b 6d69 7174 762e 636f 6c5f 6865  ': [miqtv.col_he
-00019560: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00019570: 7574 6327 5d5d 2c0a 2020 2020 2020 2020  utc']],.        
-00019580: 2020 2020 2020 2020 276f 7074 696f 6e61          'optiona
-00019590: 6c27 3a20 5b5d 7d2c 0a20 2020 2020 2020  l': []},.       
-000195a0: 2020 2020 2027 6e61 7669 6761 7469 6f6e       'navigation
-000195b0: 273a 207b 0a20 2020 2020 2020 2020 2020  ': {.           
-000195c0: 2020 2020 2027 6372 6561 7469 6f6e 4663       'creationFc
-000195d0: 7427 3a20 2763 7265 6174 6549 6d61 6765  t': 'createImage
-000195e0: 4e61 7669 6761 7469 6f6e 4669 6c65 2829  NavigationFile()
-000195f0: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-00019600: 2020 2027 7375 6666 6978 273a 2027 5f69     'suffix': '_i
-00019610: 6d61 6765 2d6e 6176 6967 6174 696f 6e2e  mage-navigation.
-00019620: 7478 7427 2c0a 2020 2020 2020 2020 2020  txt',.          
-00019630: 2020 2020 2020 2763 6f6c 7327 3a20 5b6d        'cols': [m
-00019640: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-00019650: 276d 6172 6971 7427 5d5b 2775 7463 275d  'mariqt']['utc']
-00019660: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-00019670: 2020 2027 6f70 7469 6f6e 616c 273a 205b     'optional': [
-00019680: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-00019690: 5b27 6d61 7269 7174 275d 5b27 6c6f 6e27  ['mariqt']['lon'
-000196a0: 5d2c 206d 6971 7476 2e63 6f6c 5f68 6561  ], miqtv.col_hea
-000196b0: 6465 725b 276d 6172 6971 7427 5d5b 276c  der['mariqt']['l
-000196c0: 6174 275d 2c6d 6971 7476 2e63 6f6c 5f68  at'],miqtv.col_h
-000196d0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-000196e0: 2764 6570 275d 2c20 6d69 7174 762e 636f  'dep'], miqtv.co
-000196f0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00019700: 275d 5b27 616c 7427 5d2c 206d 6971 7476  ']['alt'], miqtv
-00019710: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00019720: 6971 7427 5d5b 2768 6774 275d 2c20 6d69  iqt']['hgt'], mi
-00019730: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-00019740: 6d61 7269 7174 275d 5b27 756e 6365 7274  mariqt']['uncert
-00019750: 275d 5d7d 2c0a 2020 2020 2020 2020 7d0a  ']]},.        }.
-00019760: 0a20 2020 2020 2020 2073 656c 662e 6e6f  .        self.no
-00019770: 6e43 6f72 6546 6965 6c64 496e 7465 726d  nCoreFieldInterm
-00019780: 6564 6961 7465 4974 656d 496e 666f 4669  ediateItemInfoFi
-00019790: 6c65 7320 3d20 5b5d 0a0a 2020 2020 6465  les = []..    de
-000197a0: 6620 5f5f 6765 745f 696e 745f 6669 6c65  f __get_int_file
-000197b0: 5f70 7265 6669 7828 7365 6c66 293a 0a20  _prefix(self):. 
-000197c0: 2020 2020 2020 2022 2222 2064 6570 656e         """ depen
-000197d0: 6473 206f 6e20 2769 6d61 6765 2d65 7665  ds on 'image-eve
-000197e0: 6e74 2720 616e 6420 2769 6d61 6765 2d73  nt' and 'image-s
-000197f0: 656e 736f 7227 2073 6f20 6974 2063 616e  ensor' so it can
-00019800: 2063 6861 6e67 6520 6475 7269 6e67 2075   change during u
-00019810: 7061 7465 2022 2222 0a20 2020 2020 2020  pate """.       
-00019820: 2072 6574 7572 6e20 6f73 2e70 6174 682e   return os.path.
-00019830: 6a6f 696e 2873 656c 662e 6469 722e 746f  join(self.dir.to
-00019840: 2873 656c 662e 6469 722e 6474 2e69 6e74  (self.dir.dt.int
-00019850: 6572 6d65 6469 6174 6529 2c20 7365 6c66  ermediate), self
-00019860: 2e66 696e 6454 6d70 4669 656c 6428 2769  .findTmpField('i
-00019870: 6d61 6765 2d73 6574 2d6e 616d 6527 2929  mage-set-name'))
-00019880: 0a0a 2020 2020 6465 6620 6765 745f 696e  ..    def get_in
-00019890: 745f 6861 7368 5f66 696c 6528 7365 6c66  t_hash_file(self
-000198a0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-000198b0: 6e20 7365 6c66 2e5f 5f67 6574 5f69 6e74  n self.__get_int
-000198c0: 5f66 696c 655f 7072 6566 6978 2829 202b  _file_prefix() +
-000198d0: 2073 656c 662e 696e 7465 726d 6564 6961   self.intermedia
-000198e0: 7465 4669 6c65 7344 6566 5f63 6f72 655b  teFilesDef_core[
-000198f0: 2768 6173 6865 7327 5d5b 2773 7566 6669  'hashes']['suffi
-00019900: 7827 5d0a 0a20 2020 2064 6566 2067 6574  x']..    def get
-00019910: 5f69 6e74 5f75 7569 645f 6669 6c65 2873  _int_uuid_file(s
-00019920: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
-00019930: 7475 726e 2073 656c 662e 5f5f 6765 745f  turn self.__get_
-00019940: 696e 745f 6669 6c65 5f70 7265 6669 7828  int_file_prefix(
-00019950: 2920 2b20 7365 6c66 2e69 6e74 6572 6d65  ) + self.interme
-00019960: 6469 6174 6546 696c 6573 4465 665f 636f  diateFilesDef_co
-00019970: 7265 5b27 7575 6964 7327 5d5b 2773 7566  re['uuids']['suf
-00019980: 6669 7827 5d0a 0a20 2020 2064 6566 2067  fix']..    def g
-00019990: 6574 5f69 6e74 5f73 7461 7274 5469 6d65  et_int_startTime
-000199a0: 735f 6669 6c65 2873 656c 6629 3a0a 2020  s_file(self):.  
-000199b0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000199c0: 662e 5f5f 6765 745f 696e 745f 6669 6c65  f.__get_int_file
-000199d0: 5f70 7265 6669 7828 2920 2b20 7365 6c66  _prefix() + self
-000199e0: 2e69 6e74 6572 6d65 6469 6174 6546 696c  .intermediateFil
-000199f0: 6573 4465 665f 636f 7265 5b27 6461 7465  esDef_core['date
-00019a00: 7469 6d65 275d 5b27 7375 6666 6978 275d  time']['suffix']
-00019a10: 0a0a 2020 2020 6465 6620 6765 745f 696e  ..    def get_in
-00019a20: 745f 6e61 765f 6669 6c65 2873 656c 6629  t_nav_file(self)
-00019a30: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00019a40: 2073 656c 662e 5f5f 6765 745f 696e 745f   self.__get_int_
-00019a50: 6669 6c65 5f70 7265 6669 7828 2920 2b20  file_prefix() + 
-00019a60: 7365 6c66 2e69 6e74 6572 6d65 6469 6174  self.intermediat
-00019a70: 6546 696c 6573 4465 665f 636f 7265 5b27  eFilesDef_core['
-00019a80: 6e61 7669 6761 7469 6f6e 275d 5b27 7375  navigation']['su
-00019a90: 6666 6978 275d 0a0a                      ffix']..
+00017f20: 2020 206c 696e 6573 203d 2072 6573 2e72     lines = res.r
+00017f30: 6561 646c 696e 6573 2829 0a20 2020 2020  eadlines().     
+00017f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f50: 2020 2072 6573 2e63 6c6f 7365 2829 0a20     res.close(). 
+00017f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f70: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00017f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f90: 206c 696e 6573 203d 205b 5d0a 2020 2020   lines = [].    
+00017fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017fb0: 6920 3d20 300a 2020 2020 2020 2020 2020  i = 0.          
+00017fc0: 2020 2020 2020 2020 2020 6c69 6e65 4e72            lineNr
+00017fd0: 203d 2069 0a20 2020 2020 2020 2020 2020   = i.           
+00017fe0: 2020 2020 2020 2020 2066 6f72 206c 696e           for lin
+00017ff0: 6520 696e 206c 696e 6573 3a0a 2020 2020  e in lines:.    
+00018000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018010: 2020 2020 6966 206f 732e 7061 7468 2e62      if os.path.b
+00018020: 6173 656e 616d 6528 6669 6c65 2920 696e  asename(file) in
+00018030: 206c 696e 653a 0a20 2020 2020 2020 2020   line:.         
+00018040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018050: 2020 206c 696e 654e 7220 3d20 690a 2020     lineNr = i.  
+00018060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018070: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+00018080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018090: 2020 2020 2020 2020 6920 2b3d 2031 0a20          i += 1. 
+000180a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000180b0: 2020 2069 6620 6c69 6e65 4e72 2021 3d20     if lineNr != 
+000180c0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+000180d0: 2020 2020 2020 2020 2020 2064 656c 206c             del l
+000180e0: 696e 6573 5b6c 696e 654e 725d 0a20 2020  ines[lineNr].   
+000180f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018100: 2020 2020 2072 6573 203d 206f 7065 6e28       res = open(
+00018110: 7365 6c66 2e67 6574 5f69 6e74 5f75 7569  self.get_int_uui
+00018120: 645f 6669 6c65 2829 2c20 2277 2229 0a20  d_file(), "w"). 
+00018130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018140: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+00018150: 6c69 6e65 7328 6c69 6e65 7329 0a20 2020  lines(lines).   
+00018160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018170: 2020 2020 2072 6573 2e63 6c6f 7365 2829       res.close()
+00018180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018190: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
+000181a0: 7469 6f6e 2820 2246 696c 6520 2220 2b20  tion( "File " + 
+000181b0: 6669 6c65 202b 2022 2064 6f65 7320 6e6f  file + " does no
+000181c0: 7420 636f 7461 696e 2061 2076 616c 6964  t cotain a valid
+000181d0: 2055 5549 442e 2052 756e 2063 7265 6174   UUID. Run creat
+000181e0: 655f 7575 6964 5f66 696c 6528 2920 6669  e_uuid_file() fi
+000181f0: 7273 7421 2229 0a0a 2020 2020 2020 2020  rst!")..        
+00018200: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
+00018210: 6520 3d20 6f73 2e70 6174 682e 6261 7365  e = os.path.base
+00018220: 6e61 6d65 2866 696c 6529 0a20 2020 2020  name(file).     
+00018230: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00018240: 7420 7265 5265 6164 416c 6c20 616e 6420  t reReadAll and 
+00018250: 6669 6c65 5f6e 616d 6520 696e 2068 6173  file_name in has
+00018260: 6865 733a 0a20 2020 2020 2020 2020 2020  hes:.           
+00018270: 2020 2020 2020 2020 2068 6173 6865 735b           hashes[
+00018280: 6669 6c65 5f6e 616d 655d 203d 2068 6173  file_name] = has
+00018290: 6865 735b 6669 6c65 5f6e 616d 655d 5b6d  hes[file_name][m
+000182a0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+000182b0: 276d 6172 6971 7427 5d5b 2768 6173 6827  'mariqt']['hash'
+000182c0: 5d5d 0a20 2020 2020 2020 2020 2020 2020  ]].             
+000182d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000182e0: 2020 2020 2020 2020 2020 2020 2068 6173               has
+000182f0: 6865 735b 6669 6c65 5f6e 616d 655d 203d  hes[file_name] =
+00018300: 206d 6971 7463 2e73 6861 3235 3648 6173   miqtc.sha256Has
+00018310: 6846 696c 6528 6669 6c65 290a 2020 2020  hFile(file).    
+00018320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018330: 6164 6465 645f 6861 7368 6573 202b 3d20  added_hashes += 
+00018340: 310a 2020 2020 2020 2020 2020 2020 7072  1.            pr
+00018350: 6f67 2e63 6c65 6172 2829 0a0a 2020 2020  og.clear()..    
+00018360: 2020 2020 2020 2020 6966 2072 6552 6561          if reRea
+00018370: 6441 6c6c 206f 7220 6164 6465 645f 6861  dAll or added_ha
+00018380: 7368 6573 203e 2030 3a0a 2020 2020 2020  shes > 0:.      
+00018390: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
+000183a0: 696c 6520 3d20 6f70 656e 2873 656c 662e  ile = open(self.
+000183b0: 6765 745f 696e 745f 6861 7368 5f66 696c  get_int_hash_fil
+000183c0: 6528 292c 2022 7722 290a 2020 2020 2020  e(), "w").      
+000183d0: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
+000183e0: 696c 652e 7772 6974 6528 206d 6971 7476  ile.write( miqtv
+000183f0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+00018400: 6971 7427 5d5b 2769 6d67 275d 2b22 5c74  iqt']['img']+"\t
+00018410: 222b 6d69 7174 762e 636f 6c5f 6865 6164  "+miqtv.col_head
+00018420: 6572 5b27 6d61 7269 7174 275d 5b27 6861  er['mariqt']['ha
+00018430: 7368 275d 2b22 5c6e 2229 0a20 2020 2020  sh']+"\n").     
+00018440: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
+00018450: 696c 655f 6e61 6d65 2069 6e20 6861 7368  ile_name in hash
+00018460: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00018470: 2020 2020 2020 2020 6861 7368 5f66 696c          hash_fil
+00018480: 652e 7772 6974 6528 6669 6c65 5f6e 616d  e.write(file_nam
+00018490: 652b 225c 7422 2b68 6173 6865 735b 6669  e+"\t"+hashes[fi
+000184a0: 6c65 5f6e 616d 655d 2b22 5c6e 2229 0a0a  le_name]+"\n")..
+000184b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000184c0: 6861 7368 5f66 696c 652e 636c 6f73 6528  hash_file.close(
+000184d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000184e0: 2020 7265 7475 726e 2054 7275 652c 2022    return True, "
+000184f0: 4164 6465 6420 222b 7374 7228 6164 6465  Added "+str(adde
+00018500: 645f 6861 7368 6573 292b 2220 6861 7368  d_hashes)+" hash
+00018510: 6573 2074 6f20 6861 7368 2066 696c 6522  es to hash file"
+00018520: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00018530: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00018540: 2020 2072 6574 7572 6e20 5472 7565 2c20     return True, 
+00018550: 2241 6c6c 2068 6173 6865 7320 6578 6973  "All hashes exis
+00018560: 7422 0a0a 2020 2020 2020 2020 656c 7365  t"..        else
+00018570: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00018580: 7475 726e 2046 616c 7365 2c20 224e 6f20  turn False, "No 
+00018590: 696d 6167 6573 2066 6f75 6e64 2074 6f20  images found to 
+000185a0: 6861 7368 220a 2020 2020 2020 2020 0a20  hash".        . 
+000185b0: 2020 2064 6566 2063 7265 6174 6549 6d61     def createIma
+000185c0: 6765 5348 4132 3536 4669 6c65 2873 656c  geSHA256File(sel
+000185d0: 662c 7265 5265 6164 416c 6c3d 5472 7565  f,reReadAll=True
+000185e0: 293a 0a20 2020 2020 2020 2022 2222 2044  ):.        """ D
+000185f0: 6570 7265 6361 7465 6420 2d20 7573 6520  eprecated - use 
+00018600: 6372 6561 7465 5f69 6d61 6765 5f73 6861  create_image_sha
+00018610: 3235 365f 6669 6c65 2022 2222 0a20 2020  256_file """.   
+00018620: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00018630: 2e63 7265 6174 655f 696d 6167 655f 7368  .create_image_sh
+00018640: 6132 3536 5f66 696c 6528 7265 5265 6164  a256_file(reRead
+00018650: 416c 6c29 0a0a 0a20 2020 2064 6566 2063  All)...    def c
+00018660: 7265 6174 655f 7374 6172 745f 7469 6d65  reate_start_time
+00018670: 5f66 696c 6528 7365 6c66 293a 0a20 2020  _file(self):.   
+00018680: 2020 2020 2022 2222 2043 7265 6174 6573       """ Creates
+00018690: 2069 6e20 2f69 6e74 6572 6d65 6469 6174   in /intermediat
+000186a0: 6520 6120 7465 7874 2066 696c 6520 636f  e a text file co
+000186b0: 6e74 6169 6e69 6e67 2070 6572 2069 6d61  ntaining per ima
+000186c0: 6765 2069 7473 2073 7461 7274 2074 696d  ge its start tim
+000186d0: 6520 7061 7273 6564 2066 726f 6d20 7468  e parsed from th
+000186e0: 6520 6669 6c65 206e 616d 6520 2222 220a  e file name """.
+000186f0: 0a20 2020 2020 2020 2073 203d 206d 6971  .        s = miq
+00018700: 7463 2e50 7269 6e74 4c6f 6164 696e 674d  tc.PrintLoadingM
+00018710: 7367 2822 4372 6561 7469 6e67 2069 6e74  sg("Creating int
+00018720: 6572 6d65 6469 6174 6520 7374 6172 7474  ermediate startt
+00018730: 696d 6520 6669 6c65 2022 290a 2020 2020  ime file ").    
+00018740: 2020 2020 696d 6167 6573 496e 5261 7720      imagesInRaw 
+00018750: 3d20 7365 6c66 2e69 6d61 6765 7349 6e49  = self.imagesInI
+00018760: 6d61 6765 7344 6972 536f 7274 6564 4c69  magesDirSortedLi
+00018770: 7374 2829 0a20 2020 2020 2020 2069 6620  st().        if 
+00018780: 6c65 6e28 696d 6167 6573 496e 5261 7729  len(imagesInRaw)
+00018790: 203e 2030 3a0a 0a20 2020 2020 2020 2020   > 0:..         
+000187a0: 2020 206f 203d 206f 7065 6e28 7365 6c66     o = open(self
+000187b0: 2e67 6574 5f69 6e74 5f73 7461 7274 5469  .get_int_startTi
+000187c0: 6d65 735f 6669 6c65 2829 2c20 2277 2229  mes_file(), "w")
+000187d0: 0a20 2020 2020 2020 2020 2020 206f 2e77  .            o.w
+000187e0: 7269 7465 286d 6971 7476 2e63 6f6c 5f68  rite(miqtv.col_h
+000187f0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00018800: 2769 6d67 275d 202b 0a20 2020 2020 2020  'img'] +.       
+00018810: 2020 2020 2020 2020 2020 2020 2022 5c74               "\t
+00018820: 222b 6d69 7174 762e 636f 6c5f 6865 6164  "+miqtv.col_head
+00018830: 6572 5b27 6d61 7269 7174 275d 5b27 7574  er['mariqt']['ut
+00018840: 6327 5d2b 225c 6e22 290a 0a20 2020 2020  c']+"\n")..     
+00018850: 2020 2020 2020 2066 6f72 2066 696c 6520         for file 
+00018860: 696e 2069 6d61 6765 7349 6e52 6177 3a0a  in imagesInRaw:.
+00018870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018880: 6669 6c65 5f6e 616d 6520 3d20 6f73 2e70  file_name = os.p
+00018890: 6174 682e 6261 7365 6e61 6d65 2866 696c  ath.basename(fil
+000188a0: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
+000188b0: 2020 2020 6474 203d 206d 6971 7463 2e70      dt = miqtc.p
+000188c0: 6172 7365 4669 6c65 4461 7465 5469 6d65  arseFileDateTime
+000188d0: 4173 5554 4328 6669 6c65 5f6e 616d 6529  AsUTC(file_name)
+000188e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000188f0: 206f 2e77 7269 7465 2866 696c 655f 6e61   o.write(file_na
+00018900: 6d65 2b22 5c74 2220 2b20 6474 2e73 7472  me+"\t" + dt.str
+00018910: 6674 696d 6528 6d69 7174 762e 6461 7465  ftime(miqtv.date
+00018920: 5f66 6f72 6d61 7473 5b27 6d61 7269 7174  _formats['mariqt
+00018930: 275d 292b 225c 6e22 290a 0a20 2020 2020  '])+"\n")..     
+00018940: 2020 2020 2020 206f 2e63 6c6f 7365 2829         o.close()
+00018950: 0a20 2020 2020 2020 2020 2020 2073 2e73  .            s.s
+00018960: 746f 7028 290a 2020 2020 2020 2020 2020  top().          
+00018970: 2020 7265 7475 726e 2054 7275 652c 2022    return True, "
+00018980: 4372 6561 7465 6420 7374 6172 7420 7469  Created start ti
+00018990: 6d65 2066 696c 6522 0a20 2020 2020 2020  me file".       
+000189a0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000189b0: 2020 2073 2e73 746f 7028 290a 2020 2020     s.stop().    
+000189c0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+000189d0: 616c 7365 2c20 224e 6f20 696d 6167 6573  alse, "No images
+000189e0: 2066 6f75 6e64 2074 6f20 7265 6164 2073   found to read s
+000189f0: 7461 7274 2074 696d 6573 220a 2020 2020  tart times".    
+00018a00: 2020 2020 0a20 2020 2064 6566 2063 7265      .    def cre
+00018a10: 6174 6553 7461 7274 5469 6d65 4669 6c65  ateStartTimeFile
+00018a20: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00018a30: 2222 2220 4465 7072 6563 6174 6564 202d  """ Deprecated -
+00018a40: 2075 7365 2063 7265 6174 655f 7374 6172   use create_star
+00018a50: 745f 7469 6d65 5f66 696c 6520 2222 220a  t_time_file """.
+00018a60: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00018a70: 656c 662e 6372 6561 7465 5f73 7461 7274  elf.create_start
+00018a80: 5f74 696d 655f 6669 6c65 2829 0a0a 0a20  _time_file()... 
+00018a90: 2020 2064 6566 2063 7265 6174 6541 6371     def createAcq
+00018aa0: 7569 7369 7469 6f6e 5365 7474 696e 6773  uisitionSettings
+00018ab0: 4558 4946 4669 6c65 2873 656c 662c 6f76  EXIFFile(self,ov
+00018ac0: 6572 7269 6465 3d46 616c 7365 293a 0a20  erride=False):. 
+00018ad0: 2020 2020 2020 2022 2222 2043 7265 6174         """ Creat
+00018ae0: 6573 2069 6e20 2f69 6e74 6572 6d65 6469  es in /intermedi
+00018af0: 6174 6520 6120 7465 7874 2066 696c 6520  ate a text file 
+00018b00: 636f 6e74 6169 6e69 6e67 2070 6572 2069  containing per i
+00018b10: 6d61 6765 2061 2064 6963 7420 6f66 2065  mage a dict of e
+00018b20: 7869 6620 7461 6773 2061 6e64 2074 6865  xif tags and the
+00018b30: 6972 2076 616c 7565 7320 7061 7273 6564  ir values parsed
+00018b40: 2066 726f 6d20 7468 6520 696d 6167 6520   from the image 
+00018b50: 2222 220a 0a20 2020 2020 2020 2069 6e74  """..        int
+00018b60: 5f61 6371 7569 7369 7469 6f6e 5365 7474  _acquisitionSett
+00018b70: 696e 675f 6669 6c65 203d 2073 656c 662e  ing_file = self.
+00018b80: 5f5f 6765 745f 696e 745f 6669 6c65 5f70  __get_int_file_p
+00018b90: 7265 6669 7828 2920 2b20 275f 696d 6167  refix() + '_imag
+00018ba0: 652d 6163 7175 6973 6974 696f 6e2d 7365  e-acquisition-se
+00018bb0: 7474 696e 6773 2e74 7874 270a 2020 2020  ttings.txt'.    
+00018bc0: 2020 2020 6865 6164 6572 203d 207b 2020      header = {  
+00018bd0: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00018be0: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
+00018bf0: 5d3a 2020 6d69 7174 762e 636f 6c5f 6865  ]:  miqtv.col_he
+00018c00: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00018c10: 696d 6727 5d2c 0a20 2020 2020 2020 2020  img'],.         
+00018c20: 2020 2020 2020 2020 2020 206d 6971 7476             miqtv
+00018c30: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+00018c40: 6971 7427 5d5b 2761 6371 7569 275d 3a6d  iqt']['acqui']:m
+00018c50: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+00018c60: 276d 6172 6971 7427 5d5b 2761 6371 7569  'mariqt']['acqui
+00018c70: 275d 7d0a 2020 2020 2020 2020 6966 206f  ']}.        if o
+00018c80: 732e 7061 7468 2e65 7869 7374 7328 696e  s.path.exists(in
+00018c90: 745f 6163 7175 6973 6974 696f 6e53 6574  t_acquisitionSet
+00018ca0: 7469 6e67 5f66 696c 6529 2061 6e64 206e  ting_file) and n
+00018cb0: 6f74 206f 7665 7272 6964 653a 0a20 2020  ot override:.   
+00018cc0: 2020 2020 2020 2020 2073 656c 662e 6164           self.ad
+00018cd0: 645f 6974 656d 5f69 6e66 6f5f 7461 625f  d_item_info_tab_
+00018ce0: 6669 6c65 2869 6e74 5f61 6371 7569 7369  file(int_acquisi
+00018cf0: 7469 6f6e 5365 7474 696e 675f 6669 6c65  tionSetting_file
+00018d00: 2c22 5c74 222c 6865 6164 6572 290a 2020  ,"\t",header).  
+00018d10: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00018d20: 2054 7275 652c 2022 5265 7375 6c74 2066   True, "Result f
+00018d30: 696c 6520 6578 6973 7473 220a 0a20 2020  ile exists"..   
+00018d40: 2020 2020 2069 6d61 6765 7349 6e52 6177       imagesInRaw
+00018d50: 203d 2073 656c 662e 696d 6167 6573 496e   = self.imagesIn
+00018d60: 496d 6167 6573 4469 7253 6f72 7465 644c  ImagesDirSortedL
+00018d70: 6973 7428 290a 2020 2020 2020 2020 6966  ist().        if
+00018d80: 206c 656e 2869 6d61 6765 7349 6e52 6177   len(imagesInRaw
+00018d90: 2920 3e20 303a 0a0a 2020 2020 2020 2020  ) > 0:..        
+00018da0: 2020 2020 6f20 3d20 6f70 656e 2869 6e74      o = open(int
+00018db0: 5f61 6371 7569 7369 7469 6f6e 5365 7474  _acquisitionSett
+00018dc0: 696e 675f 6669 6c65 2c20 2277 2229 0a20  ing_file, "w"). 
+00018dd0: 2020 2020 2020 2020 2020 206f 2e77 7269             o.wri
+00018de0: 7465 286d 6971 7476 2e63 6f6c 5f68 6561  te(miqtv.col_hea
+00018df0: 6465 725b 276d 6172 6971 7427 5d5b 2769  der['mariqt']['i
+00018e00: 6d67 275d 202b 2022 5c74 222b 6d69 7174  mg'] + "\t"+miqt
+00018e10: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+00018e20: 7269 7174 275d 5b27 6163 7175 6927 5d2b  riqt']['acqui']+
+00018e30: 225c 6e22 290a 200a 2020 2020 2020 2020  "\n"). .        
+00018e40: 2020 2020 696d 6167 6573 4578 6966 7320      imagesExifs 
+00018e50: 3d20 6d69 7174 692e 6765 7449 6d61 6765  = miqti.getImage
+00018e60: 7341 6c6c 4578 6966 5661 6c75 6573 2869  sAllExifValues(i
+00018e70: 6d61 6765 7349 6e52 6177 2c73 656c 662e  magesInRaw,self.
+00018e80: 7072 6f76 290a 2020 2020 2020 2020 2020  prov).          
+00018e90: 2020 666f 7220 6669 6c65 2069 6e20 696d    for file in im
+00018ea0: 6167 6573 4578 6966 733a 0a20 2020 2020  agesExifs:.     
+00018eb0: 2020 2020 2020 2020 2020 2066 696c 655f             file_
+00018ec0: 6e61 6d65 203d 206f 732e 7061 7468 2e62  name = os.path.b
+00018ed0: 6173 656e 616d 6528 6669 6c65 290a 2020  asename(file).  
+00018ee0: 2020 2020 2020 2020 2020 2020 2020 6f2e                o.
+00018ef0: 7772 6974 6528 6669 6c65 5f6e 616d 652b  write(file_name+
+00018f00: 225c 7422 2b73 7472 2869 6d61 6765 7345  "\t"+str(imagesE
+00018f10: 7869 6673 5b66 696c 655d 292b 225c 6e22  xifs[file])+"\n"
+00018f20: 290a 0a20 2020 2020 2020 2020 2020 206f  )..            o
+00018f30: 2e63 6c6f 7365 2829 0a0a 2020 2020 2020  .close()..      
+00018f40: 2020 2020 2020 7365 6c66 2e61 6464 5f69        self.add_i
+00018f50: 7465 6d5f 696e 666f 5f74 6162 5f66 696c  tem_info_tab_fil
+00018f60: 6528 696e 745f 6163 7175 6973 6974 696f  e(int_acquisitio
+00018f70: 6e53 6574 7469 6e67 5f66 696c 652c 225c  nSetting_file,"\
+00018f80: 7422 2c68 6561 6465 7229 0a20 2020 2020  t",header).     
+00018f90: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+00018fa0: 7565 2c20 2243 7265 6174 6564 2061 6371  ue, "Created acq
+00018fb0: 7569 7369 7469 6f6e 2073 6574 7469 6e67  uisition setting
+00018fc0: 7320 6669 6c65 220a 2020 2020 2020 2020  s file".        
+00018fd0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00018fe0: 2020 7265 7475 726e 2046 616c 7365 2c20    return False, 
+00018ff0: 224e 6f20 696d 6167 6573 2066 6f75 6e64  "No images found
+00019000: 220a 0a0a 2020 2020 6465 6620 696d 6167  "...    def imag
+00019010: 6573 496e 496d 6167 6573 4469 7228 7365  esInImagesDir(se
+00019020: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
+00019030: 7572 6e20 636f 7079 2e64 6565 7063 6f70  urn copy.deepcop
+00019040: 7928 7365 6c66 2e5f 696d 6167 6573 496e  y(self._imagesIn
+00019050: 496d 6167 6573 4469 7229 0a0a 2020 2020  ImagesDir)..    
+00019060: 6465 6620 696d 6167 6573 496e 496d 6167  def imagesInImag
+00019070: 6573 4469 7253 6f72 7465 644c 6973 7428  esDirSortedList(
+00019080: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+00019090: 6574 7572 6e20 636f 7079 2e64 6565 7063  eturn copy.deepc
+000190a0: 6f70 7928 7365 6c66 2e5f 696d 6167 6573  opy(self._images
+000190b0: 496e 496d 6167 6573 4469 7253 6f72 7465  InImagesDirSorte
+000190c0: 644c 6973 7429 0a0a 0a20 2020 2064 6566  dList)...    def
+000190d0: 2070 6172 7365 4974 656d 4461 7461 6672   parseItemDatafr
+000190e0: 6f6d 5461 6246 696c 6544 6174 6128 7365  omTabFileData(se
+000190f0: 6c66 2c20 6974 656d 733a 2064 6963 742c  lf, items: dict,
+00019100: 2066 696c 653a 2073 7472 2c20 636f 6c73   file: str, cols
+00019110: 3a20 6c69 7374 2c20 6f70 7469 6f6e 616c  : list, optional
+00019120: 3a20 6c69 7374 203d 205b 5d2c 2064 6174  : list = [], dat
+00019130: 6574 696d 655f 666f 726d 6174 3a73 7472  etime_format:str
+00019140: 3d6d 6971 7476 2e64 6174 655f 666f 726d  =miqtv.date_form
+00019150: 6174 735b 276d 6172 6971 7427 5d29 3a0a  ats['mariqt']):.
+00019160: 2020 2020 2020 2020 2222 2220 7061 7273          """ pars
+00019170: 6573 2064 6174 6120 6672 6f6d 2063 6f6c  es data from col
+00019180: 756d 6e73 2069 6e20 636f 6c73 2061 6e64  umns in cols and
+00019190: 2077 7269 7465 7320 696e 666f 2074 6f20   writes info to 
+000191a0: 6974 656d 732e 2043 6f6c 756d 6e20 2769  items. Column 'i
+000191b0: 6d61 6765 2d66 696c 656e 616d 6527 206d  mage-filename' m
+000191c0: 7573 7420 6265 2069 6e20 6669 6c65 2061  ust be in file a
+000191d0: 6e64 2064 6f65 7320 6e6f 7420 6e65 6564  nd does not need
+000191e0: 2074 6f20 6265 2070 6173 7365 6420 696e   to be passed in
+000191f0: 2063 6f6c 732e 200a 2020 2020 2020 2020   cols. .        
+00019200: 2020 2020 4669 6c65 206d 7573 7420 6265      File must be
+00019210: 2074 6162 2073 6570 6172 6174 6564 2061   tab separated a
+00019220: 6e64 2063 6f6c 756d 6e73 206e 616d 6573  nd columns names
+00019230: 206d 7573 7420 6571 7561 6c20 6974 656d   must equal item
+00019240: 2066 6965 6c64 206e 616d 6573 2222 220a   field names""".
+00019250: 2020 2020 2020 2020 746d 705f 6461 7461          tmp_data
+00019260: 203d 206d 6971 7466 2e74 6162 4669 6c65   = miqtf.tabFile
+00019270: 4461 7461 2866 696c 652c 2063 6f6c 732b  Data(file, cols+
+00019280: 5b27 696d 6167 652d 6669 6c65 6e61 6d65  ['image-filename
+00019290: 275d 2b6f 7074 696f 6e61 6c2c 206b 6579  ']+optional, key
+000192a0: 5f63 6f6c 3d27 696d 6167 652d 6669 6c65  _col='image-file
+000192b0: 6e61 6d65 272c 206f 7074 696f 6e61 6c3d  name', optional=
+000192c0: 6f70 7469 6f6e 616c 2c63 6f6e 7665 7274  optional,convert
+000192d0: 3d54 7275 6529 0a20 2020 2020 2020 2073  =True).        s
+000192e0: 656c 662e 7772 6974 6550 6172 7365 6444  elf.writeParsedD
+000192f0: 6174 6154 6f49 7465 6d73 2874 6d70 5f64  ataToItems(tmp_d
+00019300: 6174 612c 6974 656d 732c 7365 6c66 2e69  ata,items,self.i
+00019310: 6664 6f5f 746d 705b 6d69 7174 762e 696d  fdo_tmp[miqtv.im
+00019320: 6167 655f 7365 745f 6865 6164 6572 5f6b  age_set_header_k
+00019330: 6579 5d2c 2064 6174 6574 696d 655f 666f  ey], datetime_fo
+00019340: 726d 6174 3d64 6174 6574 696d 655f 666f  rmat=datetime_fo
+00019350: 726d 6174 290a 0a0a 2020 2020 6465 6620  rmat)...    def 
+00019360: 7072 6173 6549 7465 6d44 6174 6146 726f  praseItemDataFro
+00019370: 6d46 696c 6528 7365 6c66 2c69 7465 6d73  mFile(self,items
+00019380: 3a64 6963 742c 6669 6c65 3a73 7472 2c73  :dict,file:str,s
+00019390: 6570 6172 6174 6f72 3a73 7472 2c68 6561  eparator:str,hea
+000193a0: 6465 723a 6469 6374 2c20 6461 7465 7469  der:dict, dateti
+000193b0: 6d65 5f66 6f72 6d61 743a 7374 723d 6d69  me_format:str=mi
+000193c0: 7174 762e 6461 7465 5f66 6f72 6d61 7473  qtv.date_formats
+000193d0: 5b27 6d61 7269 7174 275d 293a 0a20 2020  ['mariqt']):.   
+000193e0: 2020 2020 2022 2222 2070 6172 7365 7320       """ parses 
+000193f0: 6461 7461 2066 726f 6d20 6672 6f6d 2066  data from from f
+00019400: 696c 6520 746f 2069 7465 6d73 2e20 6865  ile to items. he
+00019410: 6164 6572 2064 6963 7420 6d75 7374 2062  ader dict must b
+00019420: 6520 6f66 2073 7472 7563 7475 7265 3a20  e of structure: 
+00019430: 7b3c 6974 656d 2d66 6965 6c64 2d6e 616d  {<item-field-nam
+00019440: 653e 3a3c 636f 6c75 6d6e 2d6e 616d 653e  e>:<column-name>
+00019450: 7d0a 2020 2020 2020 2020 2020 2020 616e  }.            an
+00019460: 6420 6d75 7374 2063 6f6e 7461 696e 2065  d must contain e
+00019470: 6e74 7279 2027 696d 6167 652d 6669 6c65  ntry 'image-file
+00019480: 6e61 6d65 2720 2222 220a 2020 2020 2020  name' """.      
+00019490: 2020 6966 206e 6f74 2027 696d 6167 652d    if not 'image-
+000194a0: 6669 6c65 6e61 6d65 2720 696e 2068 6561  filename' in hea
+000194b0: 6465 723a 0a20 2020 2020 2020 2020 2020  der:.           
+000194c0: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
+000194d0: 2822 6865 6164 6572 2064 6f65 7320 6e6f  ("header does no
+000194e0: 7420 636f 6e74 6169 6e20 2769 6d61 6765  t contain 'image
+000194f0: 2d66 696c 656e 616d 6527 2229 0a20 2020  -filename'").   
+00019500: 2020 2020 200a 2020 2020 2020 2020 746d       .        tm
+00019510: 705f 6461 7461 203d 206d 6971 7466 2e74  p_data = miqtf.t
+00019520: 6162 4669 6c65 4461 7461 2866 696c 652c  abFileData(file,
+00019530: 2068 6561 6465 722c 636f 6c5f 7365 7061   header,col_sepa
+00019540: 7261 746f 723d 7365 7061 7261 746f 722c  rator=separator,
+00019550: 206b 6579 5f63 6f6c 3d27 696d 6167 652d   key_col='image-
+00019560: 6669 6c65 6e61 6d65 272c 636f 6e76 6572  filename',conver
+00019570: 743d 5472 7565 290a 2020 2020 2020 2020  t=True).        
+00019580: 7365 6c66 2e77 7269 7465 5061 7273 6564  self.writeParsed
+00019590: 4461 7461 546f 4974 656d 7328 746d 705f  DataToItems(tmp_
+000195a0: 6461 7461 2c69 7465 6d73 2c73 656c 662e  data,items,self.
+000195b0: 6966 646f 5f74 6d70 5b6d 6971 7476 2e69  ifdo_tmp[miqtv.i
+000195c0: 6d61 6765 5f73 6574 5f68 6561 6465 725f  mage_set_header_
+000195d0: 6b65 795d 2c20 6461 7465 7469 6d65 5f66  key], datetime_f
+000195e0: 6f72 6d61 743d 6461 7465 7469 6d65 5f66  ormat=datetime_f
+000195f0: 6f72 6d61 7429 0a0a 0a20 2020 2064 6566  ormat)...    def
+00019600: 2077 7269 7465 5061 7273 6564 4461 7461   writeParsedData
+00019610: 546f 4974 656d 7328 7365 6c66 2c64 6174  ToItems(self,dat
+00019620: 613a 6469 6374 2c69 7465 6d73 3a64 6963  a:dict,items:dic
+00019630: 742c 6865 6164 6572 3a64 6963 742c 2064  t,header:dict, d
+00019640: 6174 6574 696d 655f 666f 726d 6174 3a73  atetime_format:s
+00019650: 7472 3d6d 6971 7476 2e64 6174 655f 666f  tr=miqtv.date_fo
+00019660: 726d 6174 735b 276d 6172 6971 7427 5d29  rmats['mariqt'])
+00019670: 3a0a 0a20 2020 2020 2020 2023 2065 7661  :..        # eva
+00019680: 6c20 7374 7269 6e67 7320 6173 2064 6963  l strings as dic
+00019690: 7420 6f72 206c 6973 740a 2020 2020 2020  t or list.      
+000196a0: 2020 6d69 7174 632e 7265 6375 7273 6976    miqtc.recursiv
+000196b0: 6545 7661 6c28 6461 7461 290a 0a20 2020  eEval(data)..   
+000196c0: 2020 2020 2023 2070 6f74 656e 7461 696c       # potentail
+000196d0: 6c79 2072 656d 6f76 6520 636f 6e73 7420  ly remove const 
+000196e0: 6461 7461 2066 726f 6d20 6974 656d 7320  data from items 
+000196f0: 616e 6420 7075 7420 696e 2068 6561 6465  and put in heade
+00019700: 720a 2020 2020 2020 2020 7365 6c66 2e65  r.        self.e
+00019710: 7874 7261 6374 436f 6e73 7444 6174 6156  xtractConstDataV
+00019720: 616c 7565 7328 6461 7461 2c68 6561 6465  alues(data,heade
+00019730: 7229 0a0a 2020 2020 2020 2020 6461 7461  r)..        data
+00019740: 203d 206d 6971 7463 2e72 6563 7572 7369   = miqtc.recursi
+00019750: 7665 6c79 5265 6d6f 7665 456d 7074 7946  velyRemoveEmptyF
+00019760: 6965 6c64 7328 6461 7461 2c63 6f6e 7465  ields(data,conte
+00019770: 6e74 3262 6552 656d 6f76 6564 3d4e 6f6e  nt2beRemoved=Non
+00019780: 6529 0a0a 2020 2020 2020 2020 2320 6164  e)..        # ad
+00019790: 6420 2769 6d61 6765 2d66 696c 656e 616d  d 'image-filenam
+000197a0: 6527 2066 6965 6c64 0a20 2020 2020 2020  e' field.       
+000197b0: 2066 6f72 2069 6d67 2c20 656e 7472 7920   for img, entry 
+000197c0: 696e 2064 6174 612e 6974 656d 7328 293a  in data.items():
+000197d0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+000197e0: 6c69 7374 0a20 2020 2020 2020 2020 2020  list.           
+000197f0: 2069 6620 6973 696e 7374 616e 6365 2865   if isinstance(e
+00019800: 6e74 7279 2c6c 6973 7429 3a0a 2020 2020  ntry,list):.    
+00019810: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00019820: 6c69 7374 4974 656d 2069 6e20 656e 7472  listItem in entr
+00019830: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+00019840: 2020 2020 2020 206c 6973 7449 7465 6d5b         listItem[
+00019850: 2769 6d61 6765 2d66 696c 656e 616d 6527  'image-filename'
+00019860: 5d20 3d20 696d 670a 2020 2020 2020 2020  ] = img.        
+00019870: 2020 2020 2020 2020 2020 2020 2320 636f              # co
+00019880: 7665 7274 2064 6174 6574 696d 6520 7374  vert datetime st
+00019890: 7269 6e67 0a20 2020 2020 2020 2020 2020  ring.           
+000198a0: 2020 2020 2020 2020 2069 6620 2769 6d61           if 'ima
+000198b0: 6765 2d64 6174 6574 696d 6527 2069 6e20  ge-datetime' in 
+000198c0: 6c69 7374 4974 656d 3a0a 2020 2020 2020  listItem:.      
+000198d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000198e0: 2020 6474 203d 2064 6174 6574 696d 652e    dt = datetime.
+000198f0: 6461 7465 7469 6d65 2e73 7472 7074 696d  datetime.strptim
+00019900: 6528 6c69 7374 4974 656d 5b27 696d 6167  e(listItem['imag
+00019910: 652d 6461 7465 7469 6d65 275d 2c20 6461  e-datetime'], da
+00019920: 7465 7469 6d65 5f66 6f72 6d61 7429 0a20  tetime_format). 
+00019930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019940: 2020 2020 2020 206c 6973 7449 7465 6d5b         listItem[
+00019950: 2769 6d61 6765 2d64 6174 6574 696d 6527  'image-datetime'
+00019960: 5d20 3d20 6474 2e73 7472 6674 696d 6528  ] = dt.strftime(
+00019970: 6d69 7174 762e 6461 7465 5f66 6f72 6d61  miqtv.date_forma
+00019980: 7473 5b27 6d61 7269 7174 275d 290a 2020  ts['mariqt']).  
+00019990: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
+000199a0: 7369 6e73 7461 6e63 6528 656e 7472 792c  sinstance(entry,
+000199b0: 6469 6374 293a 0a20 2020 2020 2020 2020  dict):.         
+000199c0: 2020 2020 2020 2065 6e74 7279 5b27 696d         entry['im
+000199d0: 6167 652d 6669 6c65 6e61 6d65 275d 203d  age-filename'] =
+000199e0: 2069 6d67 0a20 2020 2020 2020 2020 2020   img.           
+000199f0: 2020 2020 2023 2063 6f76 6572 7420 6461       # covert da
+00019a00: 7465 7469 6d65 2073 7472 696e 670a 2020  tetime string.  
+00019a10: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00019a20: 2027 696d 6167 652d 6461 7465 7469 6d65   'image-datetime
+00019a30: 2720 696e 2065 6e74 7279 3a0a 2020 2020  ' in entry:.    
+00019a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019a50: 6474 203d 2064 6174 6574 696d 652e 6461  dt = datetime.da
+00019a60: 7465 7469 6d65 2e73 7472 7074 696d 6528  tetime.strptime(
+00019a70: 656e 7472 795b 2769 6d61 6765 2d64 6174  entry['image-dat
+00019a80: 6574 696d 6527 5d2c 2064 6174 6574 696d  etime'], datetim
+00019a90: 655f 666f 726d 6174 290a 2020 2020 2020  e_format).      
+00019aa0: 2020 2020 2020 2020 2020 2020 2020 656e                en
+00019ab0: 7472 795b 2769 6d61 6765 2d64 6174 6574  try['image-datet
+00019ac0: 696d 6527 5d20 3d20 6474 2e73 7472 6674  ime'] = dt.strft
+00019ad0: 696d 6528 6d69 7174 762e 6461 7465 5f66  ime(miqtv.date_f
+00019ae0: 6f72 6d61 7473 5b27 6d61 7269 7174 275d  ormats['mariqt']
+00019af0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+00019b00: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00019b10: 2020 2020 7261 6973 6520 6d69 7174 632e      raise miqtc.
+00019b20: 4966 646f 4578 6365 7074 696f 6e28 2264  IfdoException("d
+00019b30: 6174 6120 656e 7472 6965 7320 6d75 7374  ata entries must
+00019b40: 2062 6520 6469 6374 206f 7220 6c69 7374   be dict or list
+00019b50: 2069 6620 6469 6374 7322 290a 0a20 2020   if dicts")..   
+00019b60: 2020 2020 206d 6971 7463 2e72 6563 7572       miqtc.recur
+00019b70: 7369 7665 6c79 5570 6461 7465 4469 6374  sivelyUpdateDict
+00019b80: 7328 6974 656d 732c 6461 7461 290a 0a0a  s(items,data)...
+00019b90: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
+00019ba0: 640a 2020 2020 6465 6620 6578 7472 6163  d.    def extrac
+00019bb0: 7443 6f6e 7374 4461 7461 5661 6c75 6573  tConstDataValues
+00019bc0: 2864 6174 613a 6469 6374 2c68 6561 6465  (data:dict,heade
+00019bd0: 723a 6469 6374 293a 0a20 2020 2020 2020  r:dict):.       
+00019be0: 2022 2222 2052 656d 6f76 6573 2066 6965   """ Removes fie
+00019bf0: 6c64 7320 7468 6174 2061 7265 2063 6f6e  lds that are con
+00019c00: 7374 616e 7420 666f 7220 616c 6c20 656e  stant for all en
+00019c10: 7472 6965 7320 6672 6f6d 2064 6174 6120  tries from data 
+00019c20: 6469 6374 2061 6e64 2070 7574 2074 6865  dict and put the
+00019c30: 6d20 696e 2068 6561 6465 7220 6469 6374  m in header dict
+00019c40: 2e20 0a20 2020 2020 2020 2020 2020 2045  . .            E
+00019c50: 6163 6820 656e 7472 7920 6f66 2064 6174  ach entry of dat
+00019c60: 6120 6d75 7374 2062 6520 6120 6469 6374  a must be a dict
+00019c70: 2077 6974 6820 7468 6520 7361 6d65 2073   with the same s
+00019c80: 6574 206f 6620 6b65 7973 2e20 2222 220a  et of keys. """.
+00019c90: 2020 2020 0a20 2020 2020 2020 2066 6965      .        fie
+00019ca0: 6c64 7354 6f49 676e 6f72 6520 3d20 5b27  ldsToIgnore = ['
+00019cb0: 696d 6167 652d 6461 7465 7469 6d65 275d  image-datetime']
+00019cc0: 0a20 2020 2020 2020 2063 6f6e 7374 4461  .        constDa
+00019cd0: 7461 203d 207b 7d0a 2020 2020 2020 2020  ta = {}.        
+00019ce0: 6669 7273 7449 6d61 6765 203d 2054 7275  firstImage = Tru
+00019cf0: 650a 2020 2020 2020 2020 666f 7220 696d  e.        for im
+00019d00: 6167 652c 696d 6167 655f 6461 7461 2069  age,image_data i
+00019d10: 6e20 6461 7461 2e69 7465 6d73 2829 3a0a  n data.items():.
+00019d20: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00019d30: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00019d40: 6973 696e 7374 616e 6365 2869 6d61 6765  isinstance(image
+00019d50: 5f64 6174 612c 6c69 7374 293a 0a20 2020  _data,list):.   
+00019d60: 2020 2020 2020 2020 2020 2020 2069 6d61               ima
+00019d70: 6765 5f64 6174 6120 3d20 5b69 6d61 6765  ge_data = [image
+00019d80: 5f64 6174 615d 0a0a 2020 2020 2020 2020  _data]..        
+00019d90: 2020 2020 6966 206e 6f74 2066 6972 7374      if not first
+00019da0: 496d 6167 6520 616e 6420 636f 6e73 7444  Image and constD
+00019db0: 6174 6120 3d3d 207b 7d3a 0a20 2020 2020  ata == {}:.     
+00019dc0: 2020 2020 2020 2020 2020 2062 7265 616b             break
+00019dd0: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+00019de0: 2020 2020 2020 2020 2020 6669 7273 7454            firstT
+00019df0: 696d 6550 6f69 6e74 203d 2054 7275 650a  imePoint = True.
+00019e00: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00019e10: 696d 6167 655f 7470 5f64 6174 6120 696e  image_tp_data in
+00019e20: 2069 6d61 6765 5f64 6174 613a 0a20 2020   image_data:.   
+00019e30: 2020 2020 2020 2020 2020 2020 2023 2076               # v
+00019e40: 6572 7920 6669 7273 7420 6461 7461 2066  ery first data f
+00019e50: 6f72 2063 6f6d 7061 7269 736f 6e0a 2020  or comparison.  
+00019e60: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00019e70: 2066 6972 7374 496d 6167 6520 616e 6420   firstImage and 
+00019e80: 6669 7273 7454 696d 6550 6f69 6e74 3a0a  firstTimePoint:.
+00019e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ea0: 2020 2020 636f 6e73 7444 6174 6120 3d20      constData = 
+00019eb0: 636f 7079 2e64 6565 7063 6f70 7928 696d  copy.deepcopy(im
+00019ec0: 6167 655f 7470 5f64 6174 6129 0a20 2020  age_tp_data).   
+00019ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ee0: 2066 6f72 2066 6965 6c64 2069 6e20 6669   for field in fi
+00019ef0: 656c 6473 546f 4967 6e6f 7265 3a0a 2020  eldsToIgnore:.  
+00019f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019f10: 2020 2020 2020 6966 2066 6965 6c64 2069        if field i
+00019f20: 6e20 636f 6e73 7444 6174 613a 0a20 2020  n constData:.   
+00019f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019f40: 2020 2020 2020 2020 2064 656c 2063 6f6e           del con
+00019f50: 7374 4461 7461 5b66 6965 6c64 5d0a 2020  stData[field].  
+00019f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019f70: 2020 6669 7273 7454 696d 6550 6f69 6e74    firstTimePoint
+00019f80: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+00019f90: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00019fa0: 7469 6e75 650a 0a20 2020 2020 2020 2020  tinue..         
+00019fb0: 2020 2020 2020 2063 6f6e 7374 4461 7461         constData
+00019fc0: 203d 206d 6971 7463 2e66 696e 6443 6f6d   = miqtc.findCom
+00019fd0: 6d6f 6e44 6963 7445 6c65 6d65 6e74 7328  monDictElements(
+00019fe0: 696d 6167 655f 7470 5f64 6174 612c 636f  image_tp_data,co
+00019ff0: 6e73 7444 6174 6129 0a0a 2020 2020 2020  nstData)..      
+0001a000: 2020 2020 2020 6669 7273 7449 6d61 6765        firstImage
+0001a010: 203d 2046 616c 7365 0a0a 2020 2020 2020   = False..      
+0001a020: 2020 2320 544f 444f 2063 6865 636b 2077    # TODO check w
+0001a030: 6974 6869 6e20 696d 6167 6520 7469 6d65  ithin image time
+0001a040: 7320 2d3e 2074 6f20 696d 6167 6520 6465  s -> to image de
+0001a050: 6661 756c 742e 2028 7472 6963 6b79 2073  fault. (tricky s
+0001a060: 696e 6365 2077 6520 646f 6e27 7420 6861  ince we don't ha
+0001a070: 7665 2074 6865 2064 6166 6175 6c74 2069  ve the dafault i
+0001a080: 6e64 6578 2068 6572 652e 204f 6e6c 7920  ndex here. Only 
+0001a090: 6120 7375 6273 6574 206d 6967 6874 2062  a subset might b
+0001a0a0: 6520 7570 6461 7465 2068 6572 6529 0a20  e update here). 
+0001a0b0: 2020 2020 2020 2023 2063 6865 636b 2077         # check w
+0001a0c0: 6974 6869 6e20 696d 6167 6520 6974 656d  ithin image item
+0001a0d0: 7320 2d3e 2068 6561 6465 720a 2020 2020  s -> header.    
+0001a0e0: 2020 2020 6865 6164 6572 5570 6461 7465      headerUpdate
+0001a0f0: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
+0001a100: 2863 6f6e 7374 4461 7461 290a 2020 2020  (constData).    
+0001a110: 2020 2020 6865 6164 6572 5570 6461 7465      headerUpdate
+0001a120: 6454 6573 7420 3d20 636f 7079 2e64 6565  dTest = copy.dee
+0001a130: 7063 6f70 7928 6865 6164 6572 290a 2020  pcopy(header).  
+0001a140: 2020 2020 2020 6d69 7174 632e 7265 6375        miqtc.recu
+0001a150: 7273 6976 656c 7955 7064 6174 6544 6963  rsivelyUpdateDic
+0001a160: 7473 2868 6561 6465 7255 7064 6174 6564  ts(headerUpdated
+0001a170: 5465 7374 2c68 6561 6465 7255 7064 6174  Test,headerUpdat
+0001a180: 6529 0a20 2020 2020 2020 2075 7064 6174  e).        updat
+0001a190: 6544 6966 6620 3d20 4465 6570 4469 6666  eDiff = DeepDiff
+0001a1a0: 2868 6561 6465 722c 6865 6164 6572 5570  (header,headerUp
+0001a1b0: 6461 7465 6454 6573 7429 0a20 2020 2020  datedTest).     
+0001a1c0: 2020 2023 2063 6865 636b 2069 6620 6865     # check if he
+0001a1d0: 6164 6572 5570 6461 7465 2077 6f75 6c64  aderUpdate would
+0001a1e0: 206f 7665 7277 7269 7465 2061 6e79 7468   overwrite anyth
+0001a1f0: 696e 6720 6672 6f6d 2063 7572 7265 6e74  ing from current
+0001a200: 2068 6561 6465 7220 2873 686f 756c 6420   header (should 
+0001a210: 6e6f 7420 6861 7070 656e 292c 2069 6620  not happen), if 
+0001a220: 736f 2064 6f6e 7420 7265 6d6f 7665 2066  so dont remove f
+0001a230: 726f 6d20 6974 656d 730a 2020 2020 2020  rom items.      
+0001a240: 2020 6966 206e 6f74 2027 7661 6c75 6573    if not 'values
+0001a250: 5f63 6861 6e67 6564 2720 696e 2075 7064  _changed' in upd
+0001a260: 6174 6544 6966 6620 616e 6420 6e6f 7420  ateDiff and not 
+0001a270: 2774 7970 655f 6368 616e 6765 7327 2069  'type_changes' i
+0001a280: 6e20 7570 6461 7465 4469 6666 2061 6e64  n updateDiff and
+0001a290: 206e 6f74 2027 6469 6374 696f 6e61 7279   not 'dictionary
+0001a2a0: 5f69 7465 6d5f 7265 6d6f 7665 6427 2069  _item_removed' i
+0001a2b0: 6e20 7570 6461 7465 4469 6666 3a0a 2020  n updateDiff:.  
+0001a2c0: 2020 2020 2020 2020 2020 6865 6164 6572            header
+0001a2d0: 2e63 6c65 6172 2829 0a20 2020 2020 2020  .clear().       
+0001a2e0: 2020 2020 2068 6561 6465 722e 7570 6461       header.upda
+0001a2f0: 7465 2868 6561 6465 7255 7064 6174 6564  te(headerUpdated
+0001a300: 5465 7374 290a 0a20 2020 2020 2020 2020  Test)..         
+0001a310: 2020 2023 2072 656d 6f76 6520 636f 6e73     # remove cons
+0001a320: 7420 7661 6c75 6573 2066 726f 6d20 6461  t values from da
+0001a330: 7461 0a20 2020 2020 2020 2020 2020 206d  ta.            m
+0001a340: 6971 7463 2e72 6563 7572 7369 7665 4d61  iqtc.recursiveMa
+0001a350: 6b65 4e6f 6e65 4469 6374 4669 656c 6473  keNoneDictFields
+0001a360: 456d 7074 7953 7472 2863 6f6e 7374 4461  EmptyStr(constDa
+0001a370: 7461 290a 2020 2020 2020 2020 2020 2020  ta).            
+0001a380: 666f 7220 696d 6167 652c 696d 6167 655f  for image,image_
+0001a390: 6461 7461 2069 6e20 6461 7461 2e69 7465  data in data.ite
+0001a3a0: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+0001a3b0: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
+0001a3c0: 6e73 7461 6e63 6528 696d 6167 655f 6461  nstance(image_da
+0001a3d0: 7461 2c6c 6973 7429 3a0a 2020 2020 2020  ta,list):.      
+0001a3e0: 2020 2020 2020 2020 2020 2020 2020 696d                im
+0001a3f0: 6167 655f 6461 7461 203d 205b 696d 6167  age_data = [imag
+0001a400: 655f 6461 7461 5d0a 2020 2020 2020 2020  e_data].        
+0001a410: 2020 2020 2020 2020 666f 7220 696d 6167          for imag
+0001a420: 655f 7470 5f64 6174 6120 696e 2069 6d61  e_tp_data in ima
+0001a430: 6765 5f64 6174 613a 0a20 2020 2020 2020  ge_data:.       
+0001a440: 2020 2020 2020 2020 2020 2020 206d 6971               miq
+0001a450: 7463 2e72 6563 7572 7369 7665 6c79 5570  tc.recursivelyUp
+0001a460: 6461 7465 4469 6374 7328 696d 6167 655f  dateDicts(image_
+0001a470: 7470 5f64 6174 612c 636f 6e73 7444 6174  tp_data,constDat
+0001a480: 6129 2020 2020 2020 2020 2020 0a0a 2020  a)          ..  
+0001a490: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001a4a0: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
+0001a4b0: 2020 2020 2020 2020 2023 2054 4f44 4f20           # TODO 
+0001a4c0: 6c6f 673f 0a20 2020 2020 0a0a 2020 2020  log?.     ..    
+0001a4d0: 6465 6620 696e 7465 726d 6564 6961 7465  def intermediate
+0001a4e0: 4e61 7646 696c 6545 7869 7374 7328 7365  NavFileExists(se
+0001a4f0: 6c66 293a 0a20 2020 2020 2020 2069 6620  lf):.        if 
+0001a500: 6f73 2e70 6174 682e 6578 6973 7473 2873  os.path.exists(s
+0001a510: 656c 662e 6765 745f 696e 745f 6e61 765f  elf.get_int_nav_
+0001a520: 6669 6c65 2829 293a 0a20 2020 2020 2020  file()):.       
+0001a530: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
+0001a540: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0001a550: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001a560: 6e20 4661 6c73 650a 0a0a 2020 2020 6465  n False...    de
+0001a570: 6620 6865 6164 6572 4669 656c 6446 696c  f headerFieldFil
+0001a580: 6c65 6428 7365 6c66 2c66 6965 6c64 3a73  led(self,field:s
+0001a590: 7472 293a 0a20 2020 2020 2020 2069 6620  tr):.        if 
+0001a5a0: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
+0001a5b0: 6432 2866 6965 6c64 2920 3d3d 2022 223a  d2(field) == "":
+0001a5c0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0001a5d0: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
+0001a5e0: 2020 7265 7475 726e 2054 7275 650a 0a20    return True.. 
+0001a5f0: 2020 2064 6566 2063 6f6e 7665 7274 546f     def convertTo
+0001a600: 4465 6661 756c 7444 6174 6554 696d 6546  DefaultDateTimeF
+0001a610: 6f72 6d61 7428 7365 6c66 2c69 6664 6f29  ormat(self,ifdo)
+0001a620: 3a0a 2020 2020 2020 2020 2222 2220 4368  :.        """ Ch
+0001a630: 6563 6b73 2069 6620 616c 6c20 6974 656d  ecks if all item
+0001a640: 7327 2027 696d 6167 652d 6461 7465 7469  s' 'image-dateti
+0001a650: 6d65 2720 6669 656c 6473 206d 6174 6368  me' fields match
+0001a660: 2064 6566 6175 6c74 2064 6174 6574 696d   default datetim
+0001a670: 6520 666f 726d 6174 206f 7220 6120 6375  e format or a cu
+0001a680: 7374 6f6d 206f 6e65 2064 6566 696e 6564  stom one defined
+0001a690: 2069 6e20 2769 6d61 6765 2d64 6174 6574   in 'image-datet
+0001a6a0: 696d 652d 666f 726d 6174 270a 2020 2020  ime-format'.    
+0001a6b0: 2020 2020 2020 2020 616e 6420 636f 6e76          and conv
+0001a6c0: 6572 7473 2074 6f20 6465 6661 756c 7420  erts to default 
+0001a6d0: 666f 726d 6174 2e20 5468 726f 7773 2065  format. Throws e
+0001a6e0: 7863 6570 7469 6f6e 2069 6620 6461 7465  xception if date
+0001a6f0: 7469 6d65 2063 616e 6e6f 7420 6265 2070  time cannot be p
+0001a700: 6172 7365 6420 2222 220a 2020 2020 2020  arsed """.      
+0001a710: 2020 6375 7374 6f6d 4461 7465 5469 6d65    customDateTime
+0001a720: 466f 726d 6174 466f 756e 6420 3d20 4661  FormatFound = Fa
+0001a730: 6c73 650a 2020 2020 2020 2020 6865 6164  lse.        head
+0001a740: 6572 4375 7374 6f6d 4461 7465 5469 6d65  erCustomDateTime
+0001a750: 466f 726d 6174 203d 2066 696e 6446 6965  Format = findFie
+0001a760: 6c64 2869 6664 6f5b 7365 6c66 2e69 6d61  ld(ifdo[self.ima
+0001a770: 6765 5365 7448 6561 6465 724b 6579 5d2c  geSetHeaderKey],
+0001a780: 2769 6d61 6765 2d64 6174 6574 696d 652d  'image-datetime-
+0001a790: 666f 726d 6174 2729 0a20 2020 2020 2020  format').       
+0001a7a0: 2069 6620 6865 6164 6572 4375 7374 6f6d   if headerCustom
+0001a7b0: 4461 7465 5469 6d65 466f 726d 6174 2021  DateTimeFormat !
+0001a7c0: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
+0001a7d0: 2020 6966 646f 5b73 656c 662e 696d 6167    ifdo[self.imag
+0001a7e0: 6553 6574 4865 6164 6572 4b65 795d 5b27  eSetHeaderKey]['
+0001a7f0: 696d 6167 652d 6461 7465 7469 6d65 2d66  image-datetime-f
+0001a800: 6f72 6d61 7427 5d20 3d20 2222 2023 2072  ormat'] = "" # r
+0001a810: 656d 6f76 6520 6375 7374 6f6d 2066 6f72  emove custom for
+0001a820: 6d61 740a 2020 2020 2020 2020 2020 2020  mat.            
+0001a830: 6375 7374 6f6d 4461 7465 5469 6d65 466f  customDateTimeFo
+0001a840: 726d 6174 466f 756e 6420 3d20 5472 7565  rmatFound = True
+0001a850: 0a20 2020 2020 2020 2070 726f 6720 3d20  .        prog = 
+0001a860: 6d69 7174 632e 5072 696e 744b 6e6f 776e  miqtc.PrintKnown
+0001a870: 5072 6f67 7265 7373 4d73 6728 2243 6865  ProgressMsg("Che
+0001a880: 636b 696e 6720 6461 7465 7469 6d65 2066  cking datetime f
+0001a890: 6f72 6d61 7422 2c20 6c65 6e28 6966 646f  ormat", len(ifdo
+0001a8a0: 5b73 656c 662e 696d 6167 6553 6574 4974  [self.imageSetIt
+0001a8b0: 656d 734b 6579 5d29 2c6d 6f64 756c 6f3d  emsKey]),modulo=
+0001a8c0: 3129 0a20 2020 2020 2020 2066 6f72 2066  1).        for f
+0001a8d0: 696c 652c 6974 656d 2069 6e20 6966 646f  ile,item in ifdo
+0001a8e0: 5b73 656c 662e 696d 6167 6553 6574 4974  [self.imageSetIt
+0001a8f0: 656d 734b 6579 5d2e 6974 656d 7328 293a  emsKey].items():
+0001a900: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
+0001a910: 672e 7072 6f67 7265 7373 2829 0a20 2020  g.progress().   
+0001a920: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0001a930: 6973 696e 7374 616e 6365 2869 7465 6d2c  isinstance(item,
+0001a940: 6c69 7374 293a 0a20 2020 2020 2020 2020  list):.         
+0001a950: 2020 2020 2020 2020 2020 2069 7465 6d20             item 
+0001a960: 3d20 5b69 7465 6d5d 0a20 2020 2020 2020  = [item].       
+0001a970: 2020 2020 2073 7562 4974 656d 4465 6661       subItemDefa
+0001a980: 756c 7420 3d20 6974 656d 5b30 5d0a 2020  ult = item[0].  
+0001a990: 2020 2020 2020 2020 2020 6974 656d 4375            itemCu
+0001a9a0: 7374 6f6d 4461 7465 5469 6d65 466f 726d  stomDateTimeForm
+0001a9b0: 6174 203d 2022 220a 2020 2020 2020 2020  at = "".        
+0001a9c0: 2020 2020 6966 2027 696d 6167 652d 6461      if 'image-da
+0001a9d0: 7465 7469 6d65 2d66 6f72 6d61 7427 2069  tetime-format' i
+0001a9e0: 6e20 7375 6249 7465 6d44 6566 6175 6c74  n subItemDefault
+0001a9f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001aa00: 2020 6974 656d 4375 7374 6f6d 4461 7465    itemCustomDate
+0001aa10: 5469 6d65 466f 726d 6174 203d 2073 7562  TimeFormat = sub
+0001aa20: 4974 656d 4465 6661 756c 745b 2769 6d61  ItemDefault['ima
+0001aa30: 6765 2d64 6174 6574 696d 652d 666f 726d  ge-datetime-form
+0001aa40: 6174 275d 0a20 2020 2020 2020 2020 2020  at'].           
+0001aa50: 2020 2020 2073 7562 4974 656d 4465 6661       subItemDefa
+0001aa60: 756c 745b 2769 6d61 6765 2d64 6174 6574  ult['image-datet
+0001aa70: 696d 652d 666f 726d 6174 275d 203d 2022  ime-format'] = "
+0001aa80: 2220 2320 7265 6d6f 7665 2063 7573 746f  " # remove custo
+0001aa90: 6d20 666f 726d 6174 0a20 2020 2020 2020  m format.       
+0001aaa0: 2020 2020 2020 2020 2063 7573 746f 6d44           customD
+0001aab0: 6174 6554 696d 6546 6f72 6d61 7446 6f75  ateTimeFormatFou
+0001aac0: 6e64 203d 2054 7275 650a 2020 2020 2020  nd = True.      
+0001aad0: 2020 2020 2020 666f 7220 7375 6249 7465        for subIte
+0001aae0: 6d20 696e 2069 7465 6d3a 0a20 2020 2020  m in item:.     
+0001aaf0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+0001ab00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab10: 2020 2020 666f 726d 6174 203d 206d 6971      format = miq
+0001ab20: 7476 2e64 6174 655f 666f 726d 6174 735b  tv.date_formats[
+0001ab30: 276d 6172 6971 7427 5d0a 2020 2020 2020  'mariqt'].      
+0001ab40: 2020 2020 2020 2020 2020 2020 2020 6461                da
+0001ab50: 7465 7469 6d65 2e64 6174 6574 696d 652e  tetime.datetime.
+0001ab60: 7374 7270 7469 6d65 2873 7562 4974 656d  strptime(subItem
+0001ab70: 5b27 696d 6167 652d 6461 7465 7469 6d65  ['image-datetime
+0001ab80: 275d 2c66 6f72 6d61 7429 0a20 2020 2020  '],format).     
+0001ab90: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+0001aba0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+0001abb0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+0001abc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001abd0: 2020 2020 666f 726d 6174 203d 2068 6561      format = hea
+0001abe0: 6465 7243 7573 746f 6d44 6174 6554 696d  derCustomDateTim
+0001abf0: 6546 6f72 6d61 740a 2020 2020 2020 2020  eFormat.        
+0001ac00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ac10: 6474 203d 2064 6174 6574 696d 652e 6461  dt = datetime.da
+0001ac20: 7465 7469 6d65 2e73 7472 7074 696d 6528  tetime.strptime(
+0001ac30: 7375 6249 7465 6d5b 2769 6d61 6765 2d64  subItem['image-d
+0001ac40: 6174 6574 696d 6527 5d2c 666f 726d 6174  atetime'],format
+0001ac50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001ac60: 2020 2020 2020 2020 2020 7375 6249 7465            subIte
+0001ac70: 6d5b 2769 6d61 6765 2d64 6174 6574 696d  m['image-datetim
+0001ac80: 6527 5d20 3d20 6461 7465 7469 6d65 2e64  e'] = datetime.d
+0001ac90: 6174 6574 696d 652e 7374 7266 7469 6d65  atetime.strftime
+0001aca0: 2864 742c 6d69 7174 762e 6461 7465 5f66  (dt,miqtv.date_f
+0001acb0: 6f72 6d61 7473 5b27 6d61 7269 7174 275d  ormats['mariqt']
+0001acc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001acd0: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
+0001ace0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001acf0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0001ad00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ad10: 2020 2020 2020 2066 6f72 6d61 7420 3d20         format = 
+0001ad20: 6974 656d 4375 7374 6f6d 4461 7465 5469  itemCustomDateTi
+0001ad30: 6d65 466f 726d 6174 0a20 2020 2020 2020  meFormat.       
+0001ad40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ad50: 2020 2020 2064 7420 3d20 6461 7465 7469       dt = dateti
+0001ad60: 6d65 2e64 6174 6574 696d 652e 7374 7270  me.datetime.strp
+0001ad70: 7469 6d65 2873 7562 4974 656d 5b27 696d  time(subItem['im
+0001ad80: 6167 652d 6461 7465 7469 6d65 275d 2c66  age-datetime'],f
+0001ad90: 6f72 6d61 7429 0a20 2020 2020 2020 2020  ormat).         
+0001ada0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001adb0: 2020 2073 7562 4974 656d 5b27 696d 6167     subItem['imag
+0001adc0: 652d 6461 7465 7469 6d65 275d 203d 2064  e-datetime'] = d
+0001add0: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
+0001ade0: 2e73 7472 6674 696d 6528 6474 2c6d 6971  .strftime(dt,miq
+0001adf0: 7476 2e64 6174 655f 666f 726d 6174 735b  tv.date_formats[
+0001ae00: 276d 6172 6971 7427 5d29 0a20 2020 2020  'mariqt']).     
+0001ae10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ae20: 2020 2065 7863 6570 743a 0a20 2020 2020     except:.     
+0001ae30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ae40: 2020 2020 2020 2070 726f 672e 636c 6561         prog.clea
+0001ae50: 7228 290a 2020 2020 2020 2020 2020 2020  r().            
+0001ae60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ae70: 7261 6973 6520 6d69 7174 632e 4966 646f  raise miqtc.Ifdo
+0001ae80: 4578 6365 7074 696f 6e28 2749 6e76 616c  Exception('Inval
+0001ae90: 6964 2064 6174 6574 696d 6520 7661 6c75  id datetime valu
+0001aea0: 6527 2c73 7562 4974 656d 5b27 696d 6167  e',subItem['imag
+0001aeb0: 652d 6461 7465 7469 6d65 275d 2c20 2264  e-datetime'], "d
+0001aec0: 6f65 7320 6e6f 7420 6d61 7463 6820 666f  oes not match fo
+0001aed0: 726d 6174 2064 6566 6175 6c74 206f 7220  rmat default or 
+0001aee0: 6375 7374 6f6d 2066 6f72 6d61 7422 290a  custom format").
+0001aef0: 2020 2020 2020 2020 6966 2063 7573 746f          if custo
+0001af00: 6d44 6174 6554 696d 6546 6f72 6d61 7446  mDateTimeFormatF
+0001af10: 6f75 6e64 3a0a 2020 2020 2020 2020 2020  ound:.          
+0001af20: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
+0001af30: 2243 7573 746f 6d20 6461 7465 7469 6d65  "Custom datetime
+0001af40: 2066 6f72 6d61 7473 2066 6f75 6e64 2e20   formats found. 
+0001af50: 5468 6579 2077 696c 6c20 6265 2072 6570  They will be rep
+0001af60: 6c61 6365 6420 6279 2074 6865 2064 6566  laced by the def
+0001af70: 6175 6c74 2066 6f72 6d61 742e 2229 2020  ault format.")  
+0001af80: 200a 2020 2020 2020 2020 7072 6f67 2e63   .        prog.c
+0001af90: 6c65 6172 2829 2020 2020 0a0a 0a20 2020  lear()    ...   
+0001afa0: 2064 6566 205f 5f69 6e69 7449 6e74 6572   def __initInter
+0001afb0: 6d65 6469 6174 6546 696c 6573 2873 656c  mediateFiles(sel
+0001afc0: 6629 3a0a 2020 2020 2020 2020 7365 6c66  f):.        self
+0001afd0: 2e69 6e74 6572 6d65 6469 6174 6546 696c  .intermediateFil
+0001afe0: 6573 4465 665f 636f 7265 203d 207b 0a20  esDef_core = {. 
+0001aff0: 2020 2020 2020 2020 2020 2027 6861 7368             'hash
+0001b000: 6573 273a 207b 0a20 2020 2020 2020 2020  es': {.         
+0001b010: 2020 2020 2020 2027 6372 6561 7469 6f6e         'creation
+0001b020: 4663 7427 3a20 2763 7265 6174 655f 696d  Fct': 'create_im
+0001b030: 6167 655f 7368 6132 3536 5f66 696c 6528  age_sha256_file(
+0001b040: 2927 2c0a 2020 2020 2020 2020 2020 2020  )',.            
+0001b050: 2020 2020 2773 7566 6669 7827 3a20 275f      'suffix': '_
+0001b060: 696d 6167 652d 6861 7368 6573 2e74 7874  image-hashes.txt
+0001b070: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+0001b080: 2020 2027 636f 6c73 273a 205b 6d69 7174     'cols': [miqt
+0001b090: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+0001b0a0: 7269 7174 275d 5b27 6861 7368 275d 5d2c  riqt']['hash']],
+0001b0b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b0c0: 2027 6f70 7469 6f6e 616c 273a 205b 5d7d   'optional': []}
+0001b0d0: 2c0a 2020 2020 2020 2020 2020 2020 2775  ,.            'u
+0001b0e0: 7569 6473 273a 207b 0a20 2020 2020 2020  uids': {.       
+0001b0f0: 2020 2020 2020 2020 2027 6372 6561 7469           'creati
+0001b100: 6f6e 4663 7427 3a20 2763 7265 6174 655f  onFct': 'create_
+0001b110: 7575 6964 5f66 696c 6528 2927 2c0a 2020  uuid_file()',.  
+0001b120: 2020 2020 2020 2020 2020 2020 2020 2773                's
+0001b130: 7566 6669 7827 3a20 275f 696d 6167 652d  uffix': '_image-
+0001b140: 7575 6964 732e 7478 7427 2c0a 2020 2020  uuids.txt',.    
+0001b150: 2020 2020 2020 2020 2020 2020 2763 6f6c              'col
+0001b160: 7327 3a20 5b6d 6971 7476 2e63 6f6c 5f68  s': [miqtv.col_h
+0001b170: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+0001b180: 2775 7569 6427 5d5d 2c0a 2020 2020 2020  'uuid']],.      
+0001b190: 2020 2020 2020 2020 2020 276f 7074 696f            'optio
+0001b1a0: 6e61 6c27 3a20 5b5d 7d2c 0a20 2020 2020  nal': []},.     
+0001b1b0: 2020 2020 2020 2027 6461 7465 7469 6d65         'datetime
+0001b1c0: 273a 207b 0a20 2020 2020 2020 2020 2020  ': {.           
+0001b1d0: 2020 2020 2027 6372 6561 7469 6f6e 4663       'creationFc
+0001b1e0: 7427 3a20 2763 7265 6174 655f 7374 6172  t': 'create_star
+0001b1f0: 745f 7469 6d65 5f66 696c 6528 2927 2c0a  t_time_file()',.
+0001b200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b210: 2773 7566 6669 7827 3a20 275f 696d 6167  'suffix': '_imag
+0001b220: 652d 7374 6172 742d 7469 6d65 732e 7478  e-start-times.tx
+0001b230: 7427 2c0a 2020 2020 2020 2020 2020 2020  t',.            
+0001b240: 2020 2020 2763 6f6c 7327 3a20 5b6d 6971      'cols': [miq
+0001b250: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+0001b260: 6172 6971 7427 5d5b 2775 7463 275d 5d2c  ariqt']['utc']],
+0001b270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b280: 2027 6f70 7469 6f6e 616c 273a 205b 5d7d   'optional': []}
+0001b290: 2c0a 2020 2020 2020 2020 2020 2020 276e  ,.            'n
+0001b2a0: 6176 6967 6174 696f 6e27 3a20 7b0a 2020  avigation': {.  
+0001b2b0: 2020 2020 2020 2020 2020 2020 2020 2763                'c
+0001b2c0: 7265 6174 696f 6e46 6374 273a 2027 6372  reationFct': 'cr
+0001b2d0: 6561 7465 5f69 6d61 6765 5f6e 6176 6967  eate_image_navig
+0001b2e0: 6174 696f 6e5f 6669 6c65 2829 272c 0a20  ation_file()',. 
+0001b2f0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0001b300: 7375 6666 6978 273a 2027 5f69 6d61 6765  suffix': '_image
+0001b310: 2d6e 6176 6967 6174 696f 6e2e 7478 7427  -navigation.txt'
+0001b320: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001b330: 2020 2763 6f6c 7327 3a20 5b6d 6971 7476    'cols': [miqtv
+0001b340: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+0001b350: 6971 7427 5d5b 2775 7463 275d 5d2c 0a20  iqt']['utc']],. 
+0001b360: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0001b370: 6f70 7469 6f6e 616c 273a 205b 6d69 7174  optional': [miqt
+0001b380: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+0001b390: 7269 7174 275d 5b27 6c6f 6e27 5d2c 206d  riqt']['lon'], m
+0001b3a0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+0001b3b0: 276d 6172 6971 7427 5d5b 276c 6174 275d  'mariqt']['lat']
+0001b3c0: 2c20 6d69 7174 762e 636f 6c5f 6865 6164  , miqtv.col_head
+0001b3d0: 6572 5b27 6d61 7269 7174 275d 5b27 616c  er['mariqt']['al
+0001b3e0: 7427 5d2c 206d 6971 7476 2e63 6f6c 5f68  t'], miqtv.col_h
+0001b3f0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+0001b400: 2768 6774 275d 2c20 6d69 7174 762e 636f  'hgt'], miqtv.co
+0001b410: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+0001b420: 275d 5b27 756e 6365 7274 275d 5d7d 2c0a  ']['uncert']]},.
+0001b430: 2020 2020 2020 2020 7d0a 0a20 2020 2020          }..     
+0001b440: 2020 2073 656c 662e 6e6f 6e43 6f72 6546     self.nonCoreF
+0001b450: 6965 6c64 496e 7465 726d 6564 6961 7465  ieldIntermediate
+0001b460: 4974 656d 496e 666f 4669 6c65 7320 3d20  ItemInfoFiles = 
+0001b470: 5b5d 0a0a 2020 2020 6465 6620 5f5f 6765  []..    def __ge
+0001b480: 745f 696e 745f 6669 6c65 5f70 7265 6669  t_int_file_prefi
+0001b490: 7828 7365 6c66 293a 0a20 2020 2020 2020  x(self):.       
+0001b4a0: 2022 2222 2064 6570 656e 6473 206f 6e20   """ depends on 
+0001b4b0: 2769 6d61 6765 2d65 7665 6e74 2720 616e  'image-event' an
+0001b4c0: 6420 2769 6d61 6765 2d73 656e 736f 7227  d 'image-sensor'
+0001b4d0: 2073 6f20 6974 2063 616e 2063 6861 6e67   so it can chang
+0001b4e0: 6520 6475 7269 6e67 2075 7061 7465 2022  e during upate "
+0001b4f0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+0001b500: 6e20 6f73 2e70 6174 682e 6a6f 696e 2873  n os.path.join(s
+0001b510: 656c 662e 6469 722e 746f 2873 656c 662e  elf.dir.to(self.
+0001b520: 6469 722e 6474 2e69 6e74 6572 6d65 6469  dir.dt.intermedi
+0001b530: 6174 6529 2c20 7365 6c66 2e66 696e 6454  ate), self.findT
+0001b540: 6d70 4669 656c 6428 2769 6d61 6765 2d73  mpField('image-s
+0001b550: 6574 2d6e 616d 6527 2929 0a0a 2020 2020  et-name'))..    
+0001b560: 6465 6620 6765 745f 696e 745f 6861 7368  def get_int_hash
+0001b570: 5f66 696c 6528 7365 6c66 293a 0a20 2020  _file(self):.   
+0001b580: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0001b590: 2e5f 5f67 6574 5f69 6e74 5f66 696c 655f  .__get_int_file_
+0001b5a0: 7072 6566 6978 2829 202b 2073 656c 662e  prefix() + self.
+0001b5b0: 696e 7465 726d 6564 6961 7465 4669 6c65  intermediateFile
+0001b5c0: 7344 6566 5f63 6f72 655b 2768 6173 6865  sDef_core['hashe
+0001b5d0: 7327 5d5b 2773 7566 6669 7827 5d0a 0a20  s']['suffix'].. 
+0001b5e0: 2020 2064 6566 2067 6574 5f69 6e74 5f75     def get_int_u
+0001b5f0: 7569 645f 6669 6c65 2873 656c 6629 3a0a  uid_file(self):.
+0001b600: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0001b610: 656c 662e 5f5f 6765 745f 696e 745f 6669  elf.__get_int_fi
+0001b620: 6c65 5f70 7265 6669 7828 2920 2b20 7365  le_prefix() + se
+0001b630: 6c66 2e69 6e74 6572 6d65 6469 6174 6546  lf.intermediateF
+0001b640: 696c 6573 4465 665f 636f 7265 5b27 7575  ilesDef_core['uu
+0001b650: 6964 7327 5d5b 2773 7566 6669 7827 5d0a  ids']['suffix'].
+0001b660: 0a20 2020 2064 6566 2067 6574 5f69 6e74  .    def get_int
+0001b670: 5f73 7461 7274 5469 6d65 735f 6669 6c65  _startTimes_file
+0001b680: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0001b690: 7265 7475 726e 2073 656c 662e 5f5f 6765  return self.__ge
+0001b6a0: 745f 696e 745f 6669 6c65 5f70 7265 6669  t_int_file_prefi
+0001b6b0: 7828 2920 2b20 7365 6c66 2e69 6e74 6572  x() + self.inter
+0001b6c0: 6d65 6469 6174 6546 696c 6573 4465 665f  mediateFilesDef_
+0001b6d0: 636f 7265 5b27 6461 7465 7469 6d65 275d  core['datetime']
+0001b6e0: 5b27 7375 6666 6978 275d 0a0a 2020 2020  ['suffix']..    
+0001b6f0: 6465 6620 6765 745f 696e 745f 6e61 765f  def get_int_nav_
+0001b700: 6669 6c65 2873 656c 6629 3a0a 2020 2020  file(self):.    
+0001b710: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0001b720: 5f5f 6765 745f 696e 745f 6669 6c65 5f70  __get_int_file_p
+0001b730: 7265 6669 7828 2920 2b20 7365 6c66 2e69  refix() + self.i
+0001b740: 6e74 6572 6d65 6469 6174 6546 696c 6573  ntermediateFiles
+0001b750: 4465 665f 636f 7265 5b27 6e61 7669 6761  Def_core['naviga
+0001b760: 7469 6f6e 275d 5b27 7375 6666 6978 275d  tion']['suffix']
+0001b770: 0a0a                                     ..
```

## Comparing `mariqt-0.4.4.dist-info/LICENSE` & `mariqt-0.5.1.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `mariqt-0.4.4.dist-info/METADATA` & `mariqt-0.5.1.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: mariqt
-Version: 0.4.4
+Version: 0.5.1
 Summary: The MareHub & Marine Imaging Community Image QA/QC and curation toolbox
 Author: Timm Schoening
 Author-email: tschoening@geomar.de
 Classifier: Programming Language :: Python :: 3
 Classifier: License :: OSI Approved :: GNU General Public License v3 (GPLv3)
 Classifier: Operating System :: OS Independent
 License-File: LICENSE
```

