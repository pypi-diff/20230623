# Comparing `tmp/fairbench-0.2.6-py3-none-any.whl.zip` & `tmp/fairbench-0.2.7-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,41 +1,43 @@
-Zip file size: 29907 bytes, number of entries: 39
+Zip file size: 31708 bytes, number of entries: 41
 -rw-rw-rw-  2.0 fat        4 b- defN 23-Jun-17 09:11 fairbench/__init__.py
 -rw-rw-rw-  2.0 fat     1952 b- defN 23-Jun-01 09:25 fairbench/export.py
 -rw-rw-rw-  2.0 fat       38 b- defN 23-Jun-14 13:57 fairbench/bench/__init__.py
 -rw-rw-rw-  2.0 fat     2341 b- defN 23-Jun-15 21:51 fairbench/bench/demos.py
 -rw-rw-rw-  2.0 fat     1660 b- defN 23-Jun-15 09:42 fairbench/bench/loader.py
 -rw-rw-rw-  2.0 fat       93 b- defN 23-Jun-17 19:28 fairbench/export/__init__.py
--rw-rw-rw-  2.0 fat    11887 b- defN 23-Jun-18 13:34 fairbench/export/interactive.py
+-rw-rw-rw-  2.0 fat    13283 b- defN 23-Jun-23 07:56 fairbench/export/interactive.py
 -rw-rw-rw-  2.0 fat     2912 b- defN 23-Jun-16 09:23 fairbench/export/native.py
 -rw-rw-rw-  2.0 fat      122 b- defN 23-May-13 22:58 fairbench/forks/__init__.py
 -rw-rw-rw-  2.0 fat     2130 b- defN 23-May-25 07:44 fairbench/forks/categorical.py
 -rw-rw-rw-  2.0 fat     2586 b- defN 23-Jun-16 09:22 fairbench/forks/explanation.py
--rw-rw-rw-  2.0 fat    25873 b- defN 23-Jun-15 09:40 fairbench/forks/fork.py
--rw-rw-rw-  2.0 fat      154 b- defN 23-Jan-14 23:08 fairbench/metrics/__init__.py
--rw-rw-rw-  2.0 fat     4164 b- defN 23-Jun-16 09:23 fairbench/metrics/classification.py
+-rw-rw-rw-  2.0 fat    26645 b- defN 23-Jun-20 14:13 fairbench/forks/fork.py
+-rw-rw-rw-  2.0 fat      239 b- defN 23-Jun-20 08:51 fairbench/metrics/__init__.py
+-rw-rw-rw-  2.0 fat     3777 b- defN 23-Jun-20 08:51 fairbench/metrics/classification.py
 -rw-rw-rw-  2.0 fat     2066 b- defN 23-May-31 07:41 fairbench/metrics/disparate_impact.py
 -rw-rw-rw-  2.0 fat     1494 b- defN 23-May-31 07:41 fairbench/metrics/disparate_mistreatment.py
+-rw-rw-rw-  2.0 fat      668 b- defN 23-Jun-20 11:41 fairbench/metrics/ranking.py
+-rw-rw-rw-  2.0 fat     2970 b- defN 23-Jun-20 14:07 fairbench/metrics/regression.py
 -rw-rw-rw-  2.0 fat      100 b- defN 23-May-31 10:15 fairbench/mitigation/__init__.py
 -rw-rw-rw-  2.0 fat     1790 b- defN 23-May-31 10:16 fairbench/mitigation/postprocessing.py
 -rw-rw-rw-  2.0 fat      207 b- defN 23-Jan-15 14:06 fairbench/reports/__init__.py
 -rw-rw-rw-  2.0 fat     1491 b- defN 23-Jun-07 08:52 fairbench/reports/accumulate.py
--rw-rw-rw-  2.0 fat     1937 b- defN 23-Jun-16 06:38 fairbench/reports/adhoc.py
--rw-rw-rw-  2.0 fat     2567 b- defN 23-Jun-15 21:29 fairbench/reports/base.py
+-rw-rw-rw-  2.0 fat     2021 b- defN 23-Jun-20 14:07 fairbench/reports/adhoc.py
+-rw-rw-rw-  2.0 fat     2590 b- defN 23-Jun-20 08:05 fairbench/reports/base.py
 -rw-rw-rw-  2.0 fat      883 b- defN 23-May-14 15:09 fairbench/reports/surrogate.py
 -rw-rw-rw-  2.0 fat      155 b- defN 23-Feb-20 08:42 fairbench/reports/reduction/__init__.py
 -rw-rw-rw-  2.0 fat     2260 b- defN 23-Jun-16 09:23 fairbench/reports/reduction/expanders.py
--rw-rw-rw-  2.0 fat     2611 b- defN 23-Jun-15 20:51 fairbench/reports/reduction/reduce.py
+-rw-rw-rw-  2.0 fat     2637 b- defN 23-Jun-20 14:07 fairbench/reports/reduction/reduce.py
 -rw-rw-rw-  2.0 fat     2834 b- defN 23-Jun-16 06:45 fairbench/reports/reduction/reducers.py
 -rw-rw-rw-  2.0 fat        0 b- defN 23-May-26 21:15 tests/__init__.py
 -rw-rw-rw-  2.0 fat     1394 b- defN 23-Jun-12 10:06 tests/test_batching.py
 -rw-rw-rw-  2.0 fat     1278 b- defN 23-Jun-01 09:09 tests/test_benchmarks.py
 -rw-rw-rw-  2.0 fat     1103 b- defN 23-Jun-16 09:20 tests/test_demos.py
 -rw-rw-rw-  2.0 fat     5807 b- defN 23-Jun-15 09:42 tests/test_forks.py
--rw-rw-rw-  2.0 fat     1287 b- defN 23-Jun-08 09:09 tests/test_metrics.py
+-rw-rw-rw-  2.0 fat     2685 b- defN 23-Jun-20 14:07 tests/test_metrics.py
 -rw-rw-rw-  2.0 fat     1624 b- defN 23-Jun-14 06:40 tests/test_reduction.py
 -rw-rw-rw-  2.0 fat     6556 b- defN 23-May-31 14:04 tests/test_reports.py
--rw-rw-rw-  2.0 fat      830 b- defN 23-Jun-18 14:03 fairbench-0.2.6.dist-info/METADATA
--rw-rw-rw-  2.0 fat       92 b- defN 23-Jun-18 14:03 fairbench-0.2.6.dist-info/WHEEL
--rw-rw-rw-  2.0 fat       16 b- defN 23-Jun-18 14:03 fairbench-0.2.6.dist-info/top_level.txt
-?rw-rw-r--  2.0 fat     3273 b- defN 23-Jun-18 14:03 fairbench-0.2.6.dist-info/RECORD
-39 files, 99571 bytes uncompressed, 24675 bytes compressed:  75.2%
+-rw-rw-rw-  2.0 fat      830 b- defN 23-Jun-23 09:02 fairbench-0.2.7.dist-info/METADATA
+-rw-rw-rw-  2.0 fat       92 b- defN 23-Jun-23 09:02 fairbench-0.2.7.dist-info/WHEEL
+-rw-rw-rw-  2.0 fat       16 b- defN 23-Jun-23 09:02 fairbench-0.2.7.dist-info/top_level.txt
+?rw-rw-r--  2.0 fat     3445 b- defN 23-Jun-23 09:02 fairbench-0.2.7.dist-info/RECORD
+41 files, 106778 bytes uncompressed, 26206 bytes compressed:  75.5%
```

## zipnote {}

```diff
@@ -42,14 +42,20 @@
 
 Filename: fairbench/metrics/disparate_impact.py
 Comment: 
 
 Filename: fairbench/metrics/disparate_mistreatment.py
 Comment: 
 
+Filename: fairbench/metrics/ranking.py
+Comment: 
+
+Filename: fairbench/metrics/regression.py
+Comment: 
+
 Filename: fairbench/mitigation/__init__.py
 Comment: 
 
 Filename: fairbench/mitigation/postprocessing.py
 Comment: 
 
 Filename: fairbench/reports/__init__.py
@@ -99,20 +105,20 @@
 
 Filename: tests/test_reduction.py
 Comment: 
 
 Filename: tests/test_reports.py
 Comment: 
 
-Filename: fairbench-0.2.6.dist-info/METADATA
+Filename: fairbench-0.2.7.dist-info/METADATA
 Comment: 
 
-Filename: fairbench-0.2.6.dist-info/WHEEL
+Filename: fairbench-0.2.7.dist-info/WHEEL
 Comment: 
 
-Filename: fairbench-0.2.6.dist-info/top_level.txt
+Filename: fairbench-0.2.7.dist-info/top_level.txt
 Comment: 
 
-Filename: fairbench-0.2.6.dist-info/RECORD
+Filename: fairbench-0.2.7.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## fairbench/export/interactive.py

```diff
@@ -1,10 +1,27 @@
 from fairbench.forks.fork import Fork, Forklike
 from fairbench.forks.explanation import tofloat, ExplainableError
-import sys
+
+
+def clean(fork):
+    if isinstance(fork, Fork):
+        branches = {k: clean(v) for k, v in fork.branches().items()}
+        branches = {k: v for k, v in branches.items() if v is not None}
+        if not branches:
+            return None
+        return Fork(branches)
+    if isinstance(fork, Forklike):
+        branches = {k: clean(v) for k, v in fork.items()}
+        branches = {k: v for k, v in branches.items() if v is not None}
+        if not branches:
+            return None
+        return Forklike(branches)
+    if isinstance(fork, ExplainableError):
+        return None
+    return fork
 
 
 def _in_ipynb():
     try:
         shell = get_ipython().__class__.__name__
         if shell == "ZMQInteractiveShell":
             return True  # Jupyter notebook or qtconsole
@@ -12,27 +29,23 @@
             return False  # Terminal running IPython
         else:
             return False  # Other type (?)
     except NameError:
         return False  # Probably standard Python interpreter
 
 
-def interactive(report):  # pragma: no cover
-    try:
-        import bokeh
-    except ImportError:
-        sys.stderr.write("install bokeh for interactive visualization in the browser.")
-        return
+def interactive(report, name="report", width=800):  # pragma: no cover
     from bokeh.models import (
         ColumnDataSource,
         Select,
         Range1d,
         Button,
         Div,
         FactorRange,
+        HoverTool,
         RadioButtonGroup,
     )
     from bokeh.plotting import figure
     from bokeh.layouts import column, row
     from bokeh.server.server import Server
     from bokeh.application import Application
     from bokeh.application.handlers import FunctionHandler
@@ -41,55 +54,74 @@
     from bokeh.palettes import Category20
     from bokeh.core.validation import silence
     from bokeh.core.validation.warnings import MISSING_RENDERERS
 
     silence(MISSING_RENDERERS, True)
 
     def modify_doc(doc):
-
-        plot = figure(x_range=["1", "2"], width=1200)
+        plot = figure(x_range=["1", "2"], width=width)
+        plot.add_tools(HoverTool(tooltips=[("Name", "@keys"), ("Value", "@values")]))
         select_branch = RadioButtonGroup(
             labels=["ALL"] + list(report.branches().keys()), active=0
         )
         select_view = Select(
             value="Branches", options=["Branches", "Entries"], width=100, height=30
         )
         explain = Button(label="Explain", width=100, button_type="success")
         back = Button(label="Back", button_type="danger")
         explain.sizing_mode = "stretch_width"
         back.sizing_mode = "stretch_width"
         previous = [report]
-        previous_title = ["report"]
+        previous_title = [name]
         label = Div()
 
         def _asdict(obj):
             if isinstance(obj, Fork):
                 obj = obj.branches()
             if isinstance(obj, dict):
                 obj = {
                     k: v
                     for k, v in obj.items()
                     if not isinstance(v, ExplainableError) and not isinstance(v, str)
                 }
             return obj
 
+        def _branch(selected_branch):
+            branches = _asdict(previous[-1])
+            if selected_branch in branches:
+                return branches[selected_branch]
+            return getattr(Forklike(branches), selected_branch)
+
         def _depth(obj):
+            if obj is None:
+                return 0
             if isinstance(obj, Fork):
                 return max(_depth(x) for x in obj.branches().values()) + 1
             if isinstance(obj, dict):
-                return max(_depth(x) for x in obj.values()) + 1
+                if obj.values():
+                    return max(_depth(x) for x in obj.values()) + 1
             return 0
 
         def _update_branches():
             branches = _asdict(previous[-1])
+            if isinstance(previous[-1], Forklike) or isinstance(previous[-1], Fork):
+                val = list(branches.values())[0].role()
+                prev_selection = select_view.value
+                options = ["Branch", "Entries" if val is None else val]
+                select_view.options = options
+                if prev_selection not in options:
+                    select_view.value = options[0]
+
             if _depth(previous[-1]) <= 1:
                 select_branch.labels = ["ALL"] + list(branches.keys())
                 return
             _source = dict()
-            if (select_view.value == "Branches") != isinstance(previous[-1], Fork):
+            if (select_view.value == select_view.options[0]) != isinstance(
+                previous[-1], Fork
+            ):
                 for branch in branches.keys():
                     for k, v in _asdict(branches[branch]).items():
                         if k not in _source:
                             _source[k] = list()
                         _source[k].append(branch)
             else:
                 _source = branches
@@ -98,20 +130,24 @@
         def update_plot(doc):
             branches = _asdict(previous[-1])
             back.visible = len(previous) > 1 or select_branch.active != 0
             plot.renderers = []  # clear plot
             selected_branch = select_branch.labels[select_branch.active]
             plot.x_range.factors = []
             select_view.disabled = not True
+            plot.title.text = "" if selected_branch == "ALL" else selected_branch
+            plot.title_location = "above"
             if selected_branch == "ALL":
                 plot.xgrid.grid_line_color = None
                 explain.visible = False
-                label.text = f"<h1>{'.'.join(previous_title)}</h1>Select a branch or entry to focus and explain it."
+                label.text = f"<h1>{'.'.join([t for t in previous_title if t!='ALL'])}</h1>Select a branch or entry to focus and explain it."
                 _source = dict()
-                if (select_view.value == "Branches") != isinstance(previous[-1], Fork):
+                if (select_view.value == select_view.options[0]) != isinstance(
+                    previous[-1], Fork
+                ):
                     for branch in branches.keys():
                         for k, v in _asdict(branches[branch]).items():
                             if k not in _source:
                                 _source[k] = list()
                             _source[k].append(branch)
                     try:
                         values = [
@@ -134,14 +170,15 @@
                             for metric in _source[branch]
                         ]
                     except TypeError:
                         return
                 keys = [
                     (metric, branch) for metric in _source for branch in _source[metric]
                 ]
+                plot.width = max(800, 50*len(keys))
                 plot.x_range.factors = keys
                 source = ColumnDataSource(data=dict(keys=keys, values=values))
                 plot.x_range.range_padding = 0.1
                 plot.vbar(
                     x="keys",
                     top="values",
                     width=0.9,
@@ -157,23 +194,20 @@
                         ],
                         factors=keys,
                     ),
                 )
                 select_view.disabled = not True
             else:
                 select_view.disabled = not False
-                label.text = f"<h1>{'.'.join(previous_title)}.<em>{selected_branch}</em></h1>Select ALL to switch between branch and entry views."
-                plot_data = (
-                    branches[selected_branch]
-                    if selected_branch in branches
-                    else getattr(previous[-1], selected_branch)
-                )
+                label.text = f"<h1>{'.'.join([t for t in previous_title if t!='ALL'])}.<em>{selected_branch}</em></h1>Select ALL to switch between branch and entry views."
+                plot_data = _branch(selected_branch)
                 explain.visible = hasattr(plot_data, "explain")
                 plot_data = _asdict(plot_data)
                 keys = list(plot_data.keys())
+                plot.width = max(800, 50*len(keys))
                 plot.x_range.factors = keys
                 if isinstance(plot_data, Fork):
                     plot_data = plot_data.branches()
                 try:
                     values = [tofloat(value) for value in plot_data.values()]
                 except TypeError:
                     return
@@ -192,24 +226,19 @@
                     ),
                 )
 
         def explain_button(doc):
             selected_branch = select_branch.labels[select_branch.active]
             previous_title.append(selected_branch)
             previous_title.append("explain")
-            branches = _asdict(previous[-1])
             selected_branch = select_branch.labels[select_branch.active]
             branch = (
-                branches[selected_branch]
-                if selected_branch in branches
-                else getattr(previous[-1], selected_branch)
+                previous[-1] if selected_branch == "ALL" else _branch(selected_branch)
             )
-            previous.append(branch.explain)
-            # branches = _asdict(previous[-1])
-            # select_branch.labels = ["ALL"] + list(branches.keys())
+            previous.append(clean(branch.explain))
             _update_branches()
             select_branch.active = 0
             update_plot(doc)
 
         def back_button(doc):
             if select_branch.labels[select_branch.active] != "ALL":
                 select_branch.active = 0
@@ -220,40 +249,37 @@
                 branch_name = previous_title[-1]
                 previous_title.pop()
             else:
                 branch_name = "ALL"
                 previous_title.pop()
             previous.pop()
             _update_branches()
+            select_branch.active = 0
             for i, label in enumerate(select_branch.labels):
                 if label == branch_name:
                     select_branch.active = i
+            if select_branch.active == 0:
+                if select_view.value == select_view.options[0]:
+                    select_view.value = select_view.options[1]
+                else:
+                    select_view.value = select_view.options[0]
+                _update_branches()
+                for i, label in enumerate(select_branch.labels):
+                    if label == branch_name:
+                        select_branch.active = i
             # if select_branch.active in branches and _depth(branches[select_branch.active ]) > 1:
             #    previous_title.pop()
             update_plot(doc)
 
         def update_value(doc):
-            branches = _asdict(previous[-1])
             selected_branch = select_branch.labels[select_branch.active]
-            if (
-                selected_branch != "ALL"
-                and _depth(
-                    branches[selected_branch]
-                    if selected_branch in branches
-                    else getattr(previous[-1], selected_branch)
-                )
-                > 1
-            ):
+            if selected_branch != "ALL" and _depth(_branch(selected_branch)) > 1:
                 previous_title.append(selected_branch)
-                branch = (
-                    branches[selected_branch]
-                    if selected_branch in branches
-                    else getattr(previous[-1], selected_branch)
-                )
-                previous.append(branch)
+                branch = _branch(selected_branch)
+                previous.append(clean(branch))
                 _update_branches()
                 select_branch.active = 0
             update_plot(doc)
 
         def update_view(doc):
             _update_branches()
             update_plot(doc)
```

## fairbench/forks/fork.py

```diff
@@ -1,14 +1,13 @@
 from makefun import wraps
 import eagerpy as ep
 import numpy as np
 import inspect
 import sys
 from collections.abc import Mapping
-from objwrap import ClosedWrapper
 
 _backend = "numpy"
 
 
 def _str_foreign(v, tabs=0):
     if isinstance(v, Fork):
         v = v.branches()
@@ -27,14 +26,21 @@
         )
     if isinstance(v, float) or isinstance(v, np.float64):
         return f"{v:.3f}"
     return str(v)
 
 
 class Forklike(dict):
+    def __init__(self, *args, _role=None, **kwargs):
+        super().__init__(*args, **kwargs)
+        self._role = _role
+
+    def role(self, _role=None):
+        return object.__getattribute__(self, "_role")
+
     def __getattribute__(self, name):
         if name in dir(Forklike):
             return object.__getattribute__(self, name)
         return self[name]
 
     def __getitem__(self, item):
         if item in self:
@@ -116,18 +122,19 @@
         )
     if isinstance(value, int) or isinstance(value, float):
         value = np.float64(value)
     if (
         "tensor" not in value.__class__.__name__.lower()
         and "array" not in value.__class__.__name__.lower()
         and not isinstance(value, np.float64)
+        and not isinstance(value, list)
     ):
         return value
     if isinstance(value, list):
-        value = np.array(value, dtype=np.float)
+        value = np.array(value, dtype=np.float64)
     if isinstance(value, np.float64):
         value = ep.NumPyTensor(value)
     else:
         value = tobackend(value)
     if value.ndim != 0:
         value = value.flatten()
     return value.float64()
@@ -146,15 +153,16 @@
     if isinstance(value, ep.Tensor):
         return value.raw
 
     return value
 
 
 class Fork(Mapping):
-    def __init__(self, *args, _separator="", **branches):
+    def __init__(self, *args, _separator="", _role=None, **branches):
+        self._role = _role
         for arg in args:
             if not isinstance(arg, dict):
                 raise TypeError(
                     "Forks can only support dicts (holding branch values) as positional arguments"
                 )
             for k, v in arg.items():
                 if k in branches:
@@ -166,14 +174,17 @@
                 for k2, v2 in v.items():
                     self._branches[
                         str(k2) if _separator is None else k + _separator + str(k2)
                     ] = v2
             else:
                 self._branches[k] = v
 
+    def role(self):
+        return object.__getattribute__(self, "_role")
+
     def __getattribute__(self, name):
         if name in ["_branches", "_repr_html_"] or name in dir(Fork):
             return object.__getattribute__(self, name)
         if name.startswith("_"):
             raise AttributeError(name)
         if name in self._branches:
             ret = self._branches[name]
@@ -536,15 +547,30 @@
             return Fork(**submitted)
         except KeyError as e:
             raise KeyError(str(e) + " not provided for an input")
 
     return wrapper
 
 
+def role(rolename):
+    def decorator(_wrapped_method):
+        @wraps(_wrapped_method)
+        def wrapper(*args, **kwargs):
+            ret = _wrapped_method(*args, **kwargs)
+            if isinstance(ret, Forklike) or isinstance(ret, Fork):
+                object.__setattr__(ret, "_role", rolename)
+            return ret
+
+        return wrapper
+
+    return decorator
+
+
 def comparator(_wrapped_method):
+    @wraps(_wrapped_method)
     def wrapper(*args, **kwargs):
         has_fork_of_forks = False
         for arg in args:
             if isinstance(arg, Fork):
                 for k, v in arg._branches.items():
                     if isinstance(v, Fork):
                         has_fork_of_forks = True
@@ -724,15 +750,15 @@
 
 @parallel_primitive
 def merge(dict1, dict2):
     return Forklike({**dict1, **dict2})
 
 
 @comparator
-def combine(*args):
+def combine(*args, _role=None):
     ret = {}
     for arg in args:
         assert isinstance(arg, Fork)
         ret = merge(ret, arg._branches)
     return Fork(ret)
```

## fairbench/metrics/__init__.py

```diff
@@ -1,3 +1,5 @@
 from fairbench.metrics.classification import *
+from fairbench.metrics.ranking import *
+from fairbench.metrics.regression import *
 from fairbench.metrics.disparate_impact import *
 from fairbench.metrics.disparate_mistreatment import *
```

## fairbench/metrics/classification.py

```diff
@@ -1,63 +1,50 @@
-from fairbench.forks import parallel, unit_bounded
-from fairbench.forks.explanation import Explainable, ExplanationCurve
+from fairbench.forks import parallel, unit_bounded, role
+from fairbench.forks.explanation import Explainable
 from eagerpy import Tensor
 
 
+@role("metric")
 @parallel
 @unit_bounded
 def accuracy(predictions: Tensor, labels: Tensor, sensitive: Tensor = None):
     if sensitive is None:
         sensitive = predictions.ones_like()
     num_sensitive = sensitive.sum()
     true = ((predictions - labels) * sensitive).abs().sum()
     return Explainable(
         0 if num_sensitive == 0 else 1 - true / num_sensitive,
         samples=num_sensitive,
         true=true,
     )
 
 
-@parallel
-@unit_bounded
-def auc(scores: Tensor, labels: Tensor, sensitive: Tensor = None):
-    import sklearn
-
-    if sensitive is None:
-        sensitive = scores.ones_like()
-    scores = scores[sensitive == 1]
-    labels = labels[sensitive == 1]
-    fpr, tpr, _ = sklearn.metrics.roc_curve(labels.numpy(), scores.numpy())
-    return Explainable(
-        sklearn.metrics.auc(fpr, tpr),
-        curve=ExplanationCurve(fpr, tpr, "ROC"),
-        samples=sensitive.sum(),
-    )
-
-
+@role("metric")
 @parallel
 @unit_bounded
 def pr(predictions: Tensor, sensitive: Tensor = None):
     if sensitive is None:
         sensitive = predictions.ones_like()
     sum_sensitive = sensitive.sum()
     sum_positives = (predictions * sensitive).sum()
     return Explainable(
         0 if sum_sensitive == 0 else (sum_positives / sum_sensitive),
         samples=sum_sensitive,
         positives=sum_positives,
     )
 
 
+@role("metric")
 @parallel
 @unit_bounded
 def positives(predictions: Tensor, sensitive: Tensor):
     return (predictions * sensitive).sum()
 
 
+@role("metric")
 @parallel
 @unit_bounded
 def tpr(
     predictions: Tensor,
     labels: Tensor,
     sensitive: Tensor = None,
     max_prediction: float = 1,
@@ -71,14 +58,15 @@
         0 if num_sensitive == 0 else (error_sensitive.sum() / num_sensitive),
         positives=num_sensitive,
         true_positives=error_sensitive.sum(),
         samples=sensitive.sum(),
     )
 
 
+@role("metric")
 @parallel
 @unit_bounded
 def fpr(
     predictions: Tensor,
     labels: Tensor,
     sensitive: Tensor = None,
 ):
@@ -93,14 +81,15 @@
         0 if num_sensitive == 0 else (error_sensitive.sum() / num_sensitive),
         positives=num_sensitive,
         false_positives=error_sensitive.sum(),
         samples=sensitive.sum(),
     )
 
 
+@role("metric")
 @parallel
 @unit_bounded
 def tnr(
     predictions: Tensor,
     labels: Tensor,
     sensitive: Tensor = None,
     max_prediction: float = 1,
@@ -115,14 +104,15 @@
         0 if num_sensitive == 0 else (error_sensitive.sum() / num_sensitive),
         negatives=num_sensitive,
         true_negatives=error_sensitive.sum(),
         samples=sensitive.sum(),
     )
 
 
+@role("metric")
 @parallel
 @unit_bounded
 def fnr(
     predictions: Tensor,
     labels: Tensor,
     sensitive: Tensor = None,
     max_prediction: float = 1,
```

## fairbench/reports/adhoc.py

```diff
@@ -1,18 +1,25 @@
 from fairbench.reports.base import report, reportargsparse
 from fairbench.reports import reduction as fb
 from fairbench.reports.accumulate import todict as tokwargs
-from fairbench.forks.fork import combine, merge
+from fairbench.forks.fork import combine, merge, role
 from fairbench.reports.surrogate import surrogate_positives
 from fairbench import metrics
 from fairbench.reports import reduction
 
 
 common_metrics = (metrics.accuracy, metrics.prule, metrics.dfpr, metrics.dfnr)
-acc_metrics = (metrics.accuracy, metrics.pr, metrics.tpr, metrics.tnr, metrics.auc)
+acc_metrics = (
+    metrics.accuracy,
+    metrics.pr,
+    metrics.tpr,
+    metrics.tnr,
+    metrics.auc,
+    metrics.r2,
+)
 common_reduction = (
     {"reducer": reduction.min},
     {"reducer": reduction.wmean},
     {"reducer": reduction.min, "expand": reduction.ratio},
     {"reducer": reduction.max, "expand": reduction.diff},
     {"reducer": reduction.max, "expand": reduction.barea},
 )
@@ -22,21 +29,23 @@
     return report(*args, metrics=metrics, **kwargs)
 
 
 def binreport(*args, metrics=common_metrics, **kwargs):
     return report(*args, metrics=metrics, **kwargs)
 
 
+@role("report")
 def multireport(
     *args, metrics=acc_metrics, reduction_schemes=common_reduction, **kwargs
 ):
     base = report(*args, metrics=metrics, **kwargs)
     return combine(*[fb.reduce(base, **scheme) for scheme in reduction_schemes])
 
 
+@role("report")
 def isecreport(*args, **kwargs):
     if len(args) == 0:
         params = tokwargs(**kwargs)
     else:
         params = dict()
         for arg in args:
             params = merge(params, arg)
@@ -51,9 +60,8 @@
 
     empirical = fb.reduce(
         metrics.pr(predictions=params["predictions"], sensitive=params["sensitive"]),
         fb.min,
         fb.ratio,
         name="empirical",
     )
-
     return combine(tokwargs(minprule=empirical), tokwargs(minprule=bayesian))
```

## fairbench/reports/base.py

```diff
@@ -1,8 +1,8 @@
-from fairbench.forks.fork import parallel_primitive, comparator
+from fairbench.forks.fork import parallel_primitive, comparator, role
 from fairbench.forks.explanation import Explainable
 import inspect
 from typing import Union, Iterable, Callable
 
 
 def reportargsparse(*args, **kwargs):
     for arg in args:
@@ -13,14 +13,15 @@
         for k, v in arg.items():
             if k in kwargs:
                 raise TypeError(f"Report argument {k} provided multiple times")
             kwargs[k] = v
     return kwargs
 
 
+@role("report")
 @comparator
 @parallel_primitive
 def report(*args, metrics: Union[Callable, Iterable, dict] = None, **kwargs):
     kwargs = reportargsparse(*args, **kwargs)
     assert (
         metrics is not None
     ), "Cannot use fairbench.report() without explicitly declared metrics.\nUse accreport, binreport, multireport, or isecreport as ad-hoc report generation mechanisms."
```

## fairbench/reports/reduction/reduce.py

```diff
@@ -1,8 +1,8 @@
-from fairbench.forks.fork import Fork, astensor, comparator, fromtensor
+from fairbench.forks.fork import Fork, astensor, comparator, fromtensor, role
 from fairbench.forks.explanation import Explainable, ExplainableError
 from typing import Optional
 
 # from fairbench.reports.accumulate import todict as tokwargs
 
 
 def areduce(fork: Fork, reducer, expand=None, transform=None, branches=None):
@@ -18,14 +18,15 @@
             return arg
     try:
         return method(*args, **kwargs)
     except ExplainableError as e:
         return e
 
 
+@role("reduction")
 @comparator
 def reduce(
     fork: Fork,
     reducer,
     expand=None,
     transform=None,
     branches=None,
```

## tests/test_metrics.py

```diff
@@ -1,31 +1,68 @@
 import fairbench as fb
-import numpy as np
+from .test_forks import environment
 
 
 def test_accuracy():
-    assert fb.accuracy(np.array([1, 1, 0, 0]), np.array([1, 1, 1, 0])) < 1
-    assert fb.accuracy(np.array([1, 1, 0, 0]), np.array([1, 1, 1, 0]), np.array([1, 1, 0, 1])) == 1
+    for _ in environment():
+        assert fb.accuracy(fb.astensor([1, 1, 0, 0]), fb.astensor([1, 1, 1, 0])) < 1
+        assert fb.accuracy(fb.astensor([1, 1, 0, 0]), fb.astensor([1, 1, 1, 0]), fb.astensor([1, 1, 0, 1])) == 1
 
 
 def test_tpr():
-    assert fb.tpr(np.array([1, 1, 0, 0]), np.array([1, 1, 1, 0])) == 1
-    assert fb.tpr(np.array([1, 1, 1, 0]), np.array([1, 1, 0, 0])) < 1
-    assert fb.tpr(np.array([1, 1, 1, 0]), np.array([1, 1, 0, 0]), np.array([1, 1, 0, 1])) == 1
+    for _ in environment():
+        assert fb.tpr(fb.astensor([1, 1, 0, 0]), fb.astensor([1, 1, 1, 0])) == 1
+        assert fb.tpr(fb.astensor([1, 1, 1, 0]), fb.astensor([1, 1, 0, 0])) < 1
+        assert fb.tpr(fb.astensor([1, 1, 1, 0]), fb.astensor([1, 1, 0, 0]), fb.astensor([1, 1, 0, 1])) == 1
 
 
 def test_tnr():
-    assert fb.tnr(np.array([1, 1, 0, 0]), np.array([1, 1, 1, 0])) < 1
-    assert fb.tnr(np.array([1, 1, 0, 0]), np.array([1, 0, 0, 0])) == 1
-    assert fb.tnr(np.array([1, 1, 0, 0]), np.array([1, 1, 1, 0]), np.array([1, 1, 0, 1])) == 1
+    for _ in environment():
+        assert fb.tnr(fb.astensor([1, 1, 0, 0]), fb.astensor([1, 1, 1, 0])) < 1
+        assert fb.tnr(fb.astensor([1, 1, 0, 0]), fb.astensor([1, 0, 0, 0])) == 1
+        assert fb.tnr(fb.astensor([1, 1, 0, 0]), fb.astensor([1, 1, 1, 0]), fb.astensor([1, 1, 0, 1])) == 1
 
 
 def test_fpr():
-    assert fb.fpr(np.array([1, 1, 0, 0]), np.array([1, 1, 1, 0])) == 0
-    assert fb.fpr(np.array([1, 1, 1, 0]), np.array([1, 1, 0, 0])) > 0
-    assert fb.fpr(np.array([1, 1, 1, 0]), np.array([1, 1, 0, 0]), np.array([1, 1, 0, 1])) == 0
+    for _ in environment():
+        assert fb.fpr(fb.astensor([1, 1, 0, 0]), fb.astensor([1, 1, 1, 0])) == 0
+        assert fb.fpr(fb.astensor([1, 1, 1, 0]), fb.astensor([1, 1, 0, 0])) > 0
+        assert fb.fpr(fb.astensor([1, 1, 1, 0]), fb.astensor([1, 1, 0, 0]), fb.astensor([1, 1, 0, 1])) == 0
 
 
 def test_fnr():
-    assert fb.fnr(np.array([1, 1, 0, 0]), np.array([1, 1, 1, 0])) > 0
-    assert fb.fnr(np.array([1, 1, 0, 0]), np.array([1, 0, 0, 0])) == 0
-    assert fb.fnr(np.array([1, 1, 0, 0]), np.array([1, 1, 1, 0]), np.array([1, 1, 0, 1])) == 0
+    for _ in environment():
+        assert fb.fnr(fb.astensor([1, 1, 0, 0]), fb.astensor([1, 1, 1, 0])) > 0
+        assert fb.fnr(fb.astensor([1, 1, 0, 0]), fb.astensor([1, 0, 0, 0])) == 0
+        assert fb.fnr(fb.astensor([1, 1, 0, 0]), fb.astensor([1, 1, 1, 0]), fb.astensor([1, 1, 0, 1])) == 0
+
+
+def test_auc():
+    for _ in environment():
+        assert fb.auc(scores=fb.astensor([0.5, 0.8, 0.3, 0.2]), labels=fb.astensor([1, 1, 1, 0])) > 0.5
+
+
+def test_pinball():
+    for _ in environment():
+        mae = fb.metrics.mae(scores=fb.astensor([0.5, 0.8, 0.3, 0.2]), targets=fb.astensor([1, 1, 1, 0]))
+        pinball = fb.metrics.pinball(scores=fb.astensor([0.5, 0.8, 0.3, 0.2]), targets=fb.astensor([1, 1, 1, 0]), alpha=0.5)
+        assert pinball == 0.5*mae
+
+
+def test_r2():
+    for _ in environment():
+        assert fb.r2(scores=fb.astensor([0.5, 0.8, 0.3, 0.2]), targets=fb.astensor([0.45, 0.85, 0.4, 0.1])) > 0
+
+
+def test_mae():
+    for _ in environment():
+        assert fb.mae(scores=fb.astensor([0.5, 0.8]), targets=fb.astensor([0, 1])) == 0.35
+
+
+def test_mse():
+    for _ in environment():
+        assert fb.mse(scores=fb.astensor([0.5, 0.8]), targets=fb.astensor([0, 1])) == 0.145
+
+
+def test_rmse():
+    for _ in environment():
+        assert fb.rmse(scores=fb.astensor([0.5, 0.8]), targets=fb.astensor([0, 1])) == .3807886552931954
```

## Comparing `fairbench-0.2.6.dist-info/METADATA` & `fairbench-0.2.7.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: fairbench
-Version: 0.2.6
+Version: 0.2.7
 Summary: Fairness model assessment framework
 Home-page: https://github.com/mever-team/FairBench
 Author: Emmanouil (Manios) Krasanakis
 Author-email: maniospas@hotmail.com
 License: UNKNOWN
 Platform: UNKNOWN
 Classifier: Programming Language :: Python :: 3
```

## Comparing `fairbench-0.2.6.dist-info/RECORD` & `fairbench-0.2.7.dist-info/RECORD`

 * *Files 13% similar despite different names*

```diff
@@ -1,39 +1,41 @@
 fairbench/__init__.py,sha256=26UWatnbm6ZIwQMuu9NNzQ0IW1ACO4Oe9caModuTpWM,4
 fairbench/export.py,sha256=_u97-Yi8VArkwof63mcVXgnUD-i9AY1vjxtCnQ_jKcs,1952
 fairbench/bench/__init__.py,sha256=piA_S0SAZ96_-MxdcGO_V7pCKngOFBeAv8KGj9rkGRA,38
 fairbench/bench/demos.py,sha256=ODVbSjCVrl_S1lP7cZOyoaVFPUZmsz75SYbeD3sflFY,2341
 fairbench/bench/loader.py,sha256=P1PiDtR67NFSk_lIQvzQ0Wez2ZvcxprP7zMpsLcsTYo,1660
 fairbench/export/__init__.py,sha256=Qzq3t-sg7-4M2Vz_76s6dnuQ6K6fRETQo0Ad5Qj2NEI,93
-fairbench/export/interactive.py,sha256=SSSGvCFUZ8ayYXK6LtSZGDsQGW6mqKQmAjEodtHDvAQ,11887
+fairbench/export/interactive.py,sha256=yLMF_Qa9AcBBlbM30QL9vlsKLqmRsYJWUfUMEFuHWPw,13283
 fairbench/export/native.py,sha256=s9houeUkqPRIx76Ke4NxqHED650XWAZu6s27ndXiCnA,2912
 fairbench/forks/__init__.py,sha256=eBRDSxc31Pc1yKCc1VjFBvPMsBVaOzVOfXHpkYQodG0,122
 fairbench/forks/categorical.py,sha256=nfsA1ZjrrywMzOhEoPUF6_9oazIJWcZEI4gvil-1VIs,2130
 fairbench/forks/explanation.py,sha256=Wy6Xm5nUUOLQ7D-pyPY7o28rWiSj4_DN1dyB_WIegTE,2586
-fairbench/forks/fork.py,sha256=lco_w2ALhlrhtu7t_z6n_uSk5Uuth18Homy_QKdDnFI,25873
-fairbench/metrics/__init__.py,sha256=i2kNaDKTfTSEh1aGZ83ByaVXwv0gYE-guFNjj9XlF6I,154
-fairbench/metrics/classification.py,sha256=d6edm6_K64jBH9qg4YUs0FKbQSK3g6jspsjPwQKz6ds,4164
+fairbench/forks/fork.py,sha256=c1Tcbkt-wSni0Jxc0fwiAuHOba7rQv5ntTn-moJQfKo,26645
+fairbench/metrics/__init__.py,sha256=kqs5vladIyri5R_l4u6fcte-O4j_n-jt9OeiIRA2KPo,239
+fairbench/metrics/classification.py,sha256=6q1Lu6up8qjs2nxe-GXKRVjmrBuzJ6j0cIY7ip6ZAco,3777
 fairbench/metrics/disparate_impact.py,sha256=VJw9Q4cA1YqP9fTTE-aMMUzjeuk072L-HRow_vaLkZA,2066
 fairbench/metrics/disparate_mistreatment.py,sha256=ORoUcMU_Dh18Ytz4dgQn8wPyaNJ_w98m_oegxI90vc4,1494
+fairbench/metrics/ranking.py,sha256=jnj-Ig9JgxeHqkt7v7uDfosEk-0gGv8lhXYGlkx7YKM,668
+fairbench/metrics/regression.py,sha256=XIfP9cgOHMsWw-mS-eahO9JxDhM6YHyqIXOPi1yjDq0,2970
 fairbench/mitigation/__init__.py,sha256=f-owl1xAKGweXEuVbFJGYSel3-7kccvTo6SEziKmXRk,100
 fairbench/mitigation/postprocessing.py,sha256=CF2WcAWQKKfNRJ4yvNqIjuNdLaCBrSIpI_XNhmfiUkY,1790
 fairbench/reports/__init__.py,sha256=YQm7A6K3PUB4uNOw3iDu2RUaoWa07Rsn3GJr4wZkn2M,207
 fairbench/reports/accumulate.py,sha256=jDlJFb1bK9nRfumzSWFbCpAGWi8aCOFil4L8Hj44xe0,1491
-fairbench/reports/adhoc.py,sha256=M7_PHNBrdtdM9z-g37b0r_47ORPy0l4_vNpmTTiUPaY,1937
-fairbench/reports/base.py,sha256=m4yZS3w0yPF4hkliSNiZnkxdPymQgj0imVeVjgD_MHg,2567
+fairbench/reports/adhoc.py,sha256=s4yyItIgq61SBKYA8nzhd7lxQXrdDWy3tvc72_-Swtk,2021
+fairbench/reports/base.py,sha256=KQHdSzzU7c3uH0cmV7CmU1YUlIwKhRviGtAGucNEzk4,2590
 fairbench/reports/surrogate.py,sha256=LnV6kkNPMGL2SYEBSSIFWjkXQ8N5m2k4y5as2zUyDt8,883
 fairbench/reports/reduction/__init__.py,sha256=a3c0w4bKV3f6NXnGMPPGFRxdfg_YIrcccy_mEBSr8zk,155
 fairbench/reports/reduction/expanders.py,sha256=DZvDpfXw8LI3ZquA5c22-25PSuLsOhpp_B_IYo5VeVY,2260
-fairbench/reports/reduction/reduce.py,sha256=UsN8xooDvzZMfWMGF_J21KGKZwFJhrkvMU86klBtzKA,2611
+fairbench/reports/reduction/reduce.py,sha256=H6_rIdw4JZRkhpS2ldpi3kPgBKuHjcQ6OOuXwPyRIUk,2637
 fairbench/reports/reduction/reducers.py,sha256=EQlN9rCKDBJmls0rtoA9vyAlrIyIBzQCCcpRDBMRlMA,2834
 tests/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 tests/test_batching.py,sha256=bXewsKXAlDTeyZZ8OlG74-qYQ_hhiwcYJigxy0M_YKY,1394
 tests/test_benchmarks.py,sha256=RZwehxePgR6fwFCh9HWbK3rXsXQNLHomrn7M6BboiMw,1278
 tests/test_demos.py,sha256=VgXBcev7XAnvy2OWiOZf0yBNXzhkjWvf0Bl6of00WzM,1103
 tests/test_forks.py,sha256=Dyu5UPAFG8fxVCfeZ9JwisVwUtZT0NV1WqAMe2GXt3Y,5807
-tests/test_metrics.py,sha256=IudsHC5X3SvKBN_VOHexS4zS3dnzTlxpXjLfFe-xsSY,1287
+tests/test_metrics.py,sha256=mbG4oetiyfihNwIKj620SZmARxX8YuGeuAhebOv9gH4,2685
 tests/test_reduction.py,sha256=JMXZeh3Catiboki8TG50A_caMh4zpSt_NKScqGS2Pr0,1624
 tests/test_reports.py,sha256=2nNSZjkrTdZl8P5bvEz8dDdRd_W7CmSvn51GDdHFPvo,6556
-fairbench-0.2.6.dist-info/METADATA,sha256=QKIAqRYLIGbqIynml6R0DG8gOREwQRSuZAlhoiluinU,830
-fairbench-0.2.6.dist-info/WHEEL,sha256=OqRkF0eY5GHssMorFjlbTIq072vpHpF60fIQA6lS9xA,92
-fairbench-0.2.6.dist-info/top_level.txt,sha256=lrkG910bN_2UdVUqCXaR6aeRjjXfOQX2-wSeVjhhFnM,16
-fairbench-0.2.6.dist-info/RECORD,,
+fairbench-0.2.7.dist-info/METADATA,sha256=sP-bVZyLm1iGOvCvc6eK-r-v_LUxLwYdbAvoy4XAM-w,830
+fairbench-0.2.7.dist-info/WHEEL,sha256=OqRkF0eY5GHssMorFjlbTIq072vpHpF60fIQA6lS9xA,92
+fairbench-0.2.7.dist-info/top_level.txt,sha256=lrkG910bN_2UdVUqCXaR6aeRjjXfOQX2-wSeVjhhFnM,16
+fairbench-0.2.7.dist-info/RECORD,,
```

