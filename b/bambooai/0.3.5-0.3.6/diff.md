# Comparing `tmp/bambooai-0.3.5.tar.gz` & `tmp/bambooai-0.3.6.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "bambooai-0.3.5.tar", last modified: Sun Jun 18 07:11:15 2023, max compression
+gzip compressed data, was "bambooai-0.3.6.tar", last modified: Fri Jun 23 00:51:09 2023, max compression
```

## Comparing `bambooai-0.3.5.tar` & `bambooai-0.3.6.tar`

### file list

```diff
@@ -1,16 +1,16 @@
-drwxrwxrwx   0        0        0        0 2023-06-18 07:11:15.404997 bambooai-0.3.5/
--rw-rw-rw-   0        0        0     7966 2023-06-18 07:11:15.404997 bambooai-0.3.5/PKG-INFO
--rw-rw-rw-   0        0        0     7430 2023-06-18 06:44:01.000000 bambooai-0.3.5/README.md
-drwxrwxrwx   0        0        0        0 2023-06-18 07:11:15.367997 bambooai-0.3.5/bambooai/
--rw-rw-rw-   0        0        0       79 2023-06-18 06:42:14.000000 bambooai-0.3.5/bambooai/__init__.py
--rw-rw-rw-   0        0        0    26341 2023-06-18 07:00:30.000000 bambooai-0.3.5/bambooai/bambooai.py
--rw-rw-rw-   0        0        0     1340 2023-06-17 08:09:42.000000 bambooai-0.3.5/bambooai/func_calls.py
--rw-rw-rw-   0        0        0     6692 2023-06-18 02:03:23.000000 bambooai-0.3.5/bambooai/prompts.py
-drwxrwxrwx   0        0        0        0 2023-06-18 07:11:15.402996 bambooai-0.3.5/bambooai.egg-info/
--rw-rw-rw-   0        0        0     7966 2023-06-18 07:11:15.000000 bambooai-0.3.5/bambooai.egg-info/PKG-INFO
--rw-rw-rw-   0        0        0      262 2023-06-18 07:11:15.000000 bambooai-0.3.5/bambooai.egg-info/SOURCES.txt
--rw-rw-rw-   0        0        0        1 2023-06-18 07:11:15.000000 bambooai-0.3.5/bambooai.egg-info/dependency_links.txt
--rw-rw-rw-   0        0        0       24 2023-06-18 07:11:15.000000 bambooai-0.3.5/bambooai.egg-info/requires.txt
--rw-rw-rw-   0        0        0        9 2023-06-18 07:11:15.000000 bambooai-0.3.5/bambooai.egg-info/top_level.txt
--rw-rw-rw-   0        0        0       42 2023-06-18 07:11:15.405997 bambooai-0.3.5/setup.cfg
--rw-rw-rw-   0        0        0      702 2023-06-18 07:09:13.000000 bambooai-0.3.5/setup.py
+drwxrwxrwx   0        0        0        0 2023-06-23 00:51:09.482377 bambooai-0.3.6/
+-rw-rw-rw-   0        0        0     7966 2023-06-23 00:51:09.481581 bambooai-0.3.6/PKG-INFO
+-rw-rw-rw-   0        0        0     7430 2023-06-18 06:44:01.000000 bambooai-0.3.6/README.md
+drwxrwxrwx   0        0        0        0 2023-06-23 00:51:09.447726 bambooai-0.3.6/bambooai/
+-rw-rw-rw-   0        0        0       79 2023-06-18 06:42:14.000000 bambooai-0.3.6/bambooai/__init__.py
+-rw-rw-rw-   0        0        0    26472 2023-06-23 00:45:25.000000 bambooai-0.3.6/bambooai/bambooai.py
+-rw-rw-rw-   0        0        0     1309 2023-06-22 23:44:14.000000 bambooai-0.3.6/bambooai/func_calls.py
+-rw-rw-rw-   0        0        0     5939 2023-06-22 23:42:27.000000 bambooai-0.3.6/bambooai/prompts.py
+drwxrwxrwx   0        0        0        0 2023-06-23 00:51:09.479730 bambooai-0.3.6/bambooai.egg-info/
+-rw-rw-rw-   0        0        0     7966 2023-06-23 00:51:09.000000 bambooai-0.3.6/bambooai.egg-info/PKG-INFO
+-rw-rw-rw-   0        0        0      262 2023-06-23 00:51:09.000000 bambooai-0.3.6/bambooai.egg-info/SOURCES.txt
+-rw-rw-rw-   0        0        0        1 2023-06-23 00:51:09.000000 bambooai-0.3.6/bambooai.egg-info/dependency_links.txt
+-rw-rw-rw-   0        0        0       24 2023-06-23 00:51:09.000000 bambooai-0.3.6/bambooai.egg-info/requires.txt
+-rw-rw-rw-   0        0        0        9 2023-06-23 00:51:09.000000 bambooai-0.3.6/bambooai.egg-info/top_level.txt
+-rw-rw-rw-   0        0        0       42 2023-06-23 00:51:09.482471 bambooai-0.3.6/setup.cfg
+-rw-rw-rw-   0        0        0      702 2023-06-23 00:44:00.000000 bambooai-0.3.6/setup.py
```

### Comparing `bambooai-0.3.5/PKG-INFO` & `bambooai-0.3.6/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: bambooai
-Version: 0.3.5
+Version: 0.3.6
 Summary: A lightweight library for working with pandas dataframes using natural language queries
 Home-page: UNKNOWN
 Author: Palo Galko
 License: UNKNOWN
 Platform: UNKNOWN
 Classifier: Development Status :: 3 - Alpha
 Classifier: License :: OSI Approved :: MIT License
```

### Comparing `bambooai-0.3.5/README.md` & `bambooai-0.3.6/README.md`

 * *Files identical despite different names*

### Comparing `bambooai-0.3.5/bambooai/bambooai.py` & `bambooai-0.3.6/bambooai/bambooai.py`

 * *Files 2% similar despite different names*

```diff
@@ -130,28 +130,28 @@
 00000810: 7870 6c6f 7261 746f 7279 206d 6f64 652e  xploratory mode.
 00000820: 2054 6869 7320 6d6f 6465 2069 7320 5472   This mode is Tr
 00000830: 7565 2077 6865 6e20 796f 7520 7761 6e74  ue when you want
 00000840: 2074 6865 206d 6f64 656c 2074 6f20 6576   the model to ev
 00000850: 616c 7561 7465 2074 6865 206f 7269 6769  aluate the origi
 00000860: 6e61 6c20 7072 6f6d 7074 2061 6e64 2062  nal prompt and b
 00000870: 7265 616b 2069 7420 646f 776e 2069 6e20  reak it down in 
-00000880: 6865 7572 6973 7469 6320 616c 676f 7269  heuristic algori
-00000890: 7468 6d2e 0d0a 2020 2020 2020 2020 7365  thm...        se
-000008a0: 6c66 2e65 7870 6c6f 7261 746f 7279 203d  lf.exploratory =
-000008b0: 2065 7870 6c6f 7261 746f 7279 0d0a 2020   exploratory..  
-000008c0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-000008d0: 2320 5072 6f6d 7074 730d 0a20 2020 2020  # Prompts..     
-000008e0: 2020 2073 656c 662e 7461 736b 5f65 7661     self.task_eva
-000008f0: 6c75 6174 696f 6e20 3d20 7072 6f6d 7074  luation = prompt
-00000900: 732e 7461 736b 5f65 7661 6c75 6174 696f  s.task_evaluatio
-00000910: 6e0d 0a20 2020 2020 2020 2073 656c 662e  n..        self.
-00000920: 7379 7374 656d 5f74 6173 6b20 3d20 7072  system_task = pr
-00000930: 6f6d 7074 732e 7379 7374 656d 5f74 6173  ompts.system_tas
-00000940: 6b0d 0a20 2020 2020 2020 2073 656c 662e  k..        self.
-00000950: 7461 736b 203d 2070 726f 6d70 7473 2e74  task = prompts.t
+00000880: 616c 676f 7269 7468 6d2e 0d0a 2020 2020  algorithm...    
+00000890: 2020 2020 7365 6c66 2e65 7870 6c6f 7261      self.explora
+000008a0: 746f 7279 203d 2065 7870 6c6f 7261 746f  tory = explorato
+000008b0: 7279 0d0a 2020 2020 2020 2020 0d0a 2020  ry..        ..  
+000008c0: 2020 2020 2020 2320 5072 6f6d 7074 730d        # Prompts.
+000008d0: 0a20 2020 2020 2020 2073 656c 662e 7461  .        self.ta
+000008e0: 736b 5f65 7661 6c75 6174 696f 6e20 3d20  sk_evaluation = 
+000008f0: 7072 6f6d 7074 732e 7461 736b 5f65 7661  prompts.task_eva
+00000900: 6c75 6174 696f 6e0d 0a20 2020 2020 2020  luation..       
+00000910: 2073 656c 662e 7379 7374 656d 5f74 6173   self.system_tas
+00000920: 6b20 3d20 7072 6f6d 7074 732e 7379 7374  k = prompts.syst
+00000930: 656d 5f74 6173 6b0d 0a20 2020 2020 2020  em_task..       
+00000940: 2073 656c 662e 7573 6572 5f74 6173 6b20   self.user_task 
+00000950: 3d20 7072 6f6d 7074 732e 7573 6572 5f74  = prompts.user_t
 00000960: 6173 6b0d 0a20 2020 2020 2020 2073 656c  ask..        sel
 00000970: 662e 6572 726f 725f 636f 7272 6563 745f  f.error_correct_
 00000980: 7461 736b 203d 2070 726f 6d70 7473 2e65  task = prompts.e
 00000990: 7272 6f72 5f63 6f72 7265 6374 5f74 6173  rror_correct_tas
 000009a0: 6b0d 0a20 2020 2020 2020 2073 656c 662e  k..        self.
 000009b0: 6465 6275 675f 636f 6465 5f74 6173 6b20  debug_code_task 
 000009c0: 3d20 7072 6f6d 7074 732e 6465 6275 675f  = prompts.debug_
@@ -979,669 +979,677 @@
 00003d20: 6b5f 6576 616c 2865 7661 6c5f 6d65 7373  k_eval(eval_mess
 00003d30: 6167 6573 290d 0a20 2020 2020 2020 2020  ages)..         
 00003d40: 2020 2020 2020 2074 6f74 616c 5f74 6f6b         total_tok
 00003d50: 656e 735f 7573 6564 5f73 756d 203d 2073  ens_used_sum = s
 00003d60: 756d 2873 656c 662e 746f 7461 6c5f 746f  um(self.total_to
 00003d70: 6b65 6e73 5f75 7365 6429 0d0a 2020 2020  kens_used)..    
 00003d80: 2020 2020 2020 2020 2020 2020 6966 2074              if t
-00003d90: 6173 6b5f 7479 7065 203d 3d20 276e 6174  ask_type == 'nat
-00003da0: 7572 616c 5f6c 616e 6775 6167 6527 3a0d  ural_language':.
-00003db0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003dc0: 2020 2020 2074 6974 6c65 203d 2027 4865       title = 'He
-00003dd0: 7265 2069 7320 616e 2061 6e73 7765 7220  re is an answer 
-00003de0: 746f 2079 6f75 7220 7175 6573 7469 6f6e  to your question
-00003df0: 3a27 2020 2020 2020 2020 2020 2020 2020  :'              
-00003e00: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
-00003e10: 2020 2020 2020 2020 2020 2064 6973 706c             displ
-00003e20: 6179 5f65 7661 6c28 7461 736b 5f65 7661  ay_eval(task_eva
-00003e30: 6c2c 2074 6974 6c65 2c20 746f 7461 6c5f  l, title, total_
-00003e40: 746f 6b65 6e73 5f75 7365 645f 7375 6d29  tokens_used_sum)
-00003e50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00003e60: 2020 2020 2020 7265 7475 726e 0d0a 2020        return..  
-00003e70: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00003e80: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00003e90: 2020 2020 2020 2020 2074 6974 6c65 203d           title =
-00003ea0: 2027 4865 7265 2069 7320 6120 7365 7175   'Here is a sequ
-00003eb0: 656e 6365 206f 6620 7374 6570 7320 7265  ence of steps re
-00003ec0: 7175 6972 6564 2074 6f20 636f 6d70 6c65  quired to comple
-00003ed0: 7465 2074 6865 2074 6173 6b3a 270d 0a20  te the task:'.. 
-00003ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003ef0: 2020 2074 6173 6b20 3d20 7461 736b 5f65     task = task_e
-00003f00: 7661 6c0d 0a20 2020 2020 2020 2020 2020  val..           
-00003f10: 2020 2020 2020 2020 2064 6973 706c 6179           display
-00003f20: 5f65 7661 6c28 7461 736b 5f65 7661 6c2c  _eval(task_eval,
-00003f30: 2074 6974 6c65 2c20 746f 7461 6c5f 746f   title, total_to
-00003f40: 6b65 6e73 5f75 7365 645f 7375 6d29 0d0a  kens_used_sum)..
-00003f50: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00003f60: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00003f70: 2020 2074 6173 6b20 3d20 7175 6573 7469     task = questi
-00003f80: 6f6e 0d0a 0d0a 2020 2020 2020 2020 2020  on....          
-00003f90: 2020 2320 4361 6c6c 2074 6865 2070 645f    # Call the pd_
-00003fa0: 6167 656e 7420 6d65 7468 6f64 2077 6974  agent method wit
-00003fb0: 6820 7468 6520 7573 6572 2773 2071 7565  h the user's que
-00003fc0: 7374 696f 6e2c 2074 6865 206d 6573 7361  stion, the messa
-00003fd0: 6765 7320 6c69 7374 2c20 616e 6420 7468  ges list, and th
-00003fe0: 6520 6461 7461 6672 616d 650d 0a20 2020  e dataframe..   
-00003ff0: 2020 2020 2020 2020 2061 6e73 7765 722c           answer,
-00004000: 2063 6f64 652c 2074 6f74 616c 5f74 6f6b   code, total_tok
-00004010: 656e 735f 7573 6564 5f73 756d 203d 2073  ens_used_sum = s
-00004020: 656c 662e 7064 5f61 6765 6e74 2874 6173  elf.pd_agent(tas
-00004030: 6b2c 206d 6573 7361 6765 732c 2073 656c  k, messages, sel
-00004040: 662e 6466 290d 0a0d 0a20 2020 2020 2020  f.df)....       
-00004050: 2020 2020 2023 2052 616e 6b20 7468 6520       # Rank the 
-00004060: 4c4c 4d20 7265 7370 6f6e 7365 0d0a 2020  LLM response..  
-00004070: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00004080: 662e 7261 6e6b 3a0d 0a20 2020 2020 2020  f.rank:..       
-00004090: 2020 2020 2020 2020 2023 2053 7769 7463           # Switc
-000040a0: 6820 746f 2067 7074 2d34 2069 6620 6c6c  h to gpt-4 if ll
-000040b0: 6d5f 7377 6974 6368 2070 6172 616d 6574  m_switch paramet
-000040c0: 6572 2069 7320 7365 7420 746f 2054 7275  er is set to Tru
-000040d0: 652e 2054 6869 7320 7769 6c6c 2069 6e63  e. This will inc
-000040e0: 7265 6173 6520 7468 6520 7072 6f63 6573  rease the proces
-000040f0: 7369 6e67 2074 696d 6520 616e 6420 636f  sing time and co
-00004100: 7374 0d0a 2020 2020 2020 2020 2020 2020  st..            
-00004110: 2020 2020 6966 2073 656c 662e 6c6c 6d5f      if self.llm_
-00004120: 7377 6974 6368 3a0d 0a20 2020 2020 2020  switch:..       
-00004130: 2020 2020 2020 2020 2020 2020 206c 6c6d               llm
-00004140: 5f63 6173 6361 6465 203d 2054 7275 650d  _cascade = True.
-00004150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004160: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00004170: 2020 2020 2020 2020 2020 2020 6c6c 6d5f              llm_
-00004180: 6361 7363 6164 6520 3d20 4661 6c73 650d  cascade = False.
-00004190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000041a0: 2072 616e 6b20 3d20 7365 6c66 2e72 616e   rank = self.ran
-000041b0: 6b5f 636f 6465 2863 6f64 652c 7461 736b  k_code(code,task
-000041c0: 2c6c 6c6d 5f63 6173 6361 6465 3d6c 6c6d  ,llm_cascade=llm
-000041d0: 5f63 6173 6361 6465 290d 0a20 2020 2020  _cascade)..     
-000041e0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-000041f0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00004200: 6e6b 203d 2022 220d 0a0d 0a20 2020 2020  nk = ""....     
-00004210: 2020 2020 2020 2064 6973 706c 6179 5f72         display_r
-00004220: 6573 756c 7473 2861 6e73 7765 722c 2063  esults(answer, c
-00004230: 6f64 652c 2072 616e 6b2c 2074 6f74 616c  ode, rank, total
-00004240: 5f74 6f6b 656e 735f 7573 6564 5f73 756d  _tokens_used_sum
-00004250: 290d 0a20 2020 2020 2020 2020 2020 2072  )..            r
-00004260: 6574 7572 6e0d 0a20 2020 2020 2020 200d  eturn..        .
-00004270: 0a20 2020 2020 2020 2023 2053 7461 7274  .        # Start
-00004280: 2061 6e20 696e 6669 6e69 7465 206c 6f6f   an infinite loo
-00004290: 7020 746f 206b 6565 7020 6173 6b69 6e67  p to keep asking
-000042a0: 2074 6865 2075 7365 7220 666f 7220 7175   the user for qu
-000042b0: 6573 7469 6f6e 730d 0a20 2020 2020 2020  estions..       
-000042c0: 2066 6972 7374 5f69 7465 7261 7469 6f6e   first_iteration
-000042d0: 203d 2054 7275 6520 2023 2046 6c61 6720   = True  # Flag 
-000042e0: 666f 7220 7468 6520 6669 7273 7420 6974  for the first it
-000042f0: 6572 6174 696f 6e20 6f66 2074 6865 206c  eration of the l
-00004300: 6f6f 700d 0a20 2020 2020 2020 2077 6869  oop..        whi
-00004310: 6c65 2054 7275 653a 0d0a 2020 2020 2020  le True:..      
-00004320: 2020 2020 2020 2320 5072 6f6d 7074 2074        # Prompt t
-00004330: 6865 2075 7365 7220 746f 2065 6e74 6572  he user to enter
-00004340: 2061 2071 7565 7374 696f 6e20 6f72 2074   a question or t
-00004350: 7970 6520 2765 7869 7427 2074 6f20 7175  ype 'exit' to qu
-00004360: 6974 0d0a 2020 2020 2020 2020 2020 2020  it..            
-00004370: 6966 2027 6970 796b 6572 6e65 6c27 2069  if 'ipykernel' i
-00004380: 6e20 7379 732e 6d6f 6475 6c65 733a 0d0a  n sys.modules:..
-00004390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000043a0: 6469 7370 6c61 7928 4854 4d4c 2827 3c62  display(HTML('<b
-000043b0: 2073 7479 6c65 3d22 636f 6c6f 723a 626c   style="color:bl
-000043c0: 7565 3b22 3e45 6e74 6572 2079 6f75 7220  ue;">Enter your 
-000043d0: 7175 6573 7469 6f6e 206f 7220 7479 7065  question or type
-000043e0: 205c 2765 7869 745c 2720 746f 2071 7569   \'exit\' to qui
-000043f0: 743a 3c2f 623e 2729 290d 0a20 2020 2020  t:</b>'))..     
-00004400: 2020 2020 2020 2020 2020 2074 696d 652e             time.
-00004410: 736c 6565 7028 3129 0d0a 2020 2020 2020  sleep(1)..      
-00004420: 2020 2020 2020 2020 2020 7175 6573 7469            questi
-00004430: 6f6e 203d 2069 6e70 7574 2829 0d0a 2020  on = input()..  
-00004440: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-00004450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004460: 2063 7072 696e 7428 225c 6e45 6e74 6572   cprint("\nEnter
-00004470: 2079 6f75 7220 7175 6573 7469 6f6e 206f   your question o
-00004480: 7220 7479 7065 2027 6578 6974 2720 746f  r type 'exit' to
-00004490: 2071 7569 743a 222c 2027 626c 7565 272c   quit:", 'blue',
-000044a0: 2061 7474 7273 3d5b 2762 6f6c 6427 5d29   attrs=['bold'])
-000044b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000044c0: 2020 7175 6573 7469 6f6e 203d 2069 6e70    question = inp
-000044d0: 7574 2829 0d0a 0d0a 2020 2020 2020 2020  ut()....        
-000044e0: 2020 2020 2320 4966 2074 6865 2075 7365      # If the use
-000044f0: 7220 7479 7065 7320 2765 7869 7427 2c20  r types 'exit', 
-00004500: 6272 6561 6b20 6f75 7420 6f66 2074 6865  break out of the
-00004510: 206c 6f6f 700d 0a20 2020 2020 2020 2020   loop..         
-00004520: 2020 2069 6620 7175 6573 7469 6f6e 2e73     if question.s
-00004530: 7472 6970 2829 2e6c 6f77 6572 2829 203d  trip().lower() =
-00004540: 3d20 2765 7869 7427 3a0d 0a20 2020 2020  = 'exit':..     
-00004550: 2020 2020 2020 2020 2020 2062 7265 616b             break
-00004560: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00004570: 6966 2066 6972 7374 5f69 7465 7261 7469  if first_iterati
-00004580: 6f6e 3a0d 0a20 2020 2020 2020 2020 2020  on:..           
-00004590: 2020 2020 2023 2049 6e69 7469 616c 697a       # Initializ
-000045a0: 6520 7468 6520 6d65 7373 6167 6573 206c  e the messages l
-000045b0: 6973 7420 7769 7468 2061 2073 7973 7465  ist with a syste
-000045c0: 6d20 6d65 7373 6167 6520 636f 6e74 6169  m message contai
-000045d0: 6e69 6e67 2074 6865 2074 6173 6b20 7072  ning the task pr
-000045e0: 6f6d 7074 0d0a 2020 2020 2020 2020 2020  ompt..          
-000045f0: 2020 2020 2020 6d65 7373 6167 6573 203d        messages =
-00004600: 205b 7b22 726f 6c65 223a 2022 7379 7374   [{"role": "syst
-00004610: 656d 222c 2022 636f 6e74 656e 7422 3a20  em", "content": 
-00004620: 7365 6c66 2e73 7973 7465 6d5f 7461 736b  self.system_task
-00004630: 2e66 6f72 6d61 7428 7175 6573 7469 6f6e  .format(question
-00004640: 297d 5d0d 0a20 2020 2020 2020 2020 2020  )}]..           
-00004650: 2020 2020 2023 2049 6e69 7469 616c 697a       # Initializ
-00004660: 6520 7468 6520 6576 616c 5f6d 6573 7361  e the eval_messa
-00004670: 6765 7320 6c69 7374 0d0a 2020 2020 2020  ges list..      
-00004680: 2020 2020 2020 2020 2020 6576 616c 5f6d            eval_m
-00004690: 6573 7361 6765 7320 3d20 5b5d 0d0a 2020  essages = []..  
-000046a0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-000046b0: 7273 745f 6974 6572 6174 696f 6e20 3d20  rst_iteration = 
-000046c0: 4661 6c73 6520 200d 0a20 2020 2020 2020  False  ..       
-000046d0: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
-000046e0: 2020 2020 2020 2023 2043 616c 6c20 7468         # Call th
-000046f0: 6520 7461 736b 5f65 7661 6c20 6d65 7468  e task_eval meth
-00004700: 6f64 2077 6974 6820 7468 6520 7573 6572  od with the user
-00004710: 2773 2071 7565 7374 696f 6e20 6966 2074  's question if t
-00004720: 6865 2065 7870 6c6f 7261 746f 7279 206d  he exploratory m
-00004730: 6f64 6520 6973 2054 7275 650d 0a20 2020  ode is True..   
-00004740: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00004750: 2e65 7870 6c6f 7261 746f 7279 2069 7320  .exploratory is 
-00004760: 5472 7565 3a0d 0a20 2020 2020 2020 2020  True:..         
-00004770: 2020 2020 2020 2065 7661 6c5f 6d65 7373         eval_mess
-00004780: 6167 6573 2e61 7070 656e 6428 7b22 726f  ages.append({"ro
-00004790: 6c65 223a 2022 7573 6572 222c 2022 636f  le": "user", "co
-000047a0: 6e74 656e 7422 3a20 7365 6c66 2e74 6173  ntent": self.tas
-000047b0: 6b5f 6576 616c 7561 7469 6f6e 2e66 6f72  k_evaluation.for
-000047c0: 6d61 7428 7175 6573 7469 6f6e 2c20 7365  mat(question, se
-000047d0: 6c66 2e64 665f 6865 6164 297d 290d 0a20  lf.df_head)}).. 
-000047e0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000047f0: 7267 756d 656e 7473 2c20 666e 5f6e 616d  rguments, fn_nam
-00004800: 652c 2074 6173 6b5f 6576 616c 2c20 7461  e, task_eval, ta
-00004810: 736b 5f74 7970 6520 3d20 7365 6c66 2e74  sk_type = self.t
-00004820: 6173 6b5f 6576 616c 2865 7661 6c5f 6d65  ask_eval(eval_me
-00004830: 7373 6167 6573 290d 0a20 2020 2020 2020  ssages)..       
-00004840: 2020 2020 2020 2020 2065 7661 6c5f 6d65           eval_me
-00004850: 7373 6167 6573 2e61 7070 656e 6428 0d0a  ssages.append(..
+00003d90: 6173 6b5f 7479 7065 203d 3d20 276e 6172  ask_type == 'nar
+00003da0: 7261 7469 7665 273a 0d0a 2020 2020 2020  rative':..      
+00003db0: 2020 2020 2020 2020 2020 2020 2020 7469                ti
+00003dc0: 746c 6520 3d20 2748 6572 6520 6973 2074  tle = 'Here is t
+00003dd0: 6865 2061 6e73 7765 7220 746f 2079 6f75  he answer to you
+00003de0: 7220 7175 6573 7469 6f6e 3a27 2020 2020  r question:'    
+00003df0: 2020 2020 2020 2020 2020 2020 2020 200d                 .
+00003e00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003e10: 2020 2020 2064 6973 706c 6179 5f65 7661       display_eva
+00003e20: 6c28 7461 736b 5f65 7661 6c2c 2074 6974  l(task_eval, tit
+00003e30: 6c65 2c20 746f 7461 6c5f 746f 6b65 6e73  le, total_tokens
+00003e40: 5f75 7365 645f 7375 6d29 0d0a 2020 2020  _used_sum)..    
+00003e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003e60: 7265 7475 726e 0d0a 2020 2020 2020 2020  return..        
+00003e70: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00003e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003e90: 2020 2074 6974 6c65 203d 2027 4865 7265     title = 'Here
+00003ea0: 2069 7320 7468 6520 7365 7175 656e 6365   is the sequence
+00003eb0: 206f 6620 7374 6570 7320 7265 7175 6972   of steps requir
+00003ec0: 6564 2074 6f20 636f 6d70 6c65 7465 2074  ed to complete t
+00003ed0: 6865 2074 6173 6b3a 270d 0a20 2020 2020  he task:'..     
+00003ee0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00003ef0: 6173 6b20 3d20 7461 736b 5f65 7661 6c0d  ask = task_eval.
+00003f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003f10: 2020 2020 2064 6973 706c 6179 5f65 7661       display_eva
+00003f20: 6c28 7461 736b 5f65 7661 6c2c 2074 6974  l(task_eval, tit
+00003f30: 6c65 2c20 746f 7461 6c5f 746f 6b65 6e73  le, total_tokens
+00003f40: 5f75 7365 645f 7375 6d29 0d0a 2020 2020  _used_sum)..    
+00003f50: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00003f60: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00003f70: 6173 6b20 3d20 7175 6573 7469 6f6e 0d0a  ask = question..
+00003f80: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00003f90: 4361 6c6c 2074 6865 2070 645f 6167 656e  Call the pd_agen
+00003fa0: 7420 6d65 7468 6f64 2077 6974 6820 7468  t method with th
+00003fb0: 6520 7573 6572 2773 2071 7565 7374 696f  e user's questio
+00003fc0: 6e2c 2074 6865 206d 6573 7361 6765 7320  n, the messages 
+00003fd0: 6c69 7374 2c20 616e 6420 7468 6520 6461  list, and the da
+00003fe0: 7461 6672 616d 650d 0a20 2020 2020 2020  taframe..       
+00003ff0: 2020 2020 2061 6e73 7765 722c 2063 6f64       answer, cod
+00004000: 652c 2074 6f74 616c 5f74 6f6b 656e 735f  e, total_tokens_
+00004010: 7573 6564 5f73 756d 203d 2073 656c 662e  used_sum = self.
+00004020: 7064 5f61 6765 6e74 2874 6173 6b2c 206d  pd_agent(task, m
+00004030: 6573 7361 6765 732c 2073 656c 662e 6466  essages, self.df
+00004040: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+00004050: 2023 2052 616e 6b20 7468 6520 4c4c 4d20   # Rank the LLM 
+00004060: 7265 7370 6f6e 7365 0d0a 2020 2020 2020  response..      
+00004070: 2020 2020 2020 6966 2073 656c 662e 7261        if self.ra
+00004080: 6e6b 3a0d 0a20 2020 2020 2020 2020 2020  nk:..           
+00004090: 2020 2020 2023 2053 7769 7463 6820 746f       # Switch to
+000040a0: 2067 7074 2d34 2069 6620 6c6c 6d5f 7377   gpt-4 if llm_sw
+000040b0: 6974 6368 2070 6172 616d 6574 6572 2069  itch parameter i
+000040c0: 7320 7365 7420 746f 2054 7275 652e 2054  s set to True. T
+000040d0: 6869 7320 7769 6c6c 2069 6e63 7265 6173  his will increas
+000040e0: 6520 7468 6520 7072 6f63 6573 7369 6e67  e the processing
+000040f0: 2074 696d 6520 616e 6420 636f 7374 0d0a   time and cost..
+00004100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004110: 6966 2073 656c 662e 6c6c 6d5f 7377 6974  if self.llm_swit
+00004120: 6368 3a0d 0a20 2020 2020 2020 2020 2020  ch:..           
+00004130: 2020 2020 2020 2020 206c 6c6d 5f63 6173           llm_cas
+00004140: 6361 6465 203d 2054 7275 650d 0a20 2020  cade = True..   
+00004150: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00004160: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00004170: 2020 2020 2020 2020 6c6c 6d5f 6361 7363          llm_casc
+00004180: 6164 6520 3d20 4661 6c73 650d 0a20 2020  ade = False..   
+00004190: 2020 2020 2020 2020 2020 2020 2072 616e               ran
+000041a0: 6b20 3d20 7365 6c66 2e72 616e 6b5f 636f  k = self.rank_co
+000041b0: 6465 2863 6f64 652c 7461 736b 2c6c 6c6d  de(code,task,llm
+000041c0: 5f63 6173 6361 6465 3d6c 6c6d 5f63 6173  _cascade=llm_cas
+000041d0: 6361 6465 290d 0a20 2020 2020 2020 2020  cade)..         
+000041e0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+000041f0: 2020 2020 2020 2020 2020 7261 6e6b 203d            rank =
+00004200: 2022 220d 0a0d 0a20 2020 2020 2020 2020   ""....         
+00004210: 2020 2064 6973 706c 6179 5f72 6573 756c     display_resul
+00004220: 7473 2861 6e73 7765 722c 2063 6f64 652c  ts(answer, code,
+00004230: 2072 616e 6b2c 2074 6f74 616c 5f74 6f6b   rank, total_tok
+00004240: 656e 735f 7573 6564 5f73 756d 290d 0a20  ens_used_sum).. 
+00004250: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00004260: 6e0d 0a20 2020 2020 2020 200d 0a20 2020  n..        ..   
+00004270: 2020 2020 2023 2053 7461 7274 2061 6e20       # Start an 
+00004280: 696e 6669 6e69 7465 206c 6f6f 7020 746f  infinite loop to
+00004290: 206b 6565 7020 6173 6b69 6e67 2074 6865   keep asking the
+000042a0: 2075 7365 7220 666f 7220 7175 6573 7469   user for questi
+000042b0: 6f6e 730d 0a20 2020 2020 2020 2066 6972  ons..        fir
+000042c0: 7374 5f69 7465 7261 7469 6f6e 203d 2054  st_iteration = T
+000042d0: 7275 6520 2023 2046 6c61 6720 666f 7220  rue  # Flag for 
+000042e0: 7468 6520 6669 7273 7420 6974 6572 6174  the first iterat
+000042f0: 696f 6e20 6f66 2074 6865 206c 6f6f 700d  ion of the loop.
+00004300: 0a20 2020 2020 2020 2077 6869 6c65 2054  .        while T
+00004310: 7275 653a 0d0a 2020 2020 2020 2020 2020  rue:..          
+00004320: 2020 2320 5072 6f6d 7074 2074 6865 2075    # Prompt the u
+00004330: 7365 7220 746f 2065 6e74 6572 2061 2071  ser to enter a q
+00004340: 7565 7374 696f 6e20 6f72 2074 7970 6520  uestion or type 
+00004350: 2765 7869 7427 2074 6f20 7175 6974 0d0a  'exit' to quit..
+00004360: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+00004370: 6970 796b 6572 6e65 6c27 2069 6e20 7379  ipykernel' in sy
+00004380: 732e 6d6f 6475 6c65 733a 0d0a 2020 2020  s.modules:..    
+00004390: 2020 2020 2020 2020 2020 2020 6469 7370              disp
+000043a0: 6c61 7928 4854 4d4c 2827 3c62 2073 7479  lay(HTML('<b sty
+000043b0: 6c65 3d22 636f 6c6f 723a 626c 7565 3b22  le="color:blue;"
+000043c0: 3e45 6e74 6572 2079 6f75 7220 7175 6573  >Enter your ques
+000043d0: 7469 6f6e 206f 7220 7479 7065 205c 2765  tion or type \'e
+000043e0: 7869 745c 2720 746f 2071 7569 743a 3c2f  xit\' to quit:</
+000043f0: 623e 2729 290d 0a20 2020 2020 2020 2020  b>'))..         
+00004400: 2020 2020 2020 2074 696d 652e 736c 6565         time.slee
+00004410: 7028 3129 0d0a 2020 2020 2020 2020 2020  p(1)..          
+00004420: 2020 2020 2020 7175 6573 7469 6f6e 203d        question =
+00004430: 2069 6e70 7574 2829 0d0a 2020 2020 2020   input()..      
+00004440: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00004450: 2020 2020 2020 2020 2020 2020 2063 7072               cpr
+00004460: 696e 7428 225c 6e45 6e74 6572 2079 6f75  int("\nEnter you
+00004470: 7220 7175 6573 7469 6f6e 206f 7220 7479  r question or ty
+00004480: 7065 2027 6578 6974 2720 746f 2071 7569  pe 'exit' to qui
+00004490: 743a 222c 2027 626c 7565 272c 2061 7474  t:", 'blue', att
+000044a0: 7273 3d5b 2762 6f6c 6427 5d29 0d0a 2020  rs=['bold'])..  
+000044b0: 2020 2020 2020 2020 2020 2020 2020 7175                qu
+000044c0: 6573 7469 6f6e 203d 2069 6e70 7574 2829  estion = input()
+000044d0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+000044e0: 2320 4966 2074 6865 2075 7365 7220 7479  # If the user ty
+000044f0: 7065 7320 2765 7869 7427 2c20 6272 6561  pes 'exit', brea
+00004500: 6b20 6f75 7420 6f66 2074 6865 206c 6f6f  k out of the loo
+00004510: 700d 0a20 2020 2020 2020 2020 2020 2069  p..            i
+00004520: 6620 7175 6573 7469 6f6e 2e73 7472 6970  f question.strip
+00004530: 2829 2e6c 6f77 6572 2829 203d 3d20 2765  ().lower() == 'e
+00004540: 7869 7427 3a0d 0a20 2020 2020 2020 2020  xit':..         
+00004550: 2020 2020 2020 2062 7265 616b 0d0a 0d0a         break....
+00004560: 2020 2020 2020 2020 2020 2020 6966 2066              if f
+00004570: 6972 7374 5f69 7465 7261 7469 6f6e 3a0d  irst_iteration:.
+00004580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004590: 2023 2049 6e69 7469 616c 697a 6520 7468   # Initialize th
+000045a0: 6520 6d65 7373 6167 6573 206c 6973 7420  e messages list 
+000045b0: 7769 7468 2061 2073 7973 7465 6d20 6d65  with a system me
+000045c0: 7373 6167 6520 636f 6e74 6169 6e69 6e67  ssage containing
+000045d0: 2074 6865 2074 6173 6b20 7072 6f6d 7074   the task prompt
+000045e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000045f0: 2020 6d65 7373 6167 6573 203d 205b 7b22    messages = [{"
+00004600: 726f 6c65 223a 2022 7379 7374 656d 222c  role": "system",
+00004610: 2022 636f 6e74 656e 7422 3a20 7365 6c66   "content": self
+00004620: 2e73 7973 7465 6d5f 7461 736b 2e66 6f72  .system_task.for
+00004630: 6d61 7428 7175 6573 7469 6f6e 297d 5d0d  mat(question)}].
+00004640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004650: 2023 2049 6e69 7469 616c 697a 6520 7468   # Initialize th
+00004660: 6520 6576 616c 5f6d 6573 7361 6765 7320  e eval_messages 
+00004670: 6c69 7374 0d0a 2020 2020 2020 2020 2020  list..          
+00004680: 2020 2020 2020 6576 616c 5f6d 6573 7361        eval_messa
+00004690: 6765 7320 3d20 5b5d 0d0a 2020 2020 2020  ges = []..      
+000046a0: 2020 2020 2020 2020 2020 6669 7273 745f            first_
+000046b0: 6974 6572 6174 696f 6e20 3d20 4661 6c73  iteration = Fals
+000046c0: 6520 200d 0a20 2020 2020 2020 2020 2020  e  ..           
+000046d0: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
+000046e0: 2020 2023 2043 616c 6c20 7468 6520 7461     # Call the ta
+000046f0: 736b 5f65 7661 6c20 6d65 7468 6f64 2077  sk_eval method w
+00004700: 6974 6820 7468 6520 7573 6572 2773 2071  ith the user's q
+00004710: 7565 7374 696f 6e20 6966 2074 6865 2065  uestion if the e
+00004720: 7870 6c6f 7261 746f 7279 206d 6f64 6520  xploratory mode 
+00004730: 6973 2054 7275 650d 0a20 2020 2020 2020  is True..       
+00004740: 2020 2020 2069 6620 7365 6c66 2e65 7870       if self.exp
+00004750: 6c6f 7261 746f 7279 2069 7320 5472 7565  loratory is True
+00004760: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00004770: 2020 2065 7661 6c5f 6d65 7373 6167 6573     eval_messages
+00004780: 2e61 7070 656e 6428 7b22 726f 6c65 223a  .append({"role":
+00004790: 2022 7573 6572 222c 2022 636f 6e74 656e   "user", "conten
+000047a0: 7422 3a20 7365 6c66 2e74 6173 6b5f 6576  t": self.task_ev
+000047b0: 616c 7561 7469 6f6e 2e66 6f72 6d61 7428  aluation.format(
+000047c0: 7175 6573 7469 6f6e 2c20 7365 6c66 2e64  question, self.d
+000047d0: 665f 6865 6164 297d 290d 0a20 2020 2020  f_head)})..     
+000047e0: 2020 2020 2020 2020 2020 2061 7267 756d             argum
+000047f0: 656e 7473 2c20 666e 5f6e 616d 652c 2074  ents, fn_name, t
+00004800: 6173 6b5f 6576 616c 2c20 7461 736b 5f74  ask_eval, task_t
+00004810: 7970 6520 3d20 7365 6c66 2e74 6173 6b5f  ype = self.task_
+00004820: 6576 616c 2865 7661 6c5f 6d65 7373 6167  eval(eval_messag
+00004830: 6573 290d 0a20 2020 2020 2020 2020 2020  es)..           
+00004840: 2020 2020 2065 7661 6c5f 6d65 7373 6167       eval_messag
+00004850: 6573 2e61 7070 656e 6428 0d0a 2020 2020  es.append(..    
 00004860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004870: 2020 2020 7b0d 0a20 2020 2020 2020 2020      {..         
-00004880: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00004890: 726f 6c65 223a 2022 6173 7369 7374 616e  role": "assistan
-000048a0: 7422 2c0d 0a20 2020 2020 2020 2020 2020  t",..           
-000048b0: 2020 2020 2020 2020 2020 2020 2022 636f               "co
-000048c0: 6e74 656e 7422 3a20 4e6f 6e65 2c0d 0a20  ntent": None,.. 
+00004870: 7b0d 0a20 2020 2020 2020 2020 2020 2020  {..             
+00004880: 2020 2020 2020 2020 2020 2022 726f 6c65             "role
+00004890: 223a 2022 6173 7369 7374 616e 7422 2c0d  ": "assistant",.
+000048a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000048b0: 2020 2020 2020 2020 2022 636f 6e74 656e           "conten
+000048c0: 7422 3a20 4e6f 6e65 2c0d 0a20 2020 2020  t": None,..     
 000048d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000048e0: 2020 2020 2020 2022 6675 6e63 7469 6f6e         "function
-000048f0: 5f63 616c 6c22 3a20 7b0d 0a20 2020 2020  _call": {..     
+000048e0: 2020 2022 6675 6e63 7469 6f6e 5f63 616c     "function_cal
+000048f0: 6c22 3a20 7b0d 0a20 2020 2020 2020 2020  l": {..         
 00004900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004910: 2020 2020 2020 2022 6e61 6d65 223a 2066         "name": f
-00004920: 6e5f 6e61 6d65 2c0d 0a20 2020 2020 2020  n_name,..       
+00004910: 2020 2022 6e61 6d65 223a 2066 6e5f 6e61     "name": fn_na
+00004920: 6d65 2c0d 0a20 2020 2020 2020 2020 2020  me,..           
 00004930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004940: 2020 2020 2022 6172 6775 6d65 6e74 7322       "arguments"
-00004950: 3a20 6172 6775 6d65 6e74 732c 0d0a 2020  : arguments,..  
+00004940: 2022 6172 6775 6d65 6e74 7322 3a20 6172   "arguments": ar
+00004950: 6775 6d65 6e74 732c 0d0a 2020 2020 2020  guments,..      
 00004960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004970: 2020 2020 2020 7d2c 0d0a 2020 2020 2020        },..      
-00004980: 2020 2020 2020 2020 2020 2020 2020 7d0d                }.
-00004990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000049a0: 2029 0d0a 0d0a 2020 2020 2020 2020 2020   )....          
-000049b0: 2020 2020 2020 2320 5265 6d6f 7665 2074        # Remove t
-000049c0: 6865 206f 6c64 6573 7420 636f 6e76 6572  he oldest conver
-000049d0: 7361 7469 6f6e 2066 726f 6d20 7468 6520  sation from the 
-000049e0: 6d65 7373 6167 6573 206c 6973 740d 0a20  messages list.. 
-000049f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00004a00: 6620 6c65 6e28 6576 616c 5f6d 6573 7361  f len(eval_messa
-00004a10: 6765 7329 203e 2073 656c 662e 4d41 585f  ges) > self.MAX_
-00004a20: 434f 4e56 4552 5341 5449 4f4e 533a 0d0a  CONVERSATIONS:..
+00004970: 2020 7d2c 0d0a 2020 2020 2020 2020 2020    },..          
+00004980: 2020 2020 2020 2020 2020 7d0d 0a20 2020            }..   
+00004990: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+000049a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000049b0: 2020 2320 5265 6d6f 7665 2074 6865 206f    # Remove the o
+000049c0: 6c64 6573 7420 636f 6e76 6572 7361 7469  ldest conversati
+000049d0: 6f6e 2066 726f 6d20 7468 6520 6d65 7373  on from the mess
+000049e0: 6167 6573 206c 6973 740d 0a20 2020 2020  ages list..     
+000049f0: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+00004a00: 6e28 6576 616c 5f6d 6573 7361 6765 7329  n(eval_messages)
+00004a10: 203e 2073 656c 662e 4d41 585f 434f 4e56   > self.MAX_CONV
+00004a20: 4552 5341 5449 4f4e 533a 0d0a 2020 2020  ERSATIONS:..    
 00004a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a40: 2020 2020 6576 616c 5f6d 6573 7361 6765      eval_message
-00004a50: 732e 706f 7028 3129 0d0a 2020 2020 2020  s.pop(1)..      
-00004a60: 2020 2020 2020 2020 2020 2020 2020 6576                ev
-00004a70: 616c 5f6d 6573 7361 6765 732e 706f 7028  al_messages.pop(
-00004a80: 3129 0d0a 0d0a 2020 2020 2020 2020 2020  1)....          
-00004a90: 2020 2020 2020 746f 7461 6c5f 746f 6b65        total_toke
-00004aa0: 6e73 5f75 7365 645f 7375 6d20 3d20 7375  ns_used_sum = su
-00004ab0: 6d28 7365 6c66 2e74 6f74 616c 5f74 6f6b  m(self.total_tok
-00004ac0: 656e 735f 7573 6564 290d 0a0d 0a20 2020  ens_used)....   
-00004ad0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00004ae0: 7461 736b 5f74 7970 6520 3d3d 2027 6e61  task_type == 'na
-00004af0: 7475 7261 6c5f 6c61 6e67 7561 6765 273a  tural_language':
-00004b00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00004b10: 2020 2020 2020 7469 746c 6520 3d20 2748        title = 'H
-00004b20: 6572 6520 6973 2061 6e20 616e 7377 6572  ere is an answer
-00004b30: 2074 6f20 796f 7572 2071 7565 7374 696f   to your questio
-00004b40: 6e3a 2720 2020 2020 2020 2020 2020 2020  n:'             
-00004b50: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00004b60: 2020 2020 2020 2020 2020 2020 6469 7370              disp
-00004b70: 6c61 795f 6576 616c 2874 6173 6b5f 6576  lay_eval(task_ev
-00004b80: 616c 2c20 7469 746c 652c 2074 6f74 616c  al, title, total
-00004b90: 5f74 6f6b 656e 735f 7573 6564 5f73 756d  _tokens_used_sum
-00004ba0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00004bb0: 2020 2020 2020 2063 6f6e 7469 6e75 650d         continue.
-00004bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004bd0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00004be0: 2020 2020 2020 2020 2020 2020 7469 746c              titl
-00004bf0: 6520 3d20 2748 6572 6520 6973 2061 2073  e = 'Here is a s
-00004c00: 6571 7565 6e63 6520 6f66 2073 7465 7073  equence of steps
-00004c10: 2072 6571 7569 7265 6420 746f 2063 6f6d   required to com
-00004c20: 706c 6574 6520 7468 6520 7461 736b 3a27  plete the task:'
-00004c30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00004c40: 2020 2020 2020 7461 736b 203d 2074 6173        task = tas
-00004c50: 6b5f 6576 616c 0d0a 2020 2020 2020 2020  k_eval..        
-00004c60: 2020 2020 2020 2020 2020 2020 6469 7370              disp
-00004c70: 6c61 795f 6576 616c 2874 6173 6b5f 6576  lay_eval(task_ev
-00004c80: 616c 2c20 7469 746c 652c 2074 6f74 616c  al, title, total
-00004c90: 5f74 6f6b 656e 735f 7573 6564 5f73 756d  _tokens_used_sum
-00004ca0: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-00004cb0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00004cc0: 2020 2020 2020 7461 736b 203d 2071 7565        task = que
-00004cd0: 7374 696f 6e0d 0a0d 0a20 2020 2020 2020  stion....       
-00004ce0: 2020 2020 2023 2043 616c 6c20 7468 6520       # Call the 
-00004cf0: 7064 5f61 6765 6e74 206d 6574 686f 6420  pd_agent method 
-00004d00: 7769 7468 2074 6865 2075 7365 7227 7320  with the user's 
-00004d10: 7175 6573 7469 6f6e 2c20 7468 6520 6d65  question, the me
-00004d20: 7373 6167 6573 206c 6973 742c 2061 6e64  ssages list, and
-00004d30: 2074 6865 2064 6174 6166 7261 6d65 0d0a   the dataframe..
-00004d40: 2020 2020 2020 2020 2020 2020 616e 7377              answ
-00004d50: 6572 2c20 636f 6465 2c20 746f 7461 6c5f  er, code, total_
-00004d60: 746f 6b65 6e73 5f75 7365 645f 7375 6d20  tokens_used_sum 
-00004d70: 3d20 7365 6c66 2e70 645f 6167 656e 7428  = self.pd_agent(
-00004d80: 7461 736b 2c20 6d65 7373 6167 6573 2c20  task, messages, 
-00004d90: 7365 6c66 2e64 6629 0d0a 0d0a 2020 2020  self.df)....    
-00004da0: 2020 2020 2020 2020 2320 5261 6e6b 2074          # Rank t
-00004db0: 6865 204c 4c4d 2072 6573 706f 6e73 650d  he LLM response.
-00004dc0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00004dd0: 7365 6c66 2e72 616e 6b3a 0d0a 2020 2020  self.rank:..    
-00004de0: 2020 2020 2020 2020 2020 2020 2320 5377              # Sw
-00004df0: 6974 6368 2074 6f20 6770 742d 3420 6966  itch to gpt-4 if
-00004e00: 206c 6c6d 5f73 7769 7463 6820 7061 7261   llm_switch para
-00004e10: 6d65 7465 7220 6973 2073 6574 2074 6f20  meter is set to 
-00004e20: 5472 7565 2e20 5468 6973 2077 696c 6c20  True. This will 
-00004e30: 696e 6372 6561 7365 2074 6865 2070 726f  increase the pro
-00004e40: 6365 7373 696e 6720 7469 6d65 2061 6e64  cessing time and
-00004e50: 2063 6f73 740d 0a20 2020 2020 2020 2020   cost..         
-00004e60: 2020 2020 2020 2069 6620 7365 6c66 2e6c         if self.l
-00004e70: 6c6d 5f73 7769 7463 683a 0d0a 2020 2020  lm_switch:..    
-00004e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004e90: 6c6c 6d5f 6361 7363 6164 6520 3d20 5472  llm_cascade = Tr
-00004ea0: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-00004eb0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00004ec0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00004ed0: 6c6d 5f63 6173 6361 6465 203d 2046 616c  lm_cascade = Fal
-00004ee0: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
-00004ef0: 2020 2020 7261 6e6b 203d 2073 656c 662e      rank = self.
-00004f00: 7261 6e6b 5f63 6f64 6528 636f 6465 2c74  rank_code(code,t
-00004f10: 6173 6b2c 6c6c 6d5f 6361 7363 6164 653d  ask,llm_cascade=
-00004f20: 6c6c 6d5f 6361 7363 6164 6529 0d0a 2020  llm_cascade)..  
-00004f30: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-00004f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004f50: 2072 616e 6b20 3d20 2222 0d0a 0d0a 2020   rank = ""....  
-00004f60: 2020 2020 2020 2020 2020 6469 7370 6c61            displa
-00004f70: 795f 7265 7375 6c74 7328 616e 7377 6572  y_results(answer
-00004f80: 2c20 636f 6465 2c20 7261 6e6b 2c20 746f  , code, rank, to
-00004f90: 7461 6c5f 746f 6b65 6e73 5f75 7365 645f  tal_tokens_used_
-00004fa0: 7375 6d29 0d0a 0d0a 0d0a 2020 2020 6465  sum)......    de
-00004fb0: 6620 7064 5f61 6765 6e74 2873 656c 662c  f pd_agent(self,
-00004fc0: 2071 7565 7374 696f 6e2c 206d 6573 7361   question, messa
-00004fd0: 6765 732c 2064 663d 4e6f 6e65 293a 0d0a  ges, df=None):..
-00004fe0: 2020 2020 2020 2020 2320 4164 6420 6120          # Add a 
-00004ff0: 7573 6572 206d 6573 7361 6765 2077 6974  user message wit
-00005000: 6820 7468 6520 7570 6461 7465 6420 7461  h the updated ta
-00005010: 736b 2070 726f 6d70 7420 746f 2074 6865  sk prompt to the
-00005020: 206d 6573 7361 6765 7320 6c69 7374 0d0a   messages list..
-00005030: 2020 2020 2020 2020 6d65 7373 6167 6573          messages
-00005040: 2e61 7070 656e 6428 7b22 726f 6c65 223a  .append({"role":
-00005050: 2022 7573 6572 222c 2022 636f 6e74 656e   "user", "conten
-00005060: 7422 3a20 7365 6c66 2e74 6173 6b2e 666f  t": self.task.fo
-00005070: 726d 6174 2873 656c 662e 6466 5f68 6561  rmat(self.df_hea
-00005080: 642c 2071 7565 7374 696f 6e29 7d29 0d0a  d, question)})..
-00005090: 0d0a 2020 2020 2020 2020 6966 2027 6970  ..        if 'ip
-000050a0: 796b 6572 6e65 6c27 2069 6e20 7379 732e  ykernel' in sys.
-000050b0: 6d6f 6475 6c65 733a 0d0a 2020 2020 2020  modules:..      
-000050c0: 2020 2020 2020 2320 4a75 7079 7465 7220        # Jupyter 
-000050d0: 6e6f 7465 626f 6f6b 206f 7220 6970 7974  notebook or ipyt
-000050e0: 686f 6e0d 0a20 2020 2020 2020 2020 2020  hon..           
-000050f0: 2064 6973 706c 6179 2848 544d 4c28 6627   display(HTML(f'
-00005100: 3c70 2073 7479 6c65 3d22 636f 6c6f 723a  <p style="color:
-00005110: 6d61 6765 6e74 613b 223e 5c6e 4361 6c6c  magenta;">\nCall
-00005120: 696e 6720 4d6f 6465 6c3a 207b 7365 6c66  ing Model: {self
-00005130: 2e6c 6c6d 7d3c 2f70 3e27 2929 0d0a 2020  .llm}</p>'))..  
-00005140: 2020 2020 2020 2020 2020 6469 7370 6c61            displa
-00005150: 7928 4854 4d4c 2866 273c 703e 3c62 2073  y(HTML(f'<p><b s
-00005160: 7479 6c65 3d22 636f 6c6f 723a 6d61 6765  tyle="color:mage
-00005170: 6e74 613b 223e 4920 6861 7665 2073 656e  nta;">I have sen
-00005180: 7420 796f 7572 2072 6571 7565 7374 2074  t your request t
-00005190: 6f20 7468 6520 4c4c 4d20 616e 6420 6177  o the LLM and aw
-000051a0: 6169 7469 6e67 2072 6573 706f 6e73 652c  aiting response,
-000051b0: 2070 6c65 6173 6520 7761 6974 2e2e 2e3c   please wait...<
-000051c0: 2f62 3e3c 2f70 3e3c 6272 3e27 2929 0d0a  /b></p><br>'))..
-000051d0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-000051e0: 2020 2020 2020 2020 2020 2023 204f 7468             # Oth
-000051f0: 6572 2065 6e76 6972 6f6e 6d65 6e74 2028  er environment (
-00005200: 6c69 6b65 2074 6572 6d69 6e61 6c29 0d0a  like terminal)..
-00005210: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00005220: 7428 636f 6c6f 7265 6428 6622 5c6e 3e3e  t(colored(f"\n>>
-00005230: 2043 616c 6c69 6e67 204d 6f64 656c 3a20   Calling Model: 
-00005240: 7b73 656c 662e 6c6c 6d7d 222c 2022 6d61  {self.llm}", "ma
-00005250: 6765 6e74 6122 2929 0d0a 2020 2020 2020  genta"))..      
-00005260: 2020 2020 2020 6370 7269 6e74 2866 225c        cprint(f"\
-00005270: 6e3e 3e20 4920 6861 7665 2073 656e 7420  n>> I have sent 
-00005280: 796f 7572 2072 6571 7565 7374 2074 6f20  your request to 
-00005290: 7468 6520 4c4c 4d20 616e 6420 6177 6169  the LLM and awai
-000052a0: 7469 6e67 2072 6573 706f 6e73 652c 2070  ting response, p
-000052b0: 6c65 6173 6520 7761 6974 2e2e 2e5c 6e22  lease wait...\n"
-000052c0: 2c20 276d 6167 656e 7461 272c 2061 7474  , 'magenta', att
-000052d0: 7273 3d5b 2762 6f6c 6427 5d29 0d0a 0d0a  rs=['bold'])....
-000052e0: 2020 2020 2020 2020 2320 4361 6c6c 2074          # Call t
-000052f0: 6865 204f 7065 6e41 4920 4150 490d 0a20  he OpenAI API.. 
-00005300: 2020 2020 2020 206c 6c6d 5f72 6573 706f         llm_respo
-00005310: 6e73 652c 2074 6f6b 656e 735f 7573 6564  nse, tokens_used
-00005320: 203d 2073 656c 662e 6c6c 6d5f 6361 6c6c   = self.llm_call
-00005330: 286d 6573 7361 6765 7329 0d0a 0d0a 2020  (messages)....  
-00005340: 2020 2020 2020 2320 4578 7472 6163 7420        # Extract 
-00005350: 7468 6520 636f 6465 2066 726f 6d20 7468  the code from th
-00005360: 6520 4150 4920 7265 7370 6f6e 7365 0d0a  e API response..
-00005370: 2020 2020 2020 2020 636f 6465 203d 2073          code = s
-00005380: 656c 662e 5f65 7874 7261 6374 5f63 6f64  elf._extract_cod
-00005390: 6528 6c6c 6d5f 7265 7370 6f6e 7365 290d  e(llm_response).
-000053a0: 0a0d 0a20 2020 2020 2020 2023 2055 7064  ...        # Upd
-000053b0: 6174 6520 7468 6520 746f 7461 6c20 746f  ate the total to
-000053c0: 6b65 6e73 2075 7365 640d 0a20 2020 2020  kens used..     
-000053d0: 2020 2073 656c 662e 746f 7461 6c5f 746f     self.total_to
-000053e0: 6b65 6e73 5f75 7365 642e 6170 7065 6e64  kens_used.append
-000053f0: 2874 6f6b 656e 735f 7573 6564 290d 0a0d  (tokens_used)...
-00005400: 0a20 2020 2020 2020 2023 2049 6e69 7469  .        # Initi
-00005410: 616c 697a 6520 6572 726f 7220 636f 7272  alize error corr
-00005420: 6563 7469 6f6e 2063 6f75 6e74 6572 0d0a  ection counter..
-00005430: 2020 2020 2020 2020 6572 726f 725f 636f          error_co
-00005440: 7272 6563 7469 6f6e 7320 3d20 300d 0a0d  rrections = 0...
-00005450: 0a20 2020 2020 2020 2023 2044 6562 7567  .        # Debug
-00005460: 2063 6f64 6520 6966 2064 6562 7567 2070   code if debug p
-00005470: 6172 616d 6574 6572 2069 7320 7365 7420  arameter is set 
-00005480: 746f 2054 7275 650d 0a20 2020 2020 2020  to True..       
-00005490: 2069 6620 7365 6c66 2e64 6562 7567 3a0d   if self.debug:.
-000054a0: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
-000054b0: 7769 7463 6820 746f 2067 7074 2d34 2069  witch to gpt-4 i
-000054c0: 6620 6c6c 6d5f 7377 6974 6368 2070 6172  f llm_switch par
-000054d0: 616d 6574 6572 2069 7320 7365 7420 746f  ameter is set to
-000054e0: 2054 7275 652e 2054 6869 7320 7769 6c6c   True. This will
-000054f0: 2069 6e63 7265 6173 6520 7468 6520 7072   increase the pr
-00005500: 6f63 6573 7369 6e67 2074 696d 6520 616e  ocessing time an
-00005510: 6420 636f 7374 0d0a 2020 2020 2020 2020  d cost..        
-00005520: 2020 2020 6966 2073 656c 662e 6c6c 6d5f      if self.llm_
-00005530: 7377 6974 6368 3a0d 0a20 2020 2020 2020  switch:..       
-00005540: 2020 2020 2020 2020 206c 6c6d 5f63 6173           llm_cas
-00005550: 6361 6465 203d 2054 7275 650d 0a20 2020  cade = True..   
-00005560: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00005570: 2769 7079 6b65 726e 656c 2720 696e 2073  'ipykernel' in s
-00005580: 7973 2e6d 6f64 756c 6573 3a0d 0a20 2020  ys.modules:..   
-00005590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000055a0: 2023 204a 7570 7974 6572 206e 6f74 6562   # Jupyter noteb
-000055b0: 6f6f 6b0d 0a20 2020 2020 2020 2020 2020  ook..           
-000055c0: 2020 2020 2020 2020 2064 6973 706c 6179           display
-000055d0: 2848 544d 4c28 273c 7370 616e 2073 7479  (HTML('<span sty
-000055e0: 6c65 3d22 636f 6c6f 723a 206d 6167 656e  le="color: magen
-000055f0: 7461 3b22 3e53 7769 7463 6869 6e67 206d  ta;">Switching m
-00005600: 6f64 656c 2074 6f20 6770 742d 3420 746f  odel to gpt-4 to
-00005610: 2064 6562 7567 2074 6865 2063 6f64 652e   debug the code.
-00005620: 3c2f 7370 616e 3e27 2929 0d0a 2020 2020  </span>'))..    
-00005630: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00004a40: 6576 616c 5f6d 6573 7361 6765 732e 706f  eval_messages.po
+00004a50: 7028 3129 0d0a 2020 2020 2020 2020 2020  p(1)..          
+00004a60: 2020 2020 2020 2020 2020 6576 616c 5f6d            eval_m
+00004a70: 6573 7361 6765 732e 706f 7028 3129 0d0a  essages.pop(1)..
+00004a80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004a90: 2020 746f 7461 6c5f 746f 6b65 6e73 5f75    total_tokens_u
+00004aa0: 7365 645f 7375 6d20 3d20 7375 6d28 7365  sed_sum = sum(se
+00004ab0: 6c66 2e74 6f74 616c 5f74 6f6b 656e 735f  lf.total_tokens_
+00004ac0: 7573 6564 290d 0a0d 0a20 2020 2020 2020  used)....       
+00004ad0: 2020 2020 2020 2020 2069 6620 7461 736b           if task
+00004ae0: 5f74 7970 6520 3d3d 2027 6e61 7272 6174  _type == 'narrat
+00004af0: 6976 6527 3a0d 0a20 2020 2020 2020 2020  ive':..         
+00004b00: 2020 2020 2020 2020 2020 2074 6974 6c65             title
+00004b10: 203d 2027 4865 7265 2069 7320 616e 2061   = 'Here is an a
+00004b20: 6e73 7765 7220 746f 2079 6f75 7220 7175  nswer to your qu
+00004b30: 6573 7469 6f6e 3a27 2020 2020 2020 2020  estion:'        
+00004b40: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
+00004b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004b60: 2064 6973 706c 6179 5f65 7661 6c28 7461   display_eval(ta
+00004b70: 736b 5f65 7661 6c2c 2074 6974 6c65 2c20  sk_eval, title, 
+00004b80: 746f 7461 6c5f 746f 6b65 6e73 5f75 7365  total_tokens_use
+00004b90: 645f 7375 6d29 0d0a 2020 2020 2020 2020  d_sum)..        
+00004ba0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00004bb0: 696e 7565 0d0a 2020 2020 2020 2020 2020  inue..          
+00004bc0: 2020 2020 2020 6966 2074 6173 6b5f 7479        if task_ty
+00004bd0: 7065 203d 3d20 2766 6f6c 6c6f 775f 7570  pe == 'follow_up
+00004be0: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
+00004bf0: 2020 2020 2020 2020 7469 746c 6520 3d20          title = 
+00004c00: 2754 6f20 6265 2061 626c 6520 746f 2061  'To be able to a
+00004c10: 6e73 7765 7220 796f 7572 2071 7565 7374  nswer your quest
+00004c20: 696f 6e2c 2049 2061 6d20 676f 696e 6720  ion, I am going 
+00004c30: 746f 206e 6565 6420 736f 6d65 206d 6f72  to need some mor
+00004c40: 6520 696e 666f 3a27 2020 2020 2020 2020  e info:'        
+00004c50: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
+00004c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004c70: 2064 6973 706c 6179 5f65 7661 6c28 7461   display_eval(ta
+00004c80: 736b 5f65 7661 6c2c 2074 6974 6c65 2c20  sk_eval, title, 
+00004c90: 746f 7461 6c5f 746f 6b65 6e73 5f75 7365  total_tokens_use
+00004ca0: 645f 7375 6d29 0d0a 2020 2020 2020 2020  d_sum)..        
+00004cb0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00004cc0: 696e 7565 0d0a 2020 2020 2020 2020 2020  inue..          
+00004cd0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00004ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004cf0: 2074 6974 6c65 203d 2027 4865 7265 2069   title = 'Here i
+00004d00: 7320 6120 7365 7175 656e 6365 206f 6620  s a sequence of 
+00004d10: 7374 6570 7320 7265 7175 6972 6564 2074  steps required t
+00004d20: 6f20 636f 6d70 6c65 7465 2074 6865 2074  o complete the t
+00004d30: 6173 6b3a 270d 0a20 2020 2020 2020 2020  ask:'..         
+00004d40: 2020 2020 2020 2020 2020 2074 6173 6b20             task 
+00004d50: 3d20 7461 736b 5f65 7661 6c0d 0a20 2020  = task_eval..   
+00004d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004d70: 2064 6973 706c 6179 5f65 7661 6c28 7461   display_eval(ta
+00004d80: 736b 5f65 7661 6c2c 2074 6974 6c65 2c20  sk_eval, title, 
+00004d90: 746f 7461 6c5f 746f 6b65 6e73 5f75 7365  total_tokens_use
+00004da0: 645f 7375 6d29 0d0a 2020 2020 2020 2020  d_sum)..        
+00004db0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00004dc0: 2020 2020 2020 2020 2020 2074 6173 6b20             task 
+00004dd0: 3d20 7175 6573 7469 6f6e 0d0a 0d0a 2020  = question....  
+00004de0: 2020 2020 2020 2020 2020 2320 4361 6c6c            # Call
+00004df0: 2074 6865 2070 645f 6167 656e 7420 6d65   the pd_agent me
+00004e00: 7468 6f64 2077 6974 6820 7468 6520 7573  thod with the us
+00004e10: 6572 2773 2071 7565 7374 696f 6e2c 2074  er's question, t
+00004e20: 6865 206d 6573 7361 6765 7320 6c69 7374  he messages list
+00004e30: 2c20 616e 6420 7468 6520 6461 7461 6672  , and the datafr
+00004e40: 616d 650d 0a20 2020 2020 2020 2020 2020  ame..           
+00004e50: 2061 6e73 7765 722c 2063 6f64 652c 2074   answer, code, t
+00004e60: 6f74 616c 5f74 6f6b 656e 735f 7573 6564  otal_tokens_used
+00004e70: 5f73 756d 203d 2073 656c 662e 7064 5f61  _sum = self.pd_a
+00004e80: 6765 6e74 2874 6173 6b2c 206d 6573 7361  gent(task, messa
+00004e90: 6765 732c 2073 656c 662e 6466 290d 0a0d  ges, self.df)...
+00004ea0: 0a20 2020 2020 2020 2020 2020 2023 2052  .            # R
+00004eb0: 616e 6b20 7468 6520 4c4c 4d20 7265 7370  ank the LLM resp
+00004ec0: 6f6e 7365 0d0a 2020 2020 2020 2020 2020  onse..          
+00004ed0: 2020 6966 2073 656c 662e 7261 6e6b 3a0d    if self.rank:.
+00004ee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004ef0: 2023 2053 7769 7463 6820 746f 2067 7074   # Switch to gpt
+00004f00: 2d34 2069 6620 6c6c 6d5f 7377 6974 6368  -4 if llm_switch
+00004f10: 2070 6172 616d 6574 6572 2069 7320 7365   parameter is se
+00004f20: 7420 746f 2054 7275 652e 2054 6869 7320  t to True. This 
+00004f30: 7769 6c6c 2069 6e63 7265 6173 6520 7468  will increase th
+00004f40: 6520 7072 6f63 6573 7369 6e67 2074 696d  e processing tim
+00004f50: 6520 616e 6420 636f 7374 0d0a 2020 2020  e and cost..    
+00004f60: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00004f70: 656c 662e 6c6c 6d5f 7377 6974 6368 3a0d  elf.llm_switch:.
+00004f80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004f90: 2020 2020 206c 6c6d 5f63 6173 6361 6465       llm_cascade
+00004fa0: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
+00004fb0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+00004fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004fd0: 2020 2020 6c6c 6d5f 6361 7363 6164 6520      llm_cascade 
+00004fe0: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
+00004ff0: 2020 2020 2020 2020 2072 616e 6b20 3d20           rank = 
+00005000: 7365 6c66 2e72 616e 6b5f 636f 6465 2863  self.rank_code(c
+00005010: 6f64 652c 7461 736b 2c6c 6c6d 5f63 6173  ode,task,llm_cas
+00005020: 6361 6465 3d6c 6c6d 5f63 6173 6361 6465  cade=llm_cascade
+00005030: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
+00005040: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00005050: 2020 2020 2020 7261 6e6b 203d 2022 220d        rank = "".
+00005060: 0a0d 0a20 2020 2020 2020 2020 2020 2064  ...            d
+00005070: 6973 706c 6179 5f72 6573 756c 7473 2861  isplay_results(a
+00005080: 6e73 7765 722c 2063 6f64 652c 2072 616e  nswer, code, ran
+00005090: 6b2c 2074 6f74 616c 5f74 6f6b 656e 735f  k, total_tokens_
+000050a0: 7573 6564 5f73 756d 290d 0a0d 0a0d 0a20  used_sum)...... 
+000050b0: 2020 2064 6566 2070 645f 6167 656e 7428     def pd_agent(
+000050c0: 7365 6c66 2c20 7175 6573 7469 6f6e 2c20  self, question, 
+000050d0: 6d65 7373 6167 6573 2c20 6466 3d4e 6f6e  messages, df=Non
+000050e0: 6529 3a0d 0a20 2020 2020 2020 2023 2041  e):..        # A
+000050f0: 6464 2061 2075 7365 7220 6d65 7373 6167  dd a user messag
+00005100: 6520 7769 7468 2074 6865 2075 7064 6174  e with the updat
+00005110: 6564 2074 6173 6b20 7072 6f6d 7074 2074  ed task prompt t
+00005120: 6f20 7468 6520 6d65 7373 6167 6573 206c  o the messages l
+00005130: 6973 740d 0a20 2020 2020 2020 206d 6573  ist..        mes
+00005140: 7361 6765 732e 6170 7065 6e64 287b 2272  sages.append({"r
+00005150: 6f6c 6522 3a20 2275 7365 7222 2c20 2263  ole": "user", "c
+00005160: 6f6e 7465 6e74 223a 2073 656c 662e 7573  ontent": self.us
+00005170: 6572 5f74 6173 6b2e 666f 726d 6174 2873  er_task.format(s
+00005180: 656c 662e 6466 5f68 6561 642c 2071 7565  elf.df_head, que
+00005190: 7374 696f 6e29 7d29 0d0a 0d0a 2020 2020  stion)})....    
+000051a0: 2020 2020 6966 2027 6970 796b 6572 6e65      if 'ipykerne
+000051b0: 6c27 2069 6e20 7379 732e 6d6f 6475 6c65  l' in sys.module
+000051c0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+000051d0: 2320 4a75 7079 7465 7220 6e6f 7465 626f  # Jupyter notebo
+000051e0: 6f6b 206f 7220 6970 7974 686f 6e0d 0a20  ok or ipython.. 
+000051f0: 2020 2020 2020 2020 2020 2064 6973 706c             displ
+00005200: 6179 2848 544d 4c28 6627 3c70 2073 7479  ay(HTML(f'<p sty
+00005210: 6c65 3d22 636f 6c6f 723a 6d61 6765 6e74  le="color:magent
+00005220: 613b 223e 5c6e 4361 6c6c 696e 6720 4d6f  a;">\nCalling Mo
+00005230: 6465 6c3a 207b 7365 6c66 2e6c 6c6d 7d3c  del: {self.llm}<
+00005240: 2f70 3e27 2929 0d0a 2020 2020 2020 2020  /p>'))..        
+00005250: 2020 2020 6469 7370 6c61 7928 4854 4d4c      display(HTML
+00005260: 2866 273c 703e 3c62 2073 7479 6c65 3d22  (f'<p><b style="
+00005270: 636f 6c6f 723a 6d61 6765 6e74 613b 223e  color:magenta;">
+00005280: 4920 6861 7665 2073 656e 7420 796f 7572  I have sent your
+00005290: 2072 6571 7565 7374 2074 6f20 7468 6520   request to the 
+000052a0: 4c4c 4d20 616e 6420 6177 6169 7469 6e67  LLM and awaiting
+000052b0: 2072 6573 706f 6e73 652c 2070 6c65 6173   response, pleas
+000052c0: 6520 7761 6974 2e2e 2e3c 2f62 3e3c 2f70  e wait...</b></p
+000052d0: 3e3c 6272 3e27 2929 0d0a 2020 2020 2020  ><br>'))..      
+000052e0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+000052f0: 2020 2020 2023 204f 7468 6572 2065 6e76       # Other env
+00005300: 6972 6f6e 6d65 6e74 2028 6c69 6b65 2074  ironment (like t
+00005310: 6572 6d69 6e61 6c29 0d0a 2020 2020 2020  erminal)..      
+00005320: 2020 2020 2020 7072 696e 7428 636f 6c6f        print(colo
+00005330: 7265 6428 6622 5c6e 3e3e 2043 616c 6c69  red(f"\n>> Calli
+00005340: 6e67 204d 6f64 656c 3a20 7b73 656c 662e  ng Model: {self.
+00005350: 6c6c 6d7d 222c 2022 6d61 6765 6e74 6122  llm}", "magenta"
+00005360: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00005370: 6370 7269 6e74 2866 225c 6e3e 3e20 4920  cprint(f"\n>> I 
+00005380: 6861 7665 2073 656e 7420 796f 7572 2072  have sent your r
+00005390: 6571 7565 7374 2074 6f20 7468 6520 4c4c  equest to the LL
+000053a0: 4d20 616e 6420 6177 6169 7469 6e67 2072  M and awaiting r
+000053b0: 6573 706f 6e73 652c 2070 6c65 6173 6520  esponse, please 
+000053c0: 7761 6974 2e2e 2e5c 6e22 2c20 276d 6167  wait...\n", 'mag
+000053d0: 656e 7461 272c 2061 7474 7273 3d5b 2762  enta', attrs=['b
+000053e0: 6f6c 6427 5d29 0d0a 0d0a 2020 2020 2020  old'])....      
+000053f0: 2020 2320 4361 6c6c 2074 6865 204f 7065    # Call the Ope
+00005400: 6e41 4920 4150 490d 0a20 2020 2020 2020  nAI API..       
+00005410: 206c 6c6d 5f72 6573 706f 6e73 652c 2074   llm_response, t
+00005420: 6f6b 656e 735f 7573 6564 203d 2073 656c  okens_used = sel
+00005430: 662e 6c6c 6d5f 6361 6c6c 286d 6573 7361  f.llm_call(messa
+00005440: 6765 7329 0d0a 0d0a 2020 2020 2020 2020  ges)....        
+00005450: 2320 4578 7472 6163 7420 7468 6520 636f  # Extract the co
+00005460: 6465 2066 726f 6d20 7468 6520 4150 4920  de from the API 
+00005470: 7265 7370 6f6e 7365 0d0a 2020 2020 2020  response..      
+00005480: 2020 636f 6465 203d 2073 656c 662e 5f65    code = self._e
+00005490: 7874 7261 6374 5f63 6f64 6528 6c6c 6d5f  xtract_code(llm_
+000054a0: 7265 7370 6f6e 7365 290d 0a0d 0a20 2020  response)....   
+000054b0: 2020 2020 2023 2055 7064 6174 6520 7468       # Update th
+000054c0: 6520 746f 7461 6c20 746f 6b65 6e73 2075  e total tokens u
+000054d0: 7365 640d 0a20 2020 2020 2020 2073 656c  sed..        sel
+000054e0: 662e 746f 7461 6c5f 746f 6b65 6e73 5f75  f.total_tokens_u
+000054f0: 7365 642e 6170 7065 6e64 2874 6f6b 656e  sed.append(token
+00005500: 735f 7573 6564 290d 0a0d 0a20 2020 2020  s_used)....     
+00005510: 2020 2023 2049 6e69 7469 616c 697a 6520     # Initialize 
+00005520: 6572 726f 7220 636f 7272 6563 7469 6f6e  error correction
+00005530: 2063 6f75 6e74 6572 0d0a 2020 2020 2020   counter..      
+00005540: 2020 6572 726f 725f 636f 7272 6563 7469    error_correcti
+00005550: 6f6e 7320 3d20 300d 0a0d 0a20 2020 2020  ons = 0....     
+00005560: 2020 2023 2044 6562 7567 2063 6f64 6520     # Debug code 
+00005570: 6966 2064 6562 7567 2070 6172 616d 6574  if debug paramet
+00005580: 6572 2069 7320 7365 7420 746f 2054 7275  er is set to Tru
+00005590: 650d 0a20 2020 2020 2020 2069 6620 7365  e..        if se
+000055a0: 6c66 2e64 6562 7567 3a0d 0a20 2020 2020  lf.debug:..     
+000055b0: 2020 2020 2020 2023 2053 7769 7463 6820         # Switch 
+000055c0: 746f 2067 7074 2d34 2069 6620 6c6c 6d5f  to gpt-4 if llm_
+000055d0: 7377 6974 6368 2070 6172 616d 6574 6572  switch parameter
+000055e0: 2069 7320 7365 7420 746f 2054 7275 652e   is set to True.
+000055f0: 2054 6869 7320 7769 6c6c 2069 6e63 7265   This will incre
+00005600: 6173 6520 7468 6520 7072 6f63 6573 7369  ase the processi
+00005610: 6e67 2074 696d 6520 616e 6420 636f 7374  ng time and cost
+00005620: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00005630: 2073 656c 662e 6c6c 6d5f 7377 6974 6368   self.llm_switch
 00005640: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00005650: 2020 2020 2020 2023 2043 4c49 0d0a 2020         # CLI..  
-00005660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005670: 2020 7072 696e 7428 636f 6c6f 7265 6428    print(colored(
-00005680: 225c 6e3e 3e20 5377 6974 6368 696e 6720  "\n>> Switching 
-00005690: 6d6f 6465 6c20 746f 2047 5054 2d34 2074  model to GPT-4 t
-000056a0: 6f20 6465 6275 6720 7468 6520 636f 6465  o debug the code
-000056b0: 2e22 2c20 226d 6167 656e 7461 2229 290d  .", "magenta")).
-000056c0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-000056d0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000056e0: 2020 2020 6c6c 6d5f 6361 7363 6164 6520      llm_cascade 
-000056f0: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
-00005700: 2020 2020 2063 6f64 6520 3d20 7365 6c66       code = self
-00005710: 2e64 6562 7567 5f63 6f64 6528 636f 6465  .debug_code(code
-00005720: 2c20 7175 6573 7469 6f6e 2c20 6c6c 6d5f  , question, llm_
-00005730: 6361 7363 6164 653d 6c6c 6d5f 6361 7363  cascade=llm_casc
-00005740: 6164 6529 0d0a 0d0a 2020 2020 2020 2020  ade)....        
-00005750: 2320 5265 6469 7265 6374 2073 7461 6e64  # Redirect stand
-00005760: 6172 6420 6f75 7470 7574 2074 6f20 6120  ard output to a 
-00005770: 5374 7269 6e67 494f 2062 7566 6665 720d  StringIO buffer.
-00005780: 0a20 2020 2020 2020 2077 6974 6820 7265  .        with re
-00005790: 6469 7265 6374 5f73 7464 6f75 7428 696f  direct_stdout(io
-000057a0: 2e53 7472 696e 6749 4f28 2929 2061 7320  .StringIO()) as 
-000057b0: 6f75 7470 7574 3a0d 0a20 2020 2020 2020  output:..       
-000057c0: 2020 2020 2023 2054 7279 2074 6f20 6578       # Try to ex
-000057d0: 6563 7574 6520 7468 6520 636f 6465 2061  ecute the code a
-000057e0: 6e64 2068 616e 646c 6520 6572 726f 7273  nd handle errors
-000057f0: 0d0a 2020 2020 2020 2020 2020 2020 7768  ..            wh
-00005800: 696c 6520 6572 726f 725f 636f 7272 6563  ile error_correc
-00005810: 7469 6f6e 7320 3c20 7365 6c66 2e4d 4158  tions < self.MAX
-00005820: 5f45 5252 4f52 5f43 4f52 5245 4354 494f  _ERROR_CORRECTIO
-00005830: 4e53 3a0d 0a20 2020 2020 2020 2020 2020  NS:..           
-00005840: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-00005850: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00005860: 6573 7361 6765 732e 6170 7065 6e64 287b  essages.append({
-00005870: 2272 6f6c 6522 3a20 2261 7373 6973 7461  "role": "assista
-00005880: 6e74 222c 2022 636f 6e74 656e 7422 3a20  nt", "content": 
-00005890: 6c6c 6d5f 7265 7370 6f6e 7365 7d29 0d0a  llm_response})..
-000058a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000058b0: 2020 2020 2320 5265 6d6f 7665 2074 6865      # Remove the
-000058c0: 206f 6c64 6573 7420 636f 6e76 6572 7361   oldest conversa
-000058d0: 7469 6f6e 2066 726f 6d20 7468 6520 6d65  tion from the me
-000058e0: 7373 6167 6573 206c 6973 740d 0a20 2020  ssages list..   
-000058f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005900: 2069 6620 6c65 6e28 6d65 7373 6167 6573   if len(messages
-00005910: 2920 3e20 7365 6c66 2e4d 4158 5f43 4f4e  ) > self.MAX_CON
-00005920: 5645 5253 4154 494f 4e53 3a0d 0a20 2020  VERSATIONS:..   
-00005930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005940: 2020 2020 206d 6573 7361 6765 732e 706f       messages.po
-00005950: 7028 3129 0d0a 2020 2020 2020 2020 2020  p(1)..          
-00005960: 2020 2020 2020 2020 2020 2020 2020 6d65                me
-00005970: 7373 6167 6573 2e70 6f70 2831 290d 0a20  ssages.pop(1).. 
-00005980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005990: 2020 2023 2052 6573 6574 2064 6620 746f     # Reset df to
-000059a0: 2074 6865 206f 7269 6769 6e61 6c20 7374   the original st
-000059b0: 6174 6520 6265 666f 7265 2065 7865 6375  ate before execu
-000059c0: 7469 6e67 2074 6865 2063 6f64 650d 0a20  ting the code.. 
-000059d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000059e0: 2020 2073 656c 662e 6466 203d 2073 656c     self.df = sel
-000059f0: 662e 6f72 6967 696e 616c 5f64 662e 636f  f.original_df.co
-00005a00: 7079 2829 0d0a 2020 2020 2020 2020 2020  py()..          
-00005a10: 2020 2020 2020 2020 2020 2320 4578 6563            # Exec
-00005a20: 7574 6520 7468 6520 636f 6465 0d0a 2020  ute the code..  
-00005a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005a40: 2020 6966 2063 6f64 6520 6973 206e 6f74    if code is not
-00005a50: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00005650: 2020 206c 6c6d 5f63 6173 6361 6465 203d     llm_cascade =
+00005660: 2054 7275 650d 0a20 2020 2020 2020 2020   True..         
+00005670: 2020 2020 2020 2069 6620 2769 7079 6b65         if 'ipyke
+00005680: 726e 656c 2720 696e 2073 7973 2e6d 6f64  rnel' in sys.mod
+00005690: 756c 6573 3a0d 0a20 2020 2020 2020 2020  ules:..         
+000056a0: 2020 2020 2020 2020 2020 2023 204a 7570             # Jup
+000056b0: 7974 6572 206e 6f74 6562 6f6f 6b0d 0a20  yter notebook.. 
+000056c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000056d0: 2020 2064 6973 706c 6179 2848 544d 4c28     display(HTML(
+000056e0: 273c 7370 616e 2073 7479 6c65 3d22 636f  '<span style="co
+000056f0: 6c6f 723a 206d 6167 656e 7461 3b22 3e53  lor: magenta;">S
+00005700: 7769 7463 6869 6e67 206d 6f64 656c 2074  witching model t
+00005710: 6f20 6770 742d 3420 746f 2064 6562 7567  o gpt-4 to debug
+00005720: 2074 6865 2063 6f64 652e 3c2f 7370 616e   the code.</span
+00005730: 3e27 2929 0d0a 2020 2020 2020 2020 2020  >'))..          
+00005740: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00005750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005760: 2023 2043 4c49 0d0a 2020 2020 2020 2020   # CLI..        
+00005770: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00005780: 7428 636f 6c6f 7265 6428 225c 6e3e 3e20  t(colored("\n>> 
+00005790: 5377 6974 6368 696e 6720 6d6f 6465 6c20  Switching model 
+000057a0: 746f 2047 5054 2d34 2074 6f20 6465 6275  to GPT-4 to debu
+000057b0: 6720 7468 6520 636f 6465 2e22 2c20 226d  g the code.", "m
+000057c0: 6167 656e 7461 2229 290d 0a20 2020 2020  agenta"))..     
+000057d0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+000057e0: 2020 2020 2020 2020 2020 2020 2020 6c6c                ll
+000057f0: 6d5f 6361 7363 6164 6520 3d20 4661 6c73  m_cascade = Fals
+00005800: 650d 0a20 2020 2020 2020 2020 2020 2063  e..            c
+00005810: 6f64 6520 3d20 7365 6c66 2e64 6562 7567  ode = self.debug
+00005820: 5f63 6f64 6528 636f 6465 2c20 7175 6573  _code(code, ques
+00005830: 7469 6f6e 2c20 6c6c 6d5f 6361 7363 6164  tion, llm_cascad
+00005840: 653d 6c6c 6d5f 6361 7363 6164 6529 0d0a  e=llm_cascade)..
+00005850: 0d0a 2020 2020 2020 2020 2320 5265 6469  ..        # Redi
+00005860: 7265 6374 2073 7461 6e64 6172 6420 6f75  rect standard ou
+00005870: 7470 7574 2074 6f20 6120 5374 7269 6e67  tput to a String
+00005880: 494f 2062 7566 6665 720d 0a20 2020 2020  IO buffer..     
+00005890: 2020 2077 6974 6820 7265 6469 7265 6374     with redirect
+000058a0: 5f73 7464 6f75 7428 696f 2e53 7472 696e  _stdout(io.Strin
+000058b0: 6749 4f28 2929 2061 7320 6f75 7470 7574  gIO()) as output
+000058c0: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
+000058d0: 2054 7279 2074 6f20 6578 6563 7574 6520   Try to execute 
+000058e0: 7468 6520 636f 6465 2061 6e64 2068 616e  the code and han
+000058f0: 646c 6520 6572 726f 7273 0d0a 2020 2020  dle errors..    
+00005900: 2020 2020 2020 2020 7768 696c 6520 6572          while er
+00005910: 726f 725f 636f 7272 6563 7469 6f6e 7320  ror_corrections 
+00005920: 3c20 7365 6c66 2e4d 4158 5f45 5252 4f52  < self.MAX_ERROR
+00005930: 5f43 4f52 5245 4354 494f 4e53 3a0d 0a20  _CORRECTIONS:.. 
+00005940: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00005950: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+00005960: 2020 2020 2020 2020 206d 6573 7361 6765           message
+00005970: 732e 6170 7065 6e64 287b 2272 6f6c 6522  s.append({"role"
+00005980: 3a20 2261 7373 6973 7461 6e74 222c 2022  : "assistant", "
+00005990: 636f 6e74 656e 7422 3a20 6c6c 6d5f 7265  content": llm_re
+000059a0: 7370 6f6e 7365 7d29 0d0a 2020 2020 2020  sponse})..      
+000059b0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+000059c0: 5265 6d6f 7665 2074 6865 206f 6c64 6573  Remove the oldes
+000059d0: 7420 636f 6e76 6572 7361 7469 6f6e 2066  t conversation f
+000059e0: 726f 6d20 7468 6520 6d65 7373 6167 6573  rom the messages
+000059f0: 206c 6973 740d 0a20 2020 2020 2020 2020   list..         
+00005a00: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+00005a10: 6e28 6d65 7373 6167 6573 2920 3e20 7365  n(messages) > se
+00005a20: 6c66 2e4d 4158 5f43 4f4e 5645 5253 4154  lf.MAX_CONVERSAT
+00005a30: 494f 4e53 3a0d 0a20 2020 2020 2020 2020  IONS:..         
+00005a40: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00005a50: 6573 7361 6765 732e 706f 7028 3129 0d0a  essages.pop(1)..
 00005a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005a70: 6578 6563 2863 6f64 652c 207b 2764 6627  exec(code, {'df'
-00005a80: 3a20 7365 6c66 2e64 667d 290d 0a20 2020  : self.df})..   
-00005a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005aa0: 2062 7265 616b 0d0a 2020 2020 2020 2020   break..        
-00005ab0: 2020 2020 2020 2020 6578 6365 7074 2045          except E
-00005ac0: 7863 6570 7469 6f6e 2061 7320 653a 0d0a  xception as e:..
-00005ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005ae0: 2020 2020 2320 5072 696e 7420 7468 6520      # Print the 
-00005af0: 6572 726f 7220 6d65 7373 6167 650d 0a20  error message.. 
-00005b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b10: 2020 2069 6620 2769 7079 6b65 726e 656c     if 'ipykernel
-00005b20: 2720 696e 2073 7973 2e6d 6f64 756c 6573  ' in sys.modules
-00005b30: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00005b40: 2020 2020 2020 2020 2020 2023 204a 7570             # Jup
-00005b50: 7974 6572 206e 6f74 6562 6f6f 6b0d 0a20  yter notebook.. 
-00005b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b70: 2020 2020 2020 2064 6973 706c 6179 2848         display(H
-00005b80: 544d 4c28 6627 3c62 723e 3c62 3e3c 7370  TML(f'<br><b><sp
-00005b90: 616e 2073 7479 6c65 3d22 636f 6c6f 723a  an style="color:
-00005ba0: 2023 6438 3663 3030 3b22 3e49 2072 616e   #d86c00;">I ran
-00005bb0: 2069 6e74 6f20 616e 2069 7373 7565 3a3c   into an issue:<
-00005bc0: 2f73 7061 6e3e 3c2f 623e 3c62 723e 3c70  /span></b><br><p
-00005bd0: 7265 2073 7479 6c65 3d22 636f 6c6f 723a  re style="color:
-00005be0: 2023 6438 3663 3030 3b22 3e7b 657d 3c2f   #d86c00;">{e}</
-00005bf0: 7072 653e 3c62 723e 3c62 3e3c 7370 616e  pre><br><b><span
-00005c00: 2073 7479 6c65 3d22 636f 6c6f 723a 2023   style="color: #
-00005c10: 6438 3663 3030 3b22 3e49 2077 696c 6c20  d86c00;">I will 
-00005c20: 6578 616d 696e 6520 6974 2c20 616e 6420  examine it, and 
-00005c30: 7472 7920 6167 6169 6e20 7769 7468 2061  try again with a
-00005c40: 6e20 6164 6a75 7374 6564 2063 6f64 652e  n adjusted code.
-00005c50: 3c2f 7370 616e 3e3c 2f62 3e3c 6272 3e27  </span></b><br>'
-00005c60: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-00005c70: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00005c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005c90: 2020 2020 2020 2023 2043 4c49 0d0a 2020         # CLI..  
-00005ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005cb0: 2020 2020 2020 2370 7269 6e74 2863 6f6c        #print(col
-00005cc0: 6f72 6564 2866 2749 2072 616e 2069 6e74  ored(f'I ran int
-00005cd0: 6f20 616e 2069 7373 7565 3a20 7b65 7d2e  o an issue: {e}.
-00005ce0: 203e 2049 2077 696c 6c20 6578 616d 696e   > I will examin
-00005cf0: 6520 6974 2c20 616e 6420 7472 7920 6167  e it, and try ag
-00005d00: 6169 6e20 7769 7468 2061 6e20 6164 6a75  ain with an adju
-00005d10: 7374 6564 2063 6f64 652e 272c 2027 7265  sted code.', 're
-00005d20: 6427 2929 0d0a 2020 2020 2020 2020 2020  d'))..          
-00005d30: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-00005d40: 732e 7374 6465 7272 2e77 7269 7465 2827  s.stderr.write('
-00005d50: 5c30 3333 5b33 316d 2720 2b20 6627 3e3e  \033[31m' + f'>>
-00005d60: 2049 2072 616e 2069 6e74 6f20 616e 2069   I ran into an i
-00005d70: 7373 7565 3a20 7b65 7d2e 205c 6e3e 2049  ssue: {e}. \n> I
-00005d80: 2077 696c 6c20 6578 616d 696e 6520 6974   will examine it
-00005d90: 2c20 616e 6420 7472 7920 6167 6169 6e20  , and try again 
-00005da0: 7769 7468 2061 6e20 6164 6a75 7374 6564  with an adjusted
-00005db0: 2063 6f64 652e 2720 2b20 275c 3033 335b   code.' + '\033[
-00005dc0: 306d 2720 2b20 275c 6e27 290d 0a20 2020  0m' + '\n')..   
-00005dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005de0: 2020 2020 2073 7973 2e73 7464 6572 722e       sys.stderr.
-00005df0: 666c 7573 6828 290d 0a0d 0a20 2020 2020  flush()....     
-00005e00: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00005e10: 2049 6e63 7265 6d65 6e74 2074 6865 2065   Increment the e
-00005e20: 7272 6f72 2063 6f72 7265 6374 696f 6e20  rror correction 
-00005e30: 636f 756e 7465 7220 616e 6420 7570 6461  counter and upda
-00005e40: 7465 2074 6865 206d 6573 7361 6765 7320  te the messages 
-00005e50: 6c69 7374 2077 6974 6820 7468 6520 6572  list with the er
-00005e60: 726f 720d 0a20 2020 2020 2020 2020 2020  ror..           
-00005e70: 2020 2020 2020 2020 2065 7272 6f72 5f63           error_c
-00005e80: 6f72 7265 6374 696f 6e73 202b 3d20 310d  orrections += 1.
-00005e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005ea0: 2020 2020 206d 6573 7361 6765 732e 6170       messages.ap
-00005eb0: 7065 6e64 287b 2272 6f6c 6522 3a20 2275  pend({"role": "u
-00005ec0: 7365 7222 2c20 2263 6f6e 7465 6e74 223a  ser", "content":
-00005ed0: 2073 656c 662e 6572 726f 725f 636f 7272   self.error_corr
-00005ee0: 6563 745f 7461 736b 2e66 6f72 6d61 7428  ect_task.format(
-00005ef0: 6529 7d29 0d0a 0d0a 2020 2020 2020 2020  e)})....        
-00005f00: 2020 2020 2020 2020 2020 2020 2320 5377              # Sw
-00005f10: 6974 6368 2074 6f20 6770 742d 3420 6966  itch to gpt-4 if
-00005f20: 206c 6c6d 5f73 7769 7463 6820 7061 7261   llm_switch para
-00005f30: 6d65 7465 7220 6973 2073 6574 2074 6f20  meter is set to 
-00005f40: 5472 7565 2e20 5468 6973 2077 696c 6c20  True. This will 
-00005f50: 696e 6372 6561 7365 2074 6865 2070 726f  increase the pro
-00005f60: 6365 7373 696e 6720 7469 6d65 2061 6e64  cessing time and
-00005f70: 2063 6f73 742e 0d0a 2020 2020 2020 2020   cost...        
-00005f80: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00005f90: 656c 662e 6c6c 6d5f 7377 6974 6368 3a0d  elf.llm_switch:.
-00005fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005fb0: 2020 2020 2020 2020 206c 6c6d 5f63 6173           llm_cas
-00005fc0: 6361 6465 203d 2054 7275 650d 0a20 2020  cade = True..   
-00005fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005fe0: 2020 2020 2069 6620 2769 7079 6b65 726e       if 'ipykern
-00005ff0: 656c 2720 696e 2073 7973 2e6d 6f64 756c  el' in sys.modul
-00006000: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
-00006010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006020: 2023 204a 7570 7974 6572 206e 6f74 6562   # Jupyter noteb
-00006030: 6f6f 6b0d 0a20 2020 2020 2020 2020 2020  ook..           
-00006040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006050: 2064 6973 706c 6179 2848 544d 4c28 273c   display(HTML('<
-00006060: 7370 616e 2073 7479 6c65 3d22 636f 6c6f  span style="colo
-00006070: 723a 2023 6438 3663 3030 3b22 3e53 7769  r: #d86c00;">Swi
-00006080: 7463 6869 6e67 206d 6f64 656c 2074 6f20  tching model to 
-00006090: 6770 742d 3420 746f 2074 7279 2074 6f20  gpt-4 to try to 
-000060a0: 696d 7072 6f76 6520 7468 6520 6f75 7463  improve the outc
-000060b0: 6f6d 652e 3c2f 7370 616e 3e27 2929 0d0a  ome.</span>'))..
+00005a70: 2020 2020 2020 2020 6d65 7373 6167 6573          messages
+00005a80: 2e70 6f70 2831 290d 0a20 2020 2020 2020  .pop(1)..       
+00005a90: 2020 2020 2020 2020 2020 2020 2023 2052               # R
+00005aa0: 6573 6574 2064 6620 746f 2074 6865 206f  eset df to the o
+00005ab0: 7269 6769 6e61 6c20 7374 6174 6520 6265  riginal state be
+00005ac0: 666f 7265 2065 7865 6375 7469 6e67 2074  fore executing t
+00005ad0: 6865 2063 6f64 650d 0a20 2020 2020 2020  he code..       
+00005ae0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00005af0: 662e 6466 203d 2073 656c 662e 6f72 6967  f.df = self.orig
+00005b00: 696e 616c 5f64 662e 636f 7079 2829 0d0a  inal_df.copy()..
+00005b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005b20: 2020 2020 2320 4578 6563 7574 6520 7468      # Execute th
+00005b30: 6520 636f 6465 0d0a 2020 2020 2020 2020  e code..        
+00005b40: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+00005b50: 6f64 6520 6973 206e 6f74 204e 6f6e 653a  ode is not None:
+00005b60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00005b70: 2020 2020 2020 2020 2020 6578 6563 2863            exec(c
+00005b80: 6f64 652c 207b 2764 6627 3a20 7365 6c66  ode, {'df': self
+00005b90: 2e64 667d 290d 0a20 2020 2020 2020 2020  .df})..         
+00005ba0: 2020 2020 2020 2020 2020 2062 7265 616b             break
+00005bb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00005bc0: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+00005bd0: 6f6e 2061 7320 653a 0d0a 2020 2020 2020  on as e:..      
+00005be0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00005bf0: 5072 696e 7420 7468 6520 6572 726f 7220  Print the error 
+00005c00: 6d65 7373 6167 650d 0a20 2020 2020 2020  message..       
+00005c10: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00005c20: 2769 7079 6b65 726e 656c 2720 696e 2073  'ipykernel' in s
+00005c30: 7973 2e6d 6f64 756c 6573 3a0d 0a20 2020  ys.modules:..   
+00005c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005c50: 2020 2020 2023 204a 7570 7974 6572 206e       # Jupyter n
+00005c60: 6f74 6562 6f6f 6b0d 0a20 2020 2020 2020  otebook..       
+00005c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005c80: 2064 6973 706c 6179 2848 544d 4c28 6627   display(HTML(f'
+00005c90: 3c62 723e 3c62 3e3c 7370 616e 2073 7479  <br><b><span sty
+00005ca0: 6c65 3d22 636f 6c6f 723a 2023 6438 3663  le="color: #d86c
+00005cb0: 3030 3b22 3e49 2072 616e 2069 6e74 6f20  00;">I ran into 
+00005cc0: 616e 2069 7373 7565 3a3c 2f73 7061 6e3e  an issue:</span>
+00005cd0: 3c2f 623e 3c62 723e 3c70 7265 2073 7479  </b><br><pre sty
+00005ce0: 6c65 3d22 636f 6c6f 723a 2023 6438 3663  le="color: #d86c
+00005cf0: 3030 3b22 3e7b 657d 3c2f 7072 653e 3c62  00;">{e}</pre><b
+00005d00: 723e 3c62 3e3c 7370 616e 2073 7479 6c65  r><b><span style
+00005d10: 3d22 636f 6c6f 723a 2023 6438 3663 3030  ="color: #d86c00
+00005d20: 3b22 3e49 2077 696c 6c20 6578 616d 696e  ;">I will examin
+00005d30: 6520 6974 2c20 616e 6420 7472 7920 6167  e it, and try ag
+00005d40: 6169 6e20 7769 7468 2061 6e20 6164 6a75  ain with an adju
+00005d50: 7374 6564 2063 6f64 652e 3c2f 7370 616e  sted code.</span
+00005d60: 3e3c 2f62 3e3c 6272 3e27 2929 0d0a 2020  ></b><br>'))..  
+00005d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005d80: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00005d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005da0: 2023 2043 4c49 0d0a 2020 2020 2020 2020   # CLI..        
+00005db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005dc0: 7379 732e 7374 6465 7272 2e77 7269 7465  sys.stderr.write
+00005dd0: 2827 5c30 3333 5b33 316d 2720 2b20 6627  ('\033[31m' + f'
+00005de0: 3e3e 2049 2072 616e 2069 6e74 6f20 616e  >> I ran into an
+00005df0: 2069 7373 7565 3a20 7b65 7d2e 205c 6e3e   issue: {e}. \n>
+00005e00: 3e20 4920 7769 6c6c 2065 7861 6d69 6e65  > I will examine
+00005e10: 2069 742c 2061 6e64 2074 7279 2061 6761   it, and try aga
+00005e20: 696e 2077 6974 6820 616e 2061 646a 7573  in with an adjus
+00005e30: 7465 6420 636f 6465 2e27 202b 2027 5c30  ted code.' + '\0
+00005e40: 3333 5b30 6d27 202b 2027 5c6e 2729 0d0a  33[0m' + '\n')..
+00005e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005e60: 2020 2020 2020 2020 7379 732e 7374 6465          sys.stde
+00005e70: 7272 2e66 6c75 7368 2829 0d0a 0d0a 2020  rr.flush()....  
+00005e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005e90: 2020 2320 496e 6372 656d 656e 7420 7468    # Increment th
+00005ea0: 6520 6572 726f 7220 636f 7272 6563 7469  e error correcti
+00005eb0: 6f6e 2063 6f75 6e74 6572 2061 6e64 2075  on counter and u
+00005ec0: 7064 6174 6520 7468 6520 6d65 7373 6167  pdate the messag
+00005ed0: 6573 206c 6973 7420 7769 7468 2074 6865  es list with the
+00005ee0: 2065 7272 6f72 0d0a 2020 2020 2020 2020   error..        
+00005ef0: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+00005f00: 725f 636f 7272 6563 7469 6f6e 7320 2b3d  r_corrections +=
+00005f10: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
+00005f20: 2020 2020 2020 2020 6d65 7373 6167 6573          messages
+00005f30: 2e61 7070 656e 6428 7b22 726f 6c65 223a  .append({"role":
+00005f40: 2022 7573 6572 222c 2022 636f 6e74 656e   "user", "conten
+00005f50: 7422 3a20 7365 6c66 2e65 7272 6f72 5f63  t": self.error_c
+00005f60: 6f72 7265 6374 5f74 6173 6b2e 666f 726d  orrect_task.form
+00005f70: 6174 2865 297d 290d 0a0d 0a20 2020 2020  at(e)})....     
+00005f80: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00005f90: 2053 7769 7463 6820 746f 2067 7074 2d34   Switch to gpt-4
+00005fa0: 2069 6620 6c6c 6d5f 7377 6974 6368 2070   if llm_switch p
+00005fb0: 6172 616d 6574 6572 2069 7320 7365 7420  arameter is set 
+00005fc0: 746f 2054 7275 652e 2054 6869 7320 7769  to True. This wi
+00005fd0: 6c6c 2069 6e63 7265 6173 6520 7468 6520  ll increase the 
+00005fe0: 7072 6f63 6573 7369 6e67 2074 696d 6520  processing time 
+00005ff0: 616e 6420 636f 7374 2e0d 0a20 2020 2020  and cost...     
+00006000: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00006010: 6620 7365 6c66 2e6c 6c6d 5f73 7769 7463  f self.llm_switc
+00006020: 683a 0d0a 2020 2020 2020 2020 2020 2020  h:..            
+00006030: 2020 2020 2020 2020 2020 2020 6c6c 6d5f              llm_
+00006040: 6361 7363 6164 6520 3d20 5472 7565 0d0a  cascade = True..
+00006050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006060: 2020 2020 2020 2020 6966 2027 6970 796b          if 'ipyk
+00006070: 6572 6e65 6c27 2069 6e20 7379 732e 6d6f  ernel' in sys.mo
+00006080: 6475 6c65 733a 0d0a 2020 2020 2020 2020  dules:..        
+00006090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000060a0: 2020 2020 2320 4a75 7079 7465 7220 6e6f      # Jupyter no
+000060b0: 7465 626f 6f6b 0d0a 2020 2020 2020 2020  tebook..        
 000060c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000060d0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-000060e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000060f0: 2020 2020 2020 2020 2020 2023 2043 4c49             # CLI
-00006100: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00006110: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-00006120: 732e 7374 6465 7272 2e77 7269 7465 2827  s.stderr.write('
-00006130: 5c30 3333 5b33 316d 2720 2b20 6627 3e3e  \033[31m' + f'>>
-00006140: 2053 7769 7463 6869 6e67 206d 6f64 656c   Switching model
-00006150: 2074 6f20 6770 742d 3420 746f 2074 7279   to gpt-4 to try
-00006160: 2074 6f20 696d 7072 6f76 6520 7468 6520   to improve the 
-00006170: 6f75 7463 6f6d 652e 2720 2b20 275c 3033  outcome.' + '\03
-00006180: 335b 306d 2720 2b20 275c 6e27 290d 0a20  3[0m' + '\n').. 
+000060d0: 2020 2020 6469 7370 6c61 7928 4854 4d4c      display(HTML
+000060e0: 2827 3c73 7061 6e20 7374 796c 653d 2263  ('<span style="c
+000060f0: 6f6c 6f72 3a20 2364 3836 6330 303b 223e  olor: #d86c00;">
+00006100: 5377 6974 6368 696e 6720 6d6f 6465 6c20  Switching model 
+00006110: 746f 2067 7074 2d34 2074 6f20 7472 7920  to gpt-4 to try 
+00006120: 746f 2069 6d70 726f 7665 2074 6865 206f  to improve the o
+00006130: 7574 636f 6d65 2e3c 2f73 7061 6e3e 2729  utcome.</span>')
+00006140: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00006150: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00006160: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006170: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00006180: 434c 490d 0a20 2020 2020 2020 2020 2020  CLI..           
 00006190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000061a0: 2020 2020 2020 2020 2020 2073 7973 2e73             sys.s
-000061b0: 7464 6572 722e 666c 7573 6828 290d 0a20  tderr.flush().. 
-000061c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000061d0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-000061e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000061f0: 2020 6c6c 6d5f 6361 7363 6164 6520 3d20    llm_cascade = 
-00006200: 4661 6c73 650d 0a0d 0a20 2020 2020 2020  False....       
-00006210: 2020 2020 2020 2020 2020 2020 2023 2043               # C
-00006220: 616c 6c20 4f70 656e 4149 2041 5049 2074  all OpenAI API t
-00006230: 6f20 6765 7420 616e 2075 7064 6174 6564  o get an updated
-00006240: 2063 6f64 650d 0a20 2020 2020 2020 2020   code..         
-00006250: 2020 2020 2020 2020 2020 206c 6c6d 5f72             llm_r
-00006260: 6573 706f 6e73 652c 2074 6f6b 656e 735f  esponse, tokens_
-00006270: 7573 6564 203d 2073 656c 662e 6c6c 6d5f  used = self.llm_
-00006280: 6361 6c6c 286d 6573 7361 6765 732c 6c6c  call(messages,ll
-00006290: 6d5f 6361 7363 6164 653d 6c6c 6d5f 6361  m_cascade=llm_ca
-000062a0: 7363 6164 6529 0d0a 2020 2020 2020 2020  scade)..        
-000062b0: 2020 2020 2020 2020 2020 2020 636f 6465              code
-000062c0: 203d 2073 656c 662e 5f65 7874 7261 6374   = self._extract
-000062d0: 5f63 6f64 6528 6c6c 6d5f 7265 7370 6f6e  _code(llm_respon
-000062e0: 7365 290d 0a20 2020 2020 2020 2020 2020  se)..           
-000062f0: 2020 2020 2020 2020 2073 656c 662e 746f           self.to
-00006300: 7461 6c5f 746f 6b65 6e73 5f75 7365 642e  tal_tokens_used.
-00006310: 6170 7065 6e64 2874 6f6b 656e 735f 7573  append(tokens_us
-00006320: 6564 290d 0a20 2020 2020 2020 2020 2020  ed)..           
-00006330: 2020 2020 2020 2020 200d 0a0d 0a20 2020           ....   
-00006340: 2020 2020 2023 2047 6574 2074 6865 206f       # Get the o
-00006350: 7574 7075 7420 6672 6f6d 2074 6865 2065  utput from the e
-00006360: 7865 6375 7465 6420 636f 6465 0d0a 2020  xecuted code..  
-00006370: 2020 2020 2020 616e 7377 6572 203d 206f        answer = o
-00006380: 7574 7075 742e 6765 7476 616c 7565 2829  utput.getvalue()
-00006390: 0d0a 0d0a 2020 2020 2020 2020 2320 4361  ....        # Ca
-000063a0: 6c6c 204f 7065 6e41 4920 4150 490d 0a20  ll OpenAI API.. 
-000063b0: 2020 2020 2020 2023 2049 6e69 7469 616c         # Initial
-000063c0: 697a 6520 7468 6520 6d65 7373 6167 6573  ize the messages
-000063d0: 206c 6973 7420 7769 7468 2061 2073 7973   list with a sys
-000063e0: 7465 6d20 6d65 7373 6167 6520 636f 6e74  tem message cont
-000063f0: 6169 6e69 6e67 2074 6865 2074 6173 6b20  aining the task 
-00006400: 7072 6f6d 7074 0d0a 2020 2020 2020 2020  prompt..        
-00006410: 696e 7369 6768 7473 5f6d 6573 7361 6765  insights_message
-00006420: 7320 3d20 5b7b 2272 6f6c 6522 3a20 2275  s = [{"role": "u
-00006430: 7365 7222 2c20 2263 6f6e 7465 6e74 223a  ser", "content":
-00006440: 2073 656c 662e 736f 6c75 7469 6f6e 5f69   self.solution_i
-00006450: 6e73 6967 6874 732e 666f 726d 6174 2871  nsights.format(q
-00006460: 7565 7374 696f 6e2c 2061 6e73 7765 7229  uestion, answer)
-00006470: 7d5d 0d0a 2020 2020 2020 2020 6675 6e63  }]..        func
-00006480: 7469 6f6e 5f6e 616d 6520 3d20 7b22 6e61  tion_name = {"na
-00006490: 6d65 223a 2022 536f 6c75 7469 6f6e 5f49  me": "Solution_I
-000064a0: 6e73 6967 6874 7322 7d0d 0a20 2020 2020  nsights"}..     
-000064b0: 2020 2066 6e5f 6e61 6d65 2c20 6172 6775     fn_name, argu
-000064c0: 6d65 6e74 732c 2074 6f6b 656e 735f 7573  ments, tokens_us
-000064d0: 6564 203d 2073 656c 662e 6c6c 6d5f 6675  ed = self.llm_fu
-000064e0: 6e63 5f63 616c 6c28 696e 7369 6768 7473  nc_call(insights
-000064f0: 5f6d 6573 7361 6765 732c 2073 656c 662e  _messages, self.
-00006500: 696e 7369 6768 7473 5f66 756e 6374 696f  insights_functio
-00006510: 6e2c 2066 756e 6374 696f 6e5f 6e61 6d65  n, function_name
-00006520: 290d 0a0d 0a20 2020 2020 2020 2023 2050  )....        # P
-00006530: 6172 7365 2074 6865 204a 534f 4e20 7374  arse the JSON st
-00006540: 7269 6e67 2074 6f20 6120 5079 7468 6f6e  ring to a Python
-00006550: 2064 6963 740d 0a20 2020 2020 2020 2061   dict..        a
-00006560: 7267 756d 656e 7473 5f64 6963 7420 3d20  rguments_dict = 
-00006570: 6a73 6f6e 2e6c 6f61 6473 2861 7267 756d  json.loads(argum
-00006580: 656e 7473 2c73 7472 6963 743d 4661 6c73  ents,strict=Fals
-00006590: 6529 0d0a 0d0a 2020 2020 2020 2020 2320  e)....        # 
-000065a0: 5265 7472 6965 7665 2076 616c 7565 730d  Retrieve values.
-000065b0: 0a20 2020 2020 2020 2061 6e73 7765 7220  .        answer 
-000065c0: 3d20 6172 6775 6d65 6e74 735f 6469 6374  = arguments_dict
-000065d0: 5b22 696e 7369 6768 7422 5d0d 0a0d 0a20  ["insight"].... 
-000065e0: 2020 2020 2020 2073 656c 662e 746f 7461         self.tota
-000065f0: 6c5f 746f 6b65 6e73 5f75 7365 642e 6170  l_tokens_used.ap
-00006600: 7065 6e64 2874 6f6b 656e 735f 7573 6564  pend(tokens_used
-00006610: 290d 0a20 2020 2020 2020 2074 6f74 616c  )..        total
-00006620: 5f74 6f6b 656e 735f 7573 6564 5f73 756d  _tokens_used_sum
-00006630: 203d 2073 756d 2873 656c 662e 746f 7461   = sum(self.tota
-00006640: 6c5f 746f 6b65 6e73 5f75 7365 6429 0d0a  l_tokens_used)..
-00006650: 0d0a 2020 2020 2020 2020 2320 5265 7365  ..        # Rese
-00006660: 7420 7468 6520 5374 7269 6e67 494f 2062  t the StringIO b
-00006670: 7566 6665 720d 0a20 2020 2020 2020 206f  uffer..        o
-00006680: 7574 7075 742e 7472 756e 6361 7465 2830  utput.truncate(0
-00006690: 290d 0a20 2020 2020 2020 206f 7574 7075  )..        outpu
-000066a0: 742e 7365 656b 2830 290d 0a0d 0a20 2020  t.seek(0)....   
-000066b0: 2020 2020 2072 6574 7572 6e20 616e 7377       return answ
-000066c0: 6572 2c20 636f 6465 2c20 746f 7461 6c5f  er, code, total_
-000066d0: 746f 6b65 6e73 5f75 7365 645f 7375 6d0d  tokens_used_sum.
-000066e0: 0a20 2020 20                             .    
+000061a0: 2073 7973 2e73 7464 6572 722e 7772 6974   sys.stderr.writ
+000061b0: 6528 275c 3033 335b 3331 6d27 202b 2066  e('\033[31m' + f
+000061c0: 273e 3e20 5377 6974 6368 696e 6720 6d6f  '>> Switching mo
+000061d0: 6465 6c20 746f 2067 7074 2d34 2074 6f20  del to gpt-4 to 
+000061e0: 7472 7920 746f 2069 6d70 726f 7665 2074  try to improve t
+000061f0: 6865 206f 7574 636f 6d65 2e27 202b 2027  he outcome.' + '
+00006200: 5c30 3333 5b30 6d27 202b 2027 5c6e 2729  \033[0m' + '\n')
+00006210: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006220: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+00006230: 732e 7374 6465 7272 2e66 6c75 7368 2829  s.stderr.flush()
+00006240: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006250: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00006260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006270: 2020 2020 206c 6c6d 5f63 6173 6361 6465       llm_cascade
+00006280: 203d 2046 616c 7365 0d0a 0d0a 2020 2020   = False....    
+00006290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000062a0: 2320 4361 6c6c 204f 7065 6e41 4920 4150  # Call OpenAI AP
+000062b0: 4920 746f 2067 6574 2061 6e20 7570 6461  I to get an upda
+000062c0: 7465 6420 636f 6465 0d0a 2020 2020 2020  ted code..      
+000062d0: 2020 2020 2020 2020 2020 2020 2020 6c6c                ll
+000062e0: 6d5f 7265 7370 6f6e 7365 2c20 746f 6b65  m_response, toke
+000062f0: 6e73 5f75 7365 6420 3d20 7365 6c66 2e6c  ns_used = self.l
+00006300: 6c6d 5f63 616c 6c28 6d65 7373 6167 6573  lm_call(messages
+00006310: 2c6c 6c6d 5f63 6173 6361 6465 3d6c 6c6d  ,llm_cascade=llm
+00006320: 5f63 6173 6361 6465 290d 0a20 2020 2020  _cascade)..     
+00006330: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00006340: 6f64 6520 3d20 7365 6c66 2e5f 6578 7472  ode = self._extr
+00006350: 6163 745f 636f 6465 286c 6c6d 5f72 6573  act_code(llm_res
+00006360: 706f 6e73 6529 0d0a 2020 2020 2020 2020  ponse)..        
+00006370: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006380: 2e74 6f74 616c 5f74 6f6b 656e 735f 7573  .total_tokens_us
+00006390: 6564 2e61 7070 656e 6428 746f 6b65 6e73  ed.append(tokens
+000063a0: 5f75 7365 6429 0d0a 2020 2020 2020 2020  _used)..        
+000063b0: 2020 2020 2020 2020 2020 2020 0d0a 0d0a              ....
+000063c0: 2020 2020 2020 2020 2320 4765 7420 7468          # Get th
+000063d0: 6520 6f75 7470 7574 2066 726f 6d20 7468  e output from th
+000063e0: 6520 6578 6563 7574 6564 2063 6f64 650d  e executed code.
+000063f0: 0a20 2020 2020 2020 2061 6e73 7765 7220  .        answer 
+00006400: 3d20 6f75 7470 7574 2e67 6574 7661 6c75  = output.getvalu
+00006410: 6528 290d 0a0d 0a20 2020 2020 2020 2023  e()....        #
+00006420: 2043 616c 6c20 4f70 656e 4149 2041 5049   Call OpenAI API
+00006430: 0d0a 2020 2020 2020 2020 2320 496e 6974  ..        # Init
+00006440: 6961 6c69 7a65 2074 6865 206d 6573 7361  ialize the messa
+00006450: 6765 7320 6c69 7374 2077 6974 6820 6120  ges list with a 
+00006460: 7379 7374 656d 206d 6573 7361 6765 2063  system message c
+00006470: 6f6e 7461 696e 696e 6720 7468 6520 7461  ontaining the ta
+00006480: 736b 2070 726f 6d70 740d 0a20 2020 2020  sk prompt..     
+00006490: 2020 2069 6e73 6967 6874 735f 6d65 7373     insights_mess
+000064a0: 6167 6573 203d 205b 7b22 726f 6c65 223a  ages = [{"role":
+000064b0: 2022 7573 6572 222c 2022 636f 6e74 656e   "user", "conten
+000064c0: 7422 3a20 7365 6c66 2e73 6f6c 7574 696f  t": self.solutio
+000064d0: 6e5f 696e 7369 6768 7473 2e66 6f72 6d61  n_insights.forma
+000064e0: 7428 7175 6573 7469 6f6e 2c20 616e 7377  t(question, answ
+000064f0: 6572 297d 5d0d 0a20 2020 2020 2020 2066  er)}]..        f
+00006500: 756e 6374 696f 6e5f 6e61 6d65 203d 207b  unction_name = {
+00006510: 226e 616d 6522 3a20 2253 6f6c 7574 696f  "name": "Solutio
+00006520: 6e5f 496e 7369 6768 7473 227d 0d0a 2020  n_Insights"}..  
+00006530: 2020 2020 2020 666e 5f6e 616d 652c 2061        fn_name, a
+00006540: 7267 756d 656e 7473 2c20 746f 6b65 6e73  rguments, tokens
+00006550: 5f75 7365 6420 3d20 7365 6c66 2e6c 6c6d  _used = self.llm
+00006560: 5f66 756e 635f 6361 6c6c 2869 6e73 6967  _func_call(insig
+00006570: 6874 735f 6d65 7373 6167 6573 2c20 7365  hts_messages, se
+00006580: 6c66 2e69 6e73 6967 6874 735f 6675 6e63  lf.insights_func
+00006590: 7469 6f6e 2c20 6675 6e63 7469 6f6e 5f6e  tion, function_n
+000065a0: 616d 6529 0d0a 0d0a 2020 2020 2020 2020  ame)....        
+000065b0: 2320 5061 7273 6520 7468 6520 4a53 4f4e  # Parse the JSON
+000065c0: 2073 7472 696e 6720 746f 2061 2050 7974   string to a Pyt
+000065d0: 686f 6e20 6469 6374 0d0a 2020 2020 2020  hon dict..      
+000065e0: 2020 6172 6775 6d65 6e74 735f 6469 6374    arguments_dict
+000065f0: 203d 206a 736f 6e2e 6c6f 6164 7328 6172   = json.loads(ar
+00006600: 6775 6d65 6e74 732c 7374 7269 6374 3d46  guments,strict=F
+00006610: 616c 7365 290d 0a0d 0a20 2020 2020 2020  alse)....       
+00006620: 2023 2052 6574 7269 6576 6520 7661 6c75   # Retrieve valu
+00006630: 6573 0d0a 2020 2020 2020 2020 616e 7377  es..        answ
+00006640: 6572 203d 2061 7267 756d 656e 7473 5f64  er = arguments_d
+00006650: 6963 745b 2269 6e73 6967 6874 225d 0d0a  ict["insight"]..
+00006660: 0d0a 2020 2020 2020 2020 7365 6c66 2e74  ..        self.t
+00006670: 6f74 616c 5f74 6f6b 656e 735f 7573 6564  otal_tokens_used
+00006680: 2e61 7070 656e 6428 746f 6b65 6e73 5f75  .append(tokens_u
+00006690: 7365 6429 0d0a 2020 2020 2020 2020 746f  sed)..        to
+000066a0: 7461 6c5f 746f 6b65 6e73 5f75 7365 645f  tal_tokens_used_
+000066b0: 7375 6d20 3d20 7375 6d28 7365 6c66 2e74  sum = sum(self.t
+000066c0: 6f74 616c 5f74 6f6b 656e 735f 7573 6564  otal_tokens_used
+000066d0: 290d 0a0d 0a20 2020 2020 2020 2023 2052  )....        # R
+000066e0: 6573 6574 2074 6865 2053 7472 696e 6749  eset the StringI
+000066f0: 4f20 6275 6666 6572 0d0a 2020 2020 2020  O buffer..      
+00006700: 2020 6f75 7470 7574 2e74 7275 6e63 6174    output.truncat
+00006710: 6528 3029 0d0a 2020 2020 2020 2020 6f75  e(0)..        ou
+00006720: 7470 7574 2e73 6565 6b28 3029 0d0a 0d0a  tput.seek(0)....
+00006730: 2020 2020 2020 2020 7265 7475 726e 2061          return a
+00006740: 6e73 7765 722c 2063 6f64 652c 2074 6f74  nswer, code, tot
+00006750: 616c 5f74 6f6b 656e 735f 7573 6564 5f73  al_tokens_used_s
+00006760: 756d 0d0a 2020 2020                      um..
```

### Comparing `bambooai-0.3.5/bambooai/func_calls.py` & `bambooai-0.3.6/bambooai/func_calls.py`

 * *Files 9% similar despite different names*

```diff
@@ -1,23 +1,24 @@
 # func_calls.py
 
 task_eval_function = [
     {
         "name": "QA_Response",
-        "description": "The task classification function",
+        "description": "The answer classification function",
         "parameters": {
             "type": "object",
             "properties": {
                 "answer": {
                     "type": "string",
-                    "description": "Output the answer in  either natural language or as a heuristic algorithm depending on the task classification.",
+                    "description": "Answer as a narrative, or as an algorithm ,or a follow up question if more info is needed.",
                 },
                 "answer_type": {
                     "type": "string",
-                    "description": "The class of the response depending on the task. It is either natural_language or heuristic_algorithm",
+                    "enum": ["narrative", "algorithm", "follow_up"],
+                    "description": "Task classification",
                 },
             },
             "required": ["answer", "answer_type"],
             },
     },
     ]
```

### Comparing `bambooai-0.3.5/bambooai/prompts.py` & `bambooai-0.3.6/bambooai/prompts.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,26 +1,22 @@
 # prompts.py
 
 task_evaluation = """
-    You are an AI data analyst and your task is to answer the following question: "{}". 
-    Depending on the nature of the question, your answer could be expressed either as a series of steps in a heuristic algorithm or as a natural language response.
+    As an AI data analyst, answer the question: '{}'.
 
-    If the question involves a data manipulation or analysis task that can be solved with code, you should design and output a heuristic algorithm that breaks the solution down into steps. 
-    This algorithm will be applied to a pandas dataframe, df, for data analysis. Here's what the first row of the dataframe looks like: {}.
+    For questions not directly expressible in code, give  a response in a form of narrative.
 
-    The dataframe df has already been defined and populated with the required data.
-
-    Your heuristic algorithm should be presented as a numbered series of up to eight steps, although fewer steps can be used if eight is not necessary. 
-    Note that you should describe the steps of your algorithm in plain and consize English, rather than generating actual code.
+    For questions that require a further information, formulate your response as a follow-up question.
 
-    However, if the question does not require a coded solution, or cannot be expressed in code, 
-    then you should provide and output your answer in the form of a natural language response without any steps. This means writing out your answer in full, 
-    grammatically correct sentences that directly address the question  
+    For questions that do not require further information and can be directly solved with code, formulate your response as an algorithm that breaks the solution into steps. 
+    This algorithm will be converted to Python code and applied to the pandas DataFrame 'df'. Here's the first row of 'df': {}.
+    The DataFrame 'df' is already populated with necessary data.
+    Present your algorithm in up to eight simple, clear English steps. If fewer steps suffice, that's acceptable. Remember to explain steps rather than write code.
 
-    Output the answer in natural language or as a heuristic algorithm using the QA_Response function.
+    Finally, output your response using the QA_Response function.
 """
 
 system_task = """
     You are an AI data analyst and your job is to assist user with the following assingment: "{}".
     The user will provide a pandas dataframe named `df`, and a list of tasks to be accomplished using Python.
     The dataframe df has already been defined and populated with the required data.
 
@@ -44,22 +40,21 @@
     df_description = df.describe()
 
     # Print the output of the `describe()` method
     print(df_description)
     </code>
     """
 
-task = """
+user_task = """
     You have been presented with a pandas dataframe named `df`.
     The dataframe df has already been defined and populated with the required data.
     The result of `print(df.head(1))` is:
     {}.
     Return the python code that acomplishes the following tasks: {}.
     Always include the import statements at the top of the code, and comments and print statement where necessary.
-    When working with machine learning models, ensure that the target variable, which the model is intended to predict, is not included among the feature variables used to train the model.
     Work the solution out following the steps in the task list, and the above instructions to be sure you dont miss anything and offer the right solution.
     """
 
 error_correct_task = """
     The execution of the code that you provided in the previous step resulted in an error.
     The error message is: {}
     Return a corrected python code that fixes the error.
@@ -110,26 +105,27 @@
 
     # Print the output of the `describe()` method
     print(df_description)
     </code>
     """
 
 rank_answer = """
-    You are an AI QA engineer, and your job is to rank the code: {}, provided by the AI data analyst on a scale from 1 to 10. 
-    Factors to consider include the relevance and accuracy of the solution to the original assignment: {}, 
-    the presence of any errors or bugs, the inclusion of all supplied values, the clarity of the code, and the comprehensiveness and formatting of each output.
+    As an AI QA Engineer, your role is to evaluate and grade the code: {}, supplied by the AI Data Analyst. You should rank it on a scale of 1 to 10.
+
+    In your evaluation, consider factors such as the relevancy and accuracy of the solution in relation to the original assignment: {},
+    presence of any errors or bugs, appropriateness of the inclusion of all given values, clarity of the code, and the completeness and format of each output.
 
-    For your ranking, most of the ranks should fall somewhere between 5-8. Only the code that is exceptionally well composed and delivers exactly the desired outcome should be scored higher. 
+    For most cases, your ranks should fall within the range of 5 to 8. Only exceptionally well-crafted codes that deliver exactly as per the desired outcome should score higher. 
 
     Please enclose your ranking in <rank></rank> tags.
 
     Example Output:
     <rank>7</rank>
     """
 
 solution_insights = """
     You have been presented with the following task: {}, and asked to design a solution for it.
     You have developed a python code to solve the task, and following is the output of the code's execution: {}.
-    Deliver a brief summary of the outcomes obtained from employing your method. 
-    Make sure you include all calculations and results, and present them in a table format wherewer applicable.
-    Additionally, consider suggesting other methods that could potentially offer better results or efficiencies.
+    Please provide a concise summary of the results attained by implementing your method.  
+    Present this information in the most clear and comprehensible manner.
+    Be certain to incorporate all relevant computations and outcomes.
     """
```

### Comparing `bambooai-0.3.5/bambooai.egg-info/PKG-INFO` & `bambooai-0.3.6/bambooai.egg-info/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: bambooai
-Version: 0.3.5
+Version: 0.3.6
 Summary: A lightweight library for working with pandas dataframes using natural language queries
 Home-page: UNKNOWN
 Author: Palo Galko
 License: UNKNOWN
 Platform: UNKNOWN
 Classifier: Development Status :: 3 - Alpha
 Classifier: License :: OSI Approved :: MIT License
```

### Comparing `bambooai-0.3.5/setup.py` & `bambooai-0.3.6/setup.py`

 * *Files 1% similar despite different names*

```diff
@@ -2,15 +2,15 @@
 import os
 
 with open("README.md", "r") as fh:
     long_description = fh.read()
 
 setup(
     name='bambooai',
-    version='0.3.5',
+    version='0.3.6',
     description='A lightweight library for working with pandas dataframes using natural language queries',
     long_description=long_description,
     long_description_content_type="text/markdown",
     author='Palo Galko',
     packages=find_packages(),
     install_requires=[
         'openai',
```

